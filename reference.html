<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 1.5.6.1">
<title>Reference</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<link rel="stylesheet" href="./asciidoctor.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.min.css">
<link rel="stylesheet" href="./coderay-asciidoctor.css">
<script type="text/javascript" src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
<script type="text/javascript" src="//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/js/bootstrap.min.js"></script>
<script type="text/javascript" src=".//javascripts/menu.js"></script>
<script type="text/javascript" src=".//javascripts/sidebar.js"></script>
<script type="text/javascript" src=".//javascripts/steps.js"></script>
<script type="text/javascript" src=".//javascripts/sourcecode/source-utils.js"></script>
<script type="text/javascript" src=".//javascripts/sourcecode/highlight-lines.js"></script>
<script type="text/javascript" src=".//javascripts/sourcecode/collapse-lines.js"></script>
<script type="text/javascript" src=".//javascripts/tabcontainer.js"></script>
<script type="text/javascript" src="//unpkg.com/clipboard@2.0.0/dist/clipboard.min.js"></script>
<script type="text/javascript" src=".//javascripts/clipboard.js"></script>
<script src="https://cdn.jsdelivr.net/npm/instantsearch.js@2.3/dist/instantsearch.min.js"></script>
<script type="text/javascript" src=".//javascripts/search.js"></script>
<!-- <link rel="stylesheet" type="text/css" href="http://netdna.bootstrapcdn.com/bootswatch/2.3.2/united/bootstrap.min.css" />
  <link rel="stylesheet" type="text/css" href="http://netdna.bootstrapcdn.com/twitter-bootstrap/2.3.1/css/bootstrap-responsive.min.css"
  /> -->
<link href="//fonts.googleapis.com/css?family=Open+Sans:300,400,600,800" rel="stylesheet">
<link rel="stylesheet" type="text/css" href=".//styles/zetapush-styles.css" />
<link rel="stylesheet" type="text/css" href=".//styles/custom-styles.css" />
<link rel="stylesheet" type="text/css" href=".//styles/tabcontainer.css" />
<link rel="stylesheet" type="text/css" href=".//styles/steps.css" />
<link rel="stylesheet" type="text/css" href=".//styles/sourcecode/collapse-lines.css" />
<link rel="stylesheet" type="text/css" href=".//styles/sourcecode/highlight-lines.css" />
<link rel="stylesheet" type="text/css" href=".//styles/clipboard.css" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/instantsearch.js@2.3/dist/instantsearch.min.css">
<script type="text/html" id="hit-template">
  <div class="hit">
    <div class="hit-content">
      <div class="context">
        <a href="{{sourceFile.url}}">{{sourceFile.title}}</a>
        {{#parents}}
          <a href="{{url}}">{{title}}</a>
        {{/parents}}
        <a href="{{url}}">{{{_highlightResult.title.value}}}</a>
      </div>
      <pre class="hit-description">{{{_highlightResult.content.value}}}</pre>
    </div>
  </div>
</script>
<header>
  <nav>
    <div class="main-title"><span></span><i class="fa fa-caret-down"></i></div>
    <ul>
      <li><a href="/documentation"><span>ZetaPush documentation</span><i class="fa fa-angle-right"></i></a></li>
      <li><a href="/documentation/getting-started.html"><span>Getting Started</span><i class="fa fa-angle-right"></i></a></li>
      <li><a href="/documentation/developer-manual.html"><span>Developer manual</span><i class="fa fa-angle-right"></i></a></li>
      <li><a href="/documentation/how-to.html"><span>How to guides</span><i class="fa fa-angle-right"></i></a></li>
      <li><a href="/documentation/tutorials.html"><span>Tutorials</span><i class="fa fa-angle-right"></i></a></li>
      <li><a href="/documentation/reference.html"><span>Reference</span><i class="fa fa-angle-right"></i></a></li>
      <li><a href="http://docv2.zetapush.com"><span>Documentation v2</span><i class="fa fa-angle-right"></i></a></li>
    </ul>
    <div>
      <div class="contact-us">
        <a href="https://www.zetapush.com/contact" target="_blank">Contact us</a>
      </div>
      <div class="github">
        <a href="https://github.com/zetapush" target="_blank">
          <span>Join us on</span><i class="fa fa-github-alt" title="Github"></i></a>
      </div>
      <div class="search">
        <input id="search-input" placeholder="Search for products">
        <div class="search-results">
          <div id="search-hits"></div>
        </div>
      </div>
      <div class="logo">
        <a href="https://www.zetapush.com"><span class="icon"></span></a>
      </div>
    </div>
  </nav>
</header>
</head>
<body class="book toc2 toc-left">
<div id="header">
<h1>Reference</h1>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_zetapush_management">ZetaPush management</a>
<ul class="sectlevel2">
<li><a href="#_manage_zetapush_account">Manage ZetaPush account</a></li>
<li><a href="#manage_organization">Manage your organization</a></li>
<li><a href="#_manage_applications">Manage applications</a></li>
<li><a href="#manage_environments">Manage environments</a></li>
</ul>
</li>
<li><a href="#_architecture">Architecture</a>
<ul class="sectlevel2">
<li><a href="#_general_architecture">General architecture</a></li>
<li><a href="#_zetapush_choices">ZetaPush choices</a></li>
<li><a href="#_application_code_structure">Application code structure</a></li>
</ul>
</li>
<li><a href="#_zetapush_development_concepts">ZetaPush development concepts</a>
<ul class="sectlevel2">
<li><a href="#_npm_modules_provided_by_zetapush">Npm modules provided by ZetaPush</a></li>
<li><a href="#dependency_injection">Dependency injection</a></li>
<li><a href="#modules">Modules</a></li>
<li><a href="#_current_running_context">Current running context</a></li>
</ul>
</li>
<li><a href="#_develop_with_zetapush">Develop with ZetaPush</a>
<ul class="sectlevel2">
<li><a href="#_develop_your_front_only">Develop your front only</a></li>
<li><a href="#generate_sdks">Generate SDKs from custom cloud service code</a></li>
<li><a href="#develop_custom_cloud_services">Develop custom cloud services</a></li>
<li><a href="#_advanced_usage_of_cloud_services">Advanced usage of cloud services</a></li>
</ul>
</li>
<li><a href="#_available_cloud_services">Available cloud services</a>
<ul class="sectlevel2">
<li><a href="#_standard_user_workflow">Standard User Workflow</a></li>
<li><a href="#builtin_cloud_services">Technical cloud services</a></li>
</ul>
</li>
<li><a href="#cli">Command Line Interface</a>
<ul class="sectlevel2">
<li><a href="#_config">Config</a></li>
<li><a href="#_run">Run</a></li>
<li><a href="#_push_2">Push</a></li>
<li><a href="#verbosity_level">Change verbosity</a></li>
</ul>
</li>
<li><a href="#_configuration">Configuration</a>
<ul class="sectlevel2">
<li><a href="#_account_configuration">Account configuration</a></li>
<li><a href="#_code_structure_configuration">Code structure configuration</a></li>
<li><a href="#configuration_properties">Configuration properties</a></li>
<li><a href="#_configuration_override">Configuration override</a></li>
<li><a href="#_customize_cloud_services">Customize cloud services</a></li>
</ul>
</li>
<li><a href="#_logs_2">Logs</a>
<ul class="sectlevel2">
<li><a href="#_console_log">Console.log</a></li>
<li><a href="#local_logger">Utility methods provided by @zetapush/common</a></li>
<li><a href="#log_service">Built-in log cloud service</a></li>
<li><a href="#log_with_requestcontext">Logs using requestContext</a></li>
<li><a href="#_use_another_logging_library">Use another logging library</a></li>
<li><a href="#logs_in_web_console">View logs in web console</a></li>
<li><a href="#_persist_logs">Persist logs</a></li>
<li><a href="#_external_log_visualization">External log visualization</a></li>
</ul>
</li>
<li><a href="#_tests">Tests</a>
<ul class="sectlevel2">
<li><a href="#_test_your_custom_cloud_services">Test your custom cloud services</a></li>
<li><a href="#test_in_typescript">Write tests in TypeScript</a></li>
<li><a href="#advanced_mocks">Mocks</a></li>
<li><a href="#test_snapshot">Initialize test with data</a></li>
<li><a href="#_logs_in_tests">Logs in tests</a></li>
</ul>
</li>
<li><a href="#_advanced_run_of_your_application">Advanced run of your application</a>
<ul class="sectlevel2">
<li><a href="#run_worker_only">Run cloud services only</a></li>
<li><a href="#_run_front_only">Run front only</a></li>
</ul>
</li>
<li><a href="#_advanced_deployment_of_your_application">Advanced deployment of your application</a>
<ul class="sectlevel2">
<li><a href="#partial_deployment">Partial deployment</a></li>
<li><a href="#_environment_variables">Environment variables</a></li>
<li><a href="#_custom_npm_registry">Custom npm registry</a></li>
</ul>
</li>
<li><a href="#http_server">HTTP server</a>
<ul class="sectlevel2">
<li><a href="#internal_http_server">HTTP server provided by ZetaPush</a></li>
<li><a href="#custom_http_server">Custom HTTP server</a></li>
</ul>
</li>
<li><a href="#_extend_a_cloud_service">Extend a cloud service</a></li>
</ul>
</div>
</div>
<div id="content">
<div class="sect1">
<h2 id="_zetapush_management"><a class="anchor" href="#_zetapush_management"></a>ZetaPush management</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_manage_zetapush_account"><a class="anchor" href="#_manage_zetapush_account"></a>Manage ZetaPush account</h3>
<div class="paragraph">
<p>The ZetaPush account gives you access to the ZetaPush cloud.
As a developer, you need an account to be authorized to develop your product.
As a manager, you need an account to <a href="#manage_organization">organize your teams</a>.</p>
</div>
<div class="sect3">
<h4 id="_create_your_account"><a class="anchor" href="#_create_your_account"></a>Create your account</h4>
<div class="paragraph">
<p>Currently, the only way to get a ZetaPush account is by contacting us. The aim is to understand your needs
and to advise you even if you just want to test it:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://www.zetapush.com/sign-up-for-a-free-trial/">Signup for a free trial</a></p>
</li>
<li>
<p><a href="https://www.zetapush.com/contact">Contact us for more suitable account</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Your account will be created soon after the first contact and an application that fits your
needs will be available. Then you are ready to start working with ZetaPush.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Soon we will open access to everyone for free trial. Account creation will be available through
our CLI tool, from the main site and the web console.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_manage_your_profile"><a class="anchor" href="#_manage_your_profile"></a>Manage your profile</h4>
<div class="paragraph">
<p>The management of your ZetaPush account and profile will soon be available on the web console.
Now you can <a href="https://www.zetapush.com/contact">contact us</a> if you want us to manage your informations.</p>
</div>
</div>
<div class="sect3">
<h4 id="_delete_your_account"><a class="anchor" href="#_delete_your_account"></a>Delete your account</h4>
<div class="paragraph">
<p>If you want to delete your ZetaPush account, you can contact us:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://www.zetapush.com/contact">Contact us for delete your accounts</a></p>
</li>
</ul>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="title">Permanent deletion</div>
<div class="paragraph">
<p>The removal is irreversible and permanent. All of your applications will be deleted.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="manage_organization"><a class="anchor" href="#manage_organization"></a>Manage your organization</h3>
<div class="paragraph">
<p>An <strong>organization</strong> is a concept to let you work in team.</p>
</div>
<div class="paragraph">
<p>The organization commonly groups all <strong>ZetaPush accounts</strong> of your company.
You can have several applications for your organization and you can manage access rights on applications according to members of your team.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">What is an application</div>
<div class="paragraph">
<p>An application is a logical container designed to perform a group of coordinated tasks or activities for the benefit of the user.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>For example, if you are in the company named "MyCompany" which has two applications named "MyApplication1" and "MyApplication2" :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>One organization is created with the name "MyCompany"</p>
</li>
<li>
<p>Two applications are created and named "MyApplication1" and "MyApplication2"</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The <strong>ZetaPush administrator account</strong> of this organization can access to these two applications. He can also change the access rights  <a href="#access_control_per_application">by application</a>.</p>
</div>
<div class="imageblock center">
<div class="content">
<img src="manage-organization.png" alt="manage organization" width="641" height="377">
</div>
</div>
<div class="paragraph">
<p>In the above example, we have one organization which contains two separate applications.
Each application has 3 users. The users of one application cannot work on the other application.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Manage access rights from web console</div>
<div class="paragraph">
<p>The access rights are managed by ZetaPush for now in order to fit your needs. Thereafter, you will be able to manage them via the <a href="https://console-celtia.zetapush.com"><strong>web console</strong></a>.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_manage_applications"><a class="anchor" href="#_manage_applications"></a>Manage applications</h3>
<div class="paragraph">
<p>An <strong>application</strong> is a logical container designed to perform a group of coordinated tasks or activities for the benefit of the user.</p>
</div>
<div class="sect3">
<h4 id="add_application"><a class="anchor" href="#add_application"></a>Add an application</h4>
<div class="paragraph">
<p>There are several ways to create a new application :</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://www.zetapush.com/sign-up-for-a-free-trial/">Signup for a free trial</a></p>
</li>
<li>
<p><a href="https://www.zetapush.com/contact">Contact us for more suitable application</a></p>
</li>
<li>
<p>Via the <strong>web console</strong> (not available yet)</p>
</li>
<li>
<p>Via the <strong>CLI</strong> (not available yet)</p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="_sign_up_for_a_free_trial"><a class="anchor" href="#_sign_up_for_a_free_trial"></a>Sign up for a free trial</h5>
<div class="paragraph">
<p>When you ask for a free trial, a <strong>ZetaPush account</strong> and an <strong>application</strong> are provided to you.</p>
</div>
<div class="paragraph">
<p>You can ask for a free trial via <a href="https://www.zetapush.com/sign-up-for-a-free-trial/">our web site</a>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Get free trial</div>
<div class="paragraph">
<p>Now, when you asking for a free trial, the <strong>ZetaPush account</strong> and the <strong>application</strong> are created by ZetaPush to fit your needs. Soon we will open access to everyone for get a free trial of 30 days. In this case the account and the application will be automatically created.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_create_application_via_web_console"><a class="anchor" href="#_create_application_via_web_console"></a>Create application via web console</h5>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Create application via web console</div>
<div class="paragraph">
<p>For now, the creation of an application via the <strong>web console</strong> is not available because we want to assist you.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_create_application_via_cli"><a class="anchor" href="#_create_application_via_cli"></a>Create application via CLI</h5>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Create application via CLI</div>
<div class="paragraph">
<p>For now, the creation of an application via the <strong>CLI</strong> is not available because we want to assist you.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="access_control_per_application"><a class="anchor" href="#access_control_per_application"></a>Access control per application</h4>
<div class="paragraph">
<p>As <a href="#manage_organization">seen previously</a>, an <strong>organization</strong> can have several teams or/and several applications. So you may want to control who can work on which application.</p>
</div>
<div class="sect4">
<h5 id="_grant_access_rights"><a class="anchor" href="#_grant_access_rights"></a>Grant access rights</h5>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Contact us to manage access rights</div>
<div class="paragraph">
<p>Security per application is not currently available to our clients. Instead we prefer that you <a href="https://www.zetapush.com/contact">contact us</a> to understand your needs and to guide you how to organize your teams and application.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_remove_access_rights"><a class="anchor" href="#_remove_access_rights"></a>Remove access rights</h5>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Contact us to remove access rights</div>
<div class="paragraph">
<p>Security per application is not currently available to our clients. Instead we prefer that you <a href="https://www.zetapush.com/contact">contact us</a> to understand your needs and to guide you how to organize your teams and application.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="manage_environments"><a class="anchor" href="#manage_environments"></a>Manage environments</h3>
<div class="paragraph">
<p>An <strong>application</strong> is a logical container designed to perform a group of coordinated tasks or activities for the benefit of the user.</p>
</div>
<div class="sect3">
<h4 id="add_environment"><a class="anchor" href="#add_environment"></a>Add an environment</h4>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Environment support</div>
<div class="paragraph">
<p>The <strong>environment</strong> support is not completely done. It will be soon because it is our next high priority. The management of this environments will be done via the <strong>web console</strong>. If you want to use environments you can anyway <a href="https://www.zetapush.com/contact">contact us</a> to manage them for you.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="access_control_per_environment"><a class="anchor" href="#access_control_per_environment"></a>Access control per environment</h4>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Environment support</div>
<div class="paragraph">
<p>The <strong>environment</strong> support is not completely done. It will be soon because it is our next high priority. The access control of the environments will be done via the <strong>web console</strong>. If you want to use environments you can anyway <a href="https://www.zetapush.com/contact">contact us</a> to manage them for you.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_architecture"><a class="anchor" href="#_architecture"></a>Architecture</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_general_architecture"><a class="anchor" href="#_general_architecture"></a>General architecture</h3>
<div class="paragraph">
<p>One of the most important thing to understand with ZetaPush is that you can use it in two steps: The <strong>run</strong> and the <strong>push</strong>. The <code>run</code> mode is when you develop your application, your <strong>worker</strong> is running locally and the <code>push</code> mode is when you have pushed your application on the <strong>ZetaPush Cloud</strong> and that your worker is running on it.</p>
</div>
<div class="imageblock center">
<div class="content">
<img src="process-dev-run-and-push.png" alt="process dev run and push" width="993" height="337">
</div>
<div class="title">Figure 1. Process of development with ZetaPush</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="title">Data between the two phases</div>
<div class="paragraph">
<p>Whether you run or push your application, you use the same data. For example, if you store data during your development phase (using the <code>zeta run</code> command), They will always be present in the database when you will deploy your application with <code>zeta push</code>. For a more comprehensive working, look that scheme below :</p>
</div>
</td>
</tr>
</table>
</div>
<div class="imageblock center">
<div class="content">
<img src="custom-cloud-service-dev.png" alt="custom cloud service dev" width="709" height="430">
</div>
<div class="title">Figure 2. Interactions during development phase</div>
</div>
<div class="paragraph">
<p>Both front and worker are running locally. The front interacts with <em>custom cloud services</em> contained in the worker through
ZetaPush Cloud.
As ZetaPush Cloud provides bidirectional connection, the <em>custom cloud services</em> can also interact with the front through
ZetaPush Cloud too.</p>
</div>
<div class="paragraph">
<p>A <em>custom cloud service</em> can interact with <em>built-in cloud services</em> provided by ZetaPush.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>When you start using ZetaPush, you only develop locally so from your point of vue,
your front seems to directly interact with your <em>custom cloud services</em>.</p>
</div>
<div class="paragraph">
<p>In fact, all messages go through the Internet and ZetaPush Cloud.
It means that a published front can interact with a worker that is running locally and vice versa.</p>
</div>
<div class="paragraph">
<p>See <a href="#mix_local_and_remote">how to mix local worker with worker running in cloud</a></p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_zetapush_choices"><a class="anchor" href="#_zetapush_choices"></a>ZetaPush choices</h3>
<div class="sect3">
<h4 id="_high_availability"><a class="anchor" href="#_high_availability"></a>High availability</h4>
<div class="paragraph">
<p><em>ZetaPush</em> ensures a high-availability of your appplications.</p>
</div>
<div class="paragraph">
<p>Indeed, all systems on the <em>ZetaPush cloud</em> (servers, database, &#8230;&#8203;) are redundant.
This will also be the case for <a href="#scalability">workers in next versions.</a></p>
</div>
<div class="paragraph">
<p>If a server goes down, another takes over.</p>
</div>
</div>
<div class="sect3">
<h4 id="_load_balancing"><a class="anchor" href="#_load_balancing"></a>Load-balancing</h4>
<div class="paragraph">
<p><em>ZetaPush</em> provides <em>Load-balancing</em> feature between workers.
Indeed, if an application has many workers (The back part of your application), the <em>ZetaPush cloud</em> will automatically spread incoming requests between each of them.</p>
</div>
<div class="sect4">
<h5 id="mix_local_and_remote"><a class="anchor" href="#mix_local_and_remote"></a>Running local and pushed worker on same application</h5>
<div class="paragraph">
<p>In the case of you have already deployed your application in the <em>ZetaPush cloud</em>, a worker is running on it.
Then, if you run your application locally, a second worker is running on your computer.</p>
</div>
<div class="paragraph">
<p>In this case, the <em>load-balancing</em> is always effective, the incoming requests will be spread between each worker.</p>
</div>
<div class="paragraph">
<p>If you want to grab all traffic in your local worker, you need to use the flag <code>--grab-all-trafic</code> of the <a href="#cli">CLI</a>.
For example:</p>
</div>
<div class="listingblock">
<div class="title">Grab all traffic in local worker</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="console">$ zeta run --grab-all-trafic</code></pre>
</div>
</div>
<div class="paragraph">
<p>With this option, all requests will be redirected to your local worker.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>You <strong>do not</strong> use this option in production because all of your client&#8217;s requests will be redirected on your local worker.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The possibility to grab traffic for a specific user (for debug for example) will be possible in a next version.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="scalability"><a class="anchor" href="#scalability"></a>Scalability</h4>
<div class="paragraph">
<p><em>ZetaPush</em> provides the scalability of yours workers.</p>
</div>
<div class="paragraph">
<p>For example, if you have deployed an application on the <em>ZetaPush cloud</em>,
it is possible to increase the number of worker to scale the application.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>For now, to scale your application, you need to <a href="https://www.zetapush.com/contact">contact us</a>.
But in the next versions, the scalability will be automatic.</p>
</div>
<div class="paragraph">
<p>Another feature that will be available in the next versions is the possibility to scale up your application
on a short period to absorb peak loads without extra cost.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_supervision"><a class="anchor" href="#_supervision"></a>Supervision</h4>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p>This section will explain why <em>ZetaPush</em> is useful about supervision of your applications.
It will soon be ready.</p>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="javascript_vs_typescript"><a class="anchor" href="#javascript_vs_typescript"></a>JavaScript vs TypeScript</h4>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p>This section will explain why <em>ZetaPush</em> mainly uses <em>TypeScript</em>.
It will soon be ready.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_application_code_structure"><a class="anchor" href="#_application_code_structure"></a>Application code structure</h3>
<div class="paragraph">
<p>The purpose of this section is to explain the various elements of a <strong>ZetaPush application</strong> and the interaction between them.</p>
</div>
<div class="paragraph">
<p>In the first instance we will see the <a href="#architecture_organization_application">organization of a ZetaPush application</a>, then we will see the <a href="#architecture_files_tree">role of each file or folder</a>.</p>
</div>
<div class="sect3">
<h4 id="architecture_organization_application"><a class="anchor" href="#architecture_organization_application"></a>Organization of an application</h4>
<div class="paragraph">
<p>A <strong>ZetaPush application</strong> includes several components.
You can see this with the following picture that represents the files tree of a basic application:</p>
</div>
<div class="imageblock center">
<div class="content">
<img src="./images/architecture/files-tree.png" alt="files tree">
</div>
</div>
<div class="paragraph">
<p>The <code>worker</code> folder contains your business logic. this is the code that is not directly visible to your users. It is often named as backend part. The <code>front</code> folder is the visible part of your application. It contains the code of the web pages displayed to your users. It is often named the frontend part.</p>
</div>
<div class="paragraph">
<p>The rest of the files are needed for the functioning of the application. Each role of this files is explained below :</p>
</div>
<div class="imageblock center">
<div class="content">
<img src="./images/architecture/organization-application.png" alt="organization application">
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>A ZetaPush application is mainly based on the <code>JavaScript ecosystem</code>. An application is similar to a <code>JavaSscript module</code>. So at the root of the application, we have a <code>package.json</code> file, <a href="#role_package_json">more information</a> about his role is below.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>In addition of the <code>JavaScript ecosystem</code>, a ZetaPush application uses the <code>TypeScript ecosystem</code> by default. So a <code>tsconfig.json</code> file is necessary at the root folder. You can see <a href="#role_tsconfig">more information about his role</a> also see <a href="#javascript_vs_typescript">why we use TypeScript</a>.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The <code>worker</code> folder contains your business logic.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>The <code>front</code> folder contains the web pages displayed to end users.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>The <code>application.json</code> file lets you configure the logic of your application. (Token, API key, Mailjet configuration, etc&#8230;&#8203;).</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>The <code>.zetarc</code> file contains the application and ZetaPush account information (developer login, developer password, appName, etc&#8230;&#8203;). It should not be commited (it contains login and password) so by default it is added to the <code>.gitignore</code> file.</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="architecture_files_tree"><a class="anchor" href="#architecture_files_tree"></a>Files tree</h4>
<div class="paragraph">
<p>As seen in the last section, each file has a specific role. We will explain each of them step by step:</p>
</div>
<div class="sect4">
<h5 id="role_package_json"><a class="anchor" href="#role_package_json"></a>package.json</h5>
<div class="paragraph">
<p>A <strong>ZetaPush application</strong> is based of the <code>JavaScript ecosystem</code>.
So each application has his <code>package.json</code> file.</p>
</div>
<div class="listingblock">
<div class="title">Minimal <code>package.json</code> file</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
</pre></td>
  <td class="code"><pre>{
  <span class="key"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">myApp</span><span class="delimiter">&quot;</span></span>,
  <span class="key"><span class="delimiter">&quot;</span><span class="content">main</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">worker/index.ts</span><span class="delimiter">&quot;</span></span>, <i class="conum" data-value="1"></i><b>(1)</b>
  <span class="key"><span class="delimiter">&quot;</span><span class="content">dependencies</span><span class="delimiter">&quot;</span></span>: {
    <span class="key"><span class="delimiter">&quot;</span><span class="content">@zetapush/cli</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">^v0.37.1</span><span class="delimiter">&quot;</span></span> <i class="conum" data-value="2"></i><b>(2)</b>
    <span class="key"><span class="delimiter">&quot;</span><span class="content">@zetapush/core</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">^v0.37.1</span><span class="delimiter">&quot;</span></span>, <i class="conum" data-value="3"></i><b>(3)</b>
  }
}</pre></td>
</tr></table></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Entry point of your <a href="#_worker">worker</a>. In this file you will expose your <em>custom cloud services</em></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Dependency to the <a href="#_command_line_interface_cli">CLI</a> (Command Line Interface). Use it to run your worker or deploy your code.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Dependency to the <em>ZetaPush Core</em> to write some <em>custom cloud services</em></td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The <code>main</code> property defines the path of the worker entry point. That means that when you run or push your <strong>ZetaPush application</strong>, this is from this entry point that your business logic is launched.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Location of the entry point</div>
<div class="paragraph">
<p>At the present time, the worker code needs to be in the <code>worker</code> folder, but you can specify with the <code>main</code> property any file you want in the <code>worker</code> folder to be the entry point.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="role_tsconfig"><a class="anchor" href="#role_tsconfig"></a>tsconfig.json</h5>
<div class="paragraph">
<p>The <code>tsconfig.json</code> file is here because by default ZetaPush uses the <code>TypeScript ecosystem</code>. For example, the <em>cloud services</em> are written in <code>TypeScript</code> and the <code>worker</code> folder contains by default a <code>TypeScript</code> file.
You can see <a href="#javascript_vs_typescript">why we use TypeScript</a>.</p>
</div>
<div class="paragraph">
<p>In the <code>TypeScript ecosystem</code>, the <code>tsconfig.json</code> file is needed to define the root of the application. So in our case, the <code>tsconfig.json</code> file is placed at the root of the <strong>ZetaPush application</strong>.</p>
</div>
<div class="paragraph">
<p>If you are not familiar with <code>TypeScript</code>, you can see more informations <a href="https://en.wikipedia.org/wiki/TypeScript">here</a>.</p>
</div>
<div class="paragraph">
<p>In addition to define the root of our application, the <code>tsconfig.json</code> file defines how the transpilation from <code>TypeScript</code> to <code>JavaScript</code> is done.
You can define a lot of configurations according to the <a href="https://www.typescriptlang.org/docs/handbook/tsconfig-json.html">TypeScript documentation</a>.</p>
</div>
<div class="paragraph">
<p>For the proper functioning of the <strong>ZetaPush application</strong>, the <code>tsconfig.json</code> file needs to have some minimal configuration like explained below :</p>
</div>
<div class="listingblock">
<div class="title">Minimal tsconfig.json</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
</pre></td>
  <td class="code"><pre>{
  <span class="key"><span class="delimiter">&quot;</span><span class="content">compilerOptions</span><span class="delimiter">&quot;</span></span>: {
    <span class="key"><span class="delimiter">&quot;</span><span class="content">experimentalDecorators</span><span class="delimiter">&quot;</span></span>: <span class="value">true</span>      <i class="conum" data-value="1"></i><b>(1)</b>
    <span class="key"><span class="delimiter">&quot;</span><span class="content">emitDecoratorMetadata</span><span class="delimiter">&quot;</span></span>: <span class="value">true</span>       <i class="conum" data-value="2"></i><b>(2)</b>
  }
}</pre></td>
</tr></table></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>experimentalDecorators</code> is needed to activate the <a href="https://www.typescriptlang.org/docs/handbook/decorators.html">ES7 decorators</a>. There are used in most <strong>worker</strong> code.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td><code>emitDecoratorMetadata</code> is needed for the proper functioning of the ES7 decorators. In particular for types.</td>
</tr>
</table>
</div>
<div class="paragraph">
<div class="title">Customize my tsconfig.json</div>
<p>In the case you need to customize your <code>tsconfig.json</code> file, for example to use features only declared in ES6 (es2015), you can customize your <code>tsconfig.json</code> like below. Of course, you can customize with any properties provided by <a href="https://www.typescriptlang.org/docs/handbook/tsconfig-json.html">TypeScript</a>.</p>
</div>
<div class="listingblock">
<div class="title">Customized tsconfig.json</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
</pre></td>
  <td class="code"><pre>{
  <span class="key"><span class="delimiter">&quot;</span><span class="content">compilerOptions</span><span class="delimiter">&quot;</span></span>: {
    <span class="key"><span class="delimiter">&quot;</span><span class="content">lib</span><span class="delimiter">&quot;</span></span>: [
      <span class="string"><span class="delimiter">&quot;</span><span class="content">es2015</span><span class="delimiter">&quot;</span></span>
    ],
    <span class="key"><span class="delimiter">&quot;</span><span class="content">experimentalDecorators</span><span class="delimiter">&quot;</span></span>: <span class="value">true</span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">emitDecoratorMetadata</span><span class="delimiter">&quot;</span></span>: <span class="value">true</span>
  }
}</pre></td>
</tr></table></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_worker_folder"><a class="anchor" href="#_worker_folder"></a>worker folder</h5>
<div class="paragraph">
<p>As seen above, the <code>worker</code> folder contains the business logic of your application. It is often named "backend code.
This is in this part that you will create your business logic and interact with the <em>built-in cloud services</em> provided by ZetaPush (User management, file system, database, notifications, etc&#8230;&#8203;).</p>
</div>
<div class="paragraph">
<p>By default (When the application is generated by the <em>CLI</em>), the <code>worker</code> folder contains only one file, called <code>index.ts</code>.</p>
</div>
<div class="listingblock">
<div class="title">Generated worker code with the CLI</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
</pre></td>
  <td class="code"><pre><span class="reserved">export</span> <span class="keyword">default</span> <span class="reserved">class</span> {
  hello() {
    <span class="keyword">return</span> <span class="error">`</span>Hello World from Worker at <span class="predefined">$</span>{Date.now()}<span class="error">`</span>;
  }
}</pre></td>
</tr></table></code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Develop your worker in several ways</div>
<div class="paragraph">
<p>In this example we see a worker that is created with only one class. You will see several ways to create a worker in the <a href="#develop_custom_cloud_services">cloud service development section</a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Don&#8217;t need to transpile TypeScript</div>
<div class="paragraph">
<p>Even if your worker code is in <code>TypeScript</code> you don&#8217;t need to transpile it to <code>JavaScript</code>. Indeed, when you run or push your code, it will be launched with <a href="https://github.com/TypeStrong/ts-node"><code>ts-node</code></a>.<br>
<code>ts-node</code> takes care of the transpilation, you can also configure this via the <code>tsconfig.json</code> file.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_front_folder"><a class="anchor" href="#_front_folder"></a>front folder</h5>
<div class="paragraph">
<p>The <code>front</code> folder contains your front code.
Like any other website host, you need to have a <code>index.html</code> file in this folder.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Use frameworks</div>
<div class="paragraph">
<p>You can integrate your favorite framework with ZetaPush.
For now, we give you documentation for integration with the most famous frameworks : <a href="#develop_with_angular">Angular</a>,
<a href="#develop_with_react">React</a>, <a href="#develop_with_vue">Vue.js</a> and anything else.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_application_json"><a class="anchor" href="#_application_json"></a>application.json</h5>
<div class="paragraph">
<p>This file is <strong>optional</strong> in a <strong>ZetaPush application</strong>. For now you just need to use it when you use the <a href="./developer-manual.html#integrate_user_management">StandardUserWorkflow</a>.
Of course, you can also <a href="#configuration_properties">define your own properties</a></p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">List of application.json properties</div>
<div class="paragraph">
<p>To know which keys are available for the <code>application.json</code> file, please refer you to the <em>cloud service</em> that use this configuration file like the <a href="./developer-manual.html#integrate_user_management">StandardUserWorkflow</a>.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_zetarc"><a class="anchor" href="#_zetarc"></a>.zetarc</h5>
<div class="paragraph">
<p>The <code>.zetarc</code> file is the most important file in your application.
It lets you define your <strong>ZetaPush account</strong> and which <strong>ZetaPush application</strong> you want to use.</p>
</div>
<div class="listingblock">
<div class="title">Minimal .zetarc file</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
</pre></td>
  <td class="code"><pre>{
    <span class="key"><span class="delimiter">&quot;</span><span class="content">developerLogin</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">user@gmail.com</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">developerPassword</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">password</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">appName</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">myAppName</span><span class="delimiter">&quot;</span></span>
}</pre></td>
</tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>In addition to the properties displayed in the example, 2 properties are used:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong><em>developerSecretToken</em></strong>: The <em>CLI</em> encrypts the <code>developerPassword</code> in the <code>.zetarc</code> file. You don&#8217;t need to modify it. If you want to change the ZetaPush account password in the <code>.zetarc</code> file, you can delete the <code>developerSecretToken</code> and type again the <code>developerPassword</code>.</p>
</li>
<li>
<p><strong><em>platformUrl</em></strong>: That corresponds to the used <strong>ZetaPush Cloud</strong> for your <strong>ZetaPush application</strong>. When using ZetaPush public cloud, you don&#8217;t need to configure it. If you need a private ZetaPush cloud, you can <a href="https://www.zetapush.com/contact">contact us</a> to ask for it.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Do not commit the .zetarc</div>
<div class="paragraph">
<p>The <code>.zetarc</code> file contains some credentials so we advise you not to commit this file in a version control system like <code>Git</code>.
By default (when the <strong>ZetaPush application</strong> is generated with the <strong>CLI</strong>) this file is added to the <code>.gitignore</code> file.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_zetapush_development_concepts"><a class="anchor" href="#_zetapush_development_concepts"></a>ZetaPush development concepts</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_npm_modules_provided_by_zetapush"><a class="anchor" href="#_npm_modules_provided_by_zetapush"></a>Npm modules provided by ZetaPush</h3>
<div class="paragraph">
<p>ZetaPush provides several npm modules for helping you in your development. Each module has a specific role.</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-middle">Module</th>
<th class="tableblock halign-left valign-middle">Role</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-middle"><p class="tableblock">@zetapush/cli</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">Contains the <strong>Command Line Interface</strong> of ZetaPush.
You can launch <code>zeta run</code> or <code>zeta push</code> thanks to this module.<br>
You can have more information in his <a href="#cli">dedicated section</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"><p class="tableblock">@zetapush/client</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">When you <a href="#client_types">develop the front part of your application</a>, i.e. the web pages displayed to your users,
you use a <strong>ZetaPush client</strong> to interact with your worker and the <strong>ZetaPush cloud</strong>.</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"><p class="tableblock">@zetapush/cometd</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">You don&#8217;t use this module directly.
It is used internally for the communication with the <strong>ZetaPush cloud</strong> via the <a href="https://cometd.org/">CometD</a> protocol.</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"><p class="tableblock">@zetapush/common</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">This module includes some functions and classes that are used in other modules.</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"><p class="tableblock">@zetapush/core</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">This is the core of <strong>ZetaPush</strong>. Notably, it provides the <a href="#dependency_injection">dependency injection</a></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"><p class="tableblock">@zetapush/create</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">This module is used when you create a new development project using ZetaPush through the command <code>npm init @zetapush myApp</code></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"><p class="tableblock">@zetapush/example</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">It contains a basic example of a <strong>ZetaPush application</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"><p class="tableblock">@zetapush/http-server</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">ZetaPush uses a HTTP server for some features, for example to confirm an account in the <a href="#integrate_user_management">Standard User Workflow</a>.
You have information about this module in his <a href="#http_server">dedicated section</a></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"><p class="tableblock">@zetapush/testing</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">ZetaPush integrates testing and provides some useful features about it via this module.</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"><p class="tableblock">@zetapush/integration</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">This package is used internally by ZetaPush. It contains end to end tests to ensure that each new version is well tested and that there is no regression.</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"><p class="tableblock">@zetapush/platform-legacy</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">ZetaPush contains some <em>Technical Services</em> that are the fundations to build more functional and advanced services. These services will be improved and some may be replaced by a service that matches more your needs.
This module contains them and you have more information about their utilization in the <a href="#builtin_cloud_services">dedicated section</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"><p class="tableblock">@zetapush/troubleshooting</p></td>
<td class="tableblock halign-left valign-middle"><div><div class="paragraph">
<p>When you have a technical error, it can be hard to understand what really happens. This module diagnoses all errors (errors when worker starts, errors when worker is pushed, errors in connection/network&#8230;&#8203;) and gives you an help to understand the error and to help you fix it.</p>
</div>
<div class="paragraph">
<p>For example, a network error can have several causes:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Your network card is disabled or misconfigured</p>
</li>
<li>
<p>Your computer can&#8217;t access the Internet</p>
</li>
<li>
<p>Your computer is on a local network with a proxy but proxy is not reachable</p>
</li>
<li>
<p>Your computer is on a local network with a proxy, proxy is reachable but the proxy can&#8217;t access the Internet</p>
</li>
<li>
<p>You have Internet access but ZetaPush cloud is not reachable</p>
</li>
<li>
<p>&#8230;&#8203;</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This module will give you help to understand where the problem is and how to fix it.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"><p class="tableblock">@zetapush/user-management</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">In almost every application, you need to provide user management features like user creation, user authentication, profile management&#8230;&#8203; This module provides functional cloud services that directly provides all these features. You don&#8217;t need to bother about implementing it again and again. You just consume one of these cloud services like <a href="#integrate_user_management">StandardUserWorkflow</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"><p class="tableblock">@zetapush/worker</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">This module provides the container that executes the code of your business logic i.e. the worker. It is internally used by the CLI when you launch <code>zeta run</code> or <code>zeta push</code> or by testing tools.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="dependency_injection"><a class="anchor" href="#dependency_injection"></a>Dependency injection</h3>
<div class="paragraph">
<p><strong>Dependency Injection</strong> is a technique whereby one component supplies the dependencies of another component. A dependency is a component that can be used. An injection is the passing of a dependency to a dependent component that would use it.</p>
</div>
<div class="paragraph">
<p>In our case, we the <strong>Dependency Injection</strong> to provides the <em>cloud services</em> (builtin or not) and other classes. The benefic is that you don&#8217;t need to instanciate a dependency. You ask it and you have it.</p>
</div>
<div class="paragraph">
<p>In the following example we need to have the <em>GDA builtin cloud service</em> (database). We ask the dependency injection to provide one.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre></td>
  <td class="code"><pre><span class="reserved">import</span> { Gda } from <span class="string"><span class="delimiter">'</span><span class="content">@zetapush/platform-legacy</span><span class="delimiter">'</span></span>;

<span class="error">@</span>Injectable()                       <i class="conum" data-value="1"></i><b>(1)</b>
<span class="reserved">export</span> <span class="keyword">default</span> <span class="reserved">class</span> MyApi {
  constructor(<span class="reserved">private</span> gda: Gda) {}  <i class="conum" data-value="2"></i><b>(2)</b>

  putData(name: string) {
    <span class="keyword">return</span> await <span class="local-variable">this</span>.gda.put({     <i class="conum" data-value="3"></i><b>(3)</b>
      <span class="key">table</span>: <span class="string"><span class="delimiter">'</span><span class="content">my-table</span><span class="delimiter">'</span></span>,
      <span class="key">column</span>: <span class="string"><span class="delimiter">'</span><span class="content">my-column</span><span class="delimiter">'</span></span>,
      <span class="key">key</span>: Date.now().toString(),
      <span class="key">data</span>: name
    });
  }
}</pre></td>
</tr></table></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Say to the dependency injection that it should provide some dependencies in this class</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>I just say that I need a <code>GDA</code> instance in my class</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>I use my dependency. I know that my dependency is automatically instantiated by the <strong>Dependency Injection</strong>.</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Dependencies are singletons by default</div>
<div class="paragraph">
<p>By default, when you use the dependency injection, each component that is instanciated is a <a href="https://en.wikipedia.org/wiki/Singleton_pattern">singleton</a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>ZetaPush uses <a href="https://github.com/mgechev/injection-js">Injection JS</a> library for manage the <strong>Dependency Injection</strong>. It is an extraction of the Angular&#8217;s dependency injection.</p>
</div>
<div class="paragraph">
<p>You can have more information about the dependency injection in the <a href="https://angular.io/guide/dependency-injection">Angular Dependency Injection Documentation</a></p>
</div>
</div>
<div class="sect2">
<h3 id="modules"><a class="anchor" href="#modules"></a>Modules</h3>

</div>
<div class="sect2">
<h3 id="_current_running_context"><a class="anchor" href="#_current_running_context"></a>Current running context</h3>
<div class="paragraph">
<p>When you develop your <em>cloud services</em>, you may want to use the current context.
The most important thing about this is that it depends of your runtime environment.
Indeed, the properties will be not the same when your worker is running locally
or when your worker is running on the <em>ZetaPush cloud</em>.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Different contexts</div>
<div class="paragraph">
<p>The context is not the same between locally and in the <em>ZetaPush cloud</em> because in the first
case the context is provided by the <a href="#cli">CLI</a> and in the second case the context is provided
by the <em>ZetaPush platform</em>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To handle this, ZetaPush provides some util functions to get the current context.
There are 3 classes to manage the context :</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#context_environment">Environment</a></p>
</li>
<li>
<p><a href="#configuration_properties">ConfigurationProperties</a></p>
</li>
<li>
<p><a href="#zetapush_context">ZetaPushContext</a></p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="context_environment"><a class="anchor" href="#context_environment"></a>Environment</h4>
<div class="paragraph">
<p>This object is just a wrapper for <a href="#configuration_properties">ConfigurationProperties</a> and <a href="#zetapush_context">ZetaPushContext</a>.</p>
</div>
<div class="paragraph">
<p>You can use it like this :</p>
</div>
<div class="listingblock">
<div class="title">Use Environment context</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre></td>
  <td class="code"><pre><span class="reserved">import</span> { Injectable, Environment } from <span class="string"><span class="delimiter">'</span><span class="content">@zetapush/core</span><span class="delimiter">'</span></span>;     <i class="conum" data-value="1"></i><b>(1)</b>

<span class="error">@</span>Injectable()
<span class="reserved">export</span> <span class="keyword">default</span> <span class="reserved">class</span> Api {
  constructor(<span class="reserved">private</span> env: Environment) {}                    <i class="conum" data-value="2"></i><b>(2)</b>

  getEnvironment() {
    <span class="keyword">return</span> {
      <span class="key">context</span>: <span class="local-variable">this</span>.env.context,                              <i class="conum" data-value="3"></i><b>(3)</b>
      <span class="key">name</span>: <span class="local-variable">this</span>.env.name,                                    <i class="conum" data-value="4"></i><b>(4)</b>
      <span class="key">properties</span>: <span class="local-variable">this</span>.env.properties,                        <i class="conum" data-value="5"></i><b>(5)</b>
      <span class="key">variables</span>: <span class="local-variable">this</span>.env.variables                           <i class="conum" data-value="6"></i><b>(6)</b>
    };
  }
}</pre></td>
</tr></table></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <em>Environment</em> class is in the <code>@zetapush/core</code> package.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The dependency injection provides us a <em>Environment</em> instance.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>We get the <code>ZetaPushContext</code></td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>We get the name of the environment (dev, prod, etc&#8230;&#8203;)</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>We get the <code>ConfigurationProperties</code></td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>We get the environment variables</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>As the <em>Environment</em> object is a wrapper for <a href="#configuration_properties">ConfigurationProperties</a> and <a href="#zetapush_context">ZetaPushContext</a>, we retrieve the values for these objects via the properties <code>context</code> and <code>properties</code>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Environment feature is not ready in the full chain</div>
<div class="paragraph">
<p>The name of the environment is already available in the current context but the <strong>Environment management</strong> feature is not ready yet. The integration in the <em>CLI</em> is missing and it is our next high priority.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Because the <code>Environment</code> object also contains the <code>ConfigurationProperties</code> and <code>ZetaPushContext</code>,
you can use the methods of this nested properties. For example to get the <em>application name</em> via
the <a href="#zetapush_context"><code>ZetaPushContext</code></a>:</p>
</div>
<div class="listingblock">
<div class="title">Get appName via Environment</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
10
</pre></td>
  <td class="code"><pre><span class="reserved">import</span> { Injectable, Environment } from <span class="string"><span class="delimiter">'</span><span class="content">@zetapush/core</span><span class="delimiter">'</span></span>;     <i class="conum" data-value="1"></i><b>(1)</b>

<span class="error">@</span>Injectable()
<span class="reserved">export</span> <span class="keyword">default</span> <span class="reserved">class</span> Api {
  constructor(<span class="reserved">private</span> env: Environment) {}                    <i class="conum" data-value="2"></i><b>(2)</b>

  getAppName() {
    <span class="keyword">return</span> <span class="local-variable">this</span>.env.context.getAppName();                     <i class="conum" data-value="3"></i><b>(3)</b>
  }
}</pre></td>
</tr></table></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <em>Environment</em> class is in the <code>@zetapush/core</code> package.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The dependency injection provides us a <em>Environment</em> instance.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Get the <em>appName</em> via <code>getAppName()</code> method.</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="configuration_properties"><a class="anchor" href="#configuration_properties"></a>ConfigurationProperties</h4>
<div class="paragraph">
<p>This object contains the content of your <code>application.json</code> file.</p>
</div>
<div class="sect4">
<h5 id="_access_to_application_json_properties"><a class="anchor" href="#_access_to_application_json_properties"></a>Access to application.json properties</h5>
<div class="paragraph">
<p>To interact with your <code>application.json</code> file, you can use these provided methods:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>get()</code>: Get a property value via his name, returns <code>undefined</code> if doesn&#8217;t exists</p>
</li>
<li>
<p><code>getOrThrow()</code>: Get a property value via his name, returns <code>API_ERROR</code> exception if doesn&#8217;t exists</p>
</li>
<li>
<p><code>has()</code>: Check if a property exists in the <code>application.json</code> file (returns boolean)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In the case of we have the following <code>application.json</code> file:</p>
</div>
<div class="listingblock">
<div class="title">application.json content</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
</pre></td>
  <td class="code"><pre>{
  <span class="key"><span class="delimiter">&quot;</span><span class="content">organization</span><span class="delimiter">&quot;</span></span>: {
    <span class="key"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">ZetaPush</span><span class="delimiter">&quot;</span></span>
  },
  <span class="key"><span class="delimiter">&quot;</span><span class="content">my-name</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">MyName</span><span class="delimiter">&quot;</span></span>,
}</pre></td>
</tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>We can get properties like this :</p>
</div>
<div class="listingblock">
<div class="title">Get application.json properties</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
</pre></td>
  <td class="code"><pre><span class="reserved">import</span> { Injectable, ConfigurationProperties } from <span class="string"><span class="delimiter">'</span><span class="content">@zetapush/core</span><span class="delimiter">'</span></span>;     <i class="conum" data-value="1"></i><b>(1)</b>

<span class="error">@</span>Injectable()
<span class="reserved">export</span> <span class="keyword">default</span> <span class="reserved">class</span> {
  constructor(<span class="reserved">private</span> properties: ConfigurationProperties) {}             <i class="conum" data-value="2"></i><b>(2)</b>

  getUserInfo() {
    <span class="keyword">return</span> {
      <span class="key">name</span>: <span class="local-variable">this</span>.properties.get(<span class="string"><span class="delimiter">'</span><span class="content">my-name</span><span class="delimiter">'</span></span>),                               <i class="conum" data-value="3"></i><b>(3)</b>
      <span class="key">orga</span>: <span class="local-variable">this</span>.properties.get(<span class="string"><span class="delimiter">'</span><span class="content">organization.name</span><span class="delimiter">'</span></span>)                      <i class="conum" data-value="4"></i><b>(4)</b>
    }
  }
}</pre></td>
</tr></table></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <em>ConfigurationProperties</em> class is in the <code>@zetapush/core</code> package.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The dependency injection provides us a <em>ConfigurationProperties</em> instance.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>We read the <code>application.json</code> property via a <em>getter</em></td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>We read the <code>application.json</code> nested property via a <em>getter</em></td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="zetapush_context"><a class="anchor" href="#zetapush_context"></a>ZetaPushContext</h4>
<div class="paragraph">
<p>This last object contains (amongst others) the URL of your worker and your front (deployed on the <em>ZetaPush cloud</em> or running locally).</p>
</div>
<div class="sect4">
<h5 id="_use_zetapushcontext"><a class="anchor" href="#_use_zetapushcontext"></a>Use ZetaPushContext</h5>
<div class="paragraph">
<p>The <code>ZetaPushContext</code> provides you some methods to interact with it:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>getAppName()</code>: Returns the <em>appName</em> of your application</p>
</li>
<li>
<p><code>getPlatformUrl()</code>: Returns the <em>platformUrl</em> of your application</p>
</li>
<li>
<p><code>getFrontUrl()</code>: Returns the url of the used front part of your application</p>
</li>
<li>
<p><code>getWorkerUrl()</code>: Returns the url of the used worker</p>
</li>
<li>
<p><code>getLocalZetaPushHttpPort()</code>: Returns the port used on <a href="#http_server"><em>HTTP server</em></a></p>
</li>
</ul>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Role of URL</div>
<div class="paragraph">
<p><code>getFrontUrl()</code> and <code>getWorkerUrl()</code> provide you the URL used in your application, depending of your context
(Locally or running on <em>ZetaPush cloud</em>). For example, the <code>getFrontUrl()</code> can be used for a redirection in your
application.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The <code>ZetaPushContext</code> can be used like below:</p>
</div>
<div class="listingblock">
<div class="title">Use ZetaPushContext</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre></td>
  <td class="code"><pre><span class="reserved">import</span> { ZetaPushContext, Injectable } from <span class="string"><span class="delimiter">'</span><span class="content">@zetapush/core</span><span class="delimiter">'</span></span>;       <i class="conum" data-value="1"></i><b>(1)</b>

<span class="error">@</span>Injectable()
<span class="reserved">export</span> <span class="keyword">default</span> <span class="reserved">class</span> Api {
  constructor(<span class="reserved">private</span> context: ZetaPushContext) {}                  <i class="conum" data-value="2"></i><b>(2)</b>

  getContext() {
    <span class="keyword">return</span> {
      <span class="key">front</span>: <span class="local-variable">this</span>.context.getFrontUrl(),                            <i class="conum" data-value="3"></i><b>(3)</b>
      <span class="key">worker</span>: <span class="local-variable">this</span>.context.getWorkerUrl(),
      <span class="key">zetapushPort</span>: <span class="local-variable">this</span>.context.getLocalZetaPushHttpPort(),
      <span class="key">appName</span>: <span class="local-variable">this</span>.context.getAppName(),
      <span class="key">platformUrl</span>: <span class="local-variable">this</span>.context.getPlatformUrl()
    };
  }
}</pre></td>
</tr></table></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>ZetaPushContext</code> is provided by the <em>@zetapush/core</em> module</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>We ask the <em>Dependency Injection</em> to provide an instance of <code>ZetaPushContext</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>We use all methods provided by the <code>ZetaPushContext</code></td>
</tr>
</table>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_develop_with_zetapush"><a class="anchor" href="#_develop_with_zetapush"></a>Develop with ZetaPush</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In the <em>Getting started</em> section you already see how to develop with <em>ZetaPush</em>.
So in this section we will see in more details how to develop with <em>ZetaPush</em> and some advanced usages.</p>
</div>
<div class="sect2">
<h3 id="_develop_your_front_only"><a class="anchor" href="#_develop_your_front_only"></a>Develop your front only</h3>
<div class="sect3">
<h4 id="client_types"><a class="anchor" href="#client_types"></a>ZetaPush client</h4>
<div class="paragraph">
<p>ZetaPush provides a <em>ZetaPush Client</em> to interact with the <em>ZetaPush cloud</em>.
Each of the 3 types of <em>Client</em> has a specific purpose:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#weak_client">Weak client</a> for an anonymous connection</p>
</li>
<li>
<p><a href="#simple_client">Simple client</a> for a basic authenticated connection</p>
</li>
<li>
<p><a href="#smart_client">Smart client</a> that automatically chooses between <em>Weak</em> or <em>Simple</em> client according to presence or not of credentials</p>
</li>
</ul>
</div>
<div class="sect5">
<h6 id="weak_client"><a class="anchor" href="#weak_client"></a>Weak Client</h6>
<div class="paragraph">
<p>The <em>Weak client</em> lets you create an anonymous connection with the <em>ZetaPush cloud</em>.
That means that you are only connected via a <a href="https://en.wikipedia.org/wiki/Token">token</a>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Token of anonymous user</div>
<div class="paragraph">
<p>The token is only used to identify the anonymous user during his session.
Indeed, each opened connection has its own session on the <em>ZetaPush cloud</em> so we need to identify each of them.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>How to use the <em>Weak Client</em> :</p>
</div>
<div class="paragraph tab-container">
<p>Connection with Weak Client</p>
</div>
<div class="paragraph tab">
<p>index.html</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="html"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre></td>
  <td class="code"><pre><span class="doctype">&lt;!DOCTYPE html&gt;</span>
<span class="tag">&lt;html</span> <span class="attribute-name">lang</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">en</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;head&gt;</span>
    <span class="tag">&lt;meta</span> <span class="attribute-name">charset</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">UTF-8</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
    <span class="tag">&lt;meta</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">viewport</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">content</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">width=device-width, initial-scale=1.0</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
    <span class="tag">&lt;meta</span> <span class="attribute-name">http-equiv</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">X-UA-Compatible</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">content</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">ie=edge</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
    <span class="tag">&lt;title&gt;</span>Weak client<span class="tag">&lt;/title&gt;</span>
  <span class="tag">&lt;/head&gt;</span>
  <span class="tag">&lt;body&gt;</span>
    Weak client
  <span class="tag">&lt;/body&gt;</span>
  <span class="tag">&lt;script</span> <span class="attribute-name">src</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">https://unpkg.com/@zetapush/client</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span><span class="tag">&lt;/script&gt;</span>
  <span class="tag">&lt;script</span> <span class="attribute-name">src</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">./index.js</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span><span class="tag">&lt;/script&gt;</span>
<span class="tag">&lt;/html&gt;</span></pre></td>
</tr></table></code></pre>
</div>
</div>
<div class="paragraph tab">
<p>index.js</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
</pre></td>
  <td class="code"><pre><span class="comment">// If you use npm you can do :</span>
<span class="comment">// import { WeakClient } = from '@zetapush/client';</span>

client = <span class="keyword">new</span> ZetaPushClient.WeakClient();

<span class="comment">// Connection</span>
client
  .connect()
  .then(() =&gt; console.log(<span class="string"><span class="delimiter">'</span><span class="content">connected</span><span class="delimiter">'</span></span>))
  .<span class="keyword">catch</span>(() =&gt; console.error(<span class="string"><span class="delimiter">'</span><span class="content">connection failed</span><span class="delimiter">'</span></span>));

<span class="comment">// Disconnection</span>
client.disconnect();</pre></td>
</tr></table></code></pre>
</div>
</div>
<div class="paragraph tab-container-end">
<p>-</p>
</div>
</div>
<div class="sect5">
<h6 id="simple_client"><a class="anchor" href="#simple_client"></a>Simple Client</h6>
<div class="paragraph">
<p>The <em>Simple Client</em> is used to have an authenticated connection with the <em>ZetaPush cloud</em>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Simple client authentication</div>
<div class="paragraph">
<p>With the <em>Simple Client</em> the authentication is done with a couple login/password of the end user previously created.
(It&#8217;s <strong>not</strong> your ZetaPush developer credentials at all)</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>How to use the <em>Simple Client</em> :</p>
</div>
<div class="paragraph tab-container">
<p>Connection with Simple Client</p>
</div>
<div class="paragraph tab">
<p>index.html</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="html"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre></td>
  <td class="code"><pre><span class="doctype">&lt;!DOCTYPE html&gt;</span>
<span class="tag">&lt;html</span> <span class="attribute-name">lang</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">en</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;head&gt;</span>
    <span class="tag">&lt;meta</span> <span class="attribute-name">charset</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">UTF-8</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
    <span class="tag">&lt;meta</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">viewport</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">content</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">width=device-width, initial-scale=1.0</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
    <span class="tag">&lt;meta</span> <span class="attribute-name">http-equiv</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">X-UA-Compatible</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">content</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">ie=edge</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
    <span class="tag">&lt;title&gt;</span>Simple client<span class="tag">&lt;/title&gt;</span>
  <span class="tag">&lt;/head&gt;</span>
  <span class="tag">&lt;body&gt;</span>
    Simple client
  <span class="tag">&lt;/body&gt;</span>
  <span class="tag">&lt;script</span> <span class="attribute-name">src</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">https://unpkg.com/@zetapush/client</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span><span class="tag">&lt;/script&gt;</span>
  <span class="tag">&lt;script</span> <span class="attribute-name">src</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">./index.js</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span><span class="tag">&lt;/script&gt;</span>
<span class="tag">&lt;/html&gt;</span></pre></td>
</tr></table></code></pre>
</div>
</div>
<div class="paragraph tab">
<p>index.js</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
</pre></td>
  <td class="code"><pre><span class="comment">// If you use npm you can do :</span>
<span class="comment">// import { Client } = from '@zetapush/client';</span>

client = <span class="keyword">new</span> ZetaPushClient.Client({
  authentication() {                                <i class="conum" data-value="1"></i><b>(1)</b>
    <span class="keyword">return</span> ZetaPushClient.Authentication.simple({
      <span class="key">login</span>: <span class="string"><span class="delimiter">'</span><span class="content">my-login</span><span class="delimiter">'</span></span>,
      <span class="key">password</span>: <span class="string"><span class="delimiter">'</span><span class="content">my-password</span><span class="delimiter">'</span></span>
    });
  }
});

<span class="comment">// Connection</span>
client
  .connect()
  .then(() =&gt; console.log(<span class="string"><span class="delimiter">'</span><span class="content">connected</span><span class="delimiter">'</span></span>))
  .<span class="keyword">catch</span>(() =&gt; console.error(<span class="string"><span class="delimiter">'</span><span class="content">connection failed</span><span class="delimiter">'</span></span>));

<span class="comment">// Disconnection</span>
client.disconnect();</pre></td>
</tr></table></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>We define the used authentication (<em>simple</em> in this case)</td>
</tr>
</table>
</div>
<div class="paragraph tab-container-end">
<p>-</p>
</div>
</div>
<div class="sect5">
<h6 id="smart_client"><a class="anchor" href="#smart_client"></a>Smart Client</h6>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">SmartClient is recommended</div>
<div class="paragraph">
<p>We advise you to use this <em>ZetaPush Client</em> for convenience.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The <em>Smart Client</em> is a combinaison of the <em>Weak Client</em> and the <em>Simple Client</em>.
If the <em>Client</em> has credentials, a <em>Simple Client</em> is used, otherwise a <em>Weak Client</em> is used.</p>
</div>
<div class="paragraph">
<p>How to use the <em>Smart Client</em> :</p>
</div>
<div class="paragraph tab-container">
<p>Connection with Smart Client</p>
</div>
<div class="paragraph tab">
<p>index.html</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="html"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre></td>
  <td class="code"><pre><span class="doctype">&lt;!DOCTYPE html&gt;</span>
<span class="tag">&lt;html</span> <span class="attribute-name">lang</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">en</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;head&gt;</span>
    <span class="tag">&lt;meta</span> <span class="attribute-name">charset</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">UTF-8</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
    <span class="tag">&lt;meta</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">viewport</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">content</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">width=device-width, initial-scale=1.0</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
    <span class="tag">&lt;meta</span> <span class="attribute-name">http-equiv</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">X-UA-Compatible</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">content</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">ie=edge</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
    <span class="tag">&lt;title&gt;</span>Smart client<span class="tag">&lt;/title&gt;</span>
  <span class="tag">&lt;/head&gt;</span>
  <span class="tag">&lt;body&gt;</span>
    Smart client
  <span class="tag">&lt;/body&gt;</span>
  <span class="tag">&lt;script</span> <span class="attribute-name">src</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">https://unpkg.com/@zetapush/client</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span><span class="tag">&lt;/script&gt;</span>
  <span class="tag">&lt;script</span> <span class="attribute-name">src</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">./index.js</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span><span class="tag">&lt;/script&gt;</span>
<span class="tag">&lt;/html&gt;</span></pre></td>
</tr></table></code></pre>
</div>
</div>
<div class="paragraph tab">
<p>index.js</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre></td>
  <td class="code"><pre><span class="comment">// If you use npm you can do :</span>
<span class="comment">// import { SmartClient } = from '@zetapush/client';</span>

client = <span class="keyword">new</span> ZetaPushClient.SmartClient();

<span class="comment">// Set credentials (optional)</span>
client.setCredentials({ <span class="key">login</span>: <span class="string"><span class="delimiter">'</span><span class="content">my-login</span><span class="delimiter">'</span></span>, <span class="key">password</span>: <span class="string"><span class="delimiter">'</span><span class="content">my-password</span><span class="delimiter">'</span></span>});

<span class="comment">// Connection</span>
client
  .connect()
  .then(() =&gt; console.log(<span class="string"><span class="delimiter">'</span><span class="content">connected</span><span class="delimiter">'</span></span>))
  .<span class="keyword">catch</span>(() =&gt; console.error(<span class="string"><span class="delimiter">'</span><span class="content">connection failed</span><span class="delimiter">'</span></span>));

<span class="comment">// Disconnection</span>
client.disconnect();</pre></td>
</tr></table></code></pre>
</div>
</div>
<div class="paragraph tab-container-end">
<p>-</p>
</div>
</div>
<div class="sect5">
<h6 id="_call_your_api"><a class="anchor" href="#_call_your_api"></a>Call your API</h6>
<div class="paragraph">
<p>Once you are connected to the <em>ZetaPush cloud</em>, you can call your API declared in the <code>worker</code> part of your application.
The best way is to use the method <code>createProxyTaskService()</code>. This will use <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Proxy">proxy object</a>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Use proxy for API</div>
<div class="paragraph">
<p>Using proxy avoids you to have to create a definition class of your API.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Call API through proxy :</p>
</div>
<div class="paragraph tab-container">
<p>Call API through proxy</p>
</div>
<div class="paragraph tab">
<p>index.ts (worker)</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
</pre></td>
  <td class="code"><pre><span class="reserved">export</span> <span class="keyword">default</span> <span class="reserved">class</span> {
  hello() {
    <span class="keyword">return</span> <span class="error">`</span>Hello World from Worker at <span class="predefined">$</span>{Date.now()}<span class="error">`</span>;
  }
}</pre></td>
</tr></table></code></pre>
</div>
</div>
<div class="paragraph tab">
<p>index.html</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="html"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre></td>
  <td class="code"><pre><span class="doctype">&lt;!DOCTYPE html&gt;</span>
<span class="tag">&lt;html</span> <span class="attribute-name">lang</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">en</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;head&gt;</span>
    <span class="tag">&lt;meta</span> <span class="attribute-name">charset</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">UTF-8</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
    <span class="tag">&lt;meta</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">viewport</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">content</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">width=device-width, initial-scale=1.0</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
    <span class="tag">&lt;meta</span> <span class="attribute-name">http-equiv</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">X-UA-Compatible</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">content</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">ie=edge</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
    <span class="tag">&lt;title&gt;</span>Weak client<span class="tag">&lt;/title&gt;</span>
  <span class="tag">&lt;/head&gt;</span>
  <span class="tag">&lt;body&gt;</span>
    <span class="tag">&lt;button</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">js-Hello</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>call hello()<span class="tag">&lt;/button&gt;</span>
  <span class="tag">&lt;/body&gt;</span>
  <span class="tag">&lt;script</span> <span class="attribute-name">src</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">https://unpkg.com/@zetapush/client</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span><span class="tag">&lt;/script&gt;</span>
  <span class="tag">&lt;script</span> <span class="attribute-name">src</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">./index.js</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span><span class="tag">&lt;/script&gt;</span>
<span class="tag">&lt;/html&gt;</span></pre></td>
</tr></table></code></pre>
</div>
</div>
<div class="paragraph tab">
<p>index.js (front)</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre></td>
  <td class="code"><pre><span class="comment">// If you use npm you can do :</span>
<span class="comment">// import { WeakClient } = from '@zetapush/client';</span>
client = <span class="keyword">new</span> ZetaPushClient.WeakClient();
api = client.createProxyTaskService();

<span class="comment">// Handle the click</span>
document.querySelector(<span class="string"><span class="delimiter">'</span><span class="content">.js-Hello</span><span class="delimiter">'</span></span>).addEventListener(<span class="string"><span class="delimiter">'</span><span class="content">click</span><span class="delimiter">'</span></span>, async () =&gt; {
  console.log(await api.hello());           <i class="conum" data-value="1"></i><b>(1)</b>
});

<span class="comment">// Connection</span>
client
  .connect()
  .then(() =&gt; console.log(<span class="string"><span class="delimiter">'</span><span class="content">connected</span><span class="delimiter">'</span></span>))
  .<span class="keyword">catch</span>(() =&gt; console.error(<span class="string"><span class="delimiter">'</span><span class="content">connection failed</span><span class="delimiter">'</span></span>));</pre></td>
</tr></table></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Call <code>hello()</code> method of the worker</td>
</tr>
</table>
</div>
<div class="paragraph tab-container-end">
<p>-</p>
</div>
</div>
<div class="sect5">
<h6 id="_call_api_without_proxy"><a class="anchor" href="#_call_api_without_proxy"></a>Call API without proxy</h6>
<div class="paragraph">
<p>In the case of the <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Proxy">Proxy</a> is not available on your platform, you can use the <code>createAsyncTaskService()</code> method.</p>
</div>
<div class="paragraph">
<p>For this, you need to create a definition class:</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="title">Definition class</div>
<div class="paragraph">
<p>A definition class is used to define which methods are available in your worker. It has always the same format.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph tab-container">
<p>Call API without proxy</p>
</div>
<div class="paragraph tab">
<p>index.ts (worker)</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
</pre></td>
  <td class="code"><pre><span class="reserved">export</span> <span class="keyword">default</span> <span class="reserved">class</span> {
  hello(name: string) {
    <span class="keyword">return</span> <span class="error">`</span>Hello <span class="predefined">$</span>{name} from Worker at <span class="predefined">$</span>{Date.now()}<span class="error">`</span>;
  }
}</pre></td>
</tr></table></code></pre>
</div>
</div>
<div class="paragraph tab">
<p>index.html</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="html"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre></td>
  <td class="code"><pre><span class="doctype">&lt;!DOCTYPE html&gt;</span>
<span class="tag">&lt;html</span> <span class="attribute-name">lang</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">en</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;head&gt;</span>
    <span class="tag">&lt;meta</span> <span class="attribute-name">charset</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">UTF-8</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
    <span class="tag">&lt;meta</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">viewport</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">content</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">width=device-width, initial-scale=1.0</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
    <span class="tag">&lt;meta</span> <span class="attribute-name">http-equiv</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">X-UA-Compatible</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">content</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">ie=edge</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
    <span class="tag">&lt;title&gt;</span>Weak client<span class="tag">&lt;/title&gt;</span>
  <span class="tag">&lt;/head&gt;</span>
  <span class="tag">&lt;body&gt;</span>
    <span class="tag">&lt;button</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">js-Hello</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>call hello()<span class="tag">&lt;/button&gt;</span>
  <span class="tag">&lt;/body&gt;</span>
  <span class="tag">&lt;script</span> <span class="attribute-name">src</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">https://unpkg.com/@zetapush/client</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span><span class="tag">&lt;/script&gt;</span>
  <span class="tag">&lt;script</span> <span class="attribute-name">src</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">https://unpkg.com/@zetapush/platform-legacy</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span><span class="tag">&lt;/script&gt;</span>
  <span class="tag">&lt;script</span> <span class="attribute-name">src</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">./index.js</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span><span class="tag">&lt;/script&gt;</span>
<span class="tag">&lt;/html&gt;</span></pre></td>
</tr></table></code></pre>
</div>
</div>
<div class="paragraph tab">
<p>index.js (front)</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
</pre></td>
  <td class="code"><pre><span class="comment">// If you use npm you can do :</span>
<span class="comment">// import { WeakClient } = from '@zetapush/client';</span>
<span class="comment">// import { Queue } = from '@zetapush/platform-legacy';</span>
client = <span class="keyword">new</span> ZetaPushClient.WeakClient();

<span class="comment">// Handle the click</span>
document.querySelector(<span class="string"><span class="delimiter">'</span><span class="content">.js-Hello</span><span class="delimiter">'</span></span>).addEventListener(<span class="string"><span class="delimiter">'</span><span class="content">click</span><span class="delimiter">'</span></span>, async () =&gt; {
  console.log(await api.hello(<span class="string"><span class="delimiter">'</span><span class="content">test</span><span class="delimiter">'</span></span>));                   <i class="conum" data-value="1"></i><b>(1)</b>
});

<span class="comment">// Our definition API</span>
<span class="reserved">class</span> MyApi <span class="reserved">extends</span> ZetaPushPlatPlatformLegacy.Queue {    <i class="conum" data-value="2"></i><b>(2)</b>
  hello(name) {                                           <i class="conum" data-value="3"></i><b>(3)</b>
    <span class="keyword">return</span> <span class="local-variable">this</span>.<span class="predefined">$publish</span>(<span class="string"><span class="delimiter">'</span><span class="content">hello</span><span class="delimiter">'</span></span>, name);                  <i class="conum" data-value="4"></i><b>(4)</b>
  }
}

<span class="comment">// create our AsyncTaskService</span>
const api = client.createAsyncTaskService({
  <span class="key">Type</span>: MyApi
});

<span class="comment">// Connection</span>
client
  .connect()
  .then(() =&gt; console.log(<span class="string"><span class="delimiter">'</span><span class="content">connected</span><span class="delimiter">'</span></span>))
  .<span class="keyword">catch</span>(() =&gt; console.error(<span class="string"><span class="delimiter">'</span><span class="content">connection failed</span><span class="delimiter">'</span></span>));</pre></td>
</tr></table></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Call <code>hello()</code> method of the worker</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>We extends the <em>Queue Technical Service</em> that allows us to communicate with <em>ZetaPush Cloud</em></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Each method returns a <em>Promise</em></td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>The definition API is always the same format : <code>return this.$publish('name-cloud-function', param1, paramN);</code></td>
</tr>
</table>
</div>
<div class="paragraph tab-container-end">
<p>-</p>
</div>
</div>
<div class="sect5">
<h6 id="_injection_of_your_application_s_information"><a class="anchor" href="#_injection_of_your_application_s_information"></a>Injection of your application&#8217;s information</h6>
<div class="paragraph">
<p>The creation of a <em>ZetaPush Client</em> needs to have some information for commucating with the right application.
For this, there are the <code>appName</code> and optionally the <code>platformUrl</code>.</p>
</div>
<div class="listingblock">
<div class="title">Example of <em>ZetaClient</em> creation with explicit information</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
</pre></td>
  <td class="code"><pre>client = <span class="keyword">new</span> ZetaPushClient.WeakClient({
  <span class="key">appName</span>: <span class="string"><span class="delimiter">'</span><span class="content">my-app-name</span><span class="delimiter">'</span></span>,           <i class="conum" data-value="1"></i><b>(1)</b>
  <span class="key">platformUrl</span>: <span class="string"><span class="delimiter">'</span><span class="content">my-platform-url</span><span class="delimiter">'</span></span>    <i class="conum" data-value="2"></i><b>(2)</b>
});</pre></td>
</tr></table></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Your <code>application</code> name</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The optional URL of your used platform (by default you don&#8217;t need to use this variable)</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If you develop the front part of your application in the folder defined by convention (i.e. the <code>front/</code> folder of your application) the information (<code>appName</code> and <code>platformUrl</code>) will be automatically injected by the <em>ZetaPush CLI</em>.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="title">When define <code>appName</code> or <code>platformUrl</code> ?</div>
<div class="paragraph">
<p>You only need to define <code>appName</code> (and maybe <code>platformUrl</code>) in the case of you develop your application outside of the ZetaPush <em>CLI</em> context, for example if you develop a mobile app.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect5">
<h6 id="_storage_of_credentials"><a class="anchor" href="#_storage_of_credentials"></a>Storage of credentials</h6>
<div class="paragraph">
<p><em>ZetaPush client</em> is able to automatically store some information in order to reconnect the end users without requiring to enter credentials again. As said before there are two different clients:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The token for the <em>Weak Client</em></p>
</li>
<li>
<p>The credentials for the <em>Simple Client</em> (and the <em>Smart Client</em> if credentials are used)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In the two cases, a cookie is created to save the user session. It is related to the <code>appName</code> to avoid conflicts.</p>
</div>
<div class="paragraph">
<p>The token has different expiration duration according to the client type:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>Weak client</code> has no expiration meaning that once the client connection is established the first time, the cookie is set. The next connections reuse the same token. It is useful to know that the connection is for the same anonymous user as a previous session.</p>
</li>
<li>
<p><code>Simple client</code> stores the cookie for 30 days meaning that if a user authenticates the first time on your application and then leaves it, when he comes back he can directly use your application without authenticating again.</p>
</li>
</ul>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p>Obviously, token storage can be disabled and expiration duration can be configured.
This section will later describe how to enable/disable token storage, how to change storage implementation (local storage, session storage, &#8230;&#8203;) and how to change expiration duration.</p>
</div>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_multiple_api"><a class="anchor" href="#_multiple_api"></a>Multiple API</h6>
<div class="paragraph">
<p>When you expose several cloud services in your worker, some <em>cloud functions</em> may have the same name. So you need a way to indicate which <em>cloud service</em> is targeted. Therefore in your worker you can use <a href="#namespaces">namespaces</a> to name each <em>cloud service</em>. Then you also need to indicate which <em>cloud service</em> to call in your front too.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_web_development"><a class="anchor" href="#_web_development"></a>Web development</h4>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p>The integration with the front frameworks will soon be possible.
We will describe in this section how to integrate your application with
the main frameworks (<a href="#develop_with_angular">Angular</a>, <a href="#develop_with_react">React</a>, <a href="#develop_with_vue">VueJS</a>).</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="develop_with_angular"><a class="anchor" href="#develop_with_angular"></a>Angular</h5>

</div>
<div class="sect4">
<h5 id="develop_with_react"><a class="anchor" href="#develop_with_react"></a>React</h5>

</div>
<div class="sect4">
<h5 id="develop_with_vue"><a class="anchor" href="#develop_with_vue"></a>Vue.js</h5>

</div>
</div>
<div class="sect3">
<h4 id="_mobile_development"><a class="anchor" href="#_mobile_development"></a>Mobile development</h4>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p>The mobile development with ZetaPush is already possible but the documentation is not ready.
Two SDKs are available (Android and iOS). If you need to use them, please <a href="https://www.zetapush.com/contact">contact us</a>.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_android_java"><a class="anchor" href="#_android_java"></a>Android (Java)</h5>

</div>
<div class="sect4">
<h5 id="_android_kotlin"><a class="anchor" href="#_android_kotlin"></a>Android (Kotlin)</h5>

</div>
<div class="sect4">
<h5 id="_ios"><a class="anchor" href="#_ios"></a>iOS</h5>

</div>
</div>
</div>
<div class="sect2">
<h3 id="generate_sdks"><a class="anchor" href="#generate_sdks"></a>Generate SDKs from custom cloud service code</h3>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p>When you develop your business logic, you may want to create a SDKs to expose your methods.
This feature will soon be ready.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="develop_custom_cloud_services"><a class="anchor" href="#develop_custom_cloud_services"></a>Develop custom cloud services</h3>
<div class="sect4">
<h5 id="_what_is_a_em_custom_cloud_service_em"><a class="anchor" href="#_what_is_a_em_custom_cloud_service_em"></a>What is a <em>custom cloud service</em></h5>
<div class="paragraph">
<p>A <em>custom cloud service</em> combines many <em>cloud functions</em> like the <em>cloud services</em> exposed by ZetaPush. The only difference is that <strong>you</strong> create the <em>cloud functions</em>.
Generally, you will want to put the <strong>business logic</strong> of your application in the <em>custom cloud services</em>.</p>
</div>
<div class="sect5">
<h6 id="_architecture_2"><a class="anchor" href="#_architecture_2"></a>Architecture</h6>
<div class="paragraph">
<p>You develop <em>cloud services</em> that are contained in a concept named <strong>worker</strong>. In your code it is
materialized by a folder named <code>worker</code>. The worker is the ZetaPush handler that starts your code (your <em>custom cloud services</em>).</p>
</div>
<div class="paragraph">
<p>Your application is composed of a logic part (the worker) and a UI part (the front).</p>
</div>
<div class="paragraph">
<p>There are two ways of running an application (worker and front):</p>
</div>
<div class="ulist">
<ul>
<li>
<p>You develop on your machine and iterate to provide features. Your application runs locally and interacts with ZetaPush Cloud.</p>
</li>
<li>
<p>Once you are ready to make the developed features available to your end-users, you publish your application. Your application runs directly in ZetaPush Cloud.</p>
</li>
</ul>
</div>
<div class="sect6">
<h7 id="_run_on_your_machine"><a class="anchor" href="#_run_on_your_machine"></a>Run on your machine</h7>
<div class="imageblock center">
<div class="content">
<img src="custom-cloud-service-dev.png" alt="custom cloud service dev" width="709" height="430">
</div>
<div class="title">Figure 3. Interactions during development phase</div>
</div>
<div class="paragraph">
<p>Both front and worker are running locally. The front interacts with <em>custom cloud services</em> contained in the worker through
ZetaPush Cloud.
As ZetaPush Cloud provides bidirectional connection, the <em>custom cloud services</em> can also interact with the front through
ZetaPush Cloud too.</p>
</div>
<div class="paragraph">
<p>A <em>custom cloud service</em> can interact with <em>built-in cloud services</em> provided by ZetaPush.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>When you start using ZetaPush, you only develop locally so from your point of vue,
your front seems to directly interact with your <em>custom cloud services</em>.</p>
</div>
<div class="paragraph">
<p>In fact, all messages go through the Internet and ZetaPush Cloud.
It means that a published front can interact with a worker that is running locally and vice versa.</p>
</div>
<div class="paragraph">
<p>See <a href="#mix_local_and_remote">how to mix local worker with worker running in cloud</a></p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect6">
<h7 id="_run_in_cloud"><a class="anchor" href="#_run_in_cloud"></a>Run in cloud</h7>
<div class="imageblock center">
<div class="content">
<img src="custom-cloud-service-prod.png" alt="custom cloud service prod" width="681" height="387">
</div>
<div class="title">Figure 4. Custom Cloud Service in production phase</div>
</div>
<div class="paragraph">
<p>Once published, everything runs in the ZetaPush Cloud. However the behavior is the same.
Every interaction between the front and <em>custom cloud services</em> goes through the ZetaPush Cloud.</p>
</div>
<div class="paragraph">
<p>The only main difference is that ZetaPush Cloud manages the hosting, the scalability and the
high availability for you.</p>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_develop_a_em_custom_cloud_services_em"><a class="anchor" href="#_develop_a_em_custom_cloud_services_em"></a>Develop a <em>custom cloud services</em></h5>
<div class="sect5">
<h6 id="_define_a_em_custom_cloud_service_em"><a class="anchor" href="#_define_a_em_custom_cloud_service_em"></a>Define a <em>custom cloud service</em></h6>
<div class="paragraph">
<p>As a reminder worker is the ZetaPush container that will handle your code that defines <em>custom cloud services</em>.
By convention, the code of your <em>custom cloud services</em> is placed in files under <code>worker</code> directory:</p>
</div>
<div class="listingblock">
<div class="title">Tree structure convention</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="console">myApp
 <em>.zetarc</em>
 <em>.gitignore</em>
 <em>front</em>
    ...
    ...
 <strong>worker</strong>
    file1.ts
    file2.ts
    ...
    fileN.ts
    index.ts
 <em>package.json</em>
 <em>README.md</em>
 <em>tsconfig.json</em></code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Change directory structure</div>
<div class="paragraph">
<p>See more information about <a href="#different_directory_structures">directory structure convention and how to adapt the structure</a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Translated into code, a <em>custom cloud service</em> is just a <code>class</code> and its <code>methods</code> are the  <em>cloud functions</em>.
The code is written in any <code>ts</code> file defined in <code>worker</code> directory. For small application like a "hello world",
write your code directly in <code>index.ts</code> file.
So the most basic example of a <em>custom cloud service</em> is below:</p>
</div>
<div class="listingblock">
<div class="title">Basic custom cloud service</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
</pre></td>
  <td class="code"><pre><span class="reserved">class</span> HelloWorldAsCustomCloudService {     <i class="conum" data-value="1"></i><b>(1)</b>

    constructor() {}                       <i class="conum" data-value="2"></i><b>(2)</b>

    helloWorld() {                         <i class="conum" data-value="3"></i><b>(3)</b>
        <span class="keyword">return</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">Hello World</span><span class="delimiter">&quot;</span></span>;
    }
}</pre></td>
</tr></table></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>A custom cloud service is encapsulated in a JavaScript/TypeScript class. <strong>HelloWorldAsCustomCloudService</strong> is your first <em>custom cloud service</em>.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>A class can define a constructor. We will see later why it is important</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td><code>helloWorld</code> is your first <em>custom cloud function</em></td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
A <em>cloud function</em> is always asynchronous (with the <em>async</em> keyword or not)
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Change entry point</div>
<div class="paragraph">
<p>By default, the code above is directly written in <code>index.ts</code> file. This is done in order
to follow NodeJS conventions. Indeed, <code>index.ts</code> is the usually the file that imports
all other files.</p>
</div>
<div class="paragraph">
<p>You can write code of your <em>custom cloud services</em> in any other file named as you want.
You will see <a href="#change-worker-entry-point">in the reference part</a> how to indicate to ZetaPush worker how to find your files if you don&#8217;t
want to follow convention.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect6">
<h7 id="_define_a_em_cloud_function_em"><a class="anchor" href="#_define_a_em_cloud_function_em"></a>Define a <em>cloud function</em></h7>
<div class="paragraph">
<p>Each <em>cloud function</em> in a <em>custom cloud service</em> is a standard JavaScript/TypeScript
method.
For example, if you want a <em>cloud function</em> that receives two parameters you write:</p>
</div>
<div class="listingblock highlight-lines:8-14">
<div class="title">A more realistic <em>cloud function</em></div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre></td>
  <td class="code"><pre><span class="reserved">class</span> HelloWorldAsCustomCloudService {                            <i class="conum" data-value="1"></i><b>(1)</b>
    constructor() {}

    helloWorld() {
        <span class="keyword">return</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">Hello World</span><span class="delimiter">&quot;</span></span>;
    }

    saySomething(message: string, <span class="key">times</span>: number) {                <i class="conum" data-value="2"></i><b>(2)</b>
        let fullMessage = <span class="string"><span class="delimiter">'</span><span class="delimiter">'</span></span>;
        <span class="keyword">for</span>(let i=<span class="integer">0</span> ; i&lt;times ; i++) {                            <i class="conum" data-value="3"></i><b>(3)</b>
            fullMessage += <span class="error">`</span><span class="predefined">$</span>{message}<span class="error">\</span>n<span class="error">`</span>
        }
        <span class="keyword">return</span> fullMessage                                        <i class="conum" data-value="4"></i><b>(4)</b>
    }
}</pre></td>
</tr></table></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <em>custom cloud service</em> definition as seen before</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Declaration of a <em>cloud function</em> named <code>saySomething</code>. This <em>cloud function</em> accepts
two parameters. As <a href="#javascript_vs_typescript">TypeScript is the recommended way</a>, each parameter is typed.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Just for an example, the business logic consists in looping a number of times
and concatenating the message. You can obviously write any code you want here.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>The <em>custom cloud function</em> simply returns the contactenated string.</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Why typing ?</div>
<div class="paragraph">
<p>Typing is optional but recommended to have a well defined API. Thanks to typing,
ZetaPush is able to generate more accurate <a href="#generate_api_documentation">documentation based on your code</a> and also
<a href="#generate_sdks">generate mobile/web/IoT SDKs</a> from your code with the right types so it
makes developing your clients easier (for example, auto-completion can be used).</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Tips about cloud functions</div>
<div class="paragraph">
<p>A <em>custom cloud service</em> can have as many <em>custom cloud functions</em> as you want.</p>
</div>
<div class="paragraph">
<p>A <em>custom cloud function</em> can have as many parameters as you want. Parameters can be anything: <code>string</code>, <code>number</code>,
<code>boolean</code>, <code>array</code> or <code>object</code>. You can code your function as you always do.</p>
</div>
<div class="paragraph">
<p>A <em>custom cloud function</em> can return anything including a <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise">Promise</a>.
You can also write your code using <a href="https://javascript.info/async-await">async/await syntax</a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Define several <em>custom cloud services</em></div>
<div class="paragraph">
<p>Obviously when your application grows, you need to split your <em>custom cloud service</em> into several classes in order
to make your API more understandable and more maintainable.</p>
</div>
<div class="paragraph">
<p>You can learn <a href="#several_custom_cloud services">how to define several <em>custom cloud services</em></a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You have now a <em>custom cloud service</em> that provides two <em>cloud functions</em>.
But until it is exposed, it can&#8217;t be called from outside of the worker.</p>
</div>
<div class="paragraph">
<p>The next section describes how you can expose your <em>custom cloud service</em>.</p>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_expose_a_em_custom_cloud_service_em"><a class="anchor" href="#_expose_a_em_custom_cloud_service_em"></a>Expose a <em>custom cloud service</em></h6>
<div class="paragraph">
<p>When you define a <em>custom cloud service</em> that you want to expose to the client,
you need to declare it. There are 2 cases:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Only one <em>custom cloud service</em> exposed</p>
</li>
<li>
<p>Many <em>custom cloud services</em> exposed</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In this section we only address one <em>custom cloud service</em> exposed.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">How to expose several <em>custom cloud services</em></div>
<div class="paragraph">
<p>You can also learn <a href="#expose_several_custom_cloud_services">how to expose several <em>custom cloud services</em></a> in the advanced sections.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>We follow npm conventions to indicate the entry point of your worker. Indeed, the <code>package.json</code> defines a property named <code>main</code>.
We use this property to indicate which file is the main file that declares the exposed <em>custom cloud service</em>.
By default, the main file is named <code>index.ts</code> and this file is placed in <code>worker</code> directory. So the <code>main</code>
property is by default <code>worker/index.ts</code>.</p>
</div>
<div class="imageblock center">
<div class="content">
<img src="custom-cloud-service-entry-point.png" alt="custom cloud service entry point" width="678" height="161">
</div>
</div>
<div class="paragraph">
<p>Now that your <em>custom cloud service</em> is marked as the entry point, it can be exposed by ZetaPush.
However you still have a little change to make on your code:</p>
</div>
<div class="listingblock highlight-lines:1">
<div class="title">A more realistic <em>cloud function</em></div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre></td>
  <td class="code"><pre><span class="reserved">export</span> <span class="keyword">default</span> <span class="reserved">class</span> HelloWorldAsCustomCloudService {                    <i class="conum" data-value="1"></i><b>(1)</b> <i class="conum" data-value="2"></i><b>(2)</b>
    constructor() {}

    helloWorld() {
        <span class="keyword">return</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">Hello World</span><span class="delimiter">&quot;</span></span>;
    }

    saySomething(message: string, <span class="key">times</span>: number) {
        let fullMessage = <span class="string"><span class="delimiter">'</span><span class="delimiter">'</span></span>;
        <span class="keyword">for</span>(let i=<span class="integer">0</span> ; i&lt;times ; i++) {
            fullMessage += <span class="error">`</span><span class="predefined">$</span>{message}<span class="error">\</span>n<span class="error">`</span>
        }
        <span class="keyword">return</span> fullMessage
    }
}</pre></td>
</tr></table></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>export</code>: <a href="https://www.typescriptlang.org/docs/handbook/modules.html" target="_blank" rel="noopener">this is required by TypeScript</a>.
In fact, declaring a class in a file makes it private.
It means that if you have another <code>.ts</code> file and you want to import <code>HelloWorldAsCustomCloudService</code> declaration,
it won&#8217;t be possible without <code>export</code> keyword. This is for code encapsulation.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td><code>default</code>: <a href="https://www.typescriptlang.org/docs/handbook/modules.html#default-exports">TypeScript provides this keyword</a>.
When exposing only one <em>custom cloud service</em>, <code>default</code> tells the worker that there is only one class (only one
<em>custom cloud service</em> defined in the <code>index.ts</code>). So the worker can directly analyze it and instantiate it.</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">How to expose several <em>custom cloud services</em></div>
<div class="paragraph">
<p>As seen above, you can also learn <a href="#expose_several_custom_cloud_services">how to expose several <em>custom cloud services</em></a> in the advanced sections.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Now your <em>custom cloud service</em> can be loaded by the ZetaPush worker and your <em>custom cloud service</em>
is automatically exposed.
It means that now a client can call the <em>cloud functions</em> defined in your <em>custom cloud service</em>.</p>
</div>
<div class="paragraph">
<p>The next section shows how to call a <em>cloud function</em> from a web page using pure JavaScript.</p>
</div>
</div>
<div class="sect5">
<h6 id="_use_a_em_custom_cloud_service_em_in_your_front"><a class="anchor" href="#_use_a_em_custom_cloud_service_em_in_your_front"></a>Use a <em>custom cloud service</em> in your front</h6>
<div class="paragraph">
<p>In this chapter we will see how to consume our <em>cloud functions</em> from a web page.
At the end of this example, we will have one button to call <code>helloWorld</code> <em>cloud function</em> and
one section with a message, a number of repetitions and a button to call <code>saySomething</code> <em>cloud function</em>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Mobile applications</div>
<div class="paragraph">
<p>Here we show how to create a web page that consumes our <em>custom cloud service</em>.</p>
</div>
<div class="paragraph">
<p>You can also create a mobile application for Android, iOS and Windows Phone as well
as code for a device. You can use any language you want for the client part.</p>
</div>
<div class="paragraph">
<p>By default we target web because it is currently the most used technology (even to build
some mobile applications using hybrid technologies).</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>As a reminder, here is the code of <em>custom cloud service</em> named <code>HelloWorldAsCustomCloudService</code>:</p>
</div>
<div class="listingblock">
<div class="title">worker/index.ts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre></td>
  <td class="code"><pre><span class="reserved">export</span> <span class="keyword">default</span> <span class="reserved">class</span> HelloWorldAsCustomCloudService {
    constructor() {}

    helloWorld() {
        <span class="keyword">return</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">Hello World</span><span class="delimiter">&quot;</span></span>;
    }

    saySomething(message: string, <span class="key">times</span>: number) {
        let fullMessage = <span class="string"><span class="delimiter">'</span><span class="delimiter">'</span></span>;
        <span class="keyword">for</span>(let i=<span class="integer">0</span> ; i&lt;times ; i++) {
            fullMessage += <span class="error">`</span><span class="predefined">$</span>{message}<span class="error">\</span>n<span class="error">`</span>
        }
        <span class="keyword">return</span> fullMessage
    }
}</pre></td>
</tr></table></code></pre>
</div>
</div>
<div class="sect6">
<h7 id="_prepare_your_front_for_using_zetapush_client"><a class="anchor" href="#_prepare_your_front_for_using_zetapush_client"></a>Prepare your front for using ZetaPush client</h7>
<div class="paragraph">
<p>By convention the directory structure of a ZetaPush application is defined below. You place
the code of your web page in the <code>front</code> directory:</p>
</div>
<div class="listingblock">
<div class="title">Tree structure convention</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="console">myApp
 <em>.zetarc</em>
 <em>.gitignore</em>
 <strong>front</strong>
    ...
    <strong>index.js</strong>
    <strong>index.html</strong>
 <em>worker</em>
    ...
    ...
    index.ts
 <em>package.json</em>
 <em>README.md</em>
 <em>tsconfig.json</em></code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Other front files</div>
<div class="paragraph">
<p>For this example, we only need an HTML page and a JavaScript file. Needless to say that you can
have CSS files, images and anything you want too.</p>
</div>
<div class="paragraph">
<p>See more information about <a href="#different_directory_structures">directory structure convention and how to adapt the structure</a>.</p>
</div>
<div class="paragraph">
<p>Moreover, you are not limited to write pure JavaScript code. You can also use any framework you want:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#develop_with_angular">Angular</a></p>
</li>
<li>
<p><a href="#develop_with_react">React</a></p>
</li>
<li>
<p><a href="#develop_with_vue">Vue.js</a></p>
</li>
<li>
<p>&#8230;&#8203;</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>For the example, we create an HTML page with a button to display the <em>HelloWorld</em> message in the page each time
the button is clicked:</p>
</div>
<div class="listingblock">
<div class="title">front/index.html</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="html"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
</pre></td>
  <td class="code"><pre><span class="doctype">&lt;!DOCTYPE html&gt;</span>
<span class="tag">&lt;html</span> <span class="attribute-name">lang</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">en</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>

<span class="tag">&lt;head&gt;</span>
    <span class="tag">&lt;meta</span> <span class="attribute-name">charset</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">UTF-8</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
    <span class="tag">&lt;meta</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">viewport</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">content</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">width=device-width, initial-scale=1.0</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
    <span class="tag">&lt;title&gt;</span>Celtia<span class="tag">&lt;/title&gt;</span>
<span class="tag">&lt;/head&gt;</span>

<span class="tag">&lt;body&gt;</span>
    <span class="tag">&lt;button</span> <span class="attribute-name">onclick</span>=<span class="string"><span class="delimiter">&quot;</span>hello()<span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>hello<span class="tag">&lt;/button&gt;</span>                    <i class="conum" data-value="1"></i><b>(1)</b>
    <span class="tag">&lt;ul</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">result-container</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span><span class="tag">&lt;/ul&gt;</span>                             <i class="conum" data-value="2"></i><b>(2)</b>

    <span class="tag">&lt;script</span> <span class="attribute-name">src</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">https://unpkg.com/@zetapush/client</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span><span class="tag">&lt;/script&gt;</span>  <i class="conum" data-value="2"></i><b>(2)</b>
    <span class="tag">&lt;script</span> <span class="attribute-name">src</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">./index.js</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span><span class="tag">&lt;/script&gt;</span>                          <i class="conum" data-value="3"></i><b>(3)</b>
<span class="tag">&lt;/body&gt;</span>

<span class="tag">&lt;/html&gt;</span></pre></td>
</tr></table></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>We call <code>hello()</code> function that is defined later in <code>index.js</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Define a node that will display received messages</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>We include the <code>client</code> module provided by ZetaPush</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>We include a JavaScript file to distinguish HTML code from JavaScript code. All could be written in the HTML</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Then, in order to interact with ZetaPush cloud, we need to create a client instance
and to connect to the cloud:</p>
</div>
<div class="listingblock">
<div class="title">front/index.js</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
</pre></td>
  <td class="code"><pre><span class="comment">// Create new ZetaPush Client</span>
const client = <span class="keyword">new</span> ZetaPushClient.WeakClient();     <i class="conum" data-value="1"></i><b>(1)</b>
<span class="comment">// Create a proxy to invoked worker methods</span>
const api = client.createProxyTaskService();        <i class="conum" data-value="2"></i><b>(2)</b>
<span class="comment">// Handle connection</span>
client.connect()                                    <i class="conum" data-value="3"></i><b>(3)</b>
  .then(() =&gt; {                                     <i class="conum" data-value="4"></i><b>(4)</b>
    console.debug(<span class="string"><span class="delimiter">'</span><span class="content">onConnectionEstablished</span><span class="delimiter">'</span></span>);
  });</pre></td>
</tr></table></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Use ZetaPushClient factory to instantiate a client. In this example, we ask for an anonymous connection (it means that actions are not bound to a particular user of your application)</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Custom cloud service provides some functions that can be called from a client. For example, the <em>custom cloud service</em> exposes <code>helloWorld</code> and <code>saySomething</code> <em>cloud functions</em>.
Instead of having to write the signature of these functions in the client too, we simply use a JavaScript <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Proxy">Proxy</a>.
Therefore, you can directly interact with your custom cloud service without writing any pass-through code on the client side.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The client is ready, now connects it to the ZetaPush cloud.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Once the connection is established, the Promise is resolved and you can write some code in <code>then</code> callback.</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Available client types</div>
<div class="paragraph">
<p><code>ZetaPushClient</code> provides several factories to get instances of a client according to
what you want to do. Here we are using a <code>WeakClient</code> instance but there are other
<a href="#client_types">client types</a>.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect6">
<h7 id="_call_code_hello_code_em_cloud_function_em"><a class="anchor" href="#_call_code_hello_code_em_cloud_function_em"></a>Call <code>hello</code> <em>cloud function</em></h7>
<div class="paragraph">
<p>Our client is ready and now we want to call <em>cloud function</em> named <code>helloWorld</code>, we add the following code:</p>
</div>
<div class="listingblock highlight-lines:11-14">
<div class="title">front/index.js</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre></td>
  <td class="code"><pre><span class="comment">// Create new ZetaPush Client</span>
const client = <span class="keyword">new</span> ZetaPushClient.WeakClient();
<span class="comment">// Create a proxy to invoked worker methods</span>
const api = client.createProxyTaskService();
<span class="comment">// Handle connection</span>
client.connect()
  .then(() =&gt; {
    console.debug(<span class="string"><span class="delimiter">'</span><span class="content">onConnectionEstablished</span><span class="delimiter">'</span></span>);
  });
<span class="comment">// Handle DOM events</span>
async <span class="keyword">function</span> <span class="function">hello</span>() {                                                                          <i class="conum" data-value="1"></i><b>(1)</b>
  const messageFromCloudFunction = await api.helloWorld();                                        <i class="conum" data-value="2"></i><b>(2)</b>
  document.getElementById(<span class="string"><span class="delimiter">'</span><span class="content">result-container</span><span class="delimiter">'</span></span>).innerHTML += <span class="error">`</span><span class="tag">&lt;li&gt;</span>${messageFromCloudFunction}<span class="tag">&lt;/li&gt;</span><span class="error">`</span> <i class="conum" data-value="3"></i><b>(3)</b>
}</pre></td>
</tr></table></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Each time a user clicks on the button defined in the HTML, this method is called.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Calls the <code>helloWorld</code> <em>cloud function</em> and store the result in a variable.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Add a new list item in the HTML page</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Before running this sample, we improve our front in order to also understand
how to call a <em>cloud function</em> that has parameters.</p>
</div>
</div>
<div class="sect6">
<h7 id="_call_code_saysomething_code_em_cloud_function_em"><a class="anchor" href="#_call_code_saysomething_code_em_cloud_function_em"></a>Call <code>saySomething</code> <em>cloud function</em></h7>
<div class="paragraph">
<p>We add two inputs to be able to send values to the <code>saySomething</code> <em>cloud function</em>.
The first input is a text to repeat. The second input is the number of times to repeat the message.
Here is the updated code:</p>
</div>
<div class="listingblock highlight-lines:12-16">
<div class="title">front/index.html</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="html"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
</pre></td>
  <td class="code"><pre><span class="doctype">&lt;!DOCTYPE html&gt;</span>
<span class="tag">&lt;html</span> <span class="attribute-name">lang</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">en</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>

<span class="tag">&lt;head&gt;</span>
    <span class="tag">&lt;meta</span> <span class="attribute-name">charset</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">UTF-8</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
    <span class="tag">&lt;meta</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">viewport</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">content</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">width=device-width, initial-scale=1.0</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
    <span class="tag">&lt;title&gt;</span>Celtia<span class="tag">&lt;/title&gt;</span>
<span class="tag">&lt;/head&gt;</span>

<span class="tag">&lt;body&gt;</span>
    <span class="tag">&lt;button</span> <span class="attribute-name">onclick</span>=<span class="string"><span class="delimiter">&quot;</span>hello()<span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>hello<span class="tag">&lt;/button&gt;</span>
    <span class="tag">&lt;div</span> <span class="attribute-name">style</span>=<span class="string"><span class="delimiter">&quot;</span><span class="key">border</span>: <span class="float">1px</span> <span class="value">solid</span> <span class="color">#ccc</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
      Message: <span class="tag">&lt;input</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">text</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">message-input</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>             <i class="conum" data-value="1"></i><b>(1)</b>
      Repeat: <span class="tag">&lt;input</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">text</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">1</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">repeat-input</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>     <i class="conum" data-value="2"></i><b>(2)</b>
      <span class="tag">&lt;button</span> <span class="attribute-name">onclick</span>=<span class="string"><span class="delimiter">&quot;</span>saySeveralTimes()<span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>say something<span class="tag">&lt;/button&gt;</span>    <i class="conum" data-value="3"></i><b>(3)</b>
    <span class="tag">&lt;/div&gt;</span>
    <span class="tag">&lt;ul</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">result-container</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span><span class="tag">&lt;/ul&gt;</span>

    <span class="tag">&lt;script</span> <span class="attribute-name">src</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">https://unpkg.com/@zetapush/client</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span><span class="tag">&lt;/script&gt;</span>
    <span class="tag">&lt;script</span> <span class="attribute-name">src</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">./index.js</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span><span class="tag">&lt;/script&gt;</span>
<span class="tag">&lt;/body&gt;</span>

<span class="tag">&lt;/html&gt;</span></pre></td>
</tr></table></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The first input to enter a message</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The second input to enter the number of times to repeat the message</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>A new button to call <code>saySeveralTimes()</code> function defined in <code>index.js</code></td>
</tr>
</table>
</div>
<div class="listingblock highlight-lines:15-20">
<div class="title">front/index.js</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
</pre></td>
  <td class="code"><pre><span class="comment">// Create new ZetaPush Client</span>
const client = <span class="keyword">new</span> ZetaPushClient.WeakClient();
<span class="comment">// Create a proxy to invoked worker methods</span>
const api = client.createProxyTaskService();
<span class="comment">// Handle connection</span>
client.connect()
  .then(() =&gt; {
    console.debug(<span class="string"><span class="delimiter">'</span><span class="content">onConnectionEstablished</span><span class="delimiter">'</span></span>);
  });
<span class="comment">// Handle DOM events</span>
async <span class="keyword">function</span> <span class="function">hello</span>() {
  const messageFromCloudFunction = await api.helloWorld();
  document.getElementById(<span class="string"><span class="delimiter">'</span><span class="content">result-container</span><span class="delimiter">'</span></span>).innerHTML += <span class="error">`</span><span class="tag">&lt;li&gt;</span>${messageFromCloudFunction}<span class="tag">&lt;/li&gt;</span><span class="error">`</span>
}
async <span class="keyword">function</span> <span class="function">saySeveralTimes</span>() {                                                <i class="conum" data-value="1"></i><b>(1)</b>
  const message = document.getElementById(<span class="string"><span class="delimiter">'</span><span class="content">message-input</span><span class="delimiter">'</span></span>).value;                 <i class="conum" data-value="2"></i><b>(2)</b>
  const repeat = document.getElementById(<span class="string"><span class="delimiter">'</span><span class="content">repeat-input</span><span class="delimiter">'</span></span>).value;                   <i class="conum" data-value="3"></i><b>(3)</b>
  const messages = await api.saySomething(message, parseInt(repeat));             <i class="conum" data-value="4"></i><b>(4)</b>
  document.getElementById(<span class="string"><span class="delimiter">'</span><span class="content">result-container</span><span class="delimiter">'</span></span>).innerHTML += <span class="error">`</span><span class="tag">&lt;li&gt;</span>${messages}<span class="tag">&lt;/li&gt;</span><span class="error">`</span> <i class="conum" data-value="5"></i><b>(5)</b>
}</pre></td>
</tr></table></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Each time a user clicks on the button 'say something' defined in the HTML, this method is called.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Reads the value of the input for getting the message.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Reads the value of the input for getting the number of times to display the message.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Calls <code>saySomething</code> <em>cloud function</em> with parameters. Note that as second parameter is a number, we have to convert the string from
the input to a number using <code>parseInt</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Add a new list item in the HTML page containing the repeated messages</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Now everything is ready to run our application.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
When you call a <em>cloud function</em> from the client, the result is always a Promise even if the <em>custom cloud function</em> is synchronous
because everything goes through the network.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_run_application"><a class="anchor" href="#_run_application"></a>Run application</h6>
<div class="paragraph">
<p>You have now defined a <em>custom cloud service</em> with one or several <em>cloud function(s)</em>. You
have also exposed your <em>custom cloud service</em>. So it is ready to be called from a client.
Your client is also ready to call the <em>custom cloud service</em>.</p>
</div>
<div class="paragraph">
<p>The next step is to start the project (both front and worker) using the ZetaPush <em>CLI</em>
on your computer.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Npm script aliases</div>
<div class="paragraph">
<p>Npm provides a handy feature
to run scripts provided by dependencies without needing to change your computer settings or
install the tool. ZetaPush defines npm <a href="https://medium.com/@mxstbr/npm-scripts-explained-f125e85eb378" target="_blank" rel="noopener">script aliases</a>
to run the ZetaPush <em>CLI</em> through npm.</p>
</div>
<div class="paragraph">
<p>See <a href="./developer-manual.html#_using_cli">for more information about the ways of using the CLI</a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To start your worker and you front using the ZetaPush <em>CLI</em> through npm, you simply run:</p>
</div>
<div class="listingblock">
<div class="title">Start application (front and custom cloud services)</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="console">$ npm run start -- --serve-front</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p><code>npm run start</code> is a script alias defined in the <code>package.json</code> file.
The command that is executed under the hood is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="console">$ zeta run --serve-front</code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Run only the worker</div>
<div class="paragraph">
<p>It is also possible to <a href="#run_worker_only">run only your worker</a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="title">Automatic injection of ZetaPush information in your front</div>
<div class="paragraph">
<p>If you look closely to the code we have written, there is no information about your application at all in this sample code (the <code>appName</code> defined in <code>.zetarc</code> is neither in HTML nor in JavaScript).
However, in order to interact with your application through the ZetaPush cloud, you need to provide the <code>appName</code>.</p>
</div>
<div class="paragraph">
<p>The ZetaPush <em>CLI</em> automatically injects the <code>appName</code> from <code>.zetarc</code>.</p>
</div>
<div class="paragraph">
<p>When you run your project locally, the local HTTP server that exposes the HTML page is lightly modified to include the <code>appName</code>.
This information is then automatically read by the ZetaPush client.</p>
</div>
<div class="paragraph">
<p>When your project is run in the cloud, the same principle is applied.</p>
</div>
<div class="paragraph">
<p>This way, you just use <code>.zetarc</code> file for your credentials and <code>appName</code> and avoid having to write them twice. This also avoids conflicts when you work
in team if you want different ZetaPush <code>appName</code> per developer.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong>Now when we click the "hello" button, "Hello World" is displayed on the page.</strong></p>
</div>
<div class="imageblock center">
<div class="content">
<img src="call-zetapush-cloud-service.png" alt="call zetapush cloud service" width="739" height="431">
</div>
<div class="title">Figure 5. How it works ?</div>
</div>
<div class="paragraph">
<p>When you start your project locally, the first thing that happens is that your worker connects himself automatically to the ZetaPush cloud <span class="sequence-step">1</span> <span class="sequence-step">2</span>.</p>
</div>
<div class="paragraph">
<p>Then when you open your web browser, the connection from the client is established between the web page and the ZetaPush cloud <span class="sequence-step">3</span> <span class="sequence-step">4</span>.</p>
</div>
<div class="paragraph">
<p>When you click on the button, a message is sent through the opened connection in order to tell ZetaPush cloud to execute some
remote code <span class="sequence-step">5</span>. ZetaPush cloud routes the message to your worker <span class="sequence-step">6</span> (that is running on your machine here). The worker receives the message
and calls the <code>hello</code> <em>cloud function</em> <span class="sequence-step">7</span>.</p>
</div>
<div class="paragraph">
<p>The <em>cloud function</em> generates a result <span class="sequence-step">8</span>. The worker picks this result and transform it to a message <span class="sequence-step">9</span>. This message is then sent
to the ZetaPush cloud <span class="sequence-step">10</span>. The ZetaPush cloud routes the response message to the calling client <span class="sequence-step">11</span>. The client receives the message
and the response is parsed <span class="sequence-step">12</span> and available in your JavaScript.</p>
</div>
<div class="paragraph">
<p><strong>You can also try to enter a message and a number of repetitions and hit the "say something" button.</strong></p>
</div>
<div class="paragraph">
<p>The behavior is exactly the same. This time a message is sent to call the <em>cloud function</em> with also the parameters.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Serialization/deserailization between client and <em>custom cloud service</em></div>
<div class="paragraph">
<p>When you call a <em>cloud function</em> from the client, under the hood, the values are serialized in JSON.
This is understandable because everything goes through the network.</p>
</div>
<div class="paragraph">
<p>On the worker side, everything is deserialized by the worker and your <em>custom cloud service</em>
receives the values as they were written in the front side.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect5">
<h6 id="_compose_cloud_services"><a class="anchor" href="#_compose_cloud_services"></a>Compose cloud services</h6>
<div class="paragraph">
<p>You can compose <em>cloud services</em> either by using <em>built-in cloud services</em> provided by ZetaPush or
by using another of your <em>custom cloud services</em>.</p>
</div>
<div class="sect6">
<h7 id="_dependency_injection"><a class="anchor" href="#_dependency_injection"></a>Dependency injection</h7>
<div class="paragraph">
<p><a href="https://en.wikipedia.org/wiki/Dependency_injection" target="_blank" rel="noopener">Dependency injection</a> is a powerful software technique that is
totally managed by the worker.</p>
</div>
<div class="paragraph">
<p>You don&#8217;t need to manage the creation of neither <em>built-in cloud services</em> nor your <em>custom cloud services</em>.
You just indicate in your code that you need a dependency and ZetaPush instantiates it
for you. The instantiated dependency is then injected everywhere the dependency is needed.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The dependency injection of ZetaPush uses Angular <a href="https://github.com/mgechev/injection-js" target="_blank" rel="noopener">injection-js</a> library.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To mark a <em>custom cloud service</em> injectable (meaning that can be automatically created by ZetaPush
and then injected everywhere the dependency is aksed),
you need to import the package <code>@zetapush/core</code> in order to use <code>Injectable</code> decorator.</p>
</div>
<div class="listingblock">
<div class="title">Install @zetapush/core using npm</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="console"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
</pre></td>
  <td class="code"><pre>$ npm install --save @zetapush/core</pre></td>
</tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>Once the npm package is installed, you can import <code>Injectable</code> decorator and place it on your <em>custom cloud service</em>:</p>
</div>
<div class="listingblock highlight-lines:1,3">
<div class="title">Use @Injectable on a <em>custom cloud service</em></div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
</pre></td>
  <td class="code"><pre><span class="reserved">import</span> { Injectable } from <span class="string"><span class="delimiter">'</span><span class="content">@zetapush/core</span><span class="delimiter">'</span></span>;            <i class="conum" data-value="1"></i><b>(1)</b>

<span class="error">@</span>Injectable()                                           <i class="conum" data-value="2"></i><b>(2)</b>
<span class="reserved">export</span> <span class="keyword">default</span> <span class="reserved">class</span> HelloWorldAsCustomCloudService {
  constructor() {}

  helloWorld() {
      <span class="keyword">return</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">Hello World</span><span class="delimiter">&quot;</span></span>;
  }

  saySomething(message: string, <span class="key">times</span>: number) {
      let fullMessage = <span class="string"><span class="delimiter">'</span><span class="delimiter">'</span></span>;
      <span class="keyword">for</span>(let i=<span class="integer">0</span> ; i&lt;times ; i++) {
          fullMessage += <span class="error">`</span><span class="predefined">$</span>{message}<span class="error">\</span>n<span class="error">`</span>
      }
      <span class="keyword">return</span> fullMessage
  }
}</pre></td>
</tr></table></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Import the ZetaPush module that contains core features for <em>custom cloud services</em> such as <code>injectable</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Mark you <em>custom cloud service</em> candidate for dependency injection</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Here we just indicate that this <em>custom cloud service</em> can have dependencies that
will be automatically injected and also that this <em>custom cloud service</em> can be injected
anywhere it is needed.</p>
</div>
<div class="paragraph">
<p>In the next sections, we will see in concrete terms how to use it to reuse either a <em>built-in cloud service</em>
or one of your <em>custom cloud services</em>.</p>
</div>
</div>
<div class="sect6">
<h7 id="_use_built_in_em_cloud_service_em"><a class="anchor" href="#_use_built_in_em_cloud_service_em"></a>Use built-in <em>cloud service</em></h7>
<div class="paragraph">
<p>ZetaPush <em>built-in cloud services</em> are available in <code>@zetapush/platform-legacy</code> module.
Add this module to your <code>package.json</code> by running the following command:</p>
</div>
<div class="listingblock">
<div class="title">Install @zetapush/platform-legacy using npm</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="console"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
</pre></td>
  <td class="code"><pre>$ npm install --save @zetapush/platform-legacy</pre></td>
</tr></table></code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">List of <em>cloud services</em> provided by ZetaPush</div>
<div class="paragraph">
<p>As a reminder, here is the <a href="#builtin_cloud_services">list of <em>built-in cloud services</em></a></p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In the following example, we will use the <code>Stack</code> <em>cloud service</em> provided by ZetaPush.
In our use-case, we want to put some data associated with the current timestamp and be able to list all stored data.</p>
</div>
<div class="paragraph">
<p>To do this, the <code>Stack</code> service already provides some methods:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>push({ <em>stack</em>: string, <em>data</em>: object });</code></p>
</li>
<li>
<p><code>list({ <em>stack</em>: string });</code></p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">MyStorageService</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
</pre></td>
  <td class="code"><pre><span class="reserved">import</span> { Injectable } from <span class="string"><span class="delimiter">'</span><span class="content">@zetapush/core</span><span class="delimiter">'</span></span>;
<span class="reserved">import</span> { Stack } from <span class="string"><span class="delimiter">'</span><span class="content">@zetapush/platform-legacy</span><span class="delimiter">'</span></span>;  <i class="conum" data-value="1"></i><b>(1)</b>

<span class="error">@</span>Injectable()
<span class="reserved">export</span> <span class="keyword">default</span> <span class="reserved">class</span> MyStorageService {
  <span class="reserved">private</span> stackName = <span class="string"><span class="delimiter">'</span><span class="content">stack-example</span><span class="delimiter">'</span></span>;

  constructor(<span class="reserved">private</span> stack: Stack) {}              <i class="conum" data-value="2"></i><b>(2)</b>

  <span class="comment">/**
   *  Store data with associated timestamp
   */</span>
  storeWithTimestamp(value: any) {
    <span class="keyword">return</span> <span class="local-variable">this</span>.stack.push({                        <i class="conum" data-value="3"></i><b>(3)</b>
      <span class="key">stack</span>: <span class="local-variable">this</span>.stackName,
      <span class="key">data</span>: {
        value,
        <span class="key">timestamp</span>: Date.now()
      }
    });
  }

  <span class="comment">/**
   * List all stored data
   */</span>
  getAllData() {
    <span class="keyword">return</span> <span class="local-variable">this</span>.stack.list({                        <i class="conum" data-value="4"></i><b>(4)</b>
      <span class="key">stack</span>: <span class="local-variable">this</span>.stackName
    });
  }
}</pre></td>
</tr></table></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>We import the <code>Stack</code> service so that TypeScript knows it</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>We ask ZetaPush to inject a dependency of type <code>Stack</code> (<code>stack</code> is an instance of <code>Stack</code>).
Here we use the <a href="https://kendaleiv.com/typescript-constructor-assignment-public-and-private-keywords/" target="_blank" rel="noopener">shorthand syntax</a> for declaring a constructor parameter as well as a property.
So the property <code>this.stack</code> is defined and is initialized with <code>stack</code> parameter.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Calls the <code>Stack</code> service to store data (method <code>push</code>)</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Calls the <code>Stack</code> service to list data (method <code>list</code>)</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The example defines a <em>custom cloud service</em> named <code>MyStorageService</code> that provides two <em>cloud functions</em>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>storeWithTimestamp</code> that receives a value from a client and calls the <code>Stack</code> service to
store received value (<code>value</code> parameter) as well as the current timestamp (using <code>Date.now()</code>)</p>
</li>
<li>
<p><code>getAllData</code> that has no parameters and calls <code>Stack</code> service to get all previsouly stored
pairs of <code>&lt;value, timestamp&gt;</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The most important part to understand is in the <code>constructor</code>. As described before,
the example uses dependency injection. You simply tell ZetaPush that you need a dependency of type <code>Stack</code>.
You don&#8217;t create it in your <em>custom cloud service</em> because it is not the responsibility of
your <em>custom cloud service</em> to create the <code>Stack</code> service. Instead, you let ZetaPush
handle the creation. Thanks to <code>@Injectable</code> decorator, ZetaPush detects that you have
a <em>custom cloud services</em> with needed dependencies. ZetaPush understands that you need a <code>Stack</code>
instance so it instantiates it before instantiating your <em>custom cloud service</em>. Then
ZetaPush instantiates your <em>custom cloud service</em> by providing, as the first argument of your
constructor here, the instance of <code>Stack</code>.</p>
</div>
<div class="paragraph">
<p>This behavior avoids you to have complex code to instantiate <em>built-in cloud services</em>. Moreover,
if you have several <em>custom cloud services</em> that are using the <code>Stack</code> service, thanks to
dependency injection, there will be only one instance shared between your <em>custom cloud services</em>.</p>
</div>
</div>
<div class="sect6">
<h7 id="_use_another_em_custom_cloud_service_em"><a class="anchor" href="#_use_another_em_custom_cloud_service_em"></a>Use another <em>custom cloud service</em></h7>
<div class="paragraph">
<p>In this example, we will have 2 <em>custom cloud services</em>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>Calendar</code>: Utils function to return the current date</p>
</li>
<li>
<p><code>HelloWorldService</code>: Basic example using <code>Calendar</code> <em>cloud function</em></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The first <em>custom cloud service</em> (<code>Calendar</code>) is defined in the file <code>worker/calendar.js</code>.</p>
</div>
<div class="listingblock">
<div class="title">worker/calendar.ts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
</pre></td>
  <td class="code"><pre><span class="reserved">export</span> <span class="reserved">class</span> Calendar {
  getNow() { <i class="conum" data-value="1"></i><b>(1)</b>
    <span class="keyword">return</span> <span class="keyword">new</span> Date().toLocalDateString(<span class="string"><span class="delimiter">'</span><span class="content">fr-FR</span><span class="delimiter">'</span></span>);
  }
}</pre></td>
</tr></table></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The only <em>cloud function</em> of the <code>Calendar</code> service</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Then, we have the <code>HelloWorldWithDateService</code> that use our <code>Calendar</code> service. It is defined in the file <code>worker/index.ts</code>.</p>
</div>
<div class="listingblock highlight-lines:7,13">
<div class="title">worker/index.ts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre></td>
  <td class="code"><pre><span class="reserved">import</span> { Injectable } from <span class="string"><span class="delimiter">'</span><span class="content">@zetapush/core</span><span class="delimiter">'</span></span>;
<span class="reserved">import</span> { Calendar } from <span class="string"><span class="delimiter">'</span><span class="content">./calendar</span><span class="delimiter">'</span></span>;        <i class="conum" data-value="1"></i><b>(1)</b>

<span class="error">@</span>Injectable()
<span class="reserved">export</span> <span class="keyword">default</span> <span class="reserved">class</span> HelloWorldWithDateService {
  constructor(                                <i class="conum" data-value="2"></i><b>(2)</b>
    <span class="reserved">private</span> calendar: Calendar
  ) {}
  <span class="comment">/**
   * Return 'Hello World' with current date
   */</span>
  helloWorldWithDate() {
    <span class="keyword">return</span> <span class="error">`</span>Hello world at <span class="predefined">$</span>{<span class="local-variable">this</span>.calendar.getNow()}<span class="error">`</span>;
 }
}</pre></td>
</tr></table></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>We import the <code>Calendar</code> service from the <code>worker/calendar.ts</code> file</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td><code>calendar</code> is an instance of <code>Calendar</code> and <code>this.calendar</code> is initialized with <code>calendar</code> value</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>As for <em>built-in cloud services</em>, dependency injection works for your <em>custom cloud services</em>.
Here it was an example</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Private <em>custom cloud service</em></div>
<div class="paragraph">
<p>In this example, we still have only one <em>custom cloud service</em> exposed.</p>
</div>
<div class="paragraph">
<p>One <code>HelloWorldWithDateService</code> is exposed and delegates some work to <code>Calendar</code>.
<code>Calendar</code> is not exposed and can&#8217;t be directly called from a client. So it can be considered
as a private <em>custom cloud service</em>.</p>
</div>
<div class="paragraph">
<p>Sometimes you may want to <a href="#expose_several_cloud_services">expose several <em>custom cloud services</em></a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Shared module of <em>custom cloud services</em></div>
<div class="paragraph">
<p>As you can see, a <em>custom cloud service</em> is no more than just a standard class with methods written
in TypeScript. If you want to develop reusable <em>custom cloud services</em> that could be
used in different applications, you can do it easily by following standards.
Actually, you can <a href="#shared_module">just create a npm module</a> and import it like we do with <code>@zetapush/core</code> or
<code>@zetapush/platform-legacy</code>.</p>
</div>
<div class="paragraph">
<p>You can also import any existing library that is available in the community.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect5">
<h6 id="onapplicationbootstrap"><a class="anchor" href="#onapplicationbootstrap"></a>Add initialization code</h6>
<div class="paragraph">
<p>ZetaPush manages scalability and redundancy of your <em>workers</em>. So there may have several workers that start at the same time. And if you initialize some data or configure some cloud services at the same time, it may have conflicts or duplicated data. To avoid that ZetaPush provides a way to initialize code that will ensure that is executed by only one worker.</p>
</div>
<div class="paragraph">
<p>For this, ZetaPush provides the <em>bootstrap</em> feature. To use it you need to implement the method <code>onApplicationBootstrap()</code> in your <em>custom cloud service</em>.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Bad practice for initialization code</div>
<div class="paragraph">
<p>You may want to put your initialization code in the constructor but this is a bad practice.
Indeed, even if in the most cases, a <em>custom cloud service</em> is a <a href="https://en.wikipedia.org/wiki/Singleton_pattern">singleton</a>, it may have several instances of your <em>custom cloud service</em> and your initialization code will be called many times. An other drawback is that the constructor is synchronous and the <code>onApplicationBootstrap</code> method is asynchronous (You can also put synchronous code in your <code>onApplicationBootstrap</code> with the <code>await</code> keyword).</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In the following example we will create a worker to store data in a database. The initialization code let you create a table in our database. Then we will create methods to add and list our data.</p>
</div>
<div class="listingblock">
<div class="title">Initialization code</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
</pre></td>
  <td class="code"><pre><span class="reserved">import</span> { Injectable, Bootstrappable } from <span class="string"><span class="delimiter">'</span><span class="content">@zetapush/core</span><span class="delimiter">'</span></span>;
<span class="reserved">import</span> { GdaConfigurer, Gda, GdaDataType } from <span class="string"><span class="delimiter">'</span><span class="content">@zetapush/platform-legacy</span><span class="delimiter">'</span></span>;

const NAME_TABLE = <span class="string"><span class="delimiter">'</span><span class="content">table</span><span class="delimiter">'</span></span>;
const NAME_COLUMN = <span class="string"><span class="delimiter">'</span><span class="content">column</span><span class="delimiter">'</span></span>;

<span class="error">@</span>Injectable()
<span class="reserved">export</span> <span class="keyword">default</span> <span class="reserved">class</span> <span class="reserved">implements</span> Bootstrappable {                              <i class="conum" data-value="1"></i><b>(1)</b>
  constructor(<span class="reserved">private</span> gdaConfigurer: GdaConfigurer, <span class="reserved">private</span> gda: Gda) {}

  async onApplicationBootstrap() {                                            <i class="conum" data-value="2"></i><b>(2)</b>
    <span class="local-variable">this</span>.gdaConfigurer.createTable({                                          <i class="conum" data-value="3"></i><b>(3)</b>
      <span class="key">name</span>: NAME_TABLE,
      <span class="key">columns</span>: [{
        <span class="key">name</span>: NAME_COLUMN,
        <span class="key">type</span>: GdaDataType.STRING
      }]
    });
  }

  async addData(data: string) {
    <span class="keyword">return</span> await <span class="local-variable">this</span>.gda.put({
      <span class="key">table</span>: NAME_TABLE,
      <span class="key">column</span>: NAME_COLUMN,
      data,
      <span class="key">key</span>: Date.now().toString()
    });
  }

  async getData() {
    <span class="keyword">return</span> await <span class="local-variable">this</span>.gda.list({
      <span class="key">table</span>: NAME_TABLE
    });
  }
}</pre></td>
</tr></table></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>We implement the <code>Bootstrappable</code> interface. This is optional (see below)</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The <code>onApplicationBootstrap()</code> method is always <em>asynchronous</em>, the <code>async</code> keyword is optional</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>In our initialization code we create a table in our database</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Bootstrappable interface</div>
<div class="paragraph">
<p>The implementation of the <code>Bootstrappable</code> interface is optional but it is a best practice, you just need to implement a method named <code>onApplicationBootstrap()</code>.
Indeed, implementing it avoids you to write wrong implementation of <code>onApplicationBootstrap()</code> method. It also indicates to other developers that you really wanted to add initialization code to your <em>cloud service</em> on purpose and it also provides documentation about <code>onApplicationBootstrap</code> method directly in code.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You can implement the <code>onApplicationBootstrap()</code> method in several <em>custom cloud services</em>.
A dependency tree will be created to execute all <code>onApplicationBootstrap()</code> methods in the proper order (regarding of the needed dependencies).</p>
</div>
<div class="paragraph">
<p>For example in the following scheme, we have 2 exposed API named <em>Dashboard</em> and <em>Mobile</em>.
For the case of the <em>Dashboard</em> API, it uses another service named <em>Admin</em>, that uses <em>User Management</em> and <em>Stock Management</em> services and so on.</p>
</div>
<div class="paragraph">
<p>So the services are initialized in a specific order :</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Utils</p>
</li>
<li>
<p>User Data / Stock Data</p>
</li>
<li>
<p>User Management / Stock Management / Stock Market</p>
</li>
<li>
<p>Admin / Client API / Guest Access</p>
</li>
<li>
<p>Dashboard / Mobile</p>
</li>
</ol>
</div>
<div class="imageblock center">
<div class="content">
<img src="./images//schemas/bootstrap_order.png" alt="bootstrap order">
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_advanced_usage_of_cloud_services"><a class="anchor" href="#_advanced_usage_of_cloud_services"></a>Advanced usage of cloud services</h3>
<div class="sect3">
<h4 id="several_custom_cloud_services"><a class="anchor" href="#several_custom_cloud_services"></a>Several custom cloud services</h4>
<div class="sect4">
<h5 id="_develop_a_cloud_service_that_is_not_exposed"><a class="anchor" href="#_develop_a_cloud_service_that_is_not_exposed"></a>Develop a cloud service that is not exposed</h5>
<div class="paragraph">
<p>During the development of your <em>custom cloud services</em> you may want to not expose some of them.
In this case, the affected <em>custom cloud services</em> are not reachable by the client.</p>
</div>
<div class="listingblock highlight-lines:3-13">
<div class="title">Example of private <em>custom cloud service</em></div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
</pre></td>
  <td class="code"><pre><span class="reserved">import</span> { Injectable } from <span class="string"><span class="delimiter">'</span><span class="content">@zetapush/core</span><span class="delimiter">'</span></span>;

<span class="comment">/**
 * This is a private cloud service
 */</span>
<span class="reserved">class</span> MyTimeManager {                                                     <i class="conum" data-value="1"></i><b>(1)</b>
  <span class="comment">/**
   * This is a private cloud function
   */</span>
  getCurrentTime() {                                                      <i class="conum" data-value="2"></i><b>(2)</b>
    <span class="keyword">return</span> Date.now();
  }
}

<span class="error">@</span>Injectable()                                                             <i class="conum" data-value="3"></i><b>(3)</b>
<span class="reserved">export</span> <span class="keyword">default</span> <span class="reserved">class</span> {
  constructor(<span class="reserved">private</span> timeManager: MyTimeManager) {}                      <i class="conum" data-value="4"></i><b>(4)</b>

  hello() {                                                               <i class="conum" data-value="5"></i><b>(5)</b>
    <span class="keyword">return</span> <span class="error">`</span>Hello from Worker at <span class="predefined">$</span>{<span class="local-variable">this</span>.timeManager.getCurrentTime()}<span class="error">`</span>;
  }
}</pre></td>
</tr></table></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Our private <em>custom cloud service</em> (no <code>export</code> keyword)</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td><code>getCurrentTime()</code> is not reachable by the client (front part of your application)</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>We specify that we want to use the dependency injection in our class</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>We ask the dependency injection to have an instance of <code>MyTimeManager</code></td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td><code>hello()</code> is the only method reachable by the client (front part of your application)</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="expose_several_cloud_services"><a class="anchor" href="#expose_several_cloud_services"></a>Expose several cloud services</h5>
<div class="paragraph">
<p><em>ZetaPush</em> provides the possibility to expose several <em>custom cloud services</em> if you want.
For example, you may have two <em>custom cloud services</em> that have same <em>cloud function</em> names.
To differentiate them we provide <em>namespaces</em></p>
</div>
<div class="sect5">
<h6 id="namespaces"><a class="anchor" href="#namespaces"></a>Namespaces</h6>
<div class="paragraph">
<p>With the <em>namespaces</em> you can separate several <em>custom cloud services</em>.
The result is that if a <em>ZetaPush API</em> created by a <em>ZetaPush Client</em> is configured to reach one <em>namespace</em>, the <em>cloud functions</em> exposed in the others <em>namespaces</em> will not be reachable with this API.</p>
</div>
<div class="paragraph">
<p>If we take the previous example, we may want to expose our two <em>custom cloud services</em> in two <em>namespaces</em> named <code>time</code> and <code>default</code>.</p>
</div>
<div class="paragraph tab-container">
<p>Example of several <em>custom cloud services</em> exposed</p>
</div>
<div class="paragraph tab">
<p>index.ts (worker)</p>
</div>
<div class="listingblock highlight-lines:8-10,23-24">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
</pre></td>
  <td class="code"><pre><span class="reserved">import</span> { Injectable, Module } from <span class="string"><span class="delimiter">'</span><span class="content">@zetapush/core</span><span class="delimiter">'</span></span>;

<span class="reserved">class</span> MyTimeManager {                                                         <i class="conum" data-value="1"></i><b>(1)</b>
  getCurrentTime() {
    <span class="keyword">return</span> Date.now();
  }

  hello() {
    <span class="keyword">return</span> <span class="error">`</span>Hello from MyTimeManager at <span class="predefined">$</span>{<span class="local-variable">this</span>.getCurrentTime()}<span class="error">`</span>;
  }
}

<span class="error">@</span>Injectable()
<span class="reserved">class</span> MyDefaultApi {                                                          <i class="conum" data-value="2"></i><b>(2)</b>
  constructor(<span class="reserved">private</span> timeManager: MyTimeManager) {}

  hello() {
    <span class="keyword">return</span> <span class="error">`</span>Hello from Worker at <span class="predefined">$</span>{<span class="local-variable">this</span>.timeManager.getCurrentTime()}<span class="error">`</span>;
  }
}

<span class="error">@</span>Module({                                                                     <i class="conum" data-value="3"></i><b>(3)</b>
  <span class="key">expose</span>: {
    <span class="key">timer</span>: MyTimeManager,
    <span class="keyword">default</span>: MyDefaultApi
  }
})
<span class="reserved">export</span> <span class="keyword">default</span> <span class="reserved">class</span> {}</pre></td>
</tr></table></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>A <em>custom cloud service</em> definition that defines <code>hello</code> <em>cloud function</em></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Another <em>custom cloud service</em> definition that also defines <code>hello</code> <em>cloud function</em></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>We expose a class that is defined as a <a href="#modules"><em>Module</em></a>.
In the property <code>expose</code> we define in which <em>namespace</em> we expose each of our <em>custom cloud services</em>. By explicitly associating <code>MyTimeManager</code> to <code>timer</code> key, <code>MyTimeManager</code> <em>cloud service</em> is exposed through <code>timer</code> <em>namespace</em>. Same applies to <code>MyDefaultApi</code> that is exposed through <code>default</code> <em>namespace</em></td>
</tr>
</table>
</div>
<div class="paragraph tab">
<p>index.html</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="html"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre></td>
  <td class="code"><pre><span class="doctype">&lt;!DOCTYPE html&gt;</span>
<span class="tag">&lt;html</span> <span class="attribute-name">lang</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">en</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;head&gt;</span>
    <span class="tag">&lt;meta</span> <span class="attribute-name">charset</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">UTF-8</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
    <span class="tag">&lt;meta</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">viewport</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">content</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">width=device-width, initial-scale=1.0</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
    <span class="tag">&lt;meta</span> <span class="attribute-name">http-equiv</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">X-UA-Compatible</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">content</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">ie=edge</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
    <span class="tag">&lt;title&gt;</span>Several Custom Cloud Services<span class="tag">&lt;/title&gt;</span>
  <span class="tag">&lt;/head&gt;</span>
  <span class="tag">&lt;body&gt;</span>
    <span class="tag">&lt;button</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">js-Hello</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>call hello() in default namespace<span class="tag">&lt;/button&gt;</span>
    <span class="tag">&lt;button</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">js-Timer</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>call hello() in timer namespace<span class="tag">&lt;/button&gt;</span>
  <span class="tag">&lt;/body&gt;</span>
  <span class="tag">&lt;script</span> <span class="attribute-name">src</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">https://unpkg.com/@zetapush/client</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span><span class="tag">&lt;/script&gt;</span>
  <span class="tag">&lt;script</span> <span class="attribute-name">src</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">https://unpkg.com/@zetapush/platform-legacy</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span><span class="tag">&lt;/script&gt;</span>
  <span class="tag">&lt;script</span> <span class="attribute-name">src</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">./index.js</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span><span class="tag">&lt;/script&gt;</span>
<span class="tag">&lt;/html&gt;</span>
</pre></td>
</tr></table></code></pre>
</div>
</div>
<div class="paragraph tab">
<p>index.js (front)</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
</pre></td>
  <td class="code"><pre><span class="comment">// If you use npm you can do :</span>
<span class="comment">// import { WeakClient } = from '@zetapush/client';</span>
<span class="comment">// import { Service } = from '@zetapush/platform-legacy';</span>
client = <span class="keyword">new</span> ZetaPushClient.WeakClient();

<span class="comment">// First api to reach 'default' namespace</span>
const defaultApi = client.createProxyTaskService({                                <i class="conum" data-value="1"></i><b>(1)</b>
  <span class="key">namespace</span>: <span class="string"><span class="delimiter">'</span><span class="content">default</span><span class="delimiter">'</span></span>
});

<span class="comment">// Second API to reach 'timer' namespace</span>
const timerApi = client.createProxyTaskService({                                  <i class="conum" data-value="2"></i><b>(2)</b>
  <span class="key">namespace</span>: <span class="string"><span class="delimiter">'</span><span class="content">timer</span><span class="delimiter">'</span></span>
});

<span class="comment">// Handle the clicks</span>
document.querySelector(<span class="string"><span class="delimiter">'</span><span class="content">.js-Hello</span><span class="delimiter">'</span></span>).addEventListener(<span class="string"><span class="delimiter">'</span><span class="content">click</span><span class="delimiter">'</span></span>, async () =&gt; {
  console.log(await defaultApi.hello());
});
document.querySelector(<span class="string"><span class="delimiter">'</span><span class="content">.js-Timer</span><span class="delimiter">'</span></span>).addEventListener(<span class="string"><span class="delimiter">'</span><span class="content">click</span><span class="delimiter">'</span></span>, async () =&gt; {
  console.log(await timerApi.hello());
});

<span class="comment">// Connection</span>
client
  .connect()
  .then(() =&gt; console.log(<span class="string"><span class="delimiter">'</span><span class="content">connected</span><span class="delimiter">'</span></span>))
  .<span class="keyword">catch</span>(() =&gt; console.error(<span class="string"><span class="delimiter">'</span><span class="content">connection failed</span><span class="delimiter">'</span></span>));</pre></td>
</tr></table></code></pre>
</div>
</div>
<div class="paragraph tab-container-end">
<p>-
&lt;1&gt; We create an API that reach only the <code>default</code> namespace
&lt;2&gt; We create an API that reach only the <code>timer</code> namespace</p>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="shared_module"><a class="anchor" href="#shared_module"></a>Create a shared module of cloud services</h4>

</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_available_cloud_services"><a class="anchor" href="#_available_cloud_services"></a>Available cloud services</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_standard_user_workflow"><a class="anchor" href="#_standard_user_workflow"></a>Standard User Workflow</h3>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p>Some information will soon be added about utilization of <em>Standard User Workflow</em>.
For now, you can follow the <a href="#integrate_user_management">dedicated developer manual section</a>.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_usage"><a class="anchor" href="#_usage"></a>Usage</h4>

</div>
<div class="sect3">
<h4 id="_api"><a class="anchor" href="#_api"></a>API</h4>

</div>
</div>
<div class="sect2">
<h3 id="builtin_cloud_services"><a class="anchor" href="#builtin_cloud_services"></a>Technical cloud services</h3>
<div class="sect3">
<h4 id="_user_management"><a class="anchor" href="#_user_management"></a>User Management</h4>
<div class="sect4">
<h5 id="_simple"><a class="anchor" href="#_simple"></a>Simple</h5>
<div class="paragraph">
<p>End-user API for the simple local authentication</p>
</div>
<div class="paragraph">
<p>These API verbs allow end-users to manage their account(s).</p>
</div>
<div class="sect5">
<h6 id="_createuser"><a class="anchor" href="#_createuser"></a>createUser</h6>
<div class="paragraph">
<p>Creates a new account in this 'simple' authentication realm.
Returns a map of account fields, including a field named &lt;i&gt;zetapushKey&lt;/i&gt; containing the global user key of the user (value of the &lt;b&gt;__userKey&lt;/b&gt; pseudo-constant when this new account will be used)</p>
</div>
<div class="listingblock">
<div class="title">createUser(parameters: <a href="./common/cloud-services-types/basic-authenticated-user.html">BasicAuthenticatedUser</a>): Promise&lt;<a href="./common/cloud-services-types/map&.html#8592;string">-object&gt;.adoc#,Map&lt;String,Object</a>&gt;&gt;</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="typescript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
</pre></td>
  <td class="code"><pre>const response = await this.simple.createUser(parameters);</pre></td>
</tr></table></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_credentials"><a class="anchor" href="#_credentials"></a>credentials</h6>
<div class="paragraph">
<p>Returns the list of account credentials in this service for the asking user.
Might return an empty list.</p>
</div>
<div class="listingblock">
<div class="title">credentials(parameters: <a href="./common/cloud-services-types/impersonated-traceable-request.html">ImpersonatedTraceableRequest</a>): Promise&lt;<a href="./common/cloud-services-types/all-credentials.html">AllCredentials</a>&gt;</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="typescript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
</pre></td>
  <td class="code"><pre>const response = await this.simple.credentials(parameters);</pre></td>
</tr></table></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_updatekey"><a class="anchor" href="#_updatekey"></a>updateKey</h6>
<div class="paragraph">
<p>Updates an existing account primary key (login, NOT &lt;b&gt;__userKey&lt;/b&gt;) in this 'simple' authentication realm.
The updated account MUST belong to the user making the call.
The configured login field MUST be given, as a user (identified by his zetapush userKey) might possess several accounts.
Returns a map of account fields</p>
</div>
<div class="listingblock">
<div class="title">updateKey(parameters: <a href="./common/cloud-services-types/user-loginchange.html">UserLoginchange</a>): Promise&lt;<a href="./common/cloud-services-types/map&.html#8592;string">-object&gt;.adoc#,Map&lt;String,Object</a>&gt;&gt;</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="typescript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
</pre></td>
  <td class="code"><pre>const response = await this.simple.updateKey(parameters);</pre></td>
</tr></table></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_updateuser"><a class="anchor" href="#_updateuser"></a>updateUser</h6>
<div class="paragraph">
<p>Updates an existing account in this 'simple' authentication realm.
The updated account MUST belong to the user making the call.
The configured login field MUST be given, as a user (identified by his zetapush userKey) might possess several accounts.
Returns a map of account fields</p>
</div>
<div class="listingblock">
<div class="title">updateUser(parameters: <a href="./common/cloud-services-types/basic-authenticated-user.html">BasicAuthenticatedUser</a>): Promise&lt;<a href="./common/cloud-services-types/map&.html#8592;string">-object&gt;.adoc#,Map&lt;String,Object</a>&gt;&gt;</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="typescript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
</pre></td>
  <td class="code"><pre>const response = await this.simple.updateUser(parameters);</pre></td>
</tr></table></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_deleteuser"><a class="anchor" href="#_deleteuser"></a>deleteUser</h6>
<div class="paragraph">
<p>Deletes an existing account in this 'simple' authentication realm.</p>
</div>
<div class="listingblock">
<div class="title">deleteUser(parameters: <a href="./common/cloud-services-types/existence-check.html">ExistenceCheck</a>): Promise&lt;<a href="./common/cloud-services-types/existence-check.html">ExistenceCheck</a>&gt;</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="typescript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
</pre></td>
  <td class="code"><pre>const response = await this.simple.deleteUser(parameters);</pre></td>
</tr></table></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_checkuser"><a class="anchor" href="#_checkuser"></a>checkUser</h6>
<div class="paragraph">
<p>Checks whether the given account already exists in this 'simple' authentication realm.
This verb returns all the information about the user, including non public fields.</p>
</div>
<div class="listingblock">
<div class="title">checkUser(parameters: <a href="./common/cloud-services-types/existence-check.html">ExistenceCheck</a>): Promise&lt;<a href="./common/cloud-services-types/map&.html#8592;string">-object&gt;.adoc#,Map&lt;String,Object</a>&gt;&gt;</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="typescript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
</pre></td>
  <td class="code"><pre>const response = await this.simple.checkUser(parameters);</pre></td>
</tr></table></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_requestreset"><a class="anchor" href="#_requestreset"></a>requestReset</h6>
<div class="paragraph">
<p>Requests a password reset for the given unique account key.
The account key must exist and must be given, as it cannot obviously be deduced from the currently logged in user.
The returned token needs to be sent to the intended recipient only. The typical use case is to define a macro that requests a reset, generates a email template and emails the user. The macro can then be safely called by a weakly authenticated user.
Requesting a reset does not invalidate the password.
Requesting a reset again invalidates previous reset requests (only the last token is usable)</p>
</div>
<div class="listingblock">
<div class="title">requestReset(parameters: <a href="./common/cloud-services-types/reset-request.html">ResetRequest</a>): Promise&lt;<a href="./common/cloud-services-types/reset-info.html">ResetInfo</a>&gt;</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="typescript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
</pre></td>
  <td class="code"><pre>const response = await this.simple.requestReset(parameters);</pre></td>
</tr></table></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_changepassword"><a class="anchor" href="#_changepassword"></a>changePassword</h6>
<div class="paragraph">
<p>Changes a user password for this authentication realm.
The user can be either explicit, implicit (one of the current user&#8217;s accounts) or deduced from the token.
You should provide at least one of 'key' and 'token'. If you do not, the server will try and find any key for the current user.
The change is effective immediately. However, already logged in users might stay connected.
The password and token fields are always null in the output.</p>
</div>
<div class="listingblock">
<div class="title">changePassword(parameters: <a href="./common/cloud-services-types/change-password-request.html">ChangePasswordRequest</a>): Promise&lt;<a href="./common/cloud-services-types/change-password-request.html">ChangePasswordRequest</a>&gt;</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="typescript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
</pre></td>
  <td class="code"><pre>const response = await this.simple.changePassword(parameters);</pre></td>
</tr></table></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_checkpassword"><a class="anchor" href="#_checkpassword"></a>checkPassword</h6>
<div class="listingblock">
<div class="title">checkPassword(parameters: <a href="./common/cloud-services-types/check-password-request.html">CheckPasswordRequest</a>): Promise&lt;<a href="./common/cloud-services-types/check-password-result.html">CheckPasswordResult</a>&gt;</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="typescript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
</pre></td>
  <td class="code"><pre>const response = await this.simple.checkPassword(parameters);</pre></td>
</tr></table></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_how_to_use_it"><a class="anchor" href="#_how_to_use_it"></a>How to use it ?</h6>
<div class="listingblock">
<div class="title">worker/index.ts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="typescript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
</pre></td>
  <td class="code"><pre>import { Injectable } from '@zetapush/core';
import { Simple, BasicAuthenticatedUser } from '@zetapush/platform-legacy'; <i class="conum" data-value="1"></i><b>(1)</b>

@Injectable()
export default class Api {
  constructor(
    private simple: Simple <i class="conum" data-value="2"></i><b>(2)</b>
  ) {}
  async doStuff(parameters: BasicAuthenticatedUser) {
    const response = await this.simple.createUser(parameters); <i class="conum" data-value="3"></i><b>(3)</b>
    return response;
  }
}</pre></td>
</tr></table></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Import <code>Simple</code> from platform</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Declare injected service</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Call injected service</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_weak"><a class="anchor" href="#_weak"></a>Weak</h5>
<div class="paragraph">
<p>User API for weak devices control</p>
</div>
<div class="paragraph">
<p>User API for control and release of weakly authenticated user sessions.</p>
</div>
<div class="sect5">
<h6 id="_control"><a class="anchor" href="#_control"></a>control</h6>
<div class="paragraph">
<p>Takes control of a weak user session, identified by the given public token.
The public token has been previously made available by the controlled device, for example by displaying a QRCode.
Upon control notification, the client SDK of the controlled session is expected to re-handshake.</p>
</div>
<div class="listingblock">
<div class="title">control(parameters: <a href="./common/cloud-services-types/user-control-request.html">UserControlRequest</a>): Promise&lt;<a href="./common/cloud-services-types/user-control-status.html">UserControlStatus</a>&gt;</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="typescript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
</pre></td>
  <td class="code"><pre>const response = await this.weak.control(parameters);</pre></td>
</tr></table></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_release"><a class="anchor" href="#_release"></a>release</h6>
<div class="paragraph">
<p>Releases control of a weak user session, identified by the given public token.
The weak user session must have been previously controlled by a call to 'control'.</p>
</div>
<div class="listingblock">
<div class="title">release(parameters: <a href="./common/cloud-services-types/user-control-request.html">UserControlRequest</a>): Promise&lt;<a href="./common/cloud-services-types/user-control-status.html">UserControlStatus</a>&gt;</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="typescript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
</pre></td>
  <td class="code"><pre>const response = await this.weak.release(parameters);</pre></td>
</tr></table></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_provision"><a class="anchor" href="#_provision"></a>provision</h6>
<div class="paragraph">
<p>Provisions an arbitrary number of accounts.
The maximum number of accounts that you can create in one single call is configured per server.</p>
</div>
<div class="listingblock">
<div class="title">provision(parameters: <a href="./common/cloud-services-types/provisioning-request.html">ProvisioningRequest</a>): Promise&lt;<a href="./common/cloud-services-types/provisioning-result.html">ProvisioningResult</a>&gt;</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="typescript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
</pre></td>
  <td class="code"><pre>const response = await this.weak.provision(parameters);</pre></td>
</tr></table></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_gettoken"><a class="anchor" href="#_gettoken"></a>getToken</h6>
<div class="paragraph">
<p>Returns your current session&#8217;s private token. The token field may be null, if you did not log in with this authentication.
The token can be used to log in as the same weak user another time.</p>
</div>
<div class="listingblock">
<div class="title">getToken(parameters: <a href="./common/cloud-services-types/.html">undefined</a>): Promise&lt;<a href="./common/cloud-services-types/user-token.html">UserToken</a>&gt;</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="typescript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
</pre></td>
  <td class="code"><pre>const response = await this.weak.getToken(parameters);</pre></td>
</tr></table></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_how_to_use_it_2"><a class="anchor" href="#_how_to_use_it_2"></a>How to use it ?</h6>
<div class="listingblock">
<div class="title">worker/index.ts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="typescript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
</pre></td>
  <td class="code"><pre>import { Injectable } from '@zetapush/core';
import { Weak, UserControlRequest } from '@zetapush/platform-legacy'; <i class="conum" data-value="1"></i><b>(1)</b>

@Injectable()
export default class Api {
  constructor(
    private weak: Weak <i class="conum" data-value="2"></i><b>(2)</b>
  ) {}
  async doStuff(parameters: UserControlRequest) {
    const response = await this.weak.control(parameters); <i class="conum" data-value="3"></i><b>(3)</b>
    return response;
  }
}</pre></td>
</tr></table></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Import <code>Weak</code> from platform</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Declare injected service</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Call injected service</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_userdir"><a class="anchor" href="#_userdir"></a>Userdir</h5>
<div class="paragraph">
<p>User API for user information</p>
</div>
<div class="sect5">
<h6 id="_userinfo"><a class="anchor" href="#_userinfo"></a>userInfo</h6>
<div class="listingblock">
<div class="title">userInfo(parameters: <a href="./common/cloud-services-types/user-info-request.html">UserInfoRequest</a>): Promise&lt;<a href="./common/cloud-services-types/user-info-response.html">UserInfoResponse</a>&gt;</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="typescript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
</pre></td>
  <td class="code"><pre>const response = await this.userdir.userInfo(parameters);</pre></td>
</tr></table></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_search"><a class="anchor" href="#_search"></a>search</h6>
<div class="listingblock">
<div class="title">search(parameters: <a href="./common/cloud-services-types/user-search-request.html">UserSearchRequest</a>): Promise&lt;<a href="./common/cloud-services-types/user-search-response.html">UserSearchResponse</a>&gt;</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="typescript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
</pre></td>
  <td class="code"><pre>const response = await this.userdir.search(parameters);</pre></td>
</tr></table></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_how_to_use_it_3"><a class="anchor" href="#_how_to_use_it_3"></a>How to use it ?</h6>
<div class="listingblock">
<div class="title">worker/index.ts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="typescript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
</pre></td>
  <td class="code"><pre>import { Injectable } from '@zetapush/core';
import { Userdir, UserInfoRequest } from '@zetapush/platform-legacy'; <i class="conum" data-value="1"></i><b>(1)</b>

@Injectable()
export default class Api {
  constructor(
    private userdir: Userdir <i class="conum" data-value="2"></i><b>(2)</b>
  ) {}
  async doStuff(parameters: UserInfoRequest) {
    const response = await this.userdir.userInfo(parameters); <i class="conum" data-value="3"></i><b>(3)</b>
    return response;
  }
}</pre></td>
</tr></table></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Import <code>Userdir</code> from platform</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Declare injected service</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Call injected service</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_groups"><a class="anchor" href="#_groups"></a>Groups</h5>
<div class="paragraph">
<p>User API for groups and rights.</p>
</div>
<div class="paragraph">
<p>Groups are stored per user.
This means that two users can own a group with the same identifier. A couple (owner, group) is needed to uniquely identify a group inside a group management service.
The triplet (deploymentId, owner, group) is actually needed to fully qualify a group outside of the scope of this service.</p>
</div>
<div class="sect5">
<h6 id="_grant"><a class="anchor" href="#_grant"></a>grant</h6>
<div class="paragraph">
<p>The granting API does not do any check when storing permissions.
In particular when granting rights on a verb and resource of another API, the existence of said verb and resource is not checked.</p>
</div>
<div class="listingblock">
<div class="title">grant(parameters: <a href="./common/cloud-services-types/grant.html">Grant</a>): Promise&lt;<a href="./common/cloud-services-types/grant.html">Grant</a>&gt;</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="typescript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
</pre></td>
  <td class="code"><pre>const response = await this.groups.grant(parameters);</pre></td>
</tr></table></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_creategroup"><a class="anchor" href="#_creategroup"></a>createGroup</h6>
<div class="paragraph">
<p>Creates a group owned by the current user.
Group creation may fail if the group already exists.</p>
</div>
<div class="listingblock">
<div class="title">createGroup(parameters: <a href="./common/cloud-services-types/group-info.html">GroupInfo</a>): Promise&lt;<a href="./common/cloud-services-types/group-info.html">GroupInfo</a>&gt;</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="typescript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
</pre></td>
  <td class="code"><pre>const response = await this.groups.createGroup(parameters);</pre></td>
</tr></table></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_listownedgroups"><a class="anchor" href="#_listownedgroups"></a>listOwnedGroups</h6>
<div class="paragraph">
<p>Returns the whole list of groups owned by the current user</p>
</div>
<div class="listingblock">
<div class="title">listOwnedGroups(parameters: <a href="./common/cloud-services-types/traceable-paginated-impersonated-request.html">TraceablePaginatedImpersonatedRequest</a>): Promise&lt;<a href="./common/cloud-services-types/owned-groups.html">OwnedGroups</a>&gt;</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="typescript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
</pre></td>
  <td class="code"><pre>const response = await this.groups.listOwnedGroups(parameters);</pre></td>
</tr></table></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_listdetailedownedgroups"><a class="anchor" href="#_listdetailedownedgroups"></a>listDetailedOwnedGroups</h6>
<div class="paragraph">
<p>Returns the whole list of groups owned by the current user, with their members</p>
</div>
<div class="listingblock">
<div class="title">listDetailedOwnedGroups(parameters: <a href="./common/cloud-services-types/traceable-paginated-impersonated-request.html">TraceablePaginatedImpersonatedRequest</a>): Promise&lt;<a href="./common/cloud-services-types/owned-groups-with-details.html">OwnedGroupsWithDetails</a>&gt;</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="typescript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
</pre></td>
  <td class="code"><pre>const response = await this.groups.listDetailedOwnedGroups(parameters);</pre></td>
</tr></table></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_mygroups"><a class="anchor" href="#_mygroups"></a>myGroups</h6>
<div class="paragraph">
<p>Returns the whole list of groups the current user is part of.
Groups may be owned by anyone, including the current user.</p>
</div>
<div class="listingblock">
<div class="title">myGroups(parameters: <a href="./common/cloud-services-types/impersonated-request.html">ImpersonatedRequest</a>): Promise&lt;<a href="./common/cloud-services-types/group-info.html">GroupInfo</a>[]&gt;</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="typescript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
</pre></td>
  <td class="code"><pre>const response = await this.groups.myGroups(parameters);</pre></td>
</tr></table></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_listjoinedgroups"><a class="anchor" href="#_listjoinedgroups"></a>listJoinedGroups</h6>
<div class="paragraph">
<p>Returns the whole list of groups the current user is part of.
Groups may be owned by anyone, including the current user.</p>
</div>
<div class="listingblock">
<div class="title">listJoinedGroups(parameters: <a href="./common/cloud-services-types/traceable-paginated-impersonated-request.html">TraceablePaginatedImpersonatedRequest</a>): Promise&lt;<a href="./common/cloud-services-types/joined-groups.html">JoinedGroups</a>&gt;</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="typescript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
</pre></td>
  <td class="code"><pre>const response = await this.groups.listJoinedGroups(parameters);</pre></td>
</tr></table></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_delgroup"><a class="anchor" href="#_delgroup"></a>delGroup</h6>
<div class="paragraph">
<p>Removes the given group owned by the current user or the given owner.
Also removes all grants to that group.</p>
</div>
<div class="listingblock">
<div class="title">delGroup(parameters: <a href="./common/cloud-services-types/group-related.html">GroupRelated</a>): Promise&lt;<a href="./common/cloud-services-types/group-related.html">GroupRelated</a>&gt;</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="typescript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
</pre></td>
  <td class="code"><pre>const response = await this.groups.delGroup(parameters);</pre></td>
</tr></table></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_addme"><a class="anchor" href="#_addme"></a>addMe</h6>
<div class="paragraph">
<p>Adds me (the caller) to a group.
This verb exists so that group owners may grant the right to join their groups without granting the right to add other users to those groups.
The 'user' field is implicitly set to the current user&#8217;s key.</p>
</div>
<div class="listingblock">
<div class="title">addMe(parameters: <a href="./common/cloud-services-types/user-group.html">UserGroup</a>): Promise&lt;<a href="./common/cloud-services-types/user-group.html">UserGroup</a>&gt;</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="typescript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
</pre></td>
  <td class="code"><pre>const response = await this.groups.addMe(parameters);</pre></td>
</tr></table></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_memberof"><a class="anchor" href="#_memberof"></a>memberOf</h6>
<div class="paragraph">
<p>Tests whether I (the caller) am a member of the given group.
This verb exists so that users can determine if they are part of a group without being granted particular rights.
The 'user' field is implicitly set to the current user&#8217;s key.</p>
</div>
<div class="listingblock">
<div class="title">memberOf(parameters: <a href="./common/cloud-services-types/user-membership.html">UserMembership</a>): Promise&lt;<a href="./common/cloud-services-types/user-group-membership.html">UserGroupMembership</a>&gt;</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="typescript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
</pre></td>
  <td class="code"><pre>const response = await this.groups.memberOf(parameters);</pre></td>
</tr></table></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_addusers"><a class="anchor" href="#_addusers"></a>addUsers</h6>
<div class="paragraph">
<p>Users are processed in the given order
In case of failure in the middle of a user list, this verb may have succeeded to add the first users, but will not continue processing the end of the list.</p>
</div>
<div class="listingblock">
<div class="title">addUsers(parameters: <a href="./common/cloud-services-types/group-users.html">GroupUsers</a>): Promise&lt;<a href="./common/cloud-services-types/void.html">void</a>&gt;</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="typescript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
</pre></td>
  <td class="code"><pre>const response = await this.groups.addUsers(parameters);</pre></td>
</tr></table></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_delusers"><a class="anchor" href="#_delusers"></a>delUsers</h6>
<div class="listingblock">
<div class="title">delUsers(parameters: <a href="./common/cloud-services-types/group-users.html">GroupUsers</a>): Promise&lt;<a href="./common/cloud-services-types/void.html">void</a>&gt;</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="typescript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
</pre></td>
  <td class="code"><pre>const response = await this.groups.delUsers(parameters);</pre></td>
</tr></table></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_mgrant"><a class="anchor" href="#_mgrant"></a>mgrant</h6>
<div class="paragraph">
<p>Grant several rights at once.</p>
</div>
<div class="listingblock">
<div class="title">mgrant(parameters: <a href="./common/cloud-services-types/grants.html">Grants</a>): Promise&lt;<a href="./common/cloud-services-types/grants.html">Grants</a>&gt;</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="typescript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
</pre></td>
  <td class="code"><pre>const response = await this.groups.mgrant(parameters);</pre></td>
</tr></table></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_mrevoke"><a class="anchor" href="#_mrevoke"></a>mrevoke</h6>
<div class="listingblock">
<div class="title">mrevoke(parameters: <a href="./common/cloud-services-types/grants.html">Grants</a>): Promise&lt;<a href="./common/cloud-services-types/grants.html">Grants</a>&gt;</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="typescript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
</pre></td>
  <td class="code"><pre>const response = await this.groups.mrevoke(parameters);</pre></td>
</tr></table></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_listgrants"><a class="anchor" href="#_listgrants"></a>listGrants</h6>
<div class="paragraph">
<p>This API lists explicitly configured rights.
Effective rights include configured rights, implicit rights and inherited rights.</p>
</div>
<div class="listingblock">
<div class="title">listGrants(parameters: <a href="./common/cloud-services-types/group-related.html">GroupRelated</a>): Promise&lt;<a href="./common/cloud-services-types/grant-list.html">GrantList</a>&gt;</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="typescript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
</pre></td>
  <td class="code"><pre>const response = await this.groups.listGrants(parameters);</pre></td>
</tr></table></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_listgroupgrants"><a class="anchor" href="#_listgroupgrants"></a>listGroupGrants</h6>
<div class="paragraph">
<p>This API lists explicitly configured rights.
Effective rights include configured rights, implicit rights and inherited rights.</p>
</div>
<div class="listingblock">
<div class="title">listGroupGrants(parameters: <a href="./common/cloud-services-types/group-related-and-paged.html">GroupRelatedAndPaged</a>): Promise&lt;<a href="./common/cloud-services-types/paged-grant-list.html">PagedGrantList</a>&gt;</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="typescript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
</pre></td>
  <td class="code"><pre>const response = await this.groups.listGroupGrants(parameters);</pre></td>
</tr></table></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_listpresences"><a class="anchor" href="#_listpresences"></a>listPresences</h6>
<div class="paragraph">
<p>Returns the list of members of the given groups, along with their actual and current presence on the zetapush server.
The current implementation does not include information about the particular devices users are connected with.
If a user is connected twice with two different devices, two identical entries will be returned.</p>
</div>
<div class="listingblock">
<div class="title">listPresences(parameters: <a href="./common/cloud-services-types/group-related.html">GroupRelated</a>): Promise&lt;<a href="./common/cloud-services-types/group-presence.html">GroupPresence</a>&gt;</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="typescript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
</pre></td>
  <td class="code"><pre>const response = await this.groups.listPresences(parameters);</pre></td>
</tr></table></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_listgrouppresences"><a class="anchor" href="#_listgrouppresences"></a>listGroupPresences</h6>
<div class="paragraph">
<p>Returns the list of members of the given groups, along with their actual and current presence on the zetapush server.
The current implementation does not include information about the particular devices users are connected with.
If a user is connected twice with two different devices, two identical entries will be returned.</p>
</div>
<div class="listingblock">
<div class="title">listGroupPresences(parameters: <a href="./common/cloud-services-types/group-related-and-paged.html">GroupRelatedAndPaged</a>): Promise&lt;<a href="./common/cloud-services-types/paged-group-presence.html">PagedGroupPresence</a>&gt;</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="typescript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
</pre></td>
  <td class="code"><pre>const response = await this.groups.listGroupPresences(parameters);</pre></td>
</tr></table></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_adduser"><a class="anchor" href="#_adduser"></a>addUser</h6>
<div class="paragraph">
<p>Adds the given user to the given group.
Addition may fail if the given group does not already exist.</p>
</div>
<div class="listingblock">
<div class="title">addUser(parameters: <a href="./common/cloud-services-types/user-group.html">UserGroup</a>): Promise&lt;<a href="./common/cloud-services-types/user-group.html">UserGroup</a>&gt;</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="typescript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
</pre></td>
  <td class="code"><pre>const response = await this.groups.addUser(parameters);</pre></td>
</tr></table></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_deluser"><a class="anchor" href="#_deluser"></a>delUser</h6>
<div class="listingblock">
<div class="title">delUser(parameters: <a href="./common/cloud-services-types/user-group.html">UserGroup</a>): Promise&lt;<a href="./common/cloud-services-types/user-group.html">UserGroup</a>&gt;</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="typescript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
</pre></td>
  <td class="code"><pre>const response = await this.groups.delUser(parameters);</pre></td>
</tr></table></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_groupusers"><a class="anchor" href="#_groupusers"></a>groupUsers</h6>
<div class="paragraph">
<p>Returns the whole list of users configured inside the given group.</p>
</div>
<div class="listingblock">
<div class="title">groupUsers(parameters: <a href="./common/cloud-services-types/group-related.html">GroupRelated</a>): Promise&lt;<a href="./common/cloud-services-types/group-users.html">GroupUsers</a>&gt;</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="typescript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
</pre></td>
  <td class="code"><pre>const response = await this.groups.groupUsers(parameters);</pre></td>
</tr></table></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_revoke"><a class="anchor" href="#_revoke"></a>revoke</h6>
<div class="listingblock">
<div class="title">revoke(parameters: <a href="./common/cloud-services-types/grant.html">Grant</a>): Promise&lt;<a href="./common/cloud-services-types/grant.html">Grant</a>&gt;</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="typescript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
</pre></td>
  <td class="code"><pre>const response = await this.groups.revoke(parameters);</pre></td>
</tr></table></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_allgroups"><a class="anchor" href="#_allgroups"></a>allGroups</h6>
<div class="paragraph">
<p>Returns the whole list of groups owned by the current user, with their members</p>
</div>
<div class="listingblock">
<div class="title">allGroups(parameters: <a href="./common/cloud-services-types/impersonated-request.html">ImpersonatedRequest</a>): Promise&lt;<a href="./common/cloud-services-types/group-users.html">GroupUsers</a>[]&gt;</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="typescript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
</pre></td>
  <td class="code"><pre>const response = await this.groups.allGroups(parameters);</pre></td>
</tr></table></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_groups_2"><a class="anchor" href="#_groups_2"></a>groups</h6>
<div class="paragraph">
<p>Returns the whole list of groups owned by the current user</p>
</div>
<div class="listingblock">
<div class="title">groups(parameters: <a href="./common/cloud-services-types/impersonated-request.html">ImpersonatedRequest</a>): Promise&lt;<a href="./common/cloud-services-types/group-info.html">GroupInfo</a>[]&gt;</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="typescript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
</pre></td>
  <td class="code"><pre>const response = await this.groups.groups(parameters);</pre></td>
</tr></table></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_check"><a class="anchor" href="#_check"></a>check</h6>
<div class="paragraph">
<p>This API checks if the given user has the proper authorizations to perform the given action on the owner&#8217;s resource.
If you give the same value for 'user' and 'owner', the check always passes.</p>
</div>
<div class="listingblock">
<div class="title">check(parameters: <a href="./common/cloud-services-types/grant-check-request.html">GrantCheckRequest</a>): Promise&lt;<a href="./common/cloud-services-types/grant-check-result.html">GrantCheckResult</a>&gt;</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="typescript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
</pre></td>
  <td class="code"><pre>const response = await this.groups.check(parameters);</pre></td>
</tr></table></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_exists"><a class="anchor" href="#_exists"></a>exists</h6>
<div class="paragraph">
<p>Returns whether a group exists or not.</p>
</div>
<div class="listingblock">
<div class="title">exists(parameters: <a href="./common/cloud-services-types/group-related.html">GroupRelated</a>): Promise&lt;<a href="./common/cloud-services-types/group-existence.html">GroupExistence</a>&gt;</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="typescript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
</pre></td>
  <td class="code"><pre>const response = await this.groups.exists(parameters);</pre></td>
</tr></table></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_how_to_use_it_4"><a class="anchor" href="#_how_to_use_it_4"></a>How to use it ?</h6>
<div class="listingblock">
<div class="title">worker/index.ts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="typescript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
</pre></td>
  <td class="code"><pre>import { Injectable } from '@zetapush/core';
import { Groups, Grant } from '@zetapush/platform-legacy'; <i class="conum" data-value="1"></i><b>(1)</b>

@Injectable()
export default class Api {
  constructor(
    private groups: Groups <i class="conum" data-value="2"></i><b>(2)</b>
  ) {}
  async doStuff(parameters: Grant) {
    const response = await this.groups.grant(parameters); <i class="conum" data-value="3"></i><b>(3)</b>
    return response;
  }
}</pre></td>
</tr></table></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Import <code>Groups</code> from platform</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Declare injected service</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Call injected service</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_data_management"><a class="anchor" href="#_data_management"></a>Data Management</h4>
<div class="sect4">
<h5 id="_gda"><a class="anchor" href="#_gda"></a>Gda</h5>
<div class="paragraph">
<p>GDA User API</p>
</div>
<div class="paragraph">
<p>User API for Generic Data Access.
The data are stored on a per-user basis.
Users can put, get, list their data.</p>
</div>
<div class="sect5">
<h6 id="_puts"><a class="anchor" href="#_puts"></a>puts</h6>
<div class="paragraph">
<p>Creates or replaces the (maybe partial) contents of a collection of rows.
This method only creates or replaces cells for non-null input values.</p>
</div>
<div class="listingblock">
<div class="title">puts(parameters: <a href="./common/cloud-services-types/gda-puts.html">GdaPuts</a>): Promise&lt;<a href="./common/cloud-services-types/gda-puts-result.html">GdaPutsResult</a>&gt;</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="typescript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
</pre></td>
  <td class="code"><pre>const response = await this.gda.puts(parameters);</pre></td>
</tr></table></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_inc"><a class="anchor" href="#_inc"></a>inc</h6>
<div class="paragraph">
<p>Increments a cell 64-bit signed integer value and returns the result in the data field.
The increment is atomic : if you concurrently increment 10 times a value by 1, the final result will be the initial value plus 10. The actual individual resulting values seen by the 10 concurrent callers may vary discontinuously, with duplicates : at least one of them will see the final (+10) result.</p>
</div>
<div class="listingblock">
<div class="title">inc(parameters: <a href="./common/cloud-services-types/gda-put.html">GdaPut</a>): Promise&lt;<a href="./common/cloud-services-types/gda-put.html">GdaPut</a>&gt;</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="typescript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
</pre></td>
  <td class="code"><pre>const response = await this.gda.inc(parameters);</pre></td>
</tr></table></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_removerow"><a class="anchor" href="#_removerow"></a>removeRow</h6>
<div class="paragraph">
<p>Removes all columns of the given row from the given table.</p>
</div>
<div class="listingblock">
<div class="title">removeRow(parameters: <a href="./common/cloud-services-types/gda-row-request.html">GdaRowRequest</a>): Promise&lt;<a href="./common/cloud-services-types/gda-row-request.html">GdaRowRequest</a>&gt;</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="typescript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
</pre></td>
  <td class="code"><pre>const response = await this.gda.removeRow(parameters);</pre></td>
</tr></table></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_removecolumn"><a class="anchor" href="#_removecolumn"></a>removeColumn</h6>
<div class="paragraph">
<p>Removes all cells of the given column of the given row from the given table.</p>
</div>
<div class="listingblock">
<div class="title">removeColumn(parameters: <a href="./common/cloud-services-types/gda-column-request.html">GdaColumnRequest</a>): Promise&lt;<a href="./common/cloud-services-types/gda-column-request.html">GdaColumnRequest</a>&gt;</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="typescript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
</pre></td>
  <td class="code"><pre>const response = await this.gda.removeColumn(parameters);</pre></td>
</tr></table></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_removecell"><a class="anchor" href="#_removecell"></a>removeCell</h6>
<div class="paragraph">
<p>Removes only one cell of the given column of the given row from the given table.</p>
</div>
<div class="listingblock">
<div class="title">removeCell(parameters: <a href="./common/cloud-services-types/gda-cell-request.html">GdaCellRequest</a>): Promise&lt;<a href="./common/cloud-services-types/gda-cell-request.html">GdaCellRequest</a>&gt;</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="typescript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
</pre></td>
  <td class="code"><pre>const response = await this.gda.removeCell(parameters);</pre></td>
</tr></table></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_mget"><a class="anchor" href="#_mget"></a>mget</h6>
<div class="paragraph">
<p>Returns full data rows, in the order they were asked.</p>
</div>
<div class="listingblock">
<div class="title">mget(parameters: <a href="./common/cloud-services-types/gda-multi-get-request.html">GdaMultiGetRequest</a>): Promise&lt;<a href="./common/cloud-services-types/gda-multi-get-result.html">GdaMultiGetResult</a>&gt;</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="typescript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
</pre></td>
  <td class="code"><pre>const response = await this.gda.mget(parameters);</pre></td>
</tr></table></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_getcells"><a class="anchor" href="#_getcells"></a>getCells</h6>
<div class="paragraph">
<p>Returns a precise list of cells from a column in a data row.</p>
</div>
<div class="listingblock">
<div class="title">getCells(parameters: <a href="./common/cloud-services-types/gda-cells-request.html">GdaCellsRequest</a>): Promise&lt;<a href="./common/cloud-services-types/gda-cells-result.html">GdaCellsResult</a>&gt;</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="typescript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
</pre></td>
  <td class="code"><pre>const response = await this.gda.getCells(parameters);</pre></td>
</tr></table></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_get"><a class="anchor" href="#_get"></a>get</h6>
<div class="paragraph">
<p>Returns a full data row.</p>
</div>
<div class="listingblock">
<div class="title">get(parameters: <a href="./common/cloud-services-types/gda-get.html">GdaGet</a>): Promise&lt;<a href="./common/cloud-services-types/gda-get-result.html">GdaGetResult</a>&gt;</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="typescript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
</pre></td>
  <td class="code"><pre>const response = await this.gda.get(parameters);</pre></td>
</tr></table></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_put"><a class="anchor" href="#_put"></a>put</h6>
<div class="paragraph">
<p>Creates or replaces the contents of a particular cell.</p>
</div>
<div class="listingblock">
<div class="title">put(parameters: <a href="./common/cloud-services-types/gda-put.html">GdaPut</a>): Promise&lt;<a href="./common/cloud-services-types/gda-put.html">GdaPut</a>&gt;</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="typescript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
</pre></td>
  <td class="code"><pre>const response = await this.gda.put(parameters);</pre></td>
</tr></table></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_list"><a class="anchor" href="#_list"></a>list</h6>
<div class="paragraph">
<p>Returns a paginated list of rows from the given table.</p>
</div>
<div class="listingblock">
<div class="title">list(parameters: <a href="./common/cloud-services-types/gda-list.html">GdaList</a>): Promise&lt;<a href="./common/cloud-services-types/gda-list-result.html">GdaListResult</a>&gt;</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="typescript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
</pre></td>
  <td class="code"><pre>const response = await this.gda.list(parameters);</pre></td>
</tr></table></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_removerange"><a class="anchor" href="#_removerange"></a>removeRange</h6>
<div class="paragraph">
<p>Removes the specified columns of the given range of rows from the given table.</p>
</div>
<div class="listingblock">
<div class="title">removeRange(parameters: <a href="./common/cloud-services-types/gda-remove-range.html">GdaRemoveRange</a>): Promise&lt;<a href="./common/cloud-services-types/gda-remove-range.html">GdaRemoveRange</a>&gt;</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="typescript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
</pre></td>
  <td class="code"><pre>const response = await this.gda.removeRange(parameters);</pre></td>
</tr></table></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_filter"><a class="anchor" href="#_filter"></a>filter</h6>
<div class="paragraph">
<p>Similar to range, but rows can be filtered out according to a developer-supplied predicate.
A range consists of consecutive rows from the start key (inclusive) to the stop key (exclusive).
You can specify partial keys for the start and stop fields.</p>
</div>
<div class="listingblock">
<div class="title">filter(parameters: <a href="./common/cloud-services-types/gda-filter-request.html">GdaFilterRequest</a>): Promise&lt;<a href="./common/cloud-services-types/gda-filter-result.html">GdaFilterResult</a>&gt;</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="typescript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
</pre></td>
  <td class="code"><pre>const response = await this.gda.filter(parameters);</pre></td>
</tr></table></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_range"><a class="anchor" href="#_range"></a>range</h6>
<div class="paragraph">
<p>Returns a paginated range of rows from the given table.
A range consists of consecutive rows from the start key (inclusive) to the stop key (exclusive).
You can specify partial keys for the start and stop fields.</p>
</div>
<div class="listingblock">
<div class="title">range(parameters: <a href="./common/cloud-services-types/gda-range.html">GdaRange</a>): Promise&lt;<a href="./common/cloud-services-types/gda-range-result.html">GdaRangeResult</a>&gt;</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="typescript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
</pre></td>
  <td class="code"><pre>const response = await this.gda.range(parameters);</pre></td>
</tr></table></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_reduce"><a class="anchor" href="#_reduce"></a>reduce</h6>
<div class="paragraph">
<p>Returns a computed single reduced result from a range of rows from the given table.
A range consists of consecutive rows from the start key (inclusive) to the stop key (exclusive).
You can specify partial keys for the start and stop fields.</p>
</div>
<div class="listingblock">
<div class="title">reduce(parameters: <a href="./common/cloud-services-types/gda-reduce-request.html">GdaReduceRequest</a>): Promise&lt;<a href="./common/cloud-services-types/gda-reduce-result.html">GdaReduceResult</a>&gt;</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="typescript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
</pre></td>
  <td class="code"><pre>const response = await this.gda.reduce(parameters);</pre></td>
</tr></table></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_how_to_use_it_5"><a class="anchor" href="#_how_to_use_it_5"></a>How to use it ?</h6>
<div class="listingblock">
<div class="title">worker/index.ts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="typescript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
</pre></td>
  <td class="code"><pre>import { Injectable } from '@zetapush/core';
import { Gda, GdaPuts } from '@zetapush/platform-legacy'; <i class="conum" data-value="1"></i><b>(1)</b>

@Injectable()
export default class Api {
  constructor(
    private gda: Gda <i class="conum" data-value="2"></i><b>(2)</b>
  ) {}
  async doStuff(parameters: GdaPuts) {
    const response = await this.gda.puts(parameters); <i class="conum" data-value="3"></i><b>(3)</b>
    return response;
  }
}</pre></td>
</tr></table></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Import <code>Gda</code> from platform</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Declare injected service</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Call injected service</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_stack"><a class="anchor" href="#_stack"></a>Stack</h5>
<div class="paragraph">
<p>Data stack user API</p>
</div>
<div class="paragraph">
<p>Data is stored on a per user basis. However, notifications can be sent to a configurable set of listeners.
Stack names are arbitrary and do not need to be explicitly initialized.</p>
</div>
<div class="sect5">
<h6 id="_purge"><a class="anchor" href="#_purge"></a>purge</h6>
<div class="paragraph">
<p>Removes all items from the given stack.</p>
</div>
<div class="listingblock">
<div class="title">purge(parameters: <a href="./common/cloud-services-types/stack-request.html">StackRequest</a>): Promise&lt;<a href="./common/cloud-services-types/stack-request.html">StackRequest</a>&gt;</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="typescript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
</pre></td>
  <td class="code"><pre>const response = await this.stack.purge(parameters);</pre></td>
</tr></table></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_getlisteners"><a class="anchor" href="#_getlisteners"></a>getListeners</h6>
<div class="paragraph">
<p>Returns the whole list of listeners for the given stack.</p>
</div>
<div class="listingblock">
<div class="title">getListeners(parameters: <a href="./common/cloud-services-types/stack-request.html">StackRequest</a>): Promise&lt;<a href="./common/cloud-services-types/stack-listeners.html">StackListeners</a>&gt;</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="typescript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
</pre></td>
  <td class="code"><pre>const response = await this.stack.getListeners(parameters);</pre></td>
</tr></table></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_setlisteners"><a class="anchor" href="#_setlisteners"></a>setListeners</h6>
<div class="paragraph">
<p>Sets the listeners for the given stack.</p>
</div>
<div class="listingblock">
<div class="title">setListeners(parameters: <a href="./common/cloud-services-types/stack-listeners.html">StackListeners</a>): Promise&lt;<a href="./common/cloud-services-types/stack-listeners.html">StackListeners</a>&gt;</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="typescript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
</pre></td>
  <td class="code"><pre>const response = await this.stack.setListeners(parameters);</pre></td>
</tr></table></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_remove"><a class="anchor" href="#_remove"></a>remove</h6>
<div class="paragraph">
<p>Removes the item with the given guid from the given stack.</p>
</div>
<div class="listingblock">
<div class="title">remove(parameters: <a href="./common/cloud-services-types/stack-item-remove.html">StackItemRemove</a>): Promise&lt;<a href="./common/cloud-services-types/stack-item-remove.html">StackItemRemove</a>&gt;</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="typescript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
</pre></td>
  <td class="code"><pre>const response = await this.stack.remove(parameters);</pre></td>
</tr></table></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_update"><a class="anchor" href="#_update"></a>update</h6>
<div class="paragraph">
<p>Updates an existing item of the given stack.
The item MUST exist prior to the call.</p>
</div>
<div class="listingblock">
<div class="title">update(parameters: <a href="./common/cloud-services-types/stack-item-add.html">StackItemAdd</a>): Promise&lt;<a href="./common/cloud-services-types/stack-item-add.html">StackItemAdd</a>&gt;</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="typescript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
</pre></td>
  <td class="code"><pre>const response = await this.stack.update(parameters);</pre></td>
</tr></table></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_push"><a class="anchor" href="#_push"></a>push</h6>
<div class="paragraph">
<p>Pushes an item onto the given stack.
The stack does not need to be created.</p>
</div>
<div class="listingblock">
<div class="title">push(parameters: <a href="./common/cloud-services-types/stack-item-add.html">StackItemAdd</a>): Promise&lt;<a href="./common/cloud-services-types/stack-item-add.html">StackItemAdd</a>&gt;</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="typescript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
</pre></td>
  <td class="code"><pre>const response = await this.stack.push(parameters);</pre></td>
</tr></table></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_list_2"><a class="anchor" href="#_list_2"></a>list</h6>
<div class="paragraph">
<p>Returns a paginated list of contents for the given stack.
Content is sorted according to the statically configured order.</p>
</div>
<div class="listingblock">
<div class="title">list(parameters: <a href="./common/cloud-services-types/stack-list-request.html">StackListRequest</a>): Promise&lt;<a href="./common/cloud-services-types/stack-list-response.html">StackListResponse</a>&gt;</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="typescript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
</pre></td>
  <td class="code"><pre>const response = await this.stack.list(parameters);</pre></td>
</tr></table></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_how_to_use_it_6"><a class="anchor" href="#_how_to_use_it_6"></a>How to use it ?</h6>
<div class="listingblock">
<div class="title">worker/index.ts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="typescript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
</pre></td>
  <td class="code"><pre>import { Injectable } from '@zetapush/core';
import { Stack, StackRequest } from '@zetapush/platform-legacy'; <i class="conum" data-value="1"></i><b>(1)</b>

@Injectable()
export default class Api {
  constructor(
    private stack: Stack <i class="conum" data-value="2"></i><b>(2)</b>
  ) {}
  async doStuff(parameters: StackRequest) {
    const response = await this.stack.purge(parameters); <i class="conum" data-value="3"></i><b>(3)</b>
    return response;
  }
}</pre></td>
</tr></table></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Import <code>Stack</code> from platform</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Declare injected service</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Call injected service</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_search_2"><a class="anchor" href="#_search_2"></a>Search</h5>
<div class="paragraph">
<p>ElasticSearch Service</p>
</div>
<div class="paragraph">
<p>This API is a very thin wrapper around ElasticSearch&#8217;s API.</p>
</div>
<div class="sect5">
<h6 id="_index"><a class="anchor" href="#_index"></a>index</h6>
<div class="paragraph">
<p>Inserts or updates a document into the elasticsearch engine.</p>
</div>
<div class="listingblock">
<div class="title">index(parameters: <a href="./common/cloud-services-types/search-data.html">SearchData</a>): Promise&lt;<a href="./common/cloud-services-types/void.html">void</a>&gt;</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="typescript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
</pre></td>
  <td class="code"><pre>const response = await this.search.index(parameters);</pre></td>
</tr></table></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_get_2"><a class="anchor" href="#_get_2"></a>get</h6>
<div class="paragraph">
<p>Retrieves a document from the elasticsearch engine by id.</p>
</div>
<div class="listingblock">
<div class="title">get(parameters: <a href="./common/cloud-services-types/search-document-id.html">SearchDocumentId</a>): Promise&lt;<a href="./common/cloud-services-types/search-data.html">SearchData</a>&gt;</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="typescript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
</pre></td>
  <td class="code"><pre>const response = await this.search.get(parameters);</pre></td>
</tr></table></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_delete"><a class="anchor" href="#_delete"></a>delete</h6>
<div class="paragraph">
<p>Deletes a document from the elasticsearch engine by id.</p>
</div>
<div class="listingblock">
<div class="title">delete(parameters: <a href="./common/cloud-services-types/search-document-id.html">SearchDocumentId</a>): Promise&lt;<a href="./common/cloud-services-types/void.html">void</a>&gt;</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="typescript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
</pre></td>
  <td class="code"><pre>const response = await this.search.delete(parameters);</pre></td>
</tr></table></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_search_3"><a class="anchor" href="#_search_3"></a>search</h6>
<div class="listingblock">
<div class="title">search(parameters: <a href="./common/cloud-services-types/search-request.html">SearchRequest</a>): Promise&lt;<a href="./common/cloud-services-types/search-results.html">SearchResults</a>&gt;</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="typescript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
</pre></td>
  <td class="code"><pre>const response = await this.search.search(parameters);</pre></td>
</tr></table></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_how_to_use_it_7"><a class="anchor" href="#_how_to_use_it_7"></a>How to use it ?</h6>
<div class="listingblock">
<div class="title">worker/index.ts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="typescript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
</pre></td>
  <td class="code"><pre>import { Injectable } from '@zetapush/core';
import { Search, SearchData } from '@zetapush/platform-legacy'; <i class="conum" data-value="1"></i><b>(1)</b>

@Injectable()
export default class Api {
  constructor(
    private search: Search <i class="conum" data-value="2"></i><b>(2)</b>
  ) {}
  async doStuff(parameters: SearchData) {
    const response = await this.search.index(parameters); <i class="conum" data-value="3"></i><b>(3)</b>
    return response;
  }
}</pre></td>
</tr></table></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Import <code>Search</code> from platform</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Declare injected service</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Call injected service</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_file_management"><a class="anchor" href="#_file_management"></a>File Management</h4>
<div class="sect4">
<h5 id="_zpfs_hdfs"><a class="anchor" href="#_zpfs_hdfs"></a>Zpfs_hdfs</h5>
<div class="paragraph">
<p>User API for local file management</p>
</div>
<div class="paragraph">
<p>User API for file content manipulation
User API for virtual file management and http file upload
This API contains all the verbs needed to browse, upload and remove files.
Files are stored on a per-user basis: each user has his or her own whole virtual filesystem.
Uploading a file is a 3-step process : request an upload URL, upload via HTTP, notify this service of completion.</p>
</div>
<div class="sect5">
<h6 id="_readtoken"><a class="anchor" href="#_readtoken"></a>readToken</h6>
<div class="paragraph">
<p>Requests a token. This token can be used to retrieve a compressed folder via HTTP.</p>
</div>
<div class="listingblock">
<div class="title">readToken(parameters: <a href="./common/cloud-services-types/zpfs-request.html">ZpfsRequest</a>): Promise&lt;<a href="./common/cloud-services-types/zpfs-token.html">ZpfsToken</a>&gt;</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="typescript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
</pre></td>
  <td class="code"><pre>const response = await this.zpfs_hdfs.readToken(parameters);</pre></td>
</tr></table></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_create"><a class="anchor" href="#_create"></a>create</h6>
<div class="paragraph">
<p>Creates a file, writes content and closes the file as a single operation.
Calling this verb is functionnally equivalent to successively calling 'newUploadUrl', posting the content and calling 'newFile'</p>
</div>
<div class="listingblock">
<div class="title">create(parameters: <a href="./common/cloud-services-types/file-creation-request.html">FileCreationRequest</a>): Promise&lt;<a href="./common/cloud-services-types/listing-entry-info.html">ListingEntryInfo</a>&gt;</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="typescript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
</pre></td>
  <td class="code"><pre>const response = await this.zpfs_hdfs.create(parameters);</pre></td>
</tr></table></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_open"><a class="anchor" href="#_open"></a>open</h6>
<div class="paragraph">
<p>Opens a file for reading.</p>
</div>
<div class="listingblock">
<div class="title">open(parameters: <a href="./common/cloud-services-types/zpfs-request.html">ZpfsRequest</a>): Promise&lt;<a href="./common/cloud-services-types/zpfs-file-handler.html">ZpfsFileHandler</a>&gt;</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="typescript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
</pre></td>
  <td class="code"><pre>const response = await this.zpfs_hdfs.open(parameters);</pre></td>
</tr></table></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_link"><a class="anchor" href="#_link"></a>link</h6>
<div class="paragraph">
<p>Links a file or folder to another location.
May fail if the target location is not empty.</p>
</div>
<div class="listingblock">
<div class="title">link(parameters: <a href="./common/cloud-services-types/created-file.html">CreatedFile</a>): Promise&lt;<a href="./common/cloud-services-types/created-file.html">CreatedFile</a>&gt;</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="typescript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
</pre></td>
  <td class="code"><pre>const response = await this.zpfs_hdfs.link(parameters);</pre></td>
</tr></table></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_stat"><a class="anchor" href="#_stat"></a>stat</h6>
<div class="paragraph">
<p>Returns information about a single file.
The entry field will be null if the path does not exist</p>
</div>
<div class="listingblock">
<div class="title">stat(parameters: <a href="./common/cloud-services-types/file-stat-request.html">FileStatRequest</a>): Promise&lt;<a href="./common/cloud-services-types/file-stat-result.html">FileStatResult</a>&gt;</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="typescript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
</pre></td>
  <td class="code"><pre>const response = await this.zpfs_hdfs.stat(parameters);</pre></td>
</tr></table></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_cp"><a class="anchor" href="#_cp"></a>cp</h6>
<div class="paragraph">
<p>Copies a file or folder (recursively) to a new location.
May fail if the target location is not empty.</p>
</div>
<div class="listingblock">
<div class="title">cp(parameters: <a href="./common/cloud-services-types/created-file.html">CreatedFile</a>): Promise&lt;<a href="./common/cloud-services-types/created-file.html">CreatedFile</a>&gt;</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="typescript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
</pre></td>
  <td class="code"><pre>const response = await this.zpfs_hdfs.cp(parameters);</pre></td>
</tr></table></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_ls"><a class="anchor" href="#_ls"></a>ls</h6>
<div class="paragraph">
<p>Returns a paginated list of the folder&#8217;s content.</p>
</div>
<div class="listingblock">
<div class="title">ls(parameters: <a href="./common/cloud-services-types/folder-listing-request.html">FolderListingRequest</a>): Promise&lt;<a href="./common/cloud-services-types/folder-listing.html">FolderListing</a>&gt;</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="typescript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
</pre></td>
  <td class="code"><pre>const response = await this.zpfs_hdfs.ls(parameters);</pre></td>
</tr></table></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_mv"><a class="anchor" href="#_mv"></a>mv</h6>
<div class="paragraph">
<p>Moves a file or folder (recursively) to a new location.
May fail if the target location is not empty.</p>
</div>
<div class="listingblock">
<div class="title">mv(parameters: <a href="./common/cloud-services-types/created-file.html">CreatedFile</a>): Promise&lt;<a href="./common/cloud-services-types/created-file.html">CreatedFile</a>&gt;</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="typescript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
</pre></td>
  <td class="code"><pre>const response = await this.zpfs_hdfs.mv(parameters);</pre></td>
</tr></table></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_snapshot"><a class="anchor" href="#_snapshot"></a>snapshot</h6>
<div class="paragraph">
<p>Creates a new folder and then copies the given files inside</p>
</div>
<div class="listingblock">
<div class="title">snapshot(parameters: <a href="./common/cloud-services-types/snapshot-creation-request.html">SnapshotCreationRequest</a>): Promise&lt;<a href="./common/cloud-services-types/created-file.html">CreatedFile</a>&gt;</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="typescript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
</pre></td>
  <td class="code"><pre>const response = await this.zpfs_hdfs.snapshot(parameters);</pre></td>
</tr></table></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_du"><a class="anchor" href="#_du"></a>du</h6>
<div class="paragraph">
<p>Returns an recursively aggregated number of used bytes, starting at the given path.</p>
</div>
<div class="listingblock">
<div class="title">du(parameters: <a href="./common/cloud-services-types/zpfs-request.html">ZpfsRequest</a>): Promise&lt;<a href="./common/cloud-services-types/zpfs-disk-usage.html">ZpfsDiskUsage</a>&gt;</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="typescript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
</pre></td>
  <td class="code"><pre>const response = await this.zpfs_hdfs.du(parameters);</pre></td>
</tr></table></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_rm"><a class="anchor" href="#_rm"></a>rm</h6>
<div class="paragraph">
<p>Removes a file or folder (recursively).</p>
</div>
<div class="listingblock">
<div class="title">rm(parameters: <a href="./common/cloud-services-types/file-removal.html">FileRemoval</a>): Promise&lt;<a href="./common/cloud-services-types/file-removal.html">FileRemoval</a>&gt;</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="typescript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
</pre></td>
  <td class="code"><pre>const response = await this.zpfs_hdfs.rm(parameters);</pre></td>
</tr></table></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_freeuploadurl"><a class="anchor" href="#_freeuploadurl"></a>freeUploadUrl</h6>
<div class="listingblock">
<div class="title">freeUploadUrl(parameters: <a href="./common/cloud-services-types/file-upload-request.html">FileUploadRequest</a>): Promise&lt;<a href="./common/cloud-services-types/file-upload-location.html">FileUploadLocation</a>&gt;</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="typescript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
</pre></td>
  <td class="code"><pre>const response = await this.zpfs_hdfs.freeUploadUrl(parameters);</pre></td>
</tr></table></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_newuploadurl"><a class="anchor" href="#_newuploadurl"></a>newUploadUrl</h6>
<div class="paragraph">
<p>Requests an HTTP upload URL.
The URL contains temporary credentials (typically valid for a few minutes) and is meant for immediate use.</p>
</div>
<div class="listingblock">
<div class="title">newUploadUrl(parameters: <a href="./common/cloud-services-types/file-upload-request.html">FileUploadRequest</a>): Promise&lt;<a href="./common/cloud-services-types/file-upload-location.html">FileUploadLocation</a>&gt;</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="typescript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
</pre></td>
  <td class="code"><pre>const response = await this.zpfs_hdfs.newUploadUrl(parameters);</pre></td>
</tr></table></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_updatemeta"><a class="anchor" href="#_updatemeta"></a>updateMeta</h6>
<div class="listingblock">
<div class="title">updateMeta(parameters: <a href="./common/cloud-services-types/file-meta-update.html">FileMetaUpdate</a>): Promise&lt;<a href="./common/cloud-services-types/listing-entry-info.html">ListingEntryInfo</a>&gt;</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="typescript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
</pre></td>
  <td class="code"><pre>const response = await this.zpfs_hdfs.updateMeta(parameters);</pre></td>
</tr></table></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_newfile"><a class="anchor" href="#_newfile"></a>newFile</h6>
<div class="paragraph">
<p>The client application calls this verb to notify that it&#8217;s done uploading to the cloud.
Calling that verb MAY trigger additional events such as thumbnail/metadata creation.</p>
</div>
<div class="listingblock">
<div class="title">newFile(parameters: <a href="./common/cloud-services-types/file-upload-complete.html">FileUploadComplete</a>): Promise&lt;<a href="./common/cloud-services-types/listing-entry-info.html">ListingEntryInfo</a>&gt;</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="typescript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
</pre></td>
  <td class="code"><pre>const response = await this.zpfs_hdfs.newFile(parameters);</pre></td>
</tr></table></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_mkdir"><a class="anchor" href="#_mkdir"></a>mkdir</h6>
<div class="paragraph">
<p>Creates a new folder.
May fail if the target location is not empty.</p>
</div>
<div class="listingblock">
<div class="title">mkdir(parameters: <a href="./common/cloud-services-types/folder-creation-request.html">FolderCreationRequest</a>): Promise&lt;<a href="./common/cloud-services-types/created-file.html">CreatedFile</a>&gt;</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="typescript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
</pre></td>
  <td class="code"><pre>const response = await this.zpfs_hdfs.mkdir(parameters);</pre></td>
</tr></table></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_how_to_use_it_8"><a class="anchor" href="#_how_to_use_it_8"></a>How to use it ?</h6>
<div class="listingblock">
<div class="title">worker/index.ts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="typescript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
</pre></td>
  <td class="code"><pre>import { Injectable } from '@zetapush/core';
import { Zpfs_hdfs, ZpfsRequest } from '@zetapush/platform-legacy'; <i class="conum" data-value="1"></i><b>(1)</b>

@Injectable()
export default class Api {
  constructor(
    private zpfs_hdfs: Zpfs_hdfs <i class="conum" data-value="2"></i><b>(2)</b>
  ) {}
  async doStuff(parameters: ZpfsRequest) {
    const response = await this.zpfs_hdfs.readToken(parameters); <i class="conum" data-value="3"></i><b>(3)</b>
    return response;
  }
}</pre></td>
</tr></table></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Import <code>Zpfs_hdfs</code> from platform</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Declare injected service</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Call injected service</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_template"><a class="anchor" href="#_template"></a>Template</h5>
<div class="paragraph">
<p>User API for templates</p>
</div>
<div class="paragraph">
<p>Users use this API to evaluate pre-configured templates.</p>
</div>
<div class="sect5">
<h6 id="_evaluate"><a class="anchor" href="#_evaluate"></a>evaluate</h6>
<div class="paragraph">
<p>Evaluates the given template and returns the result as a string.
Templates are parsed the first time they are evaluated. Evaluation may fail early due to a parsing error.</p>
</div>
<div class="listingblock">
<div class="title">evaluate(parameters: <a href="./common/cloud-services-types/template-request.html">TemplateRequest</a>): Promise&lt;<a href="./common/cloud-services-types/template-result.html">TemplateResult</a>&gt;</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="typescript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
</pre></td>
  <td class="code"><pre>const response = await this.template.evaluate(parameters);</pre></td>
</tr></table></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_how_to_use_it_9"><a class="anchor" href="#_how_to_use_it_9"></a>How to use it ?</h6>
<div class="listingblock">
<div class="title">worker/index.ts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="typescript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
</pre></td>
  <td class="code"><pre>import { Injectable } from '@zetapush/core';
import { Template, TemplateRequest } from '@zetapush/platform-legacy'; <i class="conum" data-value="1"></i><b>(1)</b>

@Injectable()
export default class Api {
  constructor(
    private template: Template <i class="conum" data-value="2"></i><b>(2)</b>
  ) {}
  async doStuff(parameters: TemplateRequest) {
    const response = await this.template.evaluate(parameters); <i class="conum" data-value="3"></i><b>(3)</b>
    return response;
  }
}</pre></td>
</tr></table></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Import <code>Template</code> from platform</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Declare injected service</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Call injected service</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_communication"><a class="anchor" href="#_communication"></a>Communication</h4>
<div class="sect4">
<h5 id="_messaging"><a class="anchor" href="#_messaging"></a>Messaging</h5>
<div class="paragraph">
<p>Messaging service</p>
</div>
<div class="paragraph">
<p>Simple and flexible user-to-user or user-to-group messaging service.</p>
</div>
<div class="sect5">
<h6 id="_send"><a class="anchor" href="#_send"></a>send</h6>
<div class="paragraph">
<p>Sends the given message to the specified target on the given (optional) channel.
The administratively given default channel name is used when none is provided in the message itself.</p>
</div>
<div class="listingblock">
<div class="title">send(parameters: <a href="./common/cloud-services-types/message.html">Message</a>): Promise&lt;<a href="./common/cloud-services-types/void.html">void</a>&gt;</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="typescript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
</pre></td>
  <td class="code"><pre>const response = await this.messaging.send(parameters);</pre></td>
</tr></table></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_how_to_use_it_10"><a class="anchor" href="#_how_to_use_it_10"></a>How to use it ?</h6>
<div class="listingblock">
<div class="title">worker/index.ts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="typescript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
</pre></td>
  <td class="code"><pre>import { Injectable } from '@zetapush/core';
import { Messaging, Message } from '@zetapush/platform-legacy'; <i class="conum" data-value="1"></i><b>(1)</b>

@Injectable()
export default class Api {
  constructor(
    private messaging: Messaging <i class="conum" data-value="2"></i><b>(2)</b>
  ) {}
  async doStuff(parameters: Message) {
    const response = await this.messaging.send(parameters); <i class="conum" data-value="3"></i><b>(3)</b>
    return response;
  }
}</pre></td>
</tr></table></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Import <code>Messaging</code> from platform</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Declare injected service</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Call injected service</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_notif"><a class="anchor" href="#_notif"></a>Notif</h5>
<div class="paragraph">
<p>Notification User API</p>
</div>
<div class="paragraph">
<p>User API for notifications.
For notifications to work properly, it is imperative that the resource name of a device remain constant over time.</p>
</div>
<div class="sect5">
<h6 id="_send_2"><a class="anchor" href="#_send_2"></a>send</h6>
<div class="paragraph">
<p>Sends a native push notification to the target.</p>
</div>
<div class="listingblock">
<div class="title">send(parameters: <a href="./common/cloud-services-types/notification-message.html">NotificationMessage</a>): Promise&lt;<a href="./common/cloud-services-types/notification-send-status.html">NotificationSendStatus</a>&gt;</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="typescript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
</pre></td>
  <td class="code"><pre>const response = await this.notif.send(parameters);</pre></td>
</tr></table></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_unregister"><a class="anchor" href="#_unregister"></a>unregister</h6>
<div class="paragraph">
<p>Unregisters the device for the current user and resource.
This verb does not need any parameters.</p>
</div>
<div class="listingblock">
<div class="title">unregister(parameters: <a href="./common/cloud-services-types/.html">undefined</a>): Promise&lt;<a href="./common/cloud-services-types/void.html">void</a>&gt;</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="typescript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
</pre></td>
  <td class="code"><pre>const response = await this.notif.unregister(parameters);</pre></td>
</tr></table></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_register"><a class="anchor" href="#_register"></a>register</h6>
<div class="paragraph">
<p>Registers the device for the current user and resource.
This service maintains a mapping of <em>userkey/</em>resource to device registration IDs.
You MUST NOT re-use the same resource name from one device to another if you want to target specific devices with 'send'.
Only one registration can be active for a given <em>userKey/</em>resource pair in a notification service.
Device registration can be &lt;b&gt;neither impersonated nor called indirectly&lt;/b&gt; (from a scheduled job).</p>
</div>
<div class="listingblock">
<div class="title">register(parameters: <a href="./common/cloud-services-types/notifiable-device-registration.html">NotifiableDeviceRegistration</a>): Promise&lt;<a href="./common/cloud-services-types/void.html">void</a>&gt;</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="typescript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
</pre></td>
  <td class="code"><pre>const response = await this.notif.register(parameters);</pre></td>
</tr></table></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_how_to_use_it_11"><a class="anchor" href="#_how_to_use_it_11"></a>How to use it ?</h6>
<div class="listingblock">
<div class="title">worker/index.ts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="typescript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
</pre></td>
  <td class="code"><pre>import { Injectable } from '@zetapush/core';
import { Notif, NotificationMessage } from '@zetapush/platform-legacy'; <i class="conum" data-value="1"></i><b>(1)</b>

@Injectable()
export default class Api {
  constructor(
    private notif: Notif <i class="conum" data-value="2"></i><b>(2)</b>
  ) {}
  async doStuff(parameters: NotificationMessage) {
    const response = await this.notif.send(parameters); <i class="conum" data-value="3"></i><b>(3)</b>
    return response;
  }
}</pre></td>
</tr></table></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Import <code>Notif</code> from platform</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Declare injected service</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Call injected service</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_sendmail"><a class="anchor" href="#_sendmail"></a>Sendmail</h5>
<div class="paragraph">
<p>Mail service user API</p>
</div>
<div class="paragraph">
<p>This service is statically configured with an outgoing SMTP server.
Users call the API here to actually send emails.</p>
</div>
<div class="sect5">
<h6 id="_send_3"><a class="anchor" href="#_send_3"></a>send</h6>
<div class="paragraph">
<p>Sends an email with the given body to the intended recipients.</p>
</div>
<div class="listingblock">
<div class="title">send(parameters: <a href="./common/cloud-services-types/email.html">Email</a>): Promise&lt;<a href="./common/cloud-services-types/void.html">void</a>&gt;</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="typescript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
</pre></td>
  <td class="code"><pre>const response = await this.sendmail.send(parameters);</pre></td>
</tr></table></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_how_to_use_it_12"><a class="anchor" href="#_how_to_use_it_12"></a>How to use it ?</h6>
<div class="listingblock">
<div class="title">worker/index.ts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="typescript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
</pre></td>
  <td class="code"><pre>import { Injectable } from '@zetapush/core';
import { Sendmail, Email } from '@zetapush/platform-legacy'; <i class="conum" data-value="1"></i><b>(1)</b>

@Injectable()
export default class Api {
  constructor(
    private sendmail: Sendmail <i class="conum" data-value="2"></i><b>(2)</b>
  ) {}
  async doStuff(parameters: Email) {
    const response = await this.sendmail.send(parameters); <i class="conum" data-value="3"></i><b>(3)</b>
    return response;
  }
}</pre></td>
</tr></table></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Import <code>Sendmail</code> from platform</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Declare injected service</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Call injected service</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_sms_ovh"><a class="anchor" href="#_sms_ovh"></a>Sms_ovh</h5>
<div class="paragraph">
<p>SMS service</p>
</div>
<div class="paragraph">
<p>User API for SMS.</p>
</div>
<div class="sect5">
<h6 id="_send_4"><a class="anchor" href="#_send_4"></a>send</h6>
<div class="paragraph">
<p>Sends the given message to the given recipients.</p>
</div>
<div class="listingblock">
<div class="title">send(parameters: <a href="./common/cloud-services-types/sms-message.html">SmsMessage</a>): Promise&lt;<a href="./common/cloud-services-types/void.html">void</a>&gt;</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="typescript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
</pre></td>
  <td class="code"><pre>const response = await this.sms_ovh.send(parameters);</pre></td>
</tr></table></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_how_to_use_it_13"><a class="anchor" href="#_how_to_use_it_13"></a>How to use it ?</h6>
<div class="listingblock">
<div class="title">worker/index.ts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="typescript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
</pre></td>
  <td class="code"><pre>import { Injectable } from '@zetapush/core';
import { Sms_ovh, SmsMessage } from '@zetapush/platform-legacy'; <i class="conum" data-value="1"></i><b>(1)</b>

@Injectable()
export default class Api {
  constructor(
    private sms_ovh: Sms_ovh <i class="conum" data-value="2"></i><b>(2)</b>
  ) {}
  async doStuff(parameters: SmsMessage) {
    const response = await this.sms_ovh.send(parameters); <i class="conum" data-value="3"></i><b>(3)</b>
    return response;
  }
}</pre></td>
</tr></table></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Import <code>Sms_ovh</code> from platform</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Declare injected service</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Call injected service</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_utilities_management"><a class="anchor" href="#_utilities_management"></a>Utilities Management</h4>
<div class="sect4">
<h5 id="_cron"><a class="anchor" href="#_cron"></a>Cron</h5>
<div class="paragraph">
<p>User API for the Scheduler</p>
</div>
<div class="paragraph">
<p>User endpoints for scheduling : users can schedule, list and delete tasks.
Tasks are stored on a per-user basis: a task will run with the priviledges of the user who stored it.
Tasks are run on the server and thus can call api verbs marked as server-only.</p>
</div>
<div class="sect5">
<h6 id="_schedule"><a class="anchor" href="#_schedule"></a>schedule</h6>
<div class="paragraph">
<p>Schedules a task for later execution. Tasks are executed asynchronously with the identity of the calling user.
Tasks will be executed at a fixed moment in time in the future, or repeatedly, with minute precision.
If a task already exists with the same cronName (a cronName is unique for a given user), this new task completely replaces it.
A task can be scheduled with a cron-like syntax for repetitive or one-shot execution.
Wildcards are not allowed for minutes and hours.
When scheduling for one-shot execution, the time must be at least two minutes into the future.</p>
</div>
<div class="listingblock">
<div class="title">schedule(parameters: <a href="./common/cloud-services-types/cron-task-request.html">CronTaskRequest</a>): Promise&lt;<a href="./common/cloud-services-types/cron-task-request.html">CronTaskRequest</a>&gt;</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="typescript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
</pre></td>
  <td class="code"><pre>const response = await this.cron.schedule(parameters);</pre></td>
</tr></table></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_settimeout"><a class="anchor" href="#_settimeout"></a>setTimeout</h6>
<div class="paragraph">
<p>Schedules a task for later execution. Tasks are executed asynchronously with the identity of the calling user.
Tasks will be executed with second precision in the near future (120 seconds delay max).</p>
</div>
<div class="listingblock">
<div class="title">setTimeout(parameters: <a href="./common/cloud-services-types/timer-request.html">TimerRequest</a>): Promise&lt;<a href="./common/cloud-services-types/timer-result.html">TimerResult</a>&gt;</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="typescript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
</pre></td>
  <td class="code"><pre>const response = await this.cron.setTimeout(parameters);</pre></td>
</tr></table></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_unschedule"><a class="anchor" href="#_unschedule"></a>unschedule</h6>
<div class="paragraph">
<p>Removes a previously scheduled task.
Does absolutely nothing if asked to remove a non-existent task.</p>
</div>
<div class="listingblock">
<div class="title">unschedule(parameters: <a href="./common/cloud-services-types/cron-task-deletion.html">CronTaskDeletion</a>): Promise&lt;<a href="./common/cloud-services-types/cron-task-deletion.html">CronTaskDeletion</a>&gt;</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="typescript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
</pre></td>
  <td class="code"><pre>const response = await this.cron.unschedule(parameters);</pre></td>
</tr></table></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_list_3"><a class="anchor" href="#_list_3"></a>list</h6>
<div class="paragraph">
<p>Returns a paginated list of the asking user&#8217;s tasks.</p>
</div>
<div class="listingblock">
<div class="title">list(parameters: <a href="./common/cloud-services-types/cron-task-list-request.html">CronTaskListRequest</a>): Promise&lt;<a href="./common/cloud-services-types/cron-planning.html">CronPlanning</a>&gt;</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="typescript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
</pre></td>
  <td class="code"><pre>const response = await this.cron.list(parameters);</pre></td>
</tr></table></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_how_to_use_it_14"><a class="anchor" href="#_how_to_use_it_14"></a>How to use it ?</h6>
<div class="listingblock">
<div class="title">worker/index.ts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="typescript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
</pre></td>
  <td class="code"><pre>import { Injectable } from '@zetapush/core';
import { Cron, CronTaskRequest } from '@zetapush/platform-legacy'; <i class="conum" data-value="1"></i><b>(1)</b>

@Injectable()
export default class Api {
  constructor(
    private cron: Cron <i class="conum" data-value="2"></i><b>(2)</b>
  ) {}
  async doStuff(parameters: CronTaskRequest) {
    const response = await this.cron.schedule(parameters); <i class="conum" data-value="3"></i><b>(3)</b>
    return response;
  }
}</pre></td>
</tr></table></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Import <code>Cron</code> from platform</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Declare injected service</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Call injected service</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_logs"><a class="anchor" href="#_logs"></a>Logs</h5>
<div class="paragraph">
<p>Log API</p>
</div>
<div class="paragraph">
<p>User API for logging.</p>
</div>
<div class="sect5">
<h6 id="_log"><a class="anchor" href="#_log"></a>log</h6>
<div class="paragraph">
<p>Adds some server generated data and stores the entry into the sink defined by configuration.</p>
</div>
<div class="listingblock">
<div class="title">log(parameters: <a href="./common/cloud-services-types/log-request.html">LogRequest</a>): Promise&lt;<a href="./common/cloud-services-types/void.html">void</a>&gt;</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="typescript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
</pre></td>
  <td class="code"><pre>const response = await this.logs.log(parameters);</pre></td>
</tr></table></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_how_to_use_it_15"><a class="anchor" href="#_how_to_use_it_15"></a>How to use it ?</h6>
<div class="listingblock">
<div class="title">worker/index.ts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="typescript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
</pre></td>
  <td class="code"><pre>import { Injectable } from '@zetapush/core';
import { Logs, LogRequest } from '@zetapush/platform-legacy'; <i class="conum" data-value="1"></i><b>(1)</b>

@Injectable()
export default class Api {
  constructor(
    private logs: Logs <i class="conum" data-value="2"></i><b>(2)</b>
  ) {}
  async doStuff(parameters: LogRequest) {
    const response = await this.logs.log(parameters); <i class="conum" data-value="3"></i><b>(3)</b>
    return response;
  }
}</pre></td>
</tr></table></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Import <code>Logs</code> from platform</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Declare injected service</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Call injected service</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_trigger"><a class="anchor" href="#_trigger"></a>Trigger</h5>
<div class="paragraph">
<p>Trigger service</p>
</div>
<div class="paragraph">
<p>Register listeners and trigger events.</p>
</div>
<div class="sect5">
<h6 id="_trigger_2"><a class="anchor" href="#_trigger_2"></a>trigger</h6>
<div class="paragraph">
<p>Triggers an event.
All listeners previously registered for that event will be called, in no particular order.</p>
</div>
<div class="listingblock">
<div class="title">trigger(parameters: <a href="./common/cloud-services-types/event-trigger.html">EventTrigger</a>): Promise&lt;<a href="./common/cloud-services-types/void.html">void</a>&gt;</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="typescript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
</pre></td>
  <td class="code"><pre>const response = await this.trigger.trigger(parameters);</pre></td>
</tr></table></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_how_to_use_it_16"><a class="anchor" href="#_how_to_use_it_16"></a>How to use it ?</h6>
<div class="listingblock">
<div class="title">worker/index.ts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="typescript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
</pre></td>
  <td class="code"><pre>import { Injectable } from '@zetapush/core';
import { Trigger, EventTrigger } from '@zetapush/platform-legacy'; <i class="conum" data-value="1"></i><b>(1)</b>

@Injectable()
export default class Api {
  constructor(
    private trigger: Trigger <i class="conum" data-value="2"></i><b>(2)</b>
  ) {}
  async doStuff(parameters: EventTrigger) {
    const response = await this.trigger.trigger(parameters); <i class="conum" data-value="3"></i><b>(3)</b>
    return response;
  }
}</pre></td>
</tr></table></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Import <code>Trigger</code> from platform</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Declare injected service</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Call injected service</td>
</tr>
</table>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="cli"><a class="anchor" href="#cli"></a>Command Line Interface</h2>
<div class="sectionbody">
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p>Some details about the command line interface will soon be added.
For now, you can use the <code>zeta -h</code> command to get some information.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_config"><a class="anchor" href="#_config"></a>Config</h3>

</div>
<div class="sect2">
<h3 id="_run"><a class="anchor" href="#_run"></a>Run</h3>

</div>
<div class="sect2">
<h3 id="_push_2"><a class="anchor" href="#_push_2"></a>Push</h3>

</div>
<div class="sect2">
<h3 id="verbosity_level"><a class="anchor" href="#verbosity_level"></a>Change verbosity</h3>

</div>
</div>
</div>
<div class="sect1">
<h2 id="_configuration"><a class="anchor" href="#_configuration"></a>Configuration</h2>
<div class="sectionbody">
<div class="paragraph">
<p>ZetaPush prefers convention over configuration. However, conventions can be overriden.</p>
</div>
<div class="sect2">
<h3 id="_account_configuration"><a class="anchor" href="#_account_configuration"></a>Account configuration</h3>
<div class="paragraph">
<p>To use <code>ZetaPush</code>, you need to have a <em>ZetaPush account</em> and a <em>ZetaPush application</em>.
If you don&#8217;t have any of them, you can <a href="https://www.zetapush.com/sign-up-for-a-free-trial/">signup for a free trial</a> or <a href="https://www.zetapush.com/contact">contact us for more suitable account</a>.</p>
</div>
<div class="paragraph">
<p>Then, you can set your account configuration in the <code>.zetarc</code> file.
This file is present at the root of your application folder.</p>
</div>
<div class="paragraph">
<p>Here is the list of properties that can be used. For each of them, you also have the associated <a href="#cli">cli flag</a> and environment variable.</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 1. Account variables</caption>
<colgroup>
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-middle">Name of the property</th>
<th class="tableblock halign-center valign-middle">Definition</th>
<th class="tableblock halign-center valign-middle">environment variable</th>
<th class="tableblock halign-center valign-middle">Name in the <em>.zetarc</em></th>
<th class="tableblock halign-center valign-middle">CLI parameter</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-middle"><p class="tableblock">Developer login</p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock">This login is the email used by the developer when logging in to the <a href="https://console-celtia.zetapush.com">ZetaPush console</a>. It <strong>does not concern</strong> the applications developed by the developer. It is only used to identify the <em>developer account</em>.</p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock">ZP_DEVELOPER_LOGIN</p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock">developerLogin</p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock">--developer-login &lt;login&gt;</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"><p class="tableblock">Developer password</p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock">Like the property <code>--developer-login</code>, this password is only used for the <em>ZetaPush developer account</em>. It <strong>does not concern</strong> the applications developed by the developer.</p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock">ZP_DEVELOPER_PASSWORD</p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock">developerLogin</p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock">--developer-password &lt;password&gt;</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"><p class="tableblock">Application name</p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock">A developer can develop many applications. Hence he needs to identify each of them. The <code>appName</code> property is the unique name of an application on a <em>ZetaPush developer account</em>.</p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock">ZP_APP_NAME</p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock">appName</p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock">--app-name &lt;name&gt;</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"><p class="tableblock">Platform URL</p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock">By default, the developer uses the <em>public ZetaPush cloud</em> to develop and deploy its applications. In most cases, the developer doesn&#8217;t need to set this property. <strong>This property if useful when another (on premise, or dedicated) <em>ZetaPush cloud</em> is to be used.</strong></p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock">ZP_PLATFORM_URL</p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock">platformUrl</p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock">--platform-url &lt;platform&gt;</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="_code_structure_configuration"><a class="anchor" href="#_code_structure_configuration"></a>Code structure configuration</h3>
<div class="paragraph">
<p>It is possible to configure the structure of your application.
In this part, we list the different possibilities.</p>
</div>
<div class="sect3">
<h4 id="change-worker-entry-point"><a class="anchor" href="#change-worker-entry-point"></a>Entry point for worker</h4>
<div class="paragraph">
<p>By default, the entry point of your worker code is the file <code>./worker/index.ts</code>.
You can configure the entry point of the worker setting the <code>main</code> property of the <code>package.json</code> file.</p>
</div>
<div class="paragraph">
<p>For example if you want to use the file <code>./worker/main.ts</code> as entry point you need to have the following <code>package.json</code> content :</p>
</div>
<div class="listingblock">
<div class="title">Custom worker entry point</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
</pre></td>
  <td class="code"><pre>{
  <span class="key"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">myApp</span><span class="delimiter">&quot;</span></span>,
  <span class="key"><span class="delimiter">&quot;</span><span class="content">version</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">0.1.0</span><span class="delimiter">&quot;</span></span>,
  <span class="key"><span class="delimiter">&quot;</span><span class="content">main</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">worker/main.ts</span><span class="delimiter">&quot;</span></span>,       <i class="conum" data-value="1"></i><b>(1)</b>
  <span class="error">/</span><span class="error">/</span> <span class="error">O</span><span class="error">t</span><span class="error">h</span><span class="error">e</span><span class="error">r</span> <span class="error">p</span><span class="error">r</span><span class="error">o</span><span class="error">p</span><span class="error">e</span><span class="error">r</span><span class="error">t</span><span class="error">i</span><span class="error">e</span><span class="error">s</span><span class="error">.</span><span class="error">.</span><span class="error">.</span>
}</pre></td>
</tr></table></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Path of the file used as entry point</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Detail about path of entry point</div>
<div class="paragraph">
<p>For now, the entry point of your worker need to be in the <code>worker</code> folder.
This will soon be possible to put your entry point anywhere, when the <a href="#different_directory_structures">custom directory structure</a> will be released.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="different_directory_structures"><a class="anchor" href="#different_directory_structures"></a>Custom directory structure</h4>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p>This section will be useful if you want to change the structure of your application.
The most common case is when you want to use framework (Angular, React, VueJS for example).
This documentation will soon be ready.</p>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_script_alias"><a class="anchor" href="#_script_alias"></a>Script alias</h4>
<div class="paragraph">
<p>Npm provides a handy feature to run scripts provided by dependencies without needing to change your computer settings or install the tool. ZetaPush defines npm <a href="https://medium.com/@mxstbr/npm-scripts-explained-f125e85eb378" target="_blank" rel="noopener">script aliases</a> to run the ZetaPush <em>CLI</em> through npm.</p>
</div>
<div class="paragraph">
<p>See <a href="./developer-manual.html#_using_cli">for more information about the ways of using the CLI</a>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="configuration_properties"><a class="anchor" href="#configuration_properties"></a>Configuration properties</h3>
<div class="paragraph">
<p>ZetaPush provides the <code>application.json</code> file to let you configure the behavior of your application.</p>
</div>
<div class="paragraph">
<p>For now, the <code>application.json</code> file is mainly used for the <a href="#integrate_user_management">Standard User Workflow</a> but you can also <a href="#configuration_properties ">configure your own properties for your application</a>.
The list of available properties for the <a href="#integrate_user_management">Standard User Workflow</a> are listed in <a href="#customize_standard_user_workflow">this section</a>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">New properties will added</div>
<div class="paragraph">
<p>New <em>Cloud Services</em> will be developed (to handle data, security, etc&#8230;&#8203;).
With them, some properties may be added and configurable through the application.json file.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Future features</div>
<div class="paragraph">
<p>New features about <code>application.json</code> file will be soon released :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Support of multi one <code>application.json</code> file per worker (when the multi-worker will be released)</p>
</li>
<li>
<p>Support of one shared <code>application.json</code> between workers</p>
</li>
<li>
<p>Support of one shared <code>application.json</code> for the whole application (worker and front)</p>
</li>
<li>
<p>Support of <code>application.json</code> file per environment like <code>application-&lt;env&gt;.json</code> for example. (When the multi-environment will be released)</p>
</li>
<li>
<p>Autocompletion of properties in VSCode (and other IDE)</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p>You will soon can add your own configuration property source. For example download properties from an external service or from a Git repository. (You will also be able to configure the priority of the source).</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_configuration_override"><a class="anchor" href="#_configuration_override"></a>Configuration override</h3>
<div class="paragraph">
<p>You can put many properties in several locations (environment variables, CLI&#8230;&#8203;).
ZetaPush includes and overrides this properties in a specific order:</p>
</div>
<div class="sect3">
<h4 id="_account_properties"><a class="anchor" href="#_account_properties"></a>Account properties</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Environment variables</p>
</li>
<li>
<p>.zetarc file</p>
</li>
<li>
<p>CLI parameters</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>So if you use the same property in several locations, the environment variable is overwritten by the <code>.zetarc</code> value and this last value is overwritten by the CLI parameter.</p>
</div>
</div>
<div class="sect3">
<h4 id="_application_properties"><a class="anchor" href="#_application_properties"></a>Application properties</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Default values (if exists)</p>
</li>
<li>
<p><code>application.json</code> file</p>
</li>
<li>
<p>CLI parameters</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>So if you use the same property in several locations, the default value is overwritten by the <code>application.json</code> property and this last value is overwritten by the CLI parameter.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_customize_cloud_services"><a class="anchor" href="#_customize_cloud_services"></a>Customize cloud services</h3>
<div class="sect3">
<h4 id="customize_standard_user_workflow"><a class="anchor" href="#customize_standard_user_workflow"></a>User Management</h4>
<div class="paragraph">
<p>Some properties are available in the <code>application.json</code> file to configure the <em>Standard User Workflow</em>. We will list all of them in this section:</p>
</div>
<div class="sect4">
<h5 id="_organization"><a class="anchor" href="#_organization"></a>Organization</h5>
<div id="configure_organization_name" class="paragraph">
<div class="title">Organization name</div>
<p>Name of your organization. It is used in the default email sender (<code>noreply@${organizationName}.com</code>).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json">{
  <span class="key"><span class="delimiter">&quot;</span><span class="content">organization</span><span class="delimiter">&quot;</span></span>: {
    <span class="key"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">ZetaPush</span><span class="delimiter">&quot;</span></span>
  }
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Optional property</div>
<div class="paragraph">
<p>This property is optional. If it is not configured, you need to <a href="#configure_email_sender">configure an email sender</a>.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_email"><a class="anchor" href="#_email"></a>Email</h5>
<div id="configure_email_sender" class="paragraph">
<div class="title">Email sender</div>
<p>Let you configure the sender of the different emails used in your application. For example for account registration.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Default email sender</div>
<div class="paragraph">
<p>The default email sender is <code>noreply@${organizationName}.com</code>.
So If this property is not set, you need to configure the <a href="#configure_organization_name">organization name</a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>This property support the standard notation for email (<code>name &lt;<a href="mailto:email@domain.com">email@domain.com</a>&gt;</code>):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json">{
  <span class="key"><span class="delimiter">&quot;</span><span class="content">email</span><span class="delimiter">&quot;</span></span>: {
    <span class="key"><span class="delimiter">&quot;</span><span class="content">sender</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Sender Name &lt;sender@my-domain.com&gt;</span><span class="delimiter">&quot;</span></span>  <i class="conum" data-value="1"></i><b>(1)</b>
  }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>You can also only type the email (ex: "<a href="mailto:sender@my-domain.com">sender@my-domain.com</a>")</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_account_registration"><a class="anchor" href="#_account_registration"></a>Account registration</h5>
<div class="sect5">
<h6 id="_account_confirmation"><a class="anchor" href="#_account_confirmation"></a>Account confirmation</h6>
<div class="paragraph">
<p>During the account creation workflow of the <em>StandardUserWorkflow</em>, an email is sent to ask the end-user to confirm his email. You can configure many properties about this.</p>
</div>
<div class="paragraph">
<div class="title">Email subject</div>
<p>You can set the email subject of the confirmation account creation like below:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json">{
  <span class="key"><span class="delimiter">&quot;</span><span class="content">registration</span><span class="delimiter">&quot;</span></span>: {
    <span class="key"><span class="delimiter">&quot;</span><span class="content">confirmation</span><span class="delimiter">&quot;</span></span>: {
      <span class="key"><span class="delimiter">&quot;</span><span class="content">email</span><span class="delimiter">&quot;</span></span>: {
        <span class="key"><span class="delimiter">&quot;</span><span class="content">subject</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Please confirm your account registration</span><span class="delimiter">&quot;</span></span>
      }
    }
  }
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Mandatory property</div>
<div class="paragraph">
<p>For now, this is a mandatory property. In a future version, the subject could be extracted from the email template. This allows you to define a single source of information about the sent email and moreover, it simplifies internationalization of your email.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<div class="title">URL Redirection</div>
<p>When an end-user validates his account, he is redirected to a specific URL of your application. There are 2 cases, if the confirmation is OK or if it failed:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json">{
  <span class="key"><span class="delimiter">&quot;</span><span class="content">registration</span><span class="delimiter">&quot;</span></span>: {
    <span class="key"><span class="delimiter">&quot;</span><span class="content">confirmation</span><span class="delimiter">&quot;</span></span>: {
      <span class="key"><span class="delimiter">&quot;</span><span class="content">success-url</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">https://my-app-url/#login</span><span class="delimiter">&quot;</span></span>,                   <i class="conum" data-value="1"></i><b>(1)</b>
      <span class="key"><span class="delimiter">&quot;</span><span class="content">failure-url</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">https://my-app-url/#confirmation-failed</span><span class="delimiter">&quot;</span></span>      <i class="conum" data-value="2"></i><b>(2)</b>
    }
  }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The end-user is redirected to this URL when the confirmation is OK</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The end-user is redirected to this URL when the confirmation failed</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You can also only set the path of your urls. The base url will be automatically provided by ZetaPush:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json">{
  <span class="key"><span class="delimiter">&quot;</span><span class="content">registration</span><span class="delimiter">&quot;</span></span>: {
    <span class="key"><span class="delimiter">&quot;</span><span class="content">confirmation</span><span class="delimiter">&quot;</span></span>: {
      <span class="key"><span class="delimiter">&quot;</span><span class="content">success-url</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">#login</span><span class="delimiter">&quot;</span></span>,
      <span class="key"><span class="delimiter">&quot;</span><span class="content">failure-url</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">#confirmation-failed</span><span class="delimiter">&quot;</span></span>
    }
  }
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Mandatory property</div>
<div class="paragraph">
<p>This property is mandatory.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_reset_password_workflow"><a class="anchor" href="#_reset_password_workflow"></a>Reset password workflow</h5>
<div class="paragraph">
<div class="title">URL to ask to change password</div>
<p>It is possible to configure the path of your application where the end-user will be able to choose his new password.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json">{
  <span class="key"><span class="delimiter">&quot;</span><span class="content">reset-password</span><span class="delimiter">&quot;</span></span>: {
    <span class="key"><span class="delimiter">&quot;</span><span class="content">ask</span><span class="delimiter">&quot;</span></span>: {
      <span class="key"><span class="delimiter">&quot;</span><span class="content">url</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">http://localhost:3000/reset-password#${token}</span><span class="delimiter">&quot;</span></span>,     <i class="conum" data-value="1"></i><b>(1)</b>
    }
  }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The token is sent through the URL. To use it you need to put <code>${token}</code> in your URL.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You can also only set the path of your url. The base url will be automatically provided by ZetaPush:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json">{
  <span class="key"><span class="delimiter">&quot;</span><span class="content">reset-password</span><span class="delimiter">&quot;</span></span>: {
    <span class="key"><span class="delimiter">&quot;</span><span class="content">ask</span><span class="delimiter">&quot;</span></span>: {
      <span class="key"><span class="delimiter">&quot;</span><span class="content">url</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">/reset-password#${token}</span><span class="delimiter">&quot;</span></span>,     <i class="conum" data-value="1"></i><b>(1)</b>
    }
  }
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Mandatory property</div>
<div class="paragraph">
<p>This property is mandatory.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<div class="title">Email subject</div>
<p>You can configure the subject of the sent email to reset the password:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json">{
  <span class="key"><span class="delimiter">&quot;</span><span class="content">reset-password</span><span class="delimiter">&quot;</span></span>: {
    <span class="key"><span class="delimiter">&quot;</span><span class="content">ask</span><span class="delimiter">&quot;</span></span>: {
      <span class="key"><span class="delimiter">&quot;</span><span class="content">email</span><span class="delimiter">&quot;</span></span>: {
        <span class="key"><span class="delimiter">&quot;</span><span class="content">subject</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Please choose a new password</span><span class="delimiter">&quot;</span></span>
      }
    }
  }
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Mandatory property</div>
<div class="paragraph">
<p>For now, this is a mandatory property. In a future version, the subject could be extracted from the email template. This allows you to define a single source of information about the sent email and moreover, it simplifies internationalization of your email.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_email_provider_configuration"><a class="anchor" href="#_email_provider_configuration"></a>Email provider configuration</h5>
<div class="paragraph">
<p>To use the <em>StandardUserWorkflow</em> you need to configure an email provider.
Today, you can use two possibilities: <em>Mailjet</em> or <em>SMTP</em>.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Future implementations</div>
<div class="paragraph">
<p>In future versions, other implementatins will be provided as-is. Moreover, you will be able to replace email sending by SMS or anything else.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Mandatory property</div>
<div class="paragraph">
<p>You need to set at least one email provider configuration and you need to have only one email provider configuration enabled.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect5">
<h6 id="_mailjet_configuration"><a class="anchor" href="#_mailjet_configuration"></a>Mailjet configuration</h6>
<div class="paragraph">
<p>To use the <em>Mailjet</em> configuration you need to configure the <code>application.json</code> file like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json">{
  <span class="key"><span class="delimiter">&quot;</span><span class="content">mailjet</span><span class="delimiter">&quot;</span></span>: {
    <span class="key"><span class="delimiter">&quot;</span><span class="content">apikey-public</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">my-mailjet-apikey-public</span><span class="delimiter">&quot;</span></span>,      <i class="conum" data-value="1"></i><b>(1)</b>
    <span class="key"><span class="delimiter">&quot;</span><span class="content">apikey-private</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">my-mailjet-apikey-private</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">enable</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span>,                                 <i class="conum" data-value="2"></i><b>(2)</b>
    <span class="key"><span class="delimiter">&quot;</span><span class="content">url</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">https://api.mailjet.com/v3.1/send</span><span class="delimiter">&quot;</span></span>        <i class="conum" data-value="3"></i><b>(3)</b>
  }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <code>apikey-public</code> and <code>apikey-private</code> are provided by <em>Mailjet</em> and you can find them in your <em>Mailjet</em> account information.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Optional property to define that we use this email provider configuration. (The default value is <code>true</code> if you have configured <code>apikey-public</code> and <code>apikey-private</code>)</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Optional property to define the URL to use for your <em>Mailjet</em> email provider. By default the used URL is <code><a href="https://api.mailjet.com/v3.1/send" class="bare">https://api.mailjet.com/v3.1/send</a></code>.</td>
</tr>
</table>
</div>
</div>
<div class="sect5">
<h6 id="_smtp_configuration"><a class="anchor" href="#_smtp_configuration"></a>SMTP configuration</h6>
<div class="paragraph">
<p>To use the <em>SMTP</em> configuration you need to configure the <code>application.json</code> file like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json">{
  <span class="key"><span class="delimiter">&quot;</span><span class="content">smtp</span><span class="delimiter">&quot;</span></span>: {
    <span class="key"><span class="delimiter">&quot;</span><span class="content">host</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">my-smtp-host</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">port</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">465</span><span class="delimiter">&quot;</span></span>,                      <i class="conum" data-value="1"></i><b>(1)</b>
    <span class="key"><span class="delimiter">&quot;</span><span class="content">username</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">my-smtp-username</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">password</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">my-smtp-password</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">ssl</span><span class="delimiter">&quot;</span></span>: <span class="value">true</span>,                        <i class="conum" data-value="2"></i><b>(2)</b>
    <span class="key"><span class="delimiter">&quot;</span><span class="content">starttls</span><span class="delimiter">&quot;</span></span>: <span class="value">true</span>,                   <i class="conum" data-value="2"></i><b>(2)</b>
    <span class="key"><span class="delimiter">&quot;</span><span class="content">enable</span><span class="delimiter">&quot;</span></span>: <span class="value">true</span>                      <i class="conum" data-value="3"></i><b>(3)</b>
  }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Optional, deducted from SSL and starttls</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Optional, default to <code>true</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Optional property to define that we use this email provider configuration. (The default value is <code>true</code> if you have configured at least host and port)</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect4">
<h5 id="auto_implementation_selection"><a class="anchor" href="#auto_implementation_selection"></a>Auto implementation about properties</h5>
<div class="paragraph">
<p>The implementation of the <em>StandardUserWorkflow</em> can change about the presence or not of particular properties.</p>
</div>
<div class="paragraph">
<p>For example, if you <a href="#configure_email_sender">configure an email sender</a>, the default email sender using the organization name will be overriden.</p>
</div>
<div class="paragraph">
<p>A most common case is for email provider configuration. If you change your <em>STMP</em> configuration to a <em>Mailjet</em> configuration (for example), the implementation will be automatically changed.</p>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_logs_2"><a class="anchor" href="#_logs_2"></a>Logs</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To configure the log level of your application you use the <a href="#cli">CLI</a> or from the <a href="https://console-celtia.zetapush.com">web console</a> (Not ready yet).</p>
</div>
<div class="paragraph">
<p>To do this via the <a href="#cli">CLI</a>, you need to launch the <code>zeta config</code> command (See more details in <a href="#verbosity_level">this section</a>).</p>
</div>
<div class="listingblock">
<div class="title">Get the current log level</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="console">$ zeta config --get</code></pre>
</div>
</div>
<div class="paragraph">
<p>Today, there are only two available log levels:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>verbose</p>
</li>
<li>
<p>default</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If you want leaner log level, you can <a href="https://www.zetapush.com/contact">contact us</a>.</p>
</div>
<div class="listingblock">
<div class="title">Set the log level</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="console">$ zeta config --logs verbose
$ zeta config --logs default</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Default verbose level</div>
<div class="paragraph">
<p>The default verbose level traces only errors.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="_console_log"><a class="anchor" href="#_console_log"></a>Console.log</h3>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p>It will soon be possible to see your <code>console.log()</code> in the <a href="https://console-celtia.zetapush.com">web console</a>.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="local_logger"><a class="anchor" href="#local_logger"></a>Utility methods provided by @zetapush/common</h3>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p>The utility methods from <code>@zetapush/common</code> for <em>Logs</em> will soon be documented.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="log_service"><a class="anchor" href="#log_service"></a>Built-in log cloud service</h3>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p><em>ZetaPush</em> provides a <em>Log</em> service.
For now, you can use the <a href="#log_with_requestcontext"><em>requestContext</em></a> object for more convenience.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="log_with_requestcontext"><a class="anchor" href="#log_with_requestcontext"></a>Logs using requestContext</h3>
<div class="paragraph">
<p>The <em>requestContext</em> object is an abstraction of the <a href="#logs">logs service</a>.</p>
</div>
<div class="paragraph">
<p>The <a href="#developer_manual_logs">dedicated section</a> explains what is the <em>requestContext</em> and how to use it. So in this section we will see a practical utilization of <em>requestContext</em>.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Set correct log level</div>
<div class="paragraph">
<p>To be sure to see all logs, you can put the log level to <code>verbose</code> via the <em>CLI</em> : <code>zeta config --logs verbose</code></p>
</div>
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Practical example of requestContext</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
</pre></td>
  <td class="code"><pre><span class="reserved">import</span> {
  Injectable,
  RequestContext,
  RequestContextAware,
  Bootstrappable
} from <span class="string"><span class="delimiter">&quot;</span><span class="content">@zetapush/core</span><span class="delimiter">&quot;</span></span>;
<span class="reserved">import</span> { Gda, GdaConfigurer, GdaDataType } from <span class="string"><span class="delimiter">&quot;</span><span class="content">@zetapush/platform-legacy</span><span class="delimiter">&quot;</span></span>;

<span class="error">@</span>Injectable()
<span class="reserved">export</span> <span class="keyword">default</span> <span class="reserved">class</span> Api <span class="reserved">implements</span> RequestContextAware, Bootstrappable {           <i class="conum" data-value="1"></i><b>(1)</b>
  requestContext!: RequestContext;                                                  <i class="conum" data-value="2"></i><b>(2)</b>

  constructor(<span class="reserved">private</span> gda: Gda, <span class="reserved">private</span> gdaConfigurer: GdaConfigurer) {}

  async onApplicationBootstrap() {                                                  <i class="conum" data-value="3"></i><b>(3)</b>
    await <span class="local-variable">this</span>.gdaConfigurer.createTable({
      <span class="key">name</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">table</span><span class="delimiter">&quot;</span></span>,
      <span class="key">columns</span>: [
        {
          <span class="key">name</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">column</span><span class="delimiter">&quot;</span></span>,
          <span class="key">type</span>: GdaDataType.STRING
        }
      ]
    });
  }

  async addToDatabase(data: string) {
    <span class="local-variable">this</span>.requestContext.logger.info(<span class="error">`</span>[addToDatabase] - Add <span class="predefined">$</span>{data} info<span class="error">`</span>);          <i class="conum" data-value="4"></i><b>(4)</b>
    <span class="keyword">return</span> await <span class="local-variable">this</span>.gda.put({
      <span class="key">key</span>: Date.now().toString(),
      <span class="key">table</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">table</span><span class="delimiter">&quot;</span></span>,
      <span class="key">column</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">column</span><span class="delimiter">&quot;</span></span>,
      data
    });
  }

  async getAllData() {
    <span class="local-variable">this</span>.requestContext.logger.info(<span class="error">`</span>[getAllData] - Get all data<span class="error">`</span>);                 <i class="conum" data-value="5"></i><b>(5)</b>
    <span class="keyword">try</span> {
      const { <span class="key">result</span>: resultFromDataBase } = await <span class="local-variable">this</span>.gda.list({
        <span class="key">table</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">table</span><span class="delimiter">&quot;</span></span>
      });
      <span class="keyword">if</span> (resultFromDataBase &amp;&amp; resultFromDataBase.content) {
        <span class="local-variable">this</span>.requestContext.logger.info(                                            <i class="conum" data-value="6"></i><b>(6)</b>
          <span class="error">`</span>[getAllData] - content : <span class="predefined">$</span>{resultFromDataBase.content}<span class="error">`</span>
        );
        <span class="keyword">return</span> resultFromDataBase.content;
      } <span class="keyword">else</span> {
        <span class="local-variable">this</span>.requestContext.logger.warn(                                            <i class="conum" data-value="7"></i><b>(7)</b>
          <span class="string"><span class="delimiter">&quot;</span><span class="content">[getAllData] - No content in database</span><span class="delimiter">&quot;</span></span>
        );
      }
    } <span class="keyword">catch</span> (err) {
      <span class="local-variable">this</span>.requestContext.logger.error(                                             <i class="conum" data-value="8"></i><b>(8)</b>
        <span class="string"><span class="delimiter">&quot;</span><span class="content">[getAllData] - Failed to access to database</span><span class="delimiter">&quot;</span></span>
      );
    }
  }
}</pre></td>
</tr></table></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Optional implementation of <em>RequestContextAware</em></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Injected property of <code>requestContext</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Creation of table for database</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Log in <code>info</code> when we add info in database</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Log in <code>info</code> when we try to get data</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>Log in <code>info</code> if content exists</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>Log in <code>warn</code> if no content in database</td>
</tr>
<tr>
<td><i class="conum" data-value="8"></i><b>8</b></td>
<td>Log in <code>error</code> if it failed to access to database</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The result in the database if the following:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images//logs/console-log-traces.png" alt="console log traces">
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">More Log levels</div>
<div class="paragraph">
<p>If you need to have more log levels, you can <a href="https://www.zetapush.com/contact">contact us</a>.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_use_another_logging_library"><a class="anchor" href="#_use_another_logging_library"></a>Use another logging library</h3>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p>It will soon possible to use another logging library.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="logs_in_web_console"><a class="anchor" href="#logs_in_web_console"></a>View logs in web console</h3>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p>The utilization of logs in the <a href="https://console-celtia.zetapush.com">web console</a> will soon be documented.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_persist_logs"><a class="anchor" href="#_persist_logs"></a>Persist logs</h3>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p>The persistence of logs will soon be documented.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_external_log_visualization"><a class="anchor" href="#_external_log_visualization"></a>External log visualization</h3>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p>It will soon possible to use external log visualization</p>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_tests"><a class="anchor" href="#_tests"></a>Tests</h2>
<div class="sectionbody">
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p>For now, you can use any testing library in your <em>ZetaPush application</em>.
More documentation will soon be added.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_test_your_custom_cloud_services"><a class="anchor" href="#_test_your_custom_cloud_services"></a>Test your custom cloud services</h3>
<div class="sect3">
<h4 id="testing_utilities"><a class="anchor" href="#testing_utilities"></a>Testing utilities provided by ZetaPush</h4>

</div>
<div class="sect3">
<h4 id="_unit_testing"><a class="anchor" href="#_unit_testing"></a>Unit testing</h4>

</div>
<div class="sect3">
<h4 id="integration_testing"><a class="anchor" href="#integration_testing"></a>Integration testing</h4>
<div class="sect4">
<h5 id="tests_in_cloud"><a class="anchor" href="#tests_in_cloud"></a>Integration testing on published worker</h5>

</div>
</div>
<div class="sect3">
<h4 id="e2e_testing"><a class="anchor" href="#e2e_testing"></a>Test your application (end to end)</h4>

</div>
</div>
<div class="sect2">
<h3 id="test_in_typescript"><a class="anchor" href="#test_in_typescript"></a>Write tests in TypeScript</h3>

</div>
<div class="sect2">
<h3 id="advanced_mocks"><a class="anchor" href="#advanced_mocks"></a>Mocks</h3>

</div>
<div class="sect2">
<h3 id="test_snapshot"><a class="anchor" href="#test_snapshot"></a>Initialize test with data</h3>

</div>
<div class="sect2">
<h3 id="_logs_in_tests"><a class="anchor" href="#_logs_in_tests"></a>Logs in tests</h3>
<div class="sect3">
<h4 id="verbosity_level_in_tests"><a class="anchor" href="#verbosity_level_in_tests"></a>Verbosity level</h4>

</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_advanced_run_of_your_application"><a class="anchor" href="#_advanced_run_of_your_application"></a>Advanced run of your application</h2>
<div class="sectionbody">
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p>Documentation about advanced run of your application will soon be available.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="run_worker_only"><a class="anchor" href="#run_worker_only"></a>Run cloud services only</h3>

</div>
<div class="sect2">
<h3 id="_run_front_only"><a class="anchor" href="#_run_front_only"></a>Run front only</h3>

</div>
</div>
</div>
<div class="sect1">
<h2 id="_advanced_deployment_of_your_application"><a class="anchor" href="#_advanced_deployment_of_your_application"></a>Advanced deployment of your application</h2>
<div class="sectionbody">
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p>Documentation about advanced deployment of your application will soon be available.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="partial_deployment"><a class="anchor" href="#partial_deployment"></a>Partial deployment</h3>

</div>
<div class="sect2">
<h3 id="_environment_variables"><a class="anchor" href="#_environment_variables"></a>Environment variables</h3>

</div>
<div class="sect2">
<h3 id="_custom_npm_registry"><a class="anchor" href="#_custom_npm_registry"></a>Custom npm registry</h3>

</div>
</div>
</div>
<div class="sect1">
<h2 id="http_server"><a class="anchor" href="#http_server"></a>HTTP server</h2>
<div class="sectionbody">
<div class="paragraph">
<p>ZetaPush provides you the possibility to add a <em>HTTP server</em> in your application to handle <em>HTTP</em> requests.
A <em>HTTP server</em> is already used in one <em>Cloud Service</em>, the <em>Standard User Workflow</em> (To handle confirmation account registration for example).</p>
</div>
<div class="paragraph">
<p>You have two possibilities:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#internal_http_server">Use the provided HTTP server</a></p>
</li>
<li>
<p><a href="#custom_http_server">Create your own HTTP server</a></p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="internal_http_server"><a class="anchor" href="#internal_http_server"></a>HTTP server provided by ZetaPush</h3>

</div>
<div class="sect2">
<h3 id="custom_http_server"><a class="anchor" href="#custom_http_server"></a>Custom HTTP server</h3>
<div class="paragraph">
<p>ZetaPush provides you the possibility to create your own <em>HTTP server</em>.
Here is an example using the <code>express</code> library:</p>
</div>
<div class="listingblock">
<div class="title">Custom HTTP server</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
</pre></td>
  <td class="code"><pre><span class="reserved">import</span> express from <span class="string"><span class="delimiter">'</span><span class="content">express</span><span class="delimiter">'</span></span>;                              <i class="conum" data-value="1"></i><b>(1)</b>

<span class="reserved">export</span> <span class="keyword">default</span> <span class="reserved">class</span> {
  onApplicationBootstrap() {                                <i class="conum" data-value="2"></i><b>(2)</b>
    const app = express();

    const port = process.env.HTTP_PORT || <span class="integer">3001</span>;             <i class="conum" data-value="3"></i><b>(3)</b>

    app.get(<span class="string"><span class="delimiter">'</span><span class="content">/</span><span class="delimiter">'</span></span>, (req: any, <span class="key">res</span>: any) =&gt; {                  <i class="conum" data-value="4"></i><b>(4)</b>
      res.send(<span class="error">`</span>Hello World from <span class="predefined">$</span>{port}<span class="error">`</span>);
    });

    app.listen(port, () =&gt; {                                <i class="conum" data-value="5"></i><b>(5)</b>
      console.log(<span class="error">`</span>HTTP server is listening on <span class="predefined">$</span>{port}<span class="error">`</span>);
    });
  }
}</pre></td>
</tr></table></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>In this case we use the <code>express</code> library</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>To initialize our application we use the <a href="#onapplicationbootstrap"><code>onApplicationBootstrap()</code> method</a></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The <code>HTTP_PORT</code> environment variable is provided to use a custom HTTP server when the application is running on the <em>ZetaPush cloud</em>. Locally we use the port 3001 (in this case, you can use any port).</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>We handle the request</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>We launch the <em>HTTP server</em></td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">HTTP_PORT environment variable</div>
<div class="paragraph">
<p>The <code>HTTP_PORT</code> environment variable is provided to let you use a custom <em>HTTP server</em> when your application is running on the <em>ZetaPush cloud</em>.
Indeed, the <code>HTTP_PORT</code> environment variable is a reverved port number that is redirected to a specfic URL (provided at the end of a deployment or via the <a href="https://console-celtia.zetapush.com">web console</a>).</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>When your application is running on the <em>ZetaPush cloud</em>, you can access to <em>HTTP server</em> via the URL given at the end of the deployment:</p>
</div>
<div class="listingblock">
<div class="title">Deployment details</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="console">[INFO] Bundle your application components  
[INFO]  Upload code
[INFO]  Prepare environment
[INFO]  Publish web application
[INFO]  Preparing custom cloud services for deployment
[INFO]  Publish custom cloud service on worker instance
[INFO] Web application front is available at http://front-1ceugbp7ci.celtia.zetapush.app:80/  
[INFO] Worker application queue_0 is available at http://queuea0-1ceugbp7ci.test.zetapush.app      <i class="conum" data-value="1"></i><b>(1)</b>
[INFO] Worker applications works only if you listen process.env.HTTP_PORT  </code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>URL of your <em>HTTP server</em></td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You can use your <em>http server library</em> like you would do without <em>ZetaPush</em>.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_extend_a_cloud_service"><a class="anchor" href="#_extend_a_cloud_service"></a>Extend a cloud service</h2>
<div class="sectionbody">
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p>Documentation about extention of any <em>Cloud service</em> will soon be added.</p>
</div>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2019-01-11 19:47:14 UTC
</div>
</div>
</body>
</html>