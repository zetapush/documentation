<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 1.5.6.1">
<title>Untitled</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<link rel="stylesheet" href="./asciidoctor.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.min.css">
<link rel="stylesheet" href="./coderay-asciidoctor.css">
<script type="text/javascript" src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
<script type="text/javascript" src="//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/js/bootstrap.min.js"></script>
<script type="text/javascript" src="../../../../..//javascripts/menu.js"></script>
<script type="text/javascript" src="../../../../..//javascripts/sidebar.js"></script>
<script type="text/javascript" src="../../../../..//javascripts/steps.js"></script>
<script type="text/javascript" src="../../../../..//javascripts/sourcecode/source-utils.js"></script>
<script type="text/javascript" src="../../../../..//javascripts/sourcecode/highlight-lines.js"></script>
<script type="text/javascript" src="../../../../..//javascripts/sourcecode/collapse-lines.js"></script>
<script type="text/javascript" src="../../../../..//javascripts/tabcontainer.js"></script>
<script type="text/javascript" src="//unpkg.com/clipboard@2.0.0/dist/clipboard.min.js"></script>
<script type="text/javascript" src="../../../../..//javascripts/clipboard.js"></script>
<script src="https://cdn.jsdelivr.net/npm/instantsearch.js@2.3/dist/instantsearch.min.js"></script>
<script type="text/javascript" src="../../../../..//javascripts/search.js"></script>
<!-- <link rel="stylesheet" type="text/css" href="http://netdna.bootstrapcdn.com/bootswatch/2.3.2/united/bootstrap.min.css" />
  <link rel="stylesheet" type="text/css" href="http://netdna.bootstrapcdn.com/twitter-bootstrap/2.3.1/css/bootstrap-responsive.min.css"
  /> -->
<link href="//fonts.googleapis.com/css?family=Open+Sans:300,400,600,800" rel="stylesheet">
<link rel="stylesheet" type="text/css" href="../../../../..//styles/zetapush-styles.css" />
<link rel="stylesheet" type="text/css" href="../../../../..//styles/custom-styles.css" />
<link rel="stylesheet" type="text/css" href="../../../../..//styles/tabcontainer.css" />
<link rel="stylesheet" type="text/css" href="../../../../..//styles/steps.css" />
<link rel="stylesheet" type="text/css" href="../../../../..//styles/sourcecode/collapse-lines.css" />
<link rel="stylesheet" type="text/css" href="../../../../..//styles/sourcecode/highlight-lines.css" />
<link rel="stylesheet" type="text/css" href="../../../../..//styles/clipboard.css" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/instantsearch.js@2.3/dist/instantsearch.min.css">
<script type="text/html" id="hit-template">
  <div class="hit">
    <div class="hit-content">
      <div class="context">
        <a href="{{sourceFile.url}}">{{sourceFile.title}}</a>
        {{#parents}}
          <a href="{{url}}">{{title}}</a>
        {{/parents}}
        <a href="{{url}}">{{{_highlightResult.title.value}}}</a>
      </div>
      <pre class="hit-description">{{{_highlightResult.content.value}}}</pre>
    </div>
  </div>
</script>
<header>
  <nav>
    <div class="main-title"><span></span><i class="fa fa-caret-down"></i></div>
    <ul>
      <li><a href="/documentation"><span>ZetaPush documentation</span><i class="fa fa-angle-right"></i></a></li>
      <li><a href="/documentation/quick-start.html"><span>Quick start</span><i class="fa fa-angle-right"></i></a></li>
      <li><a href="/documentation/developer-manual.html"><span>Developer manual</span><i class="fa fa-angle-right"></i></a></li>
      <li><a href="/documentation/how-to.html"><span>How to guides</span><i class="fa fa-angle-right"></i></a></li>
      <li><a href="/documentation/tutorials.html"><span>Tutorials</span><i class="fa fa-angle-right"></i></a></li>
      <li><a href="/documentation/reference.html"><span>Reference</span><i class="fa fa-angle-right"></i></a></li>
    </ul>
    <div>
      <div class="contact-us">
        <a href="https://spectrum.chat/zetapush" target="_blank">Contact us</a>
      </div>
      <div class="github">
        <a href="https://github.com/zetapush" target="_blank">
          <span>Join us on</span><i class="fa fa-github-alt" title="Github"></i></a>
      </div>
      <div class="search">
        <input id="search-input" placeholder="Search for products">
        <div class="search-results">
            <div id="search-hits"></div>
        </div>
      </div>
      <div class="logo">
        <a href="https://zetapush.com"><span class="icon"></span></a>
      </div>
    </div>
  </nav>
</header>
</head>
<body class="book">
<div id="header">
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>During the acccount confirmation process, the <em>StandardUserWorkflow</em> need to store a token to identify the created user when he validate his account. By default the token is stored in the ZetaPush legacy storage.
You can change the behavior of the storage by implementing the <em>TokenRepository</em> interface.</p>
</div>
<div class="paragraph">
<p>To use our new implementation, we need to define a provider in our module.
Here, we need to associate our implementation to the <em>TokenRepositoryInjectable</em> provider.</p>
</div>
<div class="paragraph">
<p>You will see in the following example how to implement a new <em>TokenRepository</em>.</p>
</div>
<div class="listingblock">
<div class="title">Example of <em>TokenRepository</em> implementation</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="typescript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
</pre></td>
  <td class="code"><pre>import { Module } from '@zetapush/core';
import {
  StandardUserManagementModule,
  StandardUserWorkflow,
  ConfirmationUrlHttpHandler,
  TokenRepository,
  Token,
  AssociatedValueToToken,
  StoredToken,
  TokenRepositoryInjectable,
  ExpirableToken
} from '@zetapush/user-management';

class MyTokenStorage implements TokenRepository { <i class="conum" data-value="1"></i><b>(1)</b>
  tokens: Array&lt;StoredToken&gt; = [];

  store(token: Token, associatedValue?: AssociatedValueToToken): Promise&lt;Token&gt; {
    this.tokens.push({
      token: {
        value: token instanceof ExpirableToken ? token.original.value : token.value
      },
      associatedValue
    });
    console.log('store', this.tokens);
    return Promise.resolve(token);
  }

  async getFromToken(token: Token): Promise&lt;StoredToken&gt; {
    let resultToken;
    this.tokens.forEach(elt =&gt; {
      if (token.value === elt.token.value) {
        console.log('getFromToken');
        resultToken = elt;
      }
    });
    if (resultToken) {
      return resultToken;
    } else {
      throw 'no token';
    }
  }
  async delete(token: Token): Promise&lt;Token&gt; {
    let storedToken;
    this.tokens.forEach((elt, index) =&gt; {
      if (token.value === elt.token.value) {
        storedToken = elt.token;
        this.tokens.splice(index, 1);
      }
    });

    if (storedToken) {
      return storedToken;
    } else {
      throw 'no token';
    }
  }
}

@Module({
  imports: [StandardUserManagementModule],
  expose: {
    user: StandardUserWorkflow,
    http: ConfirmationUrlHttpHandler
  },
  providers: [
    { <i class="conum" data-value="2"></i><b>(2)</b>
      provide: TokenRepositoryInjectable,
      useClass: MyTokenStorage
    }
  ]
})
export default class Api {}</pre></td>
</tr></table></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>We implement <em>TokenRepository</em>.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>We use our implementation for the <em>TokenRepositoryInjectable</em> provider.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You can also extend the existing implementations. To do this, your class need to extend an existing implementation and call the <code>super()</code>  method for the constructor and each method. The existing implementations of <em>TokenRepository</em> are the following :</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>GdaTokenRepository</em> : Default implementation using ZetaPush legacy storage.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2018-09-27 14:29:26 CEST
</div>
</div>
</body>
</html>