<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 1.5.6.1">
<title>Change the storage of the user</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<link rel="stylesheet" href="./asciidoctor.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.min.css">
<link rel="stylesheet" href="./coderay-asciidoctor.css">
<script type="text/javascript" src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
<script type="text/javascript" src="//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/js/bootstrap.min.js"></script>
<script type="text/javascript" src="../../../..//javascripts/menu.js"></script>
<script type="text/javascript" src="../../../..//javascripts/sidebar.js"></script>
<script type="text/javascript" src="../../../..//javascripts/steps.js"></script>
<script type="text/javascript" src="../../../..//javascripts/sourcecode/source-utils.js"></script>
<script type="text/javascript" src="../../../..//javascripts/sourcecode/highlight-lines.js"></script>
<script type="text/javascript" src="../../../..//javascripts/sourcecode/collapse-lines.js"></script>
<script type="text/javascript" src="../../../..//javascripts/tabcontainer.js"></script>
<script type="text/javascript" src="//unpkg.com/clipboard@2.0.0/dist/clipboard.min.js"></script>
<script type="text/javascript" src="../../../..//javascripts/clipboard.js"></script>
<script src="https://cdn.jsdelivr.net/npm/instantsearch.js@2.3/dist/instantsearch.min.js"></script>
<script type="text/javascript" src="../../../..//javascripts/search.js"></script>
<!-- <link rel="stylesheet" type="text/css" href="http://netdna.bootstrapcdn.com/bootswatch/2.3.2/united/bootstrap.min.css" />
  <link rel="stylesheet" type="text/css" href="http://netdna.bootstrapcdn.com/twitter-bootstrap/2.3.1/css/bootstrap-responsive.min.css"
  /> -->
<link href="//fonts.googleapis.com/css?family=Open+Sans:300,400,600,800" rel="stylesheet">
<link rel="stylesheet" type="text/css" href="../../../..//styles/zetapush-styles.css" />
<link rel="stylesheet" type="text/css" href="../../../..//styles/custom-styles.css" />
<link rel="stylesheet" type="text/css" href="../../../..//styles/tabcontainer.css" />
<link rel="stylesheet" type="text/css" href="../../../..//styles/steps.css" />
<link rel="stylesheet" type="text/css" href="../../../..//styles/sourcecode/collapse-lines.css" />
<link rel="stylesheet" type="text/css" href="../../../..//styles/sourcecode/highlight-lines.css" />
<link rel="stylesheet" type="text/css" href="../../../..//styles/clipboard.css" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/instantsearch.js@2.3/dist/instantsearch.min.css">
<script type="text/html" id="hit-template">
  <div class="hit">
    <div class="hit-content">
      <div class="context">
        <a href="{{sourceFile.url}}">{{sourceFile.title}}</a>
        {{#parents}}
          <a href="{{url}}">{{title}}</a>
        {{/parents}}
        <a href="{{url}}">{{{_highlightResult.title.value}}}</a>
      </div>
      <pre class="hit-description">{{{_highlightResult.content.value}}}</pre>
    </div>
  </div>
</script>
<header>
  <nav>
    <div class="main-title"><span></span><i class="fa fa-caret-down"></i></div>
    <ul>
      <li><a href="/documentation"><span>ZetaPush documentation</span><i class="fa fa-angle-right"></i></a></li>
      <li><a href="/documentation/quick-start.html"><span>Quick start</span><i class="fa fa-angle-right"></i></a></li>
      <li><a href="/documentation/developer-manual.html"><span>Developer manual</span><i class="fa fa-angle-right"></i></a></li>
      <li><a href="/documentation/how-to.html"><span>How to guides</span><i class="fa fa-angle-right"></i></a></li>
      <li><a href="/documentation/tutorials.html"><span>Tutorials</span><i class="fa fa-angle-right"></i></a></li>
      <li><a href="/documentation/reference.html"><span>Reference</span><i class="fa fa-angle-right"></i></a></li>
    </ul>
    <div>
      <div class="contact-us">
        <a href="https://spectrum.chat/zetapush" target="_blank">Contact us</a>
      </div>
      <div class="github">
        <a href="https://github.com/zetapush" target="_blank">
          <span>Join us on</span><i class="fa fa-github-alt" title="Github"></i></a>
      </div>
      <div class="search">
        <input id="search-input" placeholder="Search for products">
        <div class="search-results">
            <div id="search-hits"></div>
        </div>
      </div>
      <div class="logo">
        <a href="https://zetapush.com"><span class="icon"></span></a>
      </div>
    </div>
  </nav>
</header>
</head>
<body class="book toc2 toc-left">
<div id="header">
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_change_the_storage_of_the_user">Change the storage of the user</a></li>
<li><a href="#_change_the_method_of_sending_confirmation_email">Change the method of sending confirmation email</a></li>
<li><a href="#_change_the_generation_of_the_token_confirmation_process">Change the generation of the token (confirmation process)</a></li>
<li><a href="#_change_the_storage_of_the_token_confirmation_process">Change the storage of the token (confirmation process)</a></li>
<li><a href="#_change_the_generation_of_the_account_uuid">Change the generation of the account UUID</a></li>
<li><a href="#_change_the_user_account_creation">Change the user account creation</a></li>
</ul>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>The <em>StandardUserWorkflow</em> helps you to manage your users in your application.
If the default behavior of this Cloud Service doesn&#8217;t suit you, you can <a href="#configuration-of-standard-user-workflow">configure it</a> or implement new behavior in many part of it.
Here, we see how to implement new behavior for many use cases.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_change_the_storage_of_the_user"><a class="anchor" href="#_change_the_storage_of_the_user"></a>Change the storage of the user</h2>
<div class="sectionbody">
<div class="paragraph">
<p>By default, when you create a user in your application, it is saved in the ZetaPush legacy storage.
You can change it by implementing the <em>UserRegistry</em> interface.</p>
</div>
<div class="paragraph">
<p>To use our new implementation, we need to define a provider in our module.
Here, we need to associate our implementation to the <em>UserRepositoryInjectable</em> provider.</p>
</div>
<div class="paragraph">
<p>You will see in this example how to add behavior to the default implementation.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
In the following example we keep the default behavior of the user storage.
You can fully rewrite it implementing only <em>UserRepository</em> (no extend the <em>LegacyAdapterUserRepository</em>)
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Example of <em>UserRegistry</em> implementation</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="typescript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
</pre></td>
  <td class="code"><pre>import { Module, Injectable } from '@zetapush/core';
import {
  StandardUserManagementModule,
  StandardUserWorkflow,
  ConfirmationUrlHttpHandler,
  Account,
  AccountStatus,
  UserProfile,
  LoginPasswordCredentials,
  LegacyAdapterUserRepository
} from '@zetapush/user-management';
import { UserRepository, UserRepositoryInjectable } from '@zetapush/user-management/lib/common/api/User';
import { Simple, Gda, GdaConfigurer } from '@zetapush/platform-legacy';

@Injectable()
class MyUserRepository extends LegacyAdapterUserRepository implements UserRepository { <i class="conum" data-value="1"></i><b>(1)</b>
  constructor(simple: Simple, gda: Gda, gdaConfigurer: GdaConfigurer) {
    super(simple, gda, gdaConfigurer);
  }

  <i class="conum" data-value="2"></i><b>(2)</b>
  exists(credentials: LoginPasswordCredentials): Promise&lt;boolean&gt; {
    console.log('exists');
    return super.exists(credentials);
  }

  addUser(
    credentials: LoginPasswordCredentials,
    userProfile: UserProfile,
    accountStatus: AccountStatus,
    accountId: string
  ): Promise&lt;Account&gt; {
    console.log('addUser');
    return super.addUser(credentials, userProfile, accountStatus, accountId);
  }

  getProfile(accountId: string): Promise&lt;UserProfile&gt; {
    console.log('getProfile');
    return super.getProfile(accountId);
  }

  updateStatus(accountId: string, newStatus: AccountStatus): Promise&lt;void&gt; {
    console.log('updateStatus');
    return super.updateStatus(accountId, newStatus);
  }
}

@Module({
  imports: [StandardUserManagementModule],
  expose: {
    user: StandardUserWorkflow,
    http: ConfirmationUrlHttpHandler
  },
  providers: [
    {
      provide: UserRepositoryInjectable, <i class="conum" data-value="3"></i><b>(3)</b>
      useClass: MyUserRepository
    }
  ]
})
export default class Api {}</pre></td>
</tr></table></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>We implement <em>UserRegistry</em> to add new behavior for our use case but we also extend <em>LegacyAdapterUserRepository</em> to keep the default behavior.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>We only add some <code>console.log()</code> to our default implementation.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>We use our <em>MyUserRepository</em> for the <em>UserRepositoryInjectable</em> provider.</td>
</tr>
</table>
</div>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<i class="fa icon-caution" title="Caution"></i>
</td>
<td class="content">
Currently the authentication use the <em>Simple</em> cloud service to retrieve the user.
So if you want to fully rewrite the implementation, we advise you to create the user with the <em>Simple</em> cloud service and save the user profile with whatever you want.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You can extend the existing implementations, like the above example. The existing implementations of <em>UserRepository</em> are the following :</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>LegacyAdapterUserRepository</em> : Using the ZetaPush legacy storage to save the user profile</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_change_the_method_of_sending_confirmation_email"><a class="anchor" href="#_change_the_method_of_sending_confirmation_email"></a>Change the method of sending confirmation email</h2>
<div class="sectionbody">
<div class="paragraph">
<p>By default, the <em>StandardUserWorkflow</em> use a Mailjet implementation to send the account confirmation email.
Here we will see how to add you own implementation to send this email. To do this, you need to implement the <em>MessageSender</em> interface.</p>
</div>
<div class="paragraph">
<p>To use our new implementation, we need to define a provider in our module.
Here, we need to associate our implementation to the <em>EmailSenderInjectable</em> provider.</p>
</div>
<div class="paragraph">
<p>You will see in the following example that we don&#8217;t send the email but we display the result in the console.
So you can easily add your own implementation to send a SMS or use other channels of communication if you want.</p>
</div>
<div class="listingblock">
<div class="title">Example of <em>MessageSender</em> implementation</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="typescript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
</pre></td>
  <td class="code"><pre>import { Module } from '@zetapush/core';
import {
  StandardUserManagementModule,
  StandardUserWorkflow,
  ConfirmationUrlHttpHandler,
  MessageSender,
  Message,
  SentMessage,
  EmailSenderInjectable
} from '@zetapush/user-management';

class MyMessageSenderImpl implements MessageSender { <i class="conum" data-value="1"></i><b>(1)</b>
  send(message: Message): Promise&lt;SentMessage&gt; {
    console.log('Our message is: ', message);
    return Promise.resolve({ message });
  }
}

@Module({
  imports: [StandardUserManagementModule],
  expose: {
    user: StandardUserWorkflow,
    http: ConfirmationUrlHttpHandler
  },
  providers: [
    { <i class="conum" data-value="2"></i><b>(2)</b>
      provide: EmailSenderInjectable,
      useClass: MyMessageSenderImpl
    }
  ]
})
export default class Api {}</pre></td>
</tr></table></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>We implement <em>MessageSender</em>.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>We use our implementation for the <em>EmailSenderInjectable</em> provider.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You can also extend the existing implementations. To do this, your class need to extend an existing implementation and call the <code>super()</code>  method for the constructor and each method. The existing implementations of <em>MessageSender</em> are the following :</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>MailjetHttpEmailSender</em> : Default implementation using the <em>Mailjet</em> API.</p>
</li>
<li>
<p><em>SmtpEmailSender</em> : Implementation using a SMTP configuration.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_change_the_generation_of_the_token_confirmation_process"><a class="anchor" href="#_change_the_generation_of_the_token_confirmation_process"></a>Change the generation of the token (confirmation process)</h2>
<div class="sectionbody">
<div class="paragraph">
<p>During the acccount confirmation process, the <em>StandardUserWorkflow</em> need to generate a token to identify the created user when he validate his account. By default the token is an expirable token.
You can change the behavior of the generator by implementing the <em>TokenGenerator</em> interface.</p>
</div>
<div class="paragraph">
<p>To use our new implementation, we need to define a provider in our module.
Here, we need to associate our implementation to the <em>TokenGeneratorInjectable</em> provider.</p>
</div>
<div class="paragraph">
<p>You will see in the following example how to implement a new <em>TokenGenerator</em> based on the current timestamp.</p>
</div>
<div class="listingblock">
<div class="title">Example of <em>TokenGenerator</em> implementation</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="typescript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
</pre></td>
  <td class="code"><pre>import { Module } from '@zetapush/core';
import {
  StandardUserManagementModule,
  StandardUserWorkflow,
  ConfirmationUrlHttpHandler,
  TokenGenerator,
  Token,
  TokenGeneratorInjectable
} from '@zetapush/user-management';

class MyTokenGenerator implements TokenGenerator { <i class="conum" data-value="1"></i><b>(1)</b>
  generate(): Promise&lt;Token&gt; {
    return Promise.resolve({ value: new Date().getTime().toString() });
  }
}

@Module({
  imports: [StandardUserManagementModule],
  expose: {
    user: StandardUserWorkflow,
    http: ConfirmationUrlHttpHandler
  },
  providers: [
    { <i class="conum" data-value="2"></i><b>(2)</b>
      provide: TokenGeneratorInjectable,
      useClass: MyTokenGenerator
    }
  ]
})
export default class Api {}</pre></td>
</tr></table></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>We implement <em>TokenGenerator</em>.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>We use our implementation for the <em>TokenGeneratorInjectable</em> provider.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You can also extend the existing implementations. To do this, your class need to extend an existing implementation and call the <code>super()</code>  method for the constructor and each method. The existing implementations of <em>TokenGenerator</em> are the following :</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>Base36RandomTokenGenerator</em> : Default implementation using base64 encoder.</p>
</li>
<li>
<p><em>ExpirableTokenGenerator</em> : Implementation using an expirable token.</p>
</li>
<li>
<p><em>FuncCallTokenGenerator</em> : Implementation that use a function passed in parameters to generate the token</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_change_the_storage_of_the_token_confirmation_process"><a class="anchor" href="#_change_the_storage_of_the_token_confirmation_process"></a>Change the storage of the token (confirmation process)</h2>
<div class="sectionbody">
<div class="paragraph">
<p>During the acccount confirmation process, the <em>StandardUserWorkflow</em> need to store a token to identify the created user when he validate his account. By default the token is stored in the ZetaPush legacy storage.
You can change the behavior of the storage by implementing the <em>TokenRepository</em> interface.</p>
</div>
<div class="paragraph">
<p>To use our new implementation, we need to define a provider in our module.
Here, we need to associate our implementation to the <em>TokenRepositoryInjectable</em> provider.</p>
</div>
<div class="paragraph">
<p>You will see in the following example how to implement a new <em>TokenRepository</em>.</p>
</div>
<div class="listingblock">
<div class="title">Example of <em>TokenRepository</em> implementation</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="typescript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
</pre></td>
  <td class="code"><pre>import { Module } from '@zetapush/core';
import {
  StandardUserManagementModule,
  StandardUserWorkflow,
  ConfirmationUrlHttpHandler,
  TokenRepository,
  Token,
  AssociatedValueToToken,
  StoredToken,
  TokenRepositoryInjectable,
  ExpirableToken
} from '@zetapush/user-management';

class MyTokenStorage implements TokenRepository { <i class="conum" data-value="1"></i><b>(1)</b>
  tokens: Array&lt;StoredToken&gt; = [];

  store(token: Token, associatedValue?: AssociatedValueToToken): Promise&lt;Token&gt; {
    this.tokens.push({
      token: {
        value: token instanceof ExpirableToken ? token.original.value : token.value
      },
      associatedValue
    });
    console.log('store', this.tokens);
    return Promise.resolve(token);
  }

  async getFromToken(token: Token): Promise&lt;StoredToken&gt; {
    let resultToken;
    this.tokens.forEach(elt =&gt; {
      if (token.value === elt.token.value) {
        console.log('getFromToken');
        resultToken = elt;
      }
    });
    if (resultToken) {
      return resultToken;
    } else {
      throw 'no token';
    }
  }
  async delete(token: Token): Promise&lt;Token&gt; {
    let storedToken;
    this.tokens.forEach((elt, index) =&gt; {
      if (token.value === elt.token.value) {
        storedToken = elt.token;
        this.tokens.splice(index, 1);
      }
    });

    if (storedToken) {
      return storedToken;
    } else {
      throw 'no token';
    }
  }
}

@Module({
  imports: [StandardUserManagementModule],
  expose: {
    user: StandardUserWorkflow,
    http: ConfirmationUrlHttpHandler
  },
  providers: [
    { <i class="conum" data-value="2"></i><b>(2)</b>
      provide: TokenRepositoryInjectable,
      useClass: MyTokenStorage
    }
  ]
})
export default class Api {}</pre></td>
</tr></table></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>We implement <em>TokenRepository</em>.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>We use our implementation for the <em>TokenRepositoryInjectable</em> provider.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You can also extend the existing implementations. To do this, your class need to extend an existing implementation and call the <code>super()</code>  method for the constructor and each method. The existing implementations of <em>TokenRepository</em> are the following :</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>GdaTokenRepository</em> : Default implementation using ZetaPush legacy storage.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_change_the_generation_of_the_account_uuid"><a class="anchor" href="#_change_the_generation_of_the_account_uuid"></a>Change the generation of the account UUID</h2>
<div class="sectionbody">
<div class="paragraph">
<p>When the <em>StandardUserWorkflow</em> create a user account, it generates an unique UUID to identify the account.
By default the UUID is based on the timestamp. You can change this behavior by implementing the <em>UuidGenerator</em> interface.</p>
</div>
<div class="paragraph">
<p>To use our new implementation, we need to define a provider in our module.
Here, we need to associate our implementation to the <em>UuidGeneratorInjectable</em> provider.</p>
</div>
<div class="paragraph">
<p>You will see in the following example how to implement a new <em>UuidGenerator</em> based on a random number.</p>
</div>
<div class="listingblock">
<div class="title">Example of <em>UuidGenerator</em> implementation</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="typescript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
</pre></td>
  <td class="code"><pre>import { Module } from '@zetapush/core';
import {
  StandardUserManagementModule,
  StandardUserWorkflow,
  ConfirmationUrlHttpHandler,
  UuidGenerator,
  Uuid,
  UuidGeneratorInjectable
} from '@zetapush/user-management';

class MyUuidGenerator implements UuidGenerator { <i class="conum" data-value="1"></i><b>(1)</b>
  generate(): Promise&lt;Uuid&gt; {
    return Promise.resolve({
      value: Math.random()
        .toString(36)
        .substring(2)
    });
  }
}

@Module({
  imports: [StandardUserManagementModule],
  expose: {
    user: StandardUserWorkflow,
    http: ConfirmationUrlHttpHandler
  },
  providers: [
    { <i class="conum" data-value="2"></i><b>(2)</b>
      provide: UuidGeneratorInjectable,
      useClass: MyUuidGenerator
    }
  ]
})
export default class Api {}</pre></td>
</tr></table></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>We implement <em>UuidGenerator</em>.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>We use our implementation for the <em>UuidGeneratorInjectable</em> provider.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You can also extend the existing implementations. To do this, your class need to extend an existing implementation and call the <code>super()</code>  method for the constructor and each method. The existing implementations of <em>UuidGenerator</em> are the following :</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>TimestampBasedUuidGenerator</em> : Default implementation using timestamp and random numbers.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_change_the_user_account_creation"><a class="anchor" href="#_change_the_user_account_creation"></a>Change the user account creation</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To create a user account, the <em>StandardUserWorkflow</em> uses an implementation of the <em>AccountCreationManager</em>.
We can fully re-implement the creation of the user account by implementing this interface.</p>
</div>
<div class="paragraph">
<p>To use our new implementation, we need to define a provider in our module.
Here, we need to associate our implementation to the <em>AccountCreationManagerInjectable</em> provider.</p>
</div>
<div class="paragraph">
<p>In this following example, we will create a <em>AccountCreationManager</em> implementation that will create the user in the ZetaPush platform that is automatically active.</p>
</div>
<div class="listingblock">
<div class="title">Example of <em>AccountCreationManager</em> implementation</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="typescript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
</pre></td>
  <td class="code"><pre>import { Module, Injectable } from '@zetapush/core';
import {
  StandardUserManagementModule,
  StandardUserWorkflow,
  ConfirmationUrlHttpHandler,
  AccountCreationDetails,
  StandardAccountStatus,
  AccountCreationManagerInjectable,
  Account,
  AccountCreationManager,
  LegacyAdapterUserRepository
} from '@zetapush/user-management';

@Injectable() <i class="conum" data-value="1"></i><b>(1)</b>
class MyAccountCreationManager implements AccountCreationManager {
  constructor(private userRepository: LegacyAdapterUserRepository) {} <i class="conum" data-value="2"></i><b>(2)</b>

  async createAccount(accountCreationDetails: AccountCreationDetails): Promise&lt;Account | null&gt; {
    const accountId = Math.random()
      .toString(36)
      .substring(2);
    return await this.userRepository.addUser(
      &lt;any&gt;accountCreationDetails.credentials,
      accountCreationDetails.profile || {},
      StandardAccountStatus.Active,
      accountId
    );
  }
}

@Module({
  imports: [StandardUserManagementModule],
  expose: {
    user: StandardUserWorkflow,
    http: ConfirmationUrlHttpHandler
  },
  providers: [
    { <i class="conum" data-value="3"></i><b>(3)</b>
      provide: AccountCreationManagerInjectable,
      useClass: MyAccountCreationManager
    }
  ]
})
export default class Api {}</pre></td>
</tr></table></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Our implementation needs to be <em>Injectable</em> because we use dependencies in our constructor.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>We use <em>LegacyAdapterUserRepository</em> implementation of <em>UserRepository</em> to store our user account.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>We use our implementation for the <em>AccountCreationManagerInjectable</em> provider.</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
When you use dependencies in your constructor, you need to put the <code>Injectable()</code> annotation and use implementations, not interfaces. (See the list of implementations for each interface)
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You can also extend the existing implementations. To do this, your class need to extend an existing implementation and call the <code>super()</code>  method for the constructor and each method. The existing implementations of <em>AccountCreationManager</em> are the following :</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>LoginPasswordAccountCreationManager</em> : Default implementation using login and password credentials.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2018-09-28 14:26:10 CEST
</div>
</div>
</body>
</html>