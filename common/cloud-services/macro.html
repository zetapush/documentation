<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 1.5.6.1">
<title>Macro</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<link rel="stylesheet" href="./asciidoctor.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.min.css">
<link rel="stylesheet" href="./coderay-asciidoctor.css">
<script type="text/javascript" src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
<script type="text/javascript" src="//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/js/bootstrap.min.js"></script>
<script type="text/javascript" src="../..//javascripts/menu.js"></script>
<script type="text/javascript" src="../..//javascripts/sidebar.js"></script>
<script type="text/javascript" src="../..//javascripts/steps.js"></script>
<script type="text/javascript" src="../..//javascripts/sourcecode/source-utils.js"></script>
<script type="text/javascript" src="../..//javascripts/sourcecode/highlight-lines.js"></script>
<script type="text/javascript" src="../..//javascripts/sourcecode/collapse-lines.js"></script>
<script type="text/javascript" src="../..//javascripts/tabcontainer.js"></script>
<script type="text/javascript" src="//unpkg.com/clipboard@2.0.0/dist/clipboard.min.js"></script>
<script type="text/javascript" src="../..//javascripts/clipboard.js"></script>
<script src="https://cdn.jsdelivr.net/npm/instantsearch.js@2.3/dist/instantsearch.min.js"></script>
<script type="text/javascript" src="../..//javascripts/search.js"></script>
<!-- <link rel="stylesheet" type="text/css" href="http://netdna.bootstrapcdn.com/bootswatch/2.3.2/united/bootstrap.min.css" />
  <link rel="stylesheet" type="text/css" href="http://netdna.bootstrapcdn.com/twitter-bootstrap/2.3.1/css/bootstrap-responsive.min.css"
  /> -->
<link href="//fonts.googleapis.com/css?family=Open+Sans:300,400,600,800" rel="stylesheet">
<link rel="stylesheet" type="text/css" href="../..//styles/zetapush-styles.css" />
<link rel="stylesheet" type="text/css" href="../..//styles/custom-styles.css" />
<link rel="stylesheet" type="text/css" href="../..//styles/tabcontainer.css" />
<link rel="stylesheet" type="text/css" href="../..//styles/steps.css" />
<link rel="stylesheet" type="text/css" href="../..//styles/sourcecode/collapse-lines.css" />
<link rel="stylesheet" type="text/css" href="../..//styles/sourcecode/highlight-lines.css" />
<link rel="stylesheet" type="text/css" href="../..//styles/clipboard.css" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/instantsearch.js@2.3/dist/instantsearch.min.css">
<script type="text/html" id="hit-template">
  <div class="hit">
    <div class="hit-content">
      <div class="context">
        <a href="{{sourceFile.url}}">{{sourceFile.title}}</a>
        {{#parents}}
          <a href="{{url}}">{{title}}</a>
        {{/parents}}
        <a href="{{url}}">{{{_highlightResult.title.value}}}</a>
      </div>
      <pre class="hit-description">{{{_highlightResult.content.value}}}</pre>
    </div>
  </div>
</script>
<header>
  <nav>
    <div class="main-title"><span></span><i class="fa fa-caret-down"></i></div>
    <ul>
      <li><a href="/documentation"><span>ZetaPush documentation</span><i class="fa fa-angle-right"></i></a></li>
      <li><a href="/documentation/getting-started.html"><span>Getting Started</span><i class="fa fa-angle-right"></i></a></li>
      <li><a href="/documentation/developer-manual.html"><span>Developer manual</span><i class="fa fa-angle-right"></i></a></li>
      <li><a href="/documentation/how-to.html"><span>How to guides</span><i class="fa fa-angle-right"></i></a></li>
      <li><a href="/documentation/tutorials.html"><span>Tutorials</span><i class="fa fa-angle-right"></i></a></li>
      <li><a href="/documentation/reference.html"><span>Reference</span><i class="fa fa-angle-right"></i></a></li>
      <li><a href="http://docv2.zetapush.com"><span>Documentation v2</span><i class="fa fa-angle-right"></i></a></li>
    </ul>
    <div>
      <div class="contact-us">
        <a href="https://spectrum.chat/zetapush" target="_blank">Contact us</a>
      </div>
      <div class="github">
        <a href="https://github.com/zetapush" target="_blank">
          <span>Join us on</span><i class="fa fa-github-alt" title="Github"></i></a>
      </div>
      <div class="search">
        <input id="search-input" placeholder="Search for products">
        <div class="search-results">
          <div id="search-hits"></div>
        </div>
      </div>
      <div class="logo">
        <a href="https://zetapush.com"><span class="icon"></span></a>
      </div>
    </div>
  </nav>
</header>
</head>
<body class="book toc2 toc-left">
<div id="header">
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_macro">Macro</a>
<ul class="sectlevel2">
<li><a href="#_call">call</a></li>
<li><a href="#_evaluate">evaluate</a></li>
<li><a href="#_func">func</a></li>
<li><a href="#_sudo">sudo</a></li>
<li><a href="#_getpublichttpurl">getPublicHttpUrl</a></li>
<li><a href="#_how_to_use_it">How to use it ?</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div class="sect1">
<h2 id="_macro"><a class="anchor" href="#_macro"></a>Macro</h2>
<div class="sectionbody">
<div class="paragraph">
<p>User API for macro execution</p>
</div>
<div class="paragraph">
<p>Simple errors are reported as usual.
However, the macro execution verbs treat most errors in a particular way : instead of reporting errors on the usual 'error' channel, errors are put in the returned 'MacroCompletion' result.
This behavior can be tuned on a per-call basis with the hardFail parameter.
Note that some particular errors will always behave as if hardFail were true, because they are related to programming errors, or prevent processing from ending gracefully : STACK_OVERFLOW, NO_SUCH_FUNCTION, RAM_EXCEEDED, CYCLES_EXCEEDED, TIME_EXCEEDED, QUOTA_EXCEEDED, RATE_EXCEEDED, BAD_COMPARATOR_VALUE</p>
</div>
<div class="sect2">
<h3 id="_call"><a class="anchor" href="#_call"></a>call</h3>
<div class="paragraph">
<p>DO NOT use this verb from inside an enclosing macro when you need the result in order to proceed with the enclosing macro.
You can override the default notification channel when defining the macro.</p>
</div>
<div class="listingblock">
<div class="title">call(parameters: <a href="../../common/cloud-services-types/macro-play.html">MacroPlay</a>): Promise&lt;<a href="../../common/cloud-services-types/void.html">void</a>&gt;</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="typescript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
</pre></td>
  <td class="code"><pre>const response = await this.macro.call(parameters);</pre></td>
</tr></table></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_evaluate"><a class="anchor" href="#_evaluate"></a>evaluate</h3>
<div class="listingblock">
<div class="title">evaluate(parameters: <a href="../../common/cloud-services-types/macro-function-request.html">MacroFunctionRequest</a>): Promise&lt;<a href="../../common/cloud-services-types/macro-function-result.html">MacroFunctionResult</a>&gt;</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="typescript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
</pre></td>
  <td class="code"><pre>const response = await this.macro.evaluate(parameters);</pre></td>
</tr></table></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_func"><a class="anchor" href="#_func"></a>func</h3>
<div class="paragraph">
<p>Use this verb when you want to synchronously call a macro from inside another macro.
Despite being a server verb, func will honor the 'loud' modifier in ZMS.</p>
</div>
<div class="listingblock">
<div class="title">func(parameters: <a href="../../common/cloud-services-types/macro-play.html">MacroPlay</a>): Promise&lt;<a href="../../common/cloud-services-types/macro-completion.html">MacroCompletion</a>&gt;</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="typescript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
</pre></td>
  <td class="code"><pre>const response = await this.macro.func(parameters);</pre></td>
</tr></table></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_sudo"><a class="anchor" href="#_sudo"></a>sudo</h3>
<div class="paragraph">
<p>Use this verb when you do not want to use or cannot use the standard rights system and wish to bypass it completely.
Use this verb sparingly, as it can give the caller any right on any resource.</p>
</div>
<div class="listingblock">
<div class="title">sudo(parameters: <a href="../../common/cloud-services-types/su-macro-play.html">SuMacroPlay</a>): Promise&lt;<a href="../../common/cloud-services-types/macro-completion.html">MacroCompletion</a>&gt;</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="typescript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
</pre></td>
  <td class="code"><pre>const response = await this.macro.sudo(parameters);</pre></td>
</tr></table></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_getpublichttpurl"><a class="anchor" href="#_getpublichttpurl"></a>getPublicHttpUrl</h3>
<div class="listingblock">
<div class="title">getPublicHttpUrl(parameters: <a href="../../common/cloud-services-types/.html">undefined</a>): Promise&lt;<a href="../../common/cloud-services-types/macro-exec-base-url.html">MacroExecBaseUrl</a>&gt;</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="typescript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
</pre></td>
  <td class="code"><pre>const response = await this.macro.getPublicHttpUrl(parameters);</pre></td>
</tr></table></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_how_to_use_it"><a class="anchor" href="#_how_to_use_it"></a>How to use it ?</h3>
<div class="listingblock">
<div class="title">worker/index.ts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="typescript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
</pre></td>
  <td class="code"><pre>import { Injectable, Macro, MacroPlay } from '@zetapush/platform'; <i class="conum" data-value="1"></i><b>(1)</b>

@Injectable()
export default class Api {
  constructor(
    private macro: Macro <i class="conum" data-value="2"></i><b>(2)</b>
  ) {}
  async doStuff(parameters: MacroPlay) {
    const response = await this.macro.call(parameters); <i class="conum" data-value="3"></i><b>(3)</b>
    return response;
  }
}</pre></td>
</tr></table></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Import <code>Macro</code> from platform</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Declare injected service</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Call injected service</td>
</tr>
</table>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2018-12-04 14:36:14 UTC
</div>
</div>
</body>
</html>