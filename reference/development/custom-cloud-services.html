<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 1.5.6.1">
<title>What is a custom cloud service</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<link rel="stylesheet" href="./asciidoctor.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.min.css">
<link rel="stylesheet" href="./coderay-asciidoctor.css">
<script type="text/javascript" src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
<script type="text/javascript" src="//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/js/bootstrap.min.js"></script>
<script type="text/javascript" src="../..//javascripts/menu.js"></script>
<script type="text/javascript" src="../..//javascripts/sidebar.js"></script>
<script type="text/javascript" src="../..//javascripts/steps.js"></script>
<script type="text/javascript" src="../..//javascripts/sourcecode/source-utils.js"></script>
<script type="text/javascript" src="../..//javascripts/sourcecode/highlight-lines.js"></script>
<script type="text/javascript" src="../..//javascripts/sourcecode/collapse-lines.js"></script>
<script type="text/javascript" src="../..//javascripts/tabcontainer.js"></script>
<script type="text/javascript" src="//unpkg.com/clipboard@2.0.0/dist/clipboard.min.js"></script>
<script type="text/javascript" src="../..//javascripts/clipboard.js"></script>
<script src="https://cdn.jsdelivr.net/npm/instantsearch.js@2.3/dist/instantsearch.min.js"></script>
<script type="text/javascript" src="../..//javascripts/search.js"></script>
<!-- <link rel="stylesheet" type="text/css" href="http://netdna.bootstrapcdn.com/bootswatch/2.3.2/united/bootstrap.min.css" />
  <link rel="stylesheet" type="text/css" href="http://netdna.bootstrapcdn.com/twitter-bootstrap/2.3.1/css/bootstrap-responsive.min.css"
  /> -->
<link href="//fonts.googleapis.com/css?family=Open+Sans:300,400,600,800" rel="stylesheet">
<link rel="stylesheet" type="text/css" href="../..//styles/zetapush-styles.css" />
<link rel="stylesheet" type="text/css" href="../..//styles/custom-styles.css" />
<link rel="stylesheet" type="text/css" href="../..//styles/tabcontainer.css" />
<link rel="stylesheet" type="text/css" href="../..//styles/steps.css" />
<link rel="stylesheet" type="text/css" href="../..//styles/sourcecode/collapse-lines.css" />
<link rel="stylesheet" type="text/css" href="../..//styles/sourcecode/highlight-lines.css" />
<link rel="stylesheet" type="text/css" href="../..//styles/clipboard.css" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/instantsearch.js@2.3/dist/instantsearch.min.css">
<script type="text/html" id="hit-template">
  <div class="hit">
    <div class="hit-content">
      <div class="context">
        <a href="{{sourceFile.url}}">{{sourceFile.title}}</a>
        {{#parents}}
          <a href="{{url}}">{{title}}</a>
        {{/parents}}
        <a href="{{url}}">{{{_highlightResult.title.value}}}</a>
      </div>
      <pre class="hit-description">{{{_highlightResult.content.value}}}</pre>
    </div>
  </div>
</script>
<header>
  <nav>
    <div class="main-title"><span></span><i class="fa fa-caret-down"></i></div>
    <ul>
      <li><a href="/documentation"><span>ZetaPush documentation</span><i class="fa fa-angle-right"></i></a></li>
      <li><a href="/documentation/getting-started.html"><span>Getting Started</span><i class="fa fa-angle-right"></i></a></li>
      <li><a href="/documentation/developer-manual.html"><span>Developer manual</span><i class="fa fa-angle-right"></i></a></li>
      <li><a href="/documentation/how-to.html"><span>How to guides</span><i class="fa fa-angle-right"></i></a></li>
      <li><a href="/documentation/tutorials.html"><span>Tutorials</span><i class="fa fa-angle-right"></i></a></li>
      <li><a href="/documentation/reference.html"><span>Reference</span><i class="fa fa-angle-right"></i></a></li>
      <li><a href="http://docv2.zetapush.com"><span>Documentation v2</span><i class="fa fa-angle-right"></i></a></li>
    </ul>
    <div>
      <div class="contact-us">
        <a href="https://www.zetapush.com/contact" target="_blank">Contact us</a>
      </div>
      <div class="github">
        <a href="https://github.com/zetapush" target="_blank">
          <span>Join us on</span><i class="fa fa-github-alt" title="Github"></i></a>
      </div>
      <div class="search">
        <input id="search-input" placeholder="Search for products">
        <div class="search-results">
          <div id="search-hits"></div>
        </div>
      </div>
      <div class="logo">
        <a href="https://www.zetapush.com"><span class="icon"></span></a>
      </div>
    </div>
  </nav>
</header>
</head>
<body class="book toc2 toc-left">
<div id="header">
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel2">
<li><a href="#_what_is_a_em_custom_cloud_service_em">What is a <em>custom cloud service</em></a></li>
<li><a href="#_develop_a_em_custom_cloud_services_em">Develop a <em>custom cloud services</em></a></li>
</ul>
</div>
</div>
<div id="content">
<div class="sect2">
<h3 id="_what_is_a_em_custom_cloud_service_em"><a class="anchor" href="#_what_is_a_em_custom_cloud_service_em"></a>What is a <em>custom cloud service</em></h3>
<div class="paragraph">
<p>A <em>custom cloud service</em> combines many <em>cloud functions</em> like the <em>cloud services</em> exposed by ZetaPush. The only difference is that <strong>you</strong> create the <em>cloud functions</em>.
Generally, you will want to put the <strong>business logic</strong> of your application in the <em>custom cloud services</em>.</p>
</div>
<div class="sect3">
<h4 id="_architecture"><a class="anchor" href="#_architecture"></a>Architecture</h4>
<div class="paragraph">
<p>You develop <em>cloud services</em> that are contained in a concept named <strong>worker</strong>. In your code it is
materialized by a folder named <code>worker</code>. The worker is the ZetaPush handler that starts your code (your <em>custom cloud services</em>).</p>
</div>
<div class="paragraph">
<p>Your application is composed of a logic part (the worker) and a UI part (the front).</p>
</div>
<div class="paragraph">
<p>There are two ways of running an application (worker and front):</p>
</div>
<div class="ulist">
<ul>
<li>
<p>You develop on your machine and iterate to provide features. Your application runs locally and interacts with ZetaPush Cloud.</p>
</li>
<li>
<p>Once you are ready to make the developed features available to your end-users, you publish your application. Your application runs directly in ZetaPush Cloud.</p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="_run_on_your_machine"><a class="anchor" href="#_run_on_your_machine"></a>Run on your machine</h5>
<div class="imageblock center">
<div class="content">
<img src="custom-cloud-service-dev.png" alt="custom cloud service dev" width="709" height="430">
</div>
<div class="title">Figure 1. Interactions during development phase</div>
</div>
<div class="paragraph">
<p>Both front and worker are running locally. The front interacts with <em>custom cloud services</em> contained in the worker through
ZetaPush Cloud.
As ZetaPush Cloud provides bidirectional connection, the <em>custom cloud services</em> can also interact with the front through
ZetaPush Cloud too.</p>
</div>
<div class="paragraph">
<p>A <em>custom cloud service</em> can interact with <em>built-in cloud services</em> provided by ZetaPush.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>When you start using ZetaPush, you only develop locally so from your point of vue,
your front seems to directly interact with your <em>custom cloud services</em>.</p>
</div>
<div class="paragraph">
<p>In fact, all messages go through the Internet and ZetaPush Cloud.
It means that a published front can interact with a worker that is running locally and vice versa.</p>
</div>
<div class="paragraph">
<p>See <a href="../../reference.html#mix_local_and_remote">how to mix local worker with worker running in cloud</a></p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_run_in_cloud"><a class="anchor" href="#_run_in_cloud"></a>Run in cloud</h5>
<div class="imageblock center">
<div class="content">
<img src="custom-cloud-service-prod.png" alt="custom cloud service prod" width="681" height="387">
</div>
<div class="title">Figure 2. Custom Cloud Service in production phase</div>
</div>
<div class="paragraph">
<p>Once published, everything runs in the ZetaPush Cloud. However the behavior is the same.
Every interaction between the front and <em>custom cloud services</em> goes through the ZetaPush Cloud.</p>
</div>
<div class="paragraph">
<p>The only main difference is that ZetaPush Cloud manages the hosting, the scalability and the
high availability for you.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_develop_a_em_custom_cloud_services_em"><a class="anchor" href="#_develop_a_em_custom_cloud_services_em"></a>Develop a <em>custom cloud services</em></h3>
<div class="sect3">
<h4 id="_define_a_em_custom_cloud_service_em"><a class="anchor" href="#_define_a_em_custom_cloud_service_em"></a>Define a <em>custom cloud service</em></h4>
<div class="paragraph">
<p>As a reminder worker is the ZetaPush container that will handle your code that defines <em>custom cloud services</em>.
By convention, the code of your <em>custom cloud services</em> is placed in files under <code>worker</code> directory:</p>
</div>
<div class="listingblock">
<div class="title">Tree structure convention</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="console">myApp
├── <em>.zetarc</em>
├── <em>.gitignore</em>
├── <em>front</em>
│   ├── ...
│   └── ...
├── <strong>worker</strong>
│   ├── file1.ts
│   ├── file2.ts
│   ├── ...
│   ├── fileN.ts
│   └── index.ts
├── <em>package.json</em>
├── <em>README.md</em>
└── <em>tsconfig.json</em></code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Change directory structure</div>
<div class="paragraph">
<p>See more information about <a href="../../reference.html#different_directory_structures">directory structure convention and how to adapt the structure</a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Translated into code, a <em>custom cloud service</em> is just a <code>class</code> and its <code>methods</code> are the  <em>cloud functions</em>.
The code is written in any <code>ts</code> file defined in <code>worker</code> directory. For small application like a "hello world",
write your code directly in <code>index.ts</code> file.
So the most basic example of a <em>custom cloud service</em> is below:</p>
</div>
<div class="listingblock">
<div class="title">Basic custom cloud service</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
</pre></td>
  <td class="code"><pre><span class="reserved">class</span> HelloWorldAsCustomCloudService {     <i class="conum" data-value="1"></i><b>(1)</b>

    constructor() {}                       <i class="conum" data-value="2"></i><b>(2)</b>

    helloWorld() {                         <i class="conum" data-value="3"></i><b>(3)</b>
        <span class="keyword">return</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">Hello World</span><span class="delimiter">&quot;</span></span>;
    }
}</pre></td>
</tr></table></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>A custom cloud service is encapsulated in a JavaScript/TypeScript class. <strong>HelloWorldAsCustomCloudService</strong> is your first <em>custom cloud service</em>.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>A class can define a constructor. We will see later why it is important</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td><code>helloWorld</code> is your first <em>custom cloud function</em></td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
A <em>cloud function</em> is always asynchronous (with the <em>async</em> keyword or not)
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Change entry point</div>
<div class="paragraph">
<p>By default, the code above is directly written in <code>index.ts</code> file. This is done in order
to follow NodeJS conventions. Indeed, <code>index.ts</code> is the usually the file that imports
all other files.</p>
</div>
<div class="paragraph">
<p>You can write code of your <em>custom cloud services</em> in any other file named as you want.
You will see <a href="../../reference.html#change-worker-entry-point">in the reference part</a> how to indicate to ZetaPush worker how to find your files if you don&#8217;t
want to follow convention.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="_define_a_em_cloud_function_em"><a class="anchor" href="#_define_a_em_cloud_function_em"></a>Define a <em>cloud function</em></h5>
<div class="paragraph">
<p>Each <em>cloud function</em> in a <em>custom cloud service</em> is a standard JavaScript/TypeScript
method.
For example, if you want a <em>cloud function</em> that receives two parameters you write:</p>
</div>
<div class="listingblock highlight-lines:8-14">
<div class="title">A more realistic <em>cloud function</em></div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre></td>
  <td class="code"><pre><span class="reserved">class</span> HelloWorldAsCustomCloudService {                            <i class="conum" data-value="1"></i><b>(1)</b>
    constructor() {}

    helloWorld() {
        <span class="keyword">return</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">Hello World</span><span class="delimiter">&quot;</span></span>;
    }

    saySomething(message: string, <span class="key">times</span>: number) {                <i class="conum" data-value="2"></i><b>(2)</b>
        let fullMessage = <span class="string"><span class="delimiter">'</span><span class="delimiter">'</span></span>;
        <span class="keyword">for</span>(let i=<span class="integer">0</span> ; i&lt;times ; i++) {                            <i class="conum" data-value="3"></i><b>(3)</b>
            fullMessage += <span class="error">`</span><span class="predefined">$</span>{message}<span class="error">\</span>n<span class="error">`</span>
        }
        <span class="keyword">return</span> fullMessage                                        <i class="conum" data-value="4"></i><b>(4)</b>
    }
}</pre></td>
</tr></table></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <em>custom cloud service</em> definition as seen before</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Declaration of a <em>cloud function</em> named <code>saySomething</code>. This <em>cloud function</em> accepts
two parameters. As <a href="../../reference.html#javascript_vs_typescript">TypeScript is the recommended way</a>, each parameter is typed.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Just for an example, the business logic consists in looping a number of times
and concatenating the message. You can obviously write any code you want here.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>The <em>custom cloud function</em> simply returns the contactenated string.</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Why typing ?</div>
<div class="paragraph">
<p>Typing is optional but recommended to have a well defined API. Thanks to typing,
ZetaPush is able to generate more accurate <a href="../../reference.html#generate_api_documentation">documentation based on your code</a> and also
<a href="../../reference.html#generate_sdks">generate mobile/web/IoT SDKs</a> from your code with the right types so it
makes developing your clients easier (for example, auto-completion can be used).</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Tips about cloud functions</div>
<div class="paragraph">
<p>A <em>custom cloud service</em> can have as many <em>custom cloud functions</em> as you want.</p>
</div>
<div class="paragraph">
<p>A <em>custom cloud function</em> can have as many parameters as you want. Parameters can be anything: <code>string</code>, <code>number</code>,
<code>boolean</code>, <code>array</code> or <code>object</code>. You can code your function as you always do.</p>
</div>
<div class="paragraph">
<p>A <em>custom cloud function</em> can return anything including a <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise">Promise</a>.
You can also write your code using <a href="https://javascript.info/async-await">async/await syntax</a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Define several <em>custom cloud services</em></div>
<div class="paragraph">
<p>Obviously when your application grows, you need to split your <em>custom cloud service</em> into several classes in order
to make your API more understandable and more maintainable.</p>
</div>
<div class="paragraph">
<p>You can learn <a href="../../reference.html#several_custom_cloud services">how to define several <em>custom cloud services</em></a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You have now a <em>custom cloud service</em> that provides two <em>cloud functions</em>.
But until it is exposed, it can&#8217;t be called from outside of the worker.</p>
</div>
<div class="paragraph">
<p>The next section describes how you can expose your <em>custom cloud service</em>.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_expose_a_em_custom_cloud_service_em"><a class="anchor" href="#_expose_a_em_custom_cloud_service_em"></a>Expose a <em>custom cloud service</em></h4>
<div class="paragraph">
<p>When you define a <em>custom cloud service</em> that you want to expose to the client,
you need to declare it. There are 2 cases:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Only one <em>custom cloud service</em> exposed</p>
</li>
<li>
<p>Many <em>custom cloud services</em> exposed</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In this section we only address one <em>custom cloud service</em> exposed.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">How to expose several <em>custom cloud services</em></div>
<div class="paragraph">
<p>You can also learn <a href="../../reference.html#expose_several_custom_cloud_services">how to expose several <em>custom cloud services</em></a> in the advanced sections.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>We follow npm conventions to indicate the entry point of your worker. Indeed, the <code>package.json</code> defines a property named <code>main</code>.
We use this property to indicate which file is the main file that declares the exposed <em>custom cloud service</em>.
By default, the main file is named <code>index.ts</code> and this file is placed in <code>worker</code> directory. So the <code>main</code>
property is by default <code>worker/index.ts</code>.</p>
</div>
<div class="imageblock center">
<div class="content">
<img src="custom-cloud-service-entry-point.png" alt="custom cloud service entry point" width="678" height="161">
</div>
</div>
<div class="paragraph">
<p>Now that your <em>custom cloud service</em> is marked as the entry point, it can be exposed by ZetaPush.
However you still have a little change to make on your code:</p>
</div>
<div class="listingblock highlight-lines:1">
<div class="title">A more realistic <em>cloud function</em></div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre></td>
  <td class="code"><pre><span class="reserved">export</span> <span class="keyword">default</span> <span class="reserved">class</span> HelloWorldAsCustomCloudService {                    <i class="conum" data-value="1"></i><b>(1)</b> <i class="conum" data-value="2"></i><b>(2)</b>
    constructor() {}

    helloWorld() {
        <span class="keyword">return</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">Hello World</span><span class="delimiter">&quot;</span></span>;
    }

    saySomething(message: string, <span class="key">times</span>: number) {
        let fullMessage = <span class="string"><span class="delimiter">'</span><span class="delimiter">'</span></span>;
        <span class="keyword">for</span>(let i=<span class="integer">0</span> ; i&lt;times ; i++) {
            fullMessage += <span class="error">`</span><span class="predefined">$</span>{message}<span class="error">\</span>n<span class="error">`</span>
        }
        <span class="keyword">return</span> fullMessage
    }
}</pre></td>
</tr></table></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>export</code>: <a href="https://www.typescriptlang.org/docs/handbook/modules.html" target="_blank" rel="noopener">this is required by TypeScript</a>.
In fact, declaring a class in a file makes it private.
It means that if you have another <code>.ts</code> file and you want to import <code>HelloWorldAsCustomCloudService</code> declaration,
it won&#8217;t be possible without <code>export</code> keyword. This is for code encapsulation.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td><code>default</code>: <a href="https://www.typescriptlang.org/docs/handbook/modules.html#default-exports">TypeScript provides this keyword</a>.
When exposing only one <em>custom cloud service</em>, <code>default</code> tells the worker that there is only one class (only one
<em>custom cloud service</em> defined in the <code>index.ts</code>). So the worker can directly analyze it and instantiate it.</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">How to expose several <em>custom cloud services</em></div>
<div class="paragraph">
<p>As seen above, you can also learn <a href="../../reference.html#expose_several_custom_cloud_services">how to expose several <em>custom cloud services</em></a> in the advanced sections.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Now your <em>custom cloud service</em> can be loaded by the ZetaPush worker and your <em>custom cloud service</em>
is automatically exposed.
It means that now a client can call the <em>cloud functions</em> defined in your <em>custom cloud service</em>.</p>
</div>
<div class="paragraph">
<p>The next section shows how to call a <em>cloud function</em> from a web page using pure JavaScript.</p>
</div>
</div>
<div class="sect3">
<h4 id="_use_a_em_custom_cloud_service_em_in_your_front"><a class="anchor" href="#_use_a_em_custom_cloud_service_em_in_your_front"></a>Use a <em>custom cloud service</em> in your front</h4>
<div class="paragraph">
<p>In this chapter we will see how to consume our <em>cloud functions</em> from a web page.
At the end of this example, we will have one button to call <code>helloWorld</code> <em>cloud function</em> and
one section with a message, a number of repetitions and a button to call <code>saySomething</code> <em>cloud function</em>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Mobile applications</div>
<div class="paragraph">
<p>Here we show how to create a web page that consumes our <em>custom cloud service</em>.</p>
</div>
<div class="paragraph">
<p>You can also create a mobile application for Android, iOS and Windows Phone as well
as code for a device. You can use any language you want for the client part.</p>
</div>
<div class="paragraph">
<p>By default we target web because it is currently the most used technology (even to build
some mobile applications using hybrid technologies).</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>As a reminder, here is the code of <em>custom cloud service</em> named <code>HelloWorldAsCustomCloudService</code>:</p>
</div>
<div class="listingblock">
<div class="title">worker/index.ts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre></td>
  <td class="code"><pre><span class="reserved">export</span> <span class="keyword">default</span> <span class="reserved">class</span> HelloWorldAsCustomCloudService {
    constructor() {}

    helloWorld() {
        <span class="keyword">return</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">Hello World</span><span class="delimiter">&quot;</span></span>;
    }

    saySomething(message: string, <span class="key">times</span>: number) {
        let fullMessage = <span class="string"><span class="delimiter">'</span><span class="delimiter">'</span></span>;
        <span class="keyword">for</span>(let i=<span class="integer">0</span> ; i&lt;times ; i++) {
            fullMessage += <span class="error">`</span><span class="predefined">$</span>{message}<span class="error">\</span>n<span class="error">`</span>
        }
        <span class="keyword">return</span> fullMessage
    }
}</pre></td>
</tr></table></code></pre>
</div>
</div>
<div class="sect4">
<h5 id="_prepare_your_front_for_using_zetapush_client"><a class="anchor" href="#_prepare_your_front_for_using_zetapush_client"></a>Prepare your front for using ZetaPush client</h5>
<div class="paragraph">
<p>By convention the directory structure of a ZetaPush application is defined below. You place
the code of your web page in the <code>front</code> directory:</p>
</div>
<div class="listingblock">
<div class="title">Tree structure convention</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="console">myApp
├── <em>.zetarc</em>
├── <em>.gitignore</em>
├── <strong>front</strong>
│   ├── ...
│   ├── <strong>index.js</strong>
│   └── <strong>index.html</strong>
├── <em>worker</em>
│   ├── ...
│   ├── ...
│   └── index.ts
├── <em>package.json</em>
├── <em>README.md</em>
└── <em>tsconfig.json</em></code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Other front files</div>
<div class="paragraph">
<p>For this example, we only need an HTML page and a JavaScript file. Needless to say that you can
have CSS files, images and anything you want too.</p>
</div>
<div class="paragraph">
<p>See more information about <a href="../../reference.html#different_directory_structures">directory structure convention and how to adapt the structure</a>.</p>
</div>
<div class="paragraph">
<p>Moreover, you are not limited to write pure JavaScript code. You can also use any framework you want:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="../../reference.html#develop_with_angular">Angular</a></p>
</li>
<li>
<p><a href="../../reference.html#develop_with_react">React</a></p>
</li>
<li>
<p><a href="../../reference.html#develop_with_vue">Vue.js</a></p>
</li>
<li>
<p>&#8230;&#8203;</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>For the example, we create an HTML page with a button to display the <em>HelloWorld</em> message in the page each time
the button is clicked:</p>
</div>
<div class="listingblock">
<div class="title">front/index.html</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="html"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
</pre></td>
  <td class="code"><pre><span class="doctype">&lt;!DOCTYPE html&gt;</span>
<span class="tag">&lt;html</span> <span class="attribute-name">lang</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">en</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>

<span class="tag">&lt;head&gt;</span>
    <span class="tag">&lt;meta</span> <span class="attribute-name">charset</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">UTF-8</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
    <span class="tag">&lt;meta</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">viewport</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">content</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">width=device-width, initial-scale=1.0</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
    <span class="tag">&lt;title&gt;</span>Celtia<span class="tag">&lt;/title&gt;</span>
<span class="tag">&lt;/head&gt;</span>

<span class="tag">&lt;body&gt;</span>
    <span class="tag">&lt;button</span> <span class="attribute-name">onclick</span>=<span class="string"><span class="delimiter">&quot;</span>hello()<span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>hello<span class="tag">&lt;/button&gt;</span>                    <i class="conum" data-value="1"></i><b>(1)</b>
    <span class="tag">&lt;ul</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">result-container</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span><span class="tag">&lt;/ul&gt;</span>                             <i class="conum" data-value="2"></i><b>(2)</b>

    <span class="tag">&lt;script</span> <span class="attribute-name">src</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">https://unpkg.com/@zetapush/client</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span><span class="tag">&lt;/script&gt;</span>  <i class="conum" data-value="2"></i><b>(2)</b>
    <span class="tag">&lt;script</span> <span class="attribute-name">src</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">./index.js</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span><span class="tag">&lt;/script&gt;</span>                          <i class="conum" data-value="3"></i><b>(3)</b>
<span class="tag">&lt;/body&gt;</span>

<span class="tag">&lt;/html&gt;</span></pre></td>
</tr></table></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>We call <code>hello()</code> function that is defined later in <code>index.js</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Define a node that will display received messages</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>We include the <code>client</code> module provided by ZetaPush</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>We include a JavaScript file to distinguish HTML code from JavaScript code. All could be written in the HTML</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Then, in order to interact with ZetaPush cloud, we need to create a client instance
and to connect to the cloud:</p>
</div>
<div class="listingblock">
<div class="title">front/index.js</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
</pre></td>
  <td class="code"><pre><span class="comment">// Create new ZetaPush Client</span>
const client = <span class="keyword">new</span> ZetaPushClient.WeakClient();     <i class="conum" data-value="1"></i><b>(1)</b>
<span class="comment">// Create a proxy to invoked worker methods</span>
const api = client.createProxyTaskService();        <i class="conum" data-value="2"></i><b>(2)</b>
<span class="comment">// Handle connection</span>
client.connect()                                    <i class="conum" data-value="3"></i><b>(3)</b>
  .then(() =&gt; {                                     <i class="conum" data-value="4"></i><b>(4)</b>
    console.debug(<span class="string"><span class="delimiter">'</span><span class="content">onConnectionEstablished</span><span class="delimiter">'</span></span>);
  });</pre></td>
</tr></table></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Use ZetaPushClient factory to instantiate a client. In this example, we ask for an anonymous connection (it means that actions are not bound to a particular user of your application)</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Custom cloud service provides some functions that can be called from a client. For example, the <em>custom cloud service</em> exposes <code>helloWorld</code> and <code>saySomething</code> <em>cloud functions</em>.
Instead of having to write the signature of these functions in the client too, we simply use a JavaScript <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Proxy">Proxy</a>.
Therefore, you can directly interact with your custom cloud service without writing any pass-through code on the client side.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The client is ready, now connects it to the ZetaPush cloud.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Once the connection is established, the Promise is resolved and you can write some code in <code>then</code> callback.</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Available client types</div>
<div class="paragraph">
<p><code>ZetaPushClient</code> provides several factories to get instances of a client according to
what you want to do. Here we are using a <code>WeakClient</code> instance but there are other
<a href="../../reference.html#client_types">client types</a>.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_call_code_hello_code_em_cloud_function_em"><a class="anchor" href="#_call_code_hello_code_em_cloud_function_em"></a>Call <code>hello</code> <em>cloud function</em></h5>
<div class="paragraph">
<p>Our client is ready and now we want to call <em>cloud function</em> named <code>helloWorld</code>, we add the following code:</p>
</div>
<div class="listingblock highlight-lines:11-14">
<div class="title">front/index.js</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre></td>
  <td class="code"><pre><span class="comment">// Create new ZetaPush Client</span>
const client = <span class="keyword">new</span> ZetaPushClient.WeakClient();
<span class="comment">// Create a proxy to invoked worker methods</span>
const api = client.createProxyTaskService();
<span class="comment">// Handle connection</span>
client.connect()
  .then(() =&gt; {
    console.debug(<span class="string"><span class="delimiter">'</span><span class="content">onConnectionEstablished</span><span class="delimiter">'</span></span>);
  });
<span class="comment">// Handle DOM events</span>
async <span class="keyword">function</span> <span class="function">hello</span>() {                                                                          <i class="conum" data-value="1"></i><b>(1)</b>
  const messageFromCloudFunction = await api.helloWorld();                                        <i class="conum" data-value="2"></i><b>(2)</b>
  document.getElementById(<span class="string"><span class="delimiter">'</span><span class="content">result-container</span><span class="delimiter">'</span></span>).innerHTML += <span class="error">`</span><span class="tag">&lt;li&gt;</span>${messageFromCloudFunction}<span class="tag">&lt;/li&gt;</span><span class="error">`</span> <i class="conum" data-value="3"></i><b>(3)</b>
}</pre></td>
</tr></table></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Each time a user clicks on the button defined in the HTML, this method is called.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Calls the <code>helloWorld</code> <em>cloud function</em> and store the result in a variable.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Add a new list item in the HTML page</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Before running this sample, we improve our front in order to also understand
how to call a <em>cloud function</em> that has parameters.</p>
</div>
</div>
<div class="sect4">
<h5 id="_call_code_saysomething_code_em_cloud_function_em"><a class="anchor" href="#_call_code_saysomething_code_em_cloud_function_em"></a>Call <code>saySomething</code> <em>cloud function</em></h5>
<div class="paragraph">
<p>We add two inputs to be able to send values to the <code>saySomething</code> <em>cloud function</em>.
The first input is a text to repeat. The second input is the number of times to repeat the message.
Here is the updated code:</p>
</div>
<div class="listingblock highlight-lines:12-16">
<div class="title">front/index.html</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="html"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
</pre></td>
  <td class="code"><pre><span class="doctype">&lt;!DOCTYPE html&gt;</span>
<span class="tag">&lt;html</span> <span class="attribute-name">lang</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">en</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>

<span class="tag">&lt;head&gt;</span>
    <span class="tag">&lt;meta</span> <span class="attribute-name">charset</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">UTF-8</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
    <span class="tag">&lt;meta</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">viewport</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">content</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">width=device-width, initial-scale=1.0</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
    <span class="tag">&lt;title&gt;</span>Celtia<span class="tag">&lt;/title&gt;</span>
<span class="tag">&lt;/head&gt;</span>

<span class="tag">&lt;body&gt;</span>
    <span class="tag">&lt;button</span> <span class="attribute-name">onclick</span>=<span class="string"><span class="delimiter">&quot;</span>hello()<span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>hello<span class="tag">&lt;/button&gt;</span>
    <span class="tag">&lt;div</span> <span class="attribute-name">style</span>=<span class="string"><span class="delimiter">&quot;</span><span class="key">border</span>: <span class="float">1px</span> <span class="value">solid</span> <span class="color">#ccc</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
      Message: <span class="tag">&lt;input</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">text</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">message-input</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>             <i class="conum" data-value="1"></i><b>(1)</b>
      Repeat: <span class="tag">&lt;input</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">text</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">1</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">repeat-input</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>     <i class="conum" data-value="2"></i><b>(2)</b>
      <span class="tag">&lt;button</span> <span class="attribute-name">onclick</span>=<span class="string"><span class="delimiter">&quot;</span>saySeveralTimes()<span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>say something<span class="tag">&lt;/button&gt;</span>    <i class="conum" data-value="3"></i><b>(3)</b>
    <span class="tag">&lt;/div&gt;</span>
    <span class="tag">&lt;ul</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">result-container</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span><span class="tag">&lt;/ul&gt;</span>

    <span class="tag">&lt;script</span> <span class="attribute-name">src</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">https://unpkg.com/@zetapush/client</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span><span class="tag">&lt;/script&gt;</span>
    <span class="tag">&lt;script</span> <span class="attribute-name">src</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">./index.js</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span><span class="tag">&lt;/script&gt;</span>
<span class="tag">&lt;/body&gt;</span>

<span class="tag">&lt;/html&gt;</span></pre></td>
</tr></table></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The first input to enter a message</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The second input to enter the number of times to repeat the message</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>A new button to call <code>saySeveralTimes()</code> function defined in <code>index.js</code></td>
</tr>
</table>
</div>
<div class="listingblock highlight-lines:15-20">
<div class="title">front/index.js</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
</pre></td>
  <td class="code"><pre><span class="comment">// Create new ZetaPush Client</span>
const client = <span class="keyword">new</span> ZetaPushClient.WeakClient();
<span class="comment">// Create a proxy to invoked worker methods</span>
const api = client.createProxyTaskService();
<span class="comment">// Handle connection</span>
client.connect()
  .then(() =&gt; {
    console.debug(<span class="string"><span class="delimiter">'</span><span class="content">onConnectionEstablished</span><span class="delimiter">'</span></span>);
  });
<span class="comment">// Handle DOM events</span>
async <span class="keyword">function</span> <span class="function">hello</span>() {
  const messageFromCloudFunction = await api.helloWorld();
  document.getElementById(<span class="string"><span class="delimiter">'</span><span class="content">result-container</span><span class="delimiter">'</span></span>).innerHTML += <span class="error">`</span><span class="tag">&lt;li&gt;</span>${messageFromCloudFunction}<span class="tag">&lt;/li&gt;</span><span class="error">`</span>
}
async <span class="keyword">function</span> <span class="function">saySeveralTimes</span>() {                                                <i class="conum" data-value="1"></i><b>(1)</b>
  const message = document.getElementById(<span class="string"><span class="delimiter">'</span><span class="content">message-input</span><span class="delimiter">'</span></span>).value;                 <i class="conum" data-value="2"></i><b>(2)</b>
  const repeat = document.getElementById(<span class="string"><span class="delimiter">'</span><span class="content">repeat-input</span><span class="delimiter">'</span></span>).value;                   <i class="conum" data-value="3"></i><b>(3)</b>
  const messages = await api.saySomething(message, parseInt(repeat));             <i class="conum" data-value="4"></i><b>(4)</b>
  document.getElementById(<span class="string"><span class="delimiter">'</span><span class="content">result-container</span><span class="delimiter">'</span></span>).innerHTML += <span class="error">`</span><span class="tag">&lt;li&gt;</span>${messages}<span class="tag">&lt;/li&gt;</span><span class="error">`</span> <i class="conum" data-value="5"></i><b>(5)</b>
}</pre></td>
</tr></table></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Each time a user clicks on the button 'say something' defined in the HTML, this method is called.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Reads the value of the input for getting the message.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Reads the value of the input for getting the number of times to display the message.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Calls <code>saySomething</code> <em>cloud function</em> with parameters. Note that as second parameter is a number, we have to convert the string from
the input to a number using <code>parseInt</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Add a new list item in the HTML page containing the repeated messages</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Now everything is ready to run our application.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
When you call a <em>cloud function</em> from the client, the result is always a Promise even if the <em>custom cloud function</em> is synchronous
because everything goes through the network.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_run_application"><a class="anchor" href="#_run_application"></a>Run application</h4>
<div class="paragraph">
<p>You have now defined a <em>custom cloud service</em> with one or several <em>cloud function(s)</em>. You
have also exposed your <em>custom cloud service</em>. So it is ready to be called from a client.
Your client is also ready to call the <em>custom cloud service</em>.</p>
</div>
<div class="paragraph">
<p>The next step is to start the project (both front and worker) using the ZetaPush <em>CLI</em>
on your computer.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Npm script aliases</div>
<div class="paragraph">
<p>Npm provides a handy feature
to run scripts provided by dependencies without needing to change your computer settings or
install the tool. ZetaPush defines npm <a href="https://medium.com/@mxstbr/npm-scripts-explained-f125e85eb378" target="_blank" rel="noopener">script aliases</a>
to run the ZetaPush <em>CLI</em> through npm.</p>
</div>
<div class="paragraph">
<p>See <a href="../../developer-manual.html#_using_cli">for more information about the ways of using the CLI</a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To start your worker and you front using the ZetaPush <em>CLI</em> through npm, you simply run:</p>
</div>
<div class="listingblock">
<div class="title">Start application (front and custom cloud services)</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="console">$ npm run start -- --serve-front</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p><code>npm run start</code> is a script alias defined in the <code>package.json</code> file.
The command that is executed under the hood is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="console">$ zeta run --serve-front</code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Run only the worker</div>
<div class="paragraph">
<p>It is also possible to <a href="../../reference.html#run_worker_only">run only your worker</a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="title">Automatic injection of ZetaPush information in your front</div>
<div class="paragraph">
<p>If you look closely to the code we have written, there is no information about your application at all in this sample code (the <code>appName</code> defined in <code>.zetarc</code> is neither in HTML nor in JavaScript).
However, in order to interact with your application through the ZetaPush cloud, you need to provide the <code>appName</code>.</p>
</div>
<div class="paragraph">
<p>The ZetaPush <em>CLI</em> automatically injects the <code>appName</code> from <code>.zetarc</code>.</p>
</div>
<div class="paragraph">
<p>When you run your project locally, the local HTTP server that exposes the HTML page is lightly modified to include the <code>appName</code>.
This information is then automatically read by the ZetaPush client.</p>
</div>
<div class="paragraph">
<p>When your project is run in the cloud, the same principle is applied.</p>
</div>
<div class="paragraph">
<p>This way, you just use <code>.zetarc</code> file for your credentials and <code>appName</code> and avoid having to write them twice. This also avoids conflicts when you work
in team if you want different ZetaPush <code>appName</code> per developer.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong>Now when we click the "hello" button, "Hello World" is displayed on the page.</strong></p>
</div>
<div class="imageblock center">
<div class="content">
<img src="call-zetapush-cloud-service.png" alt="call zetapush cloud service" width="739" height="431">
</div>
<div class="title">Figure 3. How it works ?</div>
</div>
<div class="paragraph">
<p>When you start your project locally, the first thing that happens is that your worker connects himself automatically to the ZetaPush cloud <span class="sequence-step">1</span> <span class="sequence-step">2</span>.</p>
</div>
<div class="paragraph">
<p>Then when you open your web browser, the connection from the client is established between the web page and the ZetaPush cloud <span class="sequence-step">3</span> <span class="sequence-step">4</span>.</p>
</div>
<div class="paragraph">
<p>When you click on the button, a message is sent through the opened connection in order to tell ZetaPush cloud to execute some
remote code <span class="sequence-step">5</span>. ZetaPush cloud routes the message to your worker <span class="sequence-step">6</span> (that is running on your machine here). The worker receives the message
and calls the <code>hello</code> <em>cloud function</em> <span class="sequence-step">7</span>.</p>
</div>
<div class="paragraph">
<p>The <em>cloud function</em> generates a result <span class="sequence-step">8</span>. The worker picks this result and transform it to a message <span class="sequence-step">9</span>. This message is then sent
to the ZetaPush cloud <span class="sequence-step">10</span>. The ZetaPush cloud routes the response message to the calling client <span class="sequence-step">11</span>. The client receives the message
and the response is parsed <span class="sequence-step">12</span> and available in your JavaScript.</p>
</div>
<div class="paragraph">
<p><strong>You can also try to enter a message and a number of repetitions and hit the "say something" button.</strong></p>
</div>
<div class="paragraph">
<p>The behavior is exactly the same. This time a message is sent to call the <em>cloud function</em> with also the parameters.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Serialization/deserailization between client and <em>custom cloud service</em></div>
<div class="paragraph">
<p>When you call a <em>cloud function</em> from the client, under the hood, the values are serialized in JSON.
This is understandable because everything goes through the network.</p>
</div>
<div class="paragraph">
<p>On the worker side, everything is deserialized by the worker and your <em>custom cloud service</em>
receives the values as they were written in the front side.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_compose_cloud_services"><a class="anchor" href="#_compose_cloud_services"></a>Compose cloud services</h4>
<div class="paragraph">
<p>You can compose <em>cloud services</em> either by using <em>built-in cloud services</em> provided by ZetaPush or
by using another of your <em>custom cloud services</em>.</p>
</div>
<div class="sect4">
<h5 id="_dependency_injection"><a class="anchor" href="#_dependency_injection"></a>Dependency injection</h5>
<div class="paragraph">
<p><a href="https://en.wikipedia.org/wiki/Dependency_injection" target="_blank" rel="noopener">Dependency injection</a> is a powerful software technique that is
totally managed by the worker.</p>
</div>
<div class="paragraph">
<p>You don&#8217;t need to manage the creation of neither <em>built-in cloud services</em> nor your <em>custom cloud services</em>.
You just indicate in your code that you need a dependency and ZetaPush instantiates it
for you. The instantiated dependency is then injected everywhere the dependency is needed.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The dependency injection of ZetaPush uses Angular <a href="https://github.com/mgechev/injection-js" target="_blank" rel="noopener">injection-js</a> library.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To mark a <em>custom cloud service</em> injectable (meaning that can be automatically created by ZetaPush
and then injected everywhere the dependency is aksed),
you need to import the package <code>@zetapush/core</code> in order to use <code>Injectable</code> decorator.</p>
</div>
<div class="listingblock">
<div class="title">Install @zetapush/core using npm</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="console"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
</pre></td>
  <td class="code"><pre>$ npm install --save @zetapush/core</pre></td>
</tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>Once the npm package is installed, you can import <code>Injectable</code> decorator and place it on your <em>custom cloud service</em>:</p>
</div>
<div class="listingblock highlight-lines:1,3">
<div class="title">Use @Injectable on a <em>custom cloud service</em></div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
</pre></td>
  <td class="code"><pre><span class="reserved">import</span> { Injectable } from <span class="string"><span class="delimiter">'</span><span class="content">@zetapush/core</span><span class="delimiter">'</span></span>;            <i class="conum" data-value="1"></i><b>(1)</b>

<span class="error">@</span>Injectable()                                           <i class="conum" data-value="2"></i><b>(2)</b>
<span class="reserved">export</span> <span class="keyword">default</span> <span class="reserved">class</span> HelloWorldAsCustomCloudService {
  constructor() {}

  helloWorld() {
      <span class="keyword">return</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">Hello World</span><span class="delimiter">&quot;</span></span>;
  }

  saySomething(message: string, <span class="key">times</span>: number) {
      let fullMessage = <span class="string"><span class="delimiter">'</span><span class="delimiter">'</span></span>;
      <span class="keyword">for</span>(let i=<span class="integer">0</span> ; i&lt;times ; i++) {
          fullMessage += <span class="error">`</span><span class="predefined">$</span>{message}<span class="error">\</span>n<span class="error">`</span>
      }
      <span class="keyword">return</span> fullMessage
  }
}</pre></td>
</tr></table></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Import the ZetaPush module that contains core features for <em>custom cloud services</em> such as <code>injectable</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Mark you <em>custom cloud service</em> candidate for dependency injection</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Here we just indicate that this <em>custom cloud service</em> can have dependencies that
will be automatically injected and also that this <em>custom cloud service</em> can be injected
anywhere it is needed.</p>
</div>
<div class="paragraph">
<p>In the next sections, we will see in concrete terms how to use it to reuse either a <em>built-in cloud service</em>
or one of your <em>custom cloud services</em>.</p>
</div>
</div>
<div class="sect4">
<h5 id="_use_built_in_em_cloud_service_em"><a class="anchor" href="#_use_built_in_em_cloud_service_em"></a>Use built-in <em>cloud service</em></h5>
<div class="paragraph">
<p>ZetaPush <em>built-in cloud services</em> are available in <code>@zetapush/platform-legacy</code> module.
Add this module to your <code>package.json</code> by running the following command:</p>
</div>
<div class="listingblock">
<div class="title">Install @zetapush/platform-legacy using npm</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="console"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
</pre></td>
  <td class="code"><pre>$ npm install --save @zetapush/platform-legacy</pre></td>
</tr></table></code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">List of <em>cloud services</em> provided by ZetaPush</div>
<div class="paragraph">
<p>As a reminder, here is the <a href="../../reference.html#builtin_cloud_services">list of <em>built-in cloud services</em></a></p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In the following example, we will use the <code>Stack</code> <em>cloud service</em> provided by ZetaPush.
In our use-case, we want to put some data associated with the current timestamp and be able to list all stored data.</p>
</div>
<div class="paragraph">
<p>To do this, the <code>Stack</code> service already provides some methods:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>push({ <em>stack</em>: string, <em>data</em>: object });</code></p>
</li>
<li>
<p><code>list({ <em>stack</em>: string });</code></p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">MyStorageService</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
</pre></td>
  <td class="code"><pre><span class="reserved">import</span> { Injectable } from <span class="string"><span class="delimiter">'</span><span class="content">@zetapush/core</span><span class="delimiter">'</span></span>;
<span class="reserved">import</span> { Stack } from <span class="string"><span class="delimiter">'</span><span class="content">@zetapush/platform-legacy</span><span class="delimiter">'</span></span>;  <i class="conum" data-value="1"></i><b>(1)</b>

<span class="error">@</span>Injectable()
<span class="reserved">export</span> <span class="keyword">default</span> <span class="reserved">class</span> MyStorageService {
  <span class="reserved">private</span> stackName = <span class="string"><span class="delimiter">'</span><span class="content">stack-example</span><span class="delimiter">'</span></span>;

  constructor(<span class="reserved">private</span> stack: Stack) {}              <i class="conum" data-value="2"></i><b>(2)</b>

  <span class="comment">/**
   *  Store data with associated timestamp
   */</span>
  storeWithTimestamp(value: any) {
    <span class="keyword">return</span> <span class="local-variable">this</span>.stack.push({                        <i class="conum" data-value="3"></i><b>(3)</b>
      <span class="key">stack</span>: <span class="local-variable">this</span>.stackName,
      <span class="key">data</span>: {
        value,
        <span class="key">timestamp</span>: Date.now()
      }
    });
  }

  <span class="comment">/**
   * List all stored data
   */</span>
  getAllData() {
    <span class="keyword">return</span> <span class="local-variable">this</span>.stack.list({                        <i class="conum" data-value="4"></i><b>(4)</b>
      <span class="key">stack</span>: <span class="local-variable">this</span>.stackName
    });
  }
}</pre></td>
</tr></table></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>We import the <code>Stack</code> service so that TypeScript knows it</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>We ask ZetaPush to inject a dependency of type <code>Stack</code> (<code>stack</code> is an instance of <code>Stack</code>).
Here we use the <a href="https://kendaleiv.com/typescript-constructor-assignment-public-and-private-keywords/" target="_blank" rel="noopener">shorthand syntax</a> for declaring a constructor parameter as well as a property.
So the property <code>this.stack</code> is defined and is initialized with <code>stack</code> parameter.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Calls the <code>Stack</code> service to store data (method <code>push</code>)</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Calls the <code>Stack</code> service to list data (method <code>list</code>)</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The example defines a <em>custom cloud service</em> named <code>MyStorageService</code> that provides two <em>cloud functions</em>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>storeWithTimestamp</code> that receives a value from a client and calls the <code>Stack</code> service to
store received value (<code>value</code> parameter) as well as the current timestamp (using <code>Date.now()</code>)</p>
</li>
<li>
<p><code>getAllData</code> that has no parameters and calls <code>Stack</code> service to get all previsouly stored
pairs of <code>&lt;value, timestamp&gt;</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The most important part to understand is in the <code>constructor</code>. As described before,
the example uses dependency injection. You simply tell ZetaPush that you need a dependency of type <code>Stack</code>.
You don&#8217;t create it in your <em>custom cloud service</em> because it is not the responsibility of
your <em>custom cloud service</em> to create the <code>Stack</code> service. Instead, you let ZetaPush
handle the creation. Thanks to <code>@Injectable</code> decorator, ZetaPush detects that you have
a <em>custom cloud services</em> with needed dependencies. ZetaPush understands that you need a <code>Stack</code>
instance so it instantiates it before instantiating your <em>custom cloud service</em>. Then
ZetaPush instantiates your <em>custom cloud service</em> by providing, as the first argument of your
constructor here, the instance of <code>Stack</code>.</p>
</div>
<div class="paragraph">
<p>This behavior avoids you to have complex code to instantiate <em>built-in cloud services</em>. Moreover,
if you have several <em>custom cloud services</em> that are using the <code>Stack</code> service, thanks to
dependency injection, there will be only one instance shared between your <em>custom cloud services</em>.</p>
</div>
</div>
<div class="sect4">
<h5 id="_use_another_em_custom_cloud_service_em"><a class="anchor" href="#_use_another_em_custom_cloud_service_em"></a>Use another <em>custom cloud service</em></h5>
<div class="paragraph">
<p>In this example, we will have 2 <em>custom cloud services</em>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>Calendar</code>: Utils function to return the current date</p>
</li>
<li>
<p><code>HelloWorldService</code>: Basic example using <code>Calendar</code> <em>cloud function</em></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The first <em>custom cloud service</em> (<code>Calendar</code>) is defined in the file <code>worker/calendar.js</code>.</p>
</div>
<div class="listingblock">
<div class="title">worker/calendar.ts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
</pre></td>
  <td class="code"><pre><span class="reserved">export</span> <span class="reserved">class</span> Calendar {
  getNow() { <i class="conum" data-value="1"></i><b>(1)</b>
    <span class="keyword">return</span> <span class="keyword">new</span> Date().toLocalDateString(<span class="string"><span class="delimiter">'</span><span class="content">fr-FR</span><span class="delimiter">'</span></span>);
  }
}</pre></td>
</tr></table></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The only <em>cloud function</em> of the <code>Calendar</code> service</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Then, we have the <code>HelloWorldWithDateService</code> that use our <code>Calendar</code> service. It is defined in the file <code>worker/index.ts</code>.</p>
</div>
<div class="listingblock highlight-lines:7,13">
<div class="title">worker/index.ts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre></td>
  <td class="code"><pre><span class="reserved">import</span> { Injectable } from <span class="string"><span class="delimiter">'</span><span class="content">@zetapush/core</span><span class="delimiter">'</span></span>;
<span class="reserved">import</span> { Calendar } from <span class="string"><span class="delimiter">'</span><span class="content">./calendar</span><span class="delimiter">'</span></span>;        <i class="conum" data-value="1"></i><b>(1)</b>

<span class="error">@</span>Injectable()
<span class="reserved">export</span> <span class="keyword">default</span> <span class="reserved">class</span> HelloWorldWithDateService {
  constructor(                                <i class="conum" data-value="2"></i><b>(2)</b>
    <span class="reserved">private</span> calendar: Calendar
  ) {}
  <span class="comment">/**
   * Return 'Hello World' with current date
   */</span>
  helloWorldWithDate() {
    <span class="keyword">return</span> <span class="error">`</span>Hello world at <span class="predefined">$</span>{<span class="local-variable">this</span>.calendar.getNow()}<span class="error">`</span>;
 }
}</pre></td>
</tr></table></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>We import the <code>Calendar</code> service from the <code>worker/calendar.ts</code> file</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td><code>calendar</code> is an instance of <code>Calendar</code> and <code>this.calendar</code> is initialized with <code>calendar</code> value</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>As for <em>built-in cloud services</em>, dependency injection works for your <em>custom cloud services</em>.
Here it was an example</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Private <em>custom cloud service</em></div>
<div class="paragraph">
<p>In this example, we still have only one <em>custom cloud service</em> exposed.</p>
</div>
<div class="paragraph">
<p>One <code>HelloWorldWithDateService</code> is exposed and delegates some work to <code>Calendar</code>.
<code>Calendar</code> is not exposed and can&#8217;t be directly called from a client. So it can be considered
as a private <em>custom cloud service</em>.</p>
</div>
<div class="paragraph">
<p>Sometimes you may want to <a href="../../reference.html#expose_several_cloud_services">expose several <em>custom cloud services</em></a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Shared module of <em>custom cloud services</em></div>
<div class="paragraph">
<p>As you can see, a <em>custom cloud service</em> is no more than just a standard class with methods written
in TypeScript. If you want to develop reusable <em>custom cloud services</em> that could be
used in different applications, you can do it easily by following standards.
Actually, you can <a href="../../reference.html#shared_module">just create a npm module</a> and import it like we do with <code>@zetapush/core</code> or
<code>@zetapush/platform-legacy</code>.</p>
</div>
<div class="paragraph">
<p>You can also import any existing library that is available in the community.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="onapplicationbootstrap"><a class="anchor" href="#onapplicationbootstrap"></a>Add initialization code</h4>
<div class="paragraph">
<p>ZetaPush manages scalability and redundancy of your <em>workers</em>. So there may have several workers that start at the same time. And if you initialize some data or configure some cloud services at the same time, it may have conflicts or duplicated data. To avoid that ZetaPush provides a way to initialize code that will ensure that is executed by only one worker.</p>
</div>
<div class="paragraph">
<p>For this, ZetaPush provides the <em>bootstrap</em> feature. To use it you need to implement the method <code>onApplicationBootstrap()</code> in your <em>custom cloud service</em>.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Bad practice for initialization code</div>
<div class="paragraph">
<p>You may want to put your initialization code in the constructor but this is a bad practice.
Indeed, even if in the most cases, a <em>custom cloud service</em> is a <a href="https://en.wikipedia.org/wiki/Singleton_pattern">singleton</a>, it may have several instances of your <em>custom cloud service</em> and your initialization code will be called many times. An other drawback is that the constructor is synchronous and the <code>onApplicationBootstrap</code> method is asynchronous (You can also put synchronous code in your <code>onApplicationBootstrap</code> with the <code>await</code> keyword).</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In the following example we will create a worker to store data in a database. The initialization code let you create a table in our database. Then we will create methods to add and list our data.</p>
</div>
<div class="listingblock">
<div class="title">Initialization code</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
</pre></td>
  <td class="code"><pre><span class="reserved">import</span> { Injectable, Bootstrappable } from <span class="string"><span class="delimiter">'</span><span class="content">@zetapush/core</span><span class="delimiter">'</span></span>;
<span class="reserved">import</span> { GdaConfigurer, Gda, GdaDataType } from <span class="string"><span class="delimiter">'</span><span class="content">@zetapush/platform-legacy</span><span class="delimiter">'</span></span>;

const NAME_TABLE = <span class="string"><span class="delimiter">'</span><span class="content">table</span><span class="delimiter">'</span></span>;
const NAME_COLUMN = <span class="string"><span class="delimiter">'</span><span class="content">column</span><span class="delimiter">'</span></span>;

<span class="error">@</span>Injectable()
<span class="reserved">export</span> <span class="keyword">default</span> <span class="reserved">class</span> <span class="reserved">implements</span> Bootstrappable {                              <i class="conum" data-value="1"></i><b>(1)</b>
  constructor(<span class="reserved">private</span> gdaConfigurer: GdaConfigurer, <span class="reserved">private</span> gda: Gda) {}

  async onApplicationBootstrap() {                                            <i class="conum" data-value="2"></i><b>(2)</b>
    <span class="local-variable">this</span>.gdaConfigurer.createTable({                                          <i class="conum" data-value="3"></i><b>(3)</b>
      <span class="key">name</span>: NAME_TABLE,
      <span class="key">columns</span>: [{
        <span class="key">name</span>: NAME_COLUMN,
        <span class="key">type</span>: GdaDataType.STRING
      }]
    });
  }

  async addData(data: string) {
    <span class="keyword">return</span> await <span class="local-variable">this</span>.gda.put({
      <span class="key">table</span>: NAME_TABLE,
      <span class="key">column</span>: NAME_COLUMN,
      data,
      <span class="key">key</span>: Date.now().toString()
    });
  }

  async getData() {
    <span class="keyword">return</span> await <span class="local-variable">this</span>.gda.list({
      <span class="key">table</span>: NAME_TABLE
    });
  }
}</pre></td>
</tr></table></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>We implement the <code>Bootstrappable</code> interface. This is optional (see below)</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The <code>onApplicationBootstrap()</code> method is always <em>asynchronous</em>, the <code>async</code> keyword is optional</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>In our initialization code we create a table in our database</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Bootstrappable interface</div>
<div class="paragraph">
<p>The implementation of the <code>Bootstrappable</code> interface is optional but it is a best practice, you just need to implement a method named <code>onApplicationBootstrap()</code>.
Indeed, implementing it avoids you to write wrong implementation of <code>onApplicationBootstrap()</code> method. It also indicates to other developers that you really wanted to add initialization code to your <em>cloud service</em> on purpose and it also provides documentation about <code>onApplicationBootstrap</code> method directly in code.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You can implement the <code>onApplicationBootstrap()</code> method in several <em>custom cloud services</em>.
A dependency tree will be created to execute all <code>onApplicationBootstrap()</code> methods in the proper order (regarding of the needed dependencies).</p>
</div>
<div class="paragraph">
<p>For example in the following scheme, we have 2 exposed API named <em>Dashboard</em> and <em>Mobile</em>.
For the case of the <em>Dashboard</em> API, it uses another service named <em>Admin</em>, that uses <em>User Management</em> and <em>Stock Management</em> services and so on.</p>
</div>
<div class="paragraph">
<p>So the services are initialized in a specific order :</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Utils</p>
</li>
<li>
<p>User Data / Stock Data</p>
</li>
<li>
<p>User Management / Stock Management / Stock Market</p>
</li>
<li>
<p>Admin / Client API / Guest Access</p>
</li>
<li>
<p>Dashboard / Mobile</p>
</li>
</ol>
</div>
<div class="imageblock center">
<div class="content">
<img src="../../images//schemas/bootstrap_order.png" alt="bootstrap order">
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2019-01-11 19:47:14 UTC
</div>
</div>
</body>
</html>