<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 1.5.6.1">
<title>Test the feature</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<link rel="stylesheet" href="./asciidoctor.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.min.css">
<link rel="stylesheet" href="./coderay-asciidoctor.css">
<script type="text/javascript" src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
<script type="text/javascript" src="//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/js/bootstrap.min.js"></script>
<script type="text/javascript" src="../..//javascripts/menu.js"></script>
<script type="text/javascript" src="../..//javascripts/sidebar.js"></script>
<script type="text/javascript" src="../..//javascripts/steps.js"></script>
<script type="text/javascript" src="../..//javascripts/sourcecode/source-utils.js"></script>
<script type="text/javascript" src="../..//javascripts/sourcecode/highlight-lines.js"></script>
<script type="text/javascript" src="../..//javascripts/sourcecode/collapse-lines.js"></script>
<script type="text/javascript" src="../..//javascripts/tabcontainer.js"></script>
<script type="text/javascript" src="//unpkg.com/clipboard@2.0.0/dist/clipboard.min.js"></script>
<script type="text/javascript" src="../..//javascripts/clipboard.js"></script>
<script src="https://cdn.jsdelivr.net/npm/instantsearch.js@2.3/dist/instantsearch.min.js"></script>
<script type="text/javascript" src="../..//javascripts/search.js"></script>
<!-- <link rel="stylesheet" type="text/css" href="http://netdna.bootstrapcdn.com/bootswatch/2.3.2/united/bootstrap.min.css" />
  <link rel="stylesheet" type="text/css" href="http://netdna.bootstrapcdn.com/twitter-bootstrap/2.3.1/css/bootstrap-responsive.min.css"
  /> -->
<link href="//fonts.googleapis.com/css?family=Open+Sans:300,400,600,800" rel="stylesheet">
<link rel="stylesheet" type="text/css" href="../..//styles/zetapush-styles.css" />
<link rel="stylesheet" type="text/css" href="../..//styles/custom-styles.css" />
<link rel="stylesheet" type="text/css" href="../..//styles/tabcontainer.css" />
<link rel="stylesheet" type="text/css" href="../..//styles/steps.css" />
<link rel="stylesheet" type="text/css" href="../..//styles/sourcecode/collapse-lines.css" />
<link rel="stylesheet" type="text/css" href="../..//styles/sourcecode/highlight-lines.css" />
<link rel="stylesheet" type="text/css" href="../..//styles/clipboard.css" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/instantsearch.js@2.3/dist/instantsearch.min.css">
<script type="text/html" id="hit-template">
  <div class="hit">
    <div class="hit-content">
      <div class="context">
        <a href="{{sourceFile.url}}">{{sourceFile.title}}</a>
        {{#parents}}
          <a href="{{url}}">{{title}}</a>
        {{/parents}}
        <a href="{{url}}">{{{_highlightResult.title.value}}}</a>
      </div>
      <pre class="hit-description">{{{_highlightResult.content.value}}}</pre>
    </div>
  </div>
</script>
<header>
  <nav>
    <div class="main-title"><span></span><i class="fa fa-caret-down"></i></div>
    <ul>
      <li><a href="/documentation"><span>ZetaPush documentation</span><i class="fa fa-angle-right"></i></a></li>
      <li><a href="/documentation/getting-started.html"><span>Getting Started</span><i class="fa fa-angle-right"></i></a></li>
      <li><a href="/documentation/developer-manual.html"><span>Developer manual</span><i class="fa fa-angle-right"></i></a></li>
      <li><a href="/documentation/how-to.html"><span>How to guides</span><i class="fa fa-angle-right"></i></a></li>
      <li><a href="/documentation/tutorials.html"><span>Tutorials</span><i class="fa fa-angle-right"></i></a></li>
      <li><a href="/documentation/reference.html"><span>Reference</span><i class="fa fa-angle-right"></i></a></li>
      <li><a href="http://docv2.zetapush.com"><span>Documentation v2</span><i class="fa fa-angle-right"></i></a></li>
    </ul>
    <div>
      <div class="contact-us">
        <a href="https://spectrum.chat/zetapush" target="_blank">Contact us</a>
      </div>
      <div class="github">
        <a href="https://github.com/zetapush" target="_blank">
          <span>Join us on</span><i class="fa fa-github-alt" title="Github"></i></a>
      </div>
      <div class="search">
        <input id="search-input" placeholder="Search for products">
        <div class="search-results">
          <div id="search-hits"></div>
        </div>
      </div>
      <div class="logo">
        <a href="https://zetapush.com"><span class="icon"></span></a>
      </div>
    </div>
  </nav>
</header>
</head>
<body class="book toc2 toc-left">
<div id="header">
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_test_the_feature">Test the feature</a>
<ul class="sectlevel2">
<li><a href="#_simple_change_in_code_of_your_em_custom_cloud_service_em">Simple change in code of your <em>custom cloud service</em></a></li>
<li><a href="#_change_code_of_your_front">Change code of your front</a></li>
<li><a href="#_use_a_em_cloud_service_em_on_the_fly">Use a <em>cloud service</em> on the fly</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>In order to improve productivity, ZetaPush provides <strong>hot reload</strong> feature.
Once you have started your application on your computer, you just focus on writing your code.</p>
</div>
<div class="paragraph">
<p>Each time you make a change in your <em>custom cloud services</em> code, ZetaPush detects the change
and reload your <em>custom cloud services</em> code. The time to wait for code to be ready is drastically reduced so
you can develop really faster thanks to this feature.</p>
</div>
<div class="paragraph">
<p>As front part is simply HTML and JavaScript, the local HTTP server always serves the
latest version of your code. The cache is explicitly disabled in local development.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_test_the_feature"><a class="anchor" href="#_test_the_feature"></a>Test the feature</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To test this feature, we will reuse the <strong>HelloWorldAsCustomCloudService</strong> sample.
As a reminder, here is the code:</p>
</div>
<div class="paragraph tab-container">
<p>HelloWorldAsCustomCloudService</p>
</div>
<div class="paragraph tab">
<p>worker/index.ts</p>
</div>
<div class="listingblock">
<div class="title">worker/index.ts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
</pre></td>
  <td class="code"><pre><span class="reserved">import</span> { Injectable } from <span class="string"><span class="delimiter">'</span><span class="content">@zetapush/core</span><span class="delimiter">'</span></span>;

<span class="error">@</span>Injectable()
<span class="reserved">export</span> <span class="keyword">default</span> <span class="reserved">class</span> HelloWorldAsCustomCloudService {
    constructor() {}

    helloWorld() {
        <span class="keyword">return</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">Hello World</span><span class="delimiter">&quot;</span></span>;
    }

    saySomething(message: string, <span class="key">times</span>: number) {
        let fullMessage = <span class="string"><span class="delimiter">'</span><span class="delimiter">'</span></span>;
        <span class="keyword">for</span>(let i=<span class="integer">0</span> ; i&lt;times ; i++) {
            fullMessage += <span class="error">`</span><span class="predefined">$</span>{message}<span class="error">\</span>n<span class="error">`</span>
        }
        <span class="keyword">return</span> fullMessage
    }
}</pre></td>
</tr></table></code></pre>
</div>
</div>
<div class="paragraph tab">
<p>front/index.html</p>
</div>
<div class="listingblock">
<div class="title">front/index.html</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="html"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
</pre></td>
  <td class="code"><pre><span class="doctype">&lt;!DOCTYPE html&gt;</span>
<span class="tag">&lt;html</span> <span class="attribute-name">lang</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">en</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>

<span class="tag">&lt;head&gt;</span>
    <span class="tag">&lt;meta</span> <span class="attribute-name">charset</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">UTF-8</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
    <span class="tag">&lt;meta</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">viewport</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">content</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">width=device-width, initial-scale=1.0</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
    <span class="tag">&lt;title&gt;</span>Celtia<span class="tag">&lt;/title&gt;</span>
<span class="tag">&lt;/head&gt;</span>

<span class="tag">&lt;body&gt;</span>
    <span class="tag">&lt;button</span> <span class="attribute-name">onclick</span>=<span class="string"><span class="delimiter">&quot;</span>hello()<span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>hello<span class="tag">&lt;/button&gt;</span>
    <span class="tag">&lt;div</span> <span class="attribute-name">style</span>=<span class="string"><span class="delimiter">&quot;</span><span class="key">border</span>: <span class="float">1px</span> <span class="value">solid</span> <span class="color">#ccc</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
      Message: <span class="tag">&lt;input</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">text</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">message-input</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
      Repeat: <span class="tag">&lt;input</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">text</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">1</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">repeat-input</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
      <span class="tag">&lt;button</span> <span class="attribute-name">onclick</span>=<span class="string"><span class="delimiter">&quot;</span>saySeveralTimes()<span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>say something<span class="tag">&lt;/button&gt;</span>
    <span class="tag">&lt;/div&gt;</span>
    <span class="tag">&lt;ul</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">result-container</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span><span class="tag">&lt;/ul&gt;</span>

    <span class="tag">&lt;script</span> <span class="attribute-name">src</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">https://unpkg.com/@zetapush/client</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span><span class="tag">&lt;/script&gt;</span>
    <span class="tag">&lt;script</span> <span class="attribute-name">src</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">./index.js</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span><span class="tag">&lt;/script&gt;</span>
<span class="tag">&lt;/body&gt;</span>

<span class="tag">&lt;/html&gt;</span></pre></td>
</tr></table></code></pre>
</div>
</div>
<div class="paragraph tab">
<p>front/index.js</p>
</div>
<div class="listingblock">
<div class="title">front/index.js</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
</pre></td>
  <td class="code"><pre><span class="comment">// Create new ZetaPush Client</span>
const client = <span class="keyword">new</span> ZetaPushClient.WeakClient();
<span class="comment">// Create a proxy to invoked worker methods</span>
const api = client.createProxyTaskService();
<span class="comment">// Handle connection</span>
client.connect()
  .then(() =&gt; {
    console.debug(<span class="string"><span class="delimiter">'</span><span class="content">onConnectionEstablished</span><span class="delimiter">'</span></span>);
  });
<span class="comment">// Handle DOM events</span>
async <span class="keyword">function</span> <span class="function">hello</span>() {
  const messageFromCloudFunction = await api.helloWorld();
  document.getElementById(<span class="string"><span class="delimiter">'</span><span class="content">result-container</span><span class="delimiter">'</span></span>).innerHTML += <span class="error">`</span><span class="tag">&lt;li&gt;</span>${messageFromCloudFunction}<span class="tag">&lt;/li&gt;</span><span class="error">`</span>
}
async <span class="keyword">function</span> <span class="function">saySeveralTimes</span>() {
  const message = document.getElementById(<span class="string"><span class="delimiter">'</span><span class="content">message-input</span><span class="delimiter">'</span></span>).value;
  const repeat = document.getElementById(<span class="string"><span class="delimiter">'</span><span class="content">repeat-input</span><span class="delimiter">'</span></span>).value;
  const messages = await api.saySomething(message, parseInt(repeat));
  document.getElementById(<span class="string"><span class="delimiter">'</span><span class="content">result-container</span><span class="delimiter">'</span></span>).innerHTML += <span class="error">`</span><span class="tag">&lt;li&gt;</span>${messages}<span class="tag">&lt;/li&gt;</span><span class="error">`</span>
}</pre></td>
</tr></table></code></pre>
</div>
</div>
<div class="paragraph tab-container-end">
<p>-</p>
</div>
<div class="paragraph">
<p>Now start your application by running:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="console">$ npm run start -- --serve-front</code></pre>
</div>
</div>
<div class="paragraph">
<p>Click on 'hello' button, the message "Hello World" appears in the web page.</p>
</div>
<div class="sect2">
<h3 id="_simple_change_in_code_of_your_em_custom_cloud_service_em"><a class="anchor" href="#_simple_change_in_code_of_your_em_custom_cloud_service_em"></a>Simple change in code of your <em>custom cloud service</em></h3>
<div class="paragraph">
<p>Your application is started locally. Now we will test this feature by updating your code.
Update the <code>worker/index.ts</code> file as following:</p>
</div>
<div class="listingblock highlight-lines:8 collapse-lines:10-17">
<div class="title">worker/index.ts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
</pre></td>
  <td class="code"><pre><span class="reserved">import</span> { Injectable } from <span class="string"><span class="delimiter">'</span><span class="content">@zetapush/core</span><span class="delimiter">'</span></span>;

<span class="error">@</span>Injectable()
<span class="reserved">export</span> <span class="keyword">default</span> <span class="reserved">class</span> HelloWorldAsCustomCloudService {
    constructor() {}

    helloWorld() {
        <span class="keyword">return</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">Hello World !!!</span><span class="delimiter">&quot;</span></span>;                       <i class="conum" data-value="1"></i><b>(1)</b>
    }

    saySomething(message: string, <span class="key">times</span>: number) {
        let fullMessage = <span class="string"><span class="delimiter">'</span><span class="delimiter">'</span></span>;
        <span class="keyword">for</span>(let i=<span class="integer">0</span> ; i&lt;times ; i++) {
            fullMessage += <span class="error">`</span><span class="predefined">$</span>{message}<span class="error">\</span>n<span class="error">`</span>
        }
        <span class="keyword">return</span> fullMessage
    }
}</pre></td>
</tr></table></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Add " !!!" at the end of the string</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Save the file and check your terminal. You should see something like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="console">⠋ Reloading worker...
[INFO] Worker is up!</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can check that the code is really updated by clicking on the 'hello' button.
Now you see that "Hello World !!!" is displayed in the web page.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">No change is needed on the front</div>
<div class="paragraph">
<p>You don&#8217;t need to reload the web page or to reconnect the client to the ZetaPush cloud.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_change_code_of_your_front"><a class="anchor" href="#_change_code_of_your_front"></a>Change code of your front</h3>
<div class="paragraph">
<p>To demonstrate a change in your front, we will update the code of the
<code>saySeveralTimes</code> function:</p>
</div>
<div class="listingblock highlight-lines:18 collapse-lines:1-14">
<div class="title">front/index.js</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
</pre></td>
  <td class="code"><pre><span class="comment">// Create new ZetaPush Client</span>
const client = <span class="keyword">new</span> ZetaPushClient.WeakClient();
<span class="comment">// Create a proxy to invoked worker methods</span>
const api = client.createProxyTaskService();
<span class="comment">// Handle connection</span>
client.connect()
  .then(() =&gt; {
    console.debug(<span class="string"><span class="delimiter">'</span><span class="content">onConnectionEstablished</span><span class="delimiter">'</span></span>);
  });
<span class="comment">// Handle DOM events</span>
async <span class="keyword">function</span> <span class="function">hello</span>() {
  const messageFromCloudFunction = await api.helloWorld();
  document.getElementById(<span class="string"><span class="delimiter">'</span><span class="content">result-container</span><span class="delimiter">'</span></span>).innerHTML += <span class="error">`</span><span class="tag">&lt;li&gt;</span>${messageFromCloudFunction}<span class="tag">&lt;/li&gt;</span><span class="error">`</span>
}
async <span class="keyword">function</span> <span class="function">saySeveralTimes</span>() {
  const message = document.getElementById(<span class="string"><span class="delimiter">'</span><span class="content">message-input</span><span class="delimiter">'</span></span>).value;
  const repeat = document.getElementById(<span class="string"><span class="delimiter">'</span><span class="content">repeat-input</span><span class="delimiter">'</span></span>).value;
  const messages = await api.saySomething(message + <span class="string"><span class="delimiter">'</span><span class="content"> - </span><span class="delimiter">'</span></span>, parseInt(repeat));               <i class="conum" data-value="1"></i><b>(1)</b>
  document.getElementById(<span class="string"><span class="delimiter">'</span><span class="content">result-container</span><span class="delimiter">'</span></span>).innerHTML += <span class="error">`</span><span class="tag">&lt;li&gt;</span>${messages}<span class="tag">&lt;/li&gt;</span><span class="error">`</span>
}</pre></td>
</tr></table></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>We add ' - ' on the message parameter</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Save your file and reload your web page. Enter a message ("hello" for example) and click on 'say something' button.
You should see "hello - hello - " (if you have chosen 2 repetitions).</p>
</div>
</div>
<div class="sect2">
<h3 id="_use_a_em_cloud_service_em_on_the_fly"><a class="anchor" href="#_use_a_em_cloud_service_em_on_the_fly"></a>Use a <em>cloud service</em> on the fly</h3>
<div class="paragraph">
<p>As your application grows, you will need to use other <em>built-in cloud services</em> or <em>custom cloud services</em>.</p>
</div>
<div class="paragraph">
<p>We will improve our <em>custom cloud service</em> to use the <code>Stack</code> <em>built-in cloud service</em> to store messages.
First <code>Stack</code> service is provided by <code>@zetapush/platform-legacy</code> module. So you have to install it.
You can keep your application running in your terminal and open another terminal in the same folder.
Execute this command in the new terminal:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="console">$ npm install --save @zetapush/platform-legacy</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can now import <code>Stack</code> service in your code and use it:</p>
</div>
<div class="listingblock highlight-lines:2,6,17-26,30-37">
<div class="title">worker/index.ts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
</pre></td>
  <td class="code"><pre><span class="reserved">import</span> { Injectable } from <span class="string"><span class="delimiter">'</span><span class="content">@zetapush/core</span><span class="delimiter">'</span></span>;
<span class="reserved">import</span> { Stack } from <span class="string"><span class="delimiter">'</span><span class="content">@zetapush/platform-legacy</span><span class="delimiter">'</span></span>;          <i class="conum" data-value="1"></i><b>(1)</b>

<span class="error">@</span>Injectable()
<span class="reserved">export</span> <span class="keyword">default</span> <span class="reserved">class</span> HelloWorldAsCustomCloudService {
  constructor(<span class="reserved">private</span> stack: Stack) {}                      <i class="conum" data-value="2"></i><b>(2)</b>

  helloWorld() {
    <span class="keyword">return</span> <span class="string"><span class="delimiter">'</span><span class="content">Hello World</span><span class="delimiter">'</span></span>;
  }

  async saySomething(message: string, <span class="key">times</span>: number) {
    let fullMessage = <span class="string"><span class="delimiter">'</span><span class="delimiter">'</span></span>;
    <span class="keyword">for</span> (let i = <span class="integer">0</span>; i &lt; times; i++) {
      fullMessage += <span class="error">`</span><span class="predefined">$</span>{message}<span class="error">\</span>n<span class="error">`</span>;
    }
    <span class="comment">// store source information (message and times)</span>
    <span class="comment">// and generated information (fullMessage)</span>
    await <span class="local-variable">this</span>.stack.push({                                 <i class="conum" data-value="3"></i><b>(3)</b>
      <span class="key">stack</span>: <span class="string"><span class="delimiter">'</span><span class="content">messages</span><span class="delimiter">'</span></span>,
      <span class="key">data</span>: {
        message,
        times,
        fullMessage
      }
    });
    <span class="keyword">return</span> fullMessage;
  }

  async getStoredMessages() {                               <i class="conum" data-value="4"></i><b>(4)</b>
    <span class="comment">// get all values</span>
    const response = await <span class="local-variable">this</span>.stack.list({
      <span class="key">stack</span>: <span class="string"><span class="delimiter">'</span><span class="content">messages</span><span class="delimiter">'</span></span>
    });
    <span class="comment">// get only useful part (message, times, fullMessage)</span>
    <span class="keyword">return</span> response.result ? response.result.content.map((item) =&gt; item.data) : [];
  }
}</pre></td>
</tr></table></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Import the module <code>@zetapush/platform-legacy</code> that we just installed with npm</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Indicate that we need a dependency of type <code>Stack</code> that will be provided by ZetaPush worker</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Add some code to store the messages. Here we store both received parameters and the generated message</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>A new <em>cloud function</em> in order to display what&#8217;s in the database</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You can save your file and if you look in your terminal, you can see something like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="console">⠋ Reloading worker...
[INFO] Create services [ [ { itemId: 'stack',
      businessId: 'v79ivn00l',
      deploymentId: 'stack_0',
      description: 'stack',
      options: {},
      forbiddenVerbs: [Array],
⠴ Reloading worker...
[INFO] Worker is up!</code></pre>
</div>
</div>
<div class="paragraph">
<p>To ensure that everything works fine, you need to update your front:</p>
</div>
<div class="listingblock highlight-lines:8,19,21-25 collapse-lines:1-4">
<div class="title">front/index.js</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
</pre></td>
  <td class="code"><pre><span class="comment">// Create new ZetaPush Client</span>
const client = <span class="keyword">new</span> ZetaPushClient.WeakClient();
<span class="comment">// Create a proxy to invoked worker methods</span>
const api = client.createProxyTaskService();
<span class="comment">// Handle connection</span>
client.connect().then(() =&gt; {
  console.debug(<span class="string"><span class="delimiter">'</span><span class="content">onConnectionEstablished</span><span class="delimiter">'</span></span>);
  <span class="keyword">return</span> displayAllMessages();                                                                 <i class="conum" data-value="1"></i><b>(1)</b>
});
<span class="comment">// Handle DOM events</span>
async <span class="keyword">function</span> <span class="function">hello</span>() {
  const messageFromCloudFunction = await api.helloWorld();
  document.getElementById(<span class="string"><span class="delimiter">'</span><span class="content">result-container</span><span class="delimiter">'</span></span>).innerHTML += <span class="error">`</span><span class="tag">&lt;li&gt;</span>${messageFromCloudFunction}<span class="tag">&lt;/li&gt;</span><span class="error">`</span>;
}
async <span class="keyword">function</span> <span class="function">saySeveralTimes</span>() {
  const message = document.getElementById(<span class="string"><span class="delimiter">'</span><span class="content">message-input</span><span class="delimiter">'</span></span>).value;
  const repeat = document.getElementById(<span class="string"><span class="delimiter">'</span><span class="content">repeat-input</span><span class="delimiter">'</span></span>).value;
  const messages = await api.saySomething(message + <span class="string"><span class="delimiter">'</span><span class="content"> - </span><span class="delimiter">'</span></span>, parseInt(repeat));
  await displayAllMessages();                                                                  <i class="conum" data-value="2"></i><b>(2)</b>
}
async <span class="keyword">function</span> <span class="function">displayAllMessages</span>() {                                                          <i class="conum" data-value="3"></i><b>(3)</b>
  const storedMessages = await api.getStoredMessages();                                        <i class="conum" data-value="4"></i><b>(4)</b>
  const messagesAsString = storedMessages.map((msg) =&gt; <span class="error">`</span><span class="tag">&lt;li&gt;</span>${JSON.stringify(msg)}<span class="tag">&lt;/li&gt;</span><span class="error">`</span>);     <i class="conum" data-value="5"></i><b>(5)</b>
  document.getElementById(<span class="string"><span class="delimiter">'</span><span class="content">result-container</span><span class="delimiter">'</span></span>).innerHTML = messagesAsString.join(<span class="string"><span class="delimiter">'</span><span class="delimiter">'</span></span>);           <i class="conum" data-value="6"></i><b>(6)</b>
}</pre></td>
</tr></table></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Load all messages once connected.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Replace code that writes <code>fullMessage</code> in the HTML by a call to the function below.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Define another function to display all messages.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Call the <em>cloud function</em> to retrieve all stored messages in database. This is the
important part of the code because it calls a <em>cloud function</em> freshly written.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Convert object of values to a JSON string.</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>Write all stored messages in the HTML.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Save your file and reload your web page. You can enter a message ("foo" for example) and a number
of repetitions (5 for example). Then hit the 'say something' button. Now you will see something like:</p>
</div>
<div class="paragraph">
<p><code>{"message":"foo - ","times":5,"fullMessage":"foo - foo - foo - foo - foo - "}</code></p>
</div>
<div class="paragraph">
<p>This means that your <em>custom cloud service</em> has been reloaded and the <code>Stack</code> service
is really used. You can ensure that by reloading the web page, you will see the message
displayed in the web page.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Import npm module</div>
<div class="paragraph">
<p>As you can see, you can add a npm module even if your application is running
and then import it in your code. The hot reload takes effect only when
you update the code handled by the ZetaPush worker (i.e. your <em>custom cloud services</em> code).</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Hot reload with <em>built-in cloud services</em></div>
<div class="paragraph">
<p>Thanks to dependency injection, ZetaPush worker can detect if a <em>built-in cloud service</em>
is newly needed as a dependency. In fact, the worker keeps tracking of all dependencies to <em>built-in cloud services</em>
and check if a new service is asked. If so, the worker creates it on ZetaPush cloud,
instantiates it, and injects it everywhere it is needed.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<i class="fa icon-caution" title="Caution"></i>
</td>
<td class="content">
<div class="title">Hot reload on other files</div>
<div class="paragraph">
<p>Currently, if you update <code>.zetarc</code> or you update a configuration file or any other file
that is not code loaded by the worker, your <em>custom cloud services</em> won&#8217;t be automatically reloaded.</p>
</div>
<div class="paragraph">
<p>This feature will be supported in a future version.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2018-12-18 09:26:37 UTC
</div>
</div>
</body>
</html>