<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 1.5.6.1">
<title>Untitled</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<link rel="stylesheet" href="./asciidoctor.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.min.css">
<link rel="stylesheet" href="./coderay-asciidoctor.css">
<script type="text/javascript" src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
<script type="text/javascript" src="//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/js/bootstrap.min.js"></script>
<script type="text/javascript" src="../..//javascripts/menu.js"></script>
<script type="text/javascript" src="../..//javascripts/sidebar.js"></script>
<script type="text/javascript" src="../..//javascripts/steps.js"></script>
<script type="text/javascript" src="../..//javascripts/sourcecode/source-utils.js"></script>
<script type="text/javascript" src="../..//javascripts/sourcecode/highlight-lines.js"></script>
<script type="text/javascript" src="../..//javascripts/sourcecode/collapse-lines.js"></script>
<script type="text/javascript" src="../..//javascripts/tabcontainer.js"></script>
<script type="text/javascript" src="//unpkg.com/clipboard@2.0.0/dist/clipboard.min.js"></script>
<script type="text/javascript" src="../..//javascripts/clipboard.js"></script>
<script src="https://cdn.jsdelivr.net/npm/instantsearch.js@2.3/dist/instantsearch.min.js"></script>
<script type="text/javascript" src="../..//javascripts/search.js"></script>
<!-- <link rel="stylesheet" type="text/css" href="http://netdna.bootstrapcdn.com/bootswatch/2.3.2/united/bootstrap.min.css" />
  <link rel="stylesheet" type="text/css" href="http://netdna.bootstrapcdn.com/twitter-bootstrap/2.3.1/css/bootstrap-responsive.min.css"
  /> -->
<link href="//fonts.googleapis.com/css?family=Open+Sans:300,400,600,800" rel="stylesheet">
<link rel="stylesheet" type="text/css" href="../..//styles/zetapush-styles.css" />
<link rel="stylesheet" type="text/css" href="../..//styles/custom-styles.css" />
<link rel="stylesheet" type="text/css" href="../..//styles/tabcontainer.css" />
<link rel="stylesheet" type="text/css" href="../..//styles/steps.css" />
<link rel="stylesheet" type="text/css" href="../..//styles/sourcecode/collapse-lines.css" />
<link rel="stylesheet" type="text/css" href="../..//styles/sourcecode/highlight-lines.css" />
<link rel="stylesheet" type="text/css" href="../..//styles/clipboard.css" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/instantsearch.js@2.3/dist/instantsearch.min.css">
<script type="text/html" id="hit-template">
  <div class="hit">
    <div class="hit-content">
      <div class="context">
        <a href="{{sourceFile.url}}">{{sourceFile.title}}</a>
        {{#parents}}
          <a href="{{url}}">{{title}}</a>
        {{/parents}}
        <a href="{{url}}">{{{_highlightResult.title.value}}}</a>
      </div>
      <pre class="hit-description">{{{_highlightResult.content.value}}}</pre>
    </div>
  </div>
</script>
<header>
  <nav>
    <div class="main-title"><span></span><i class="fa fa-caret-down"></i></div>
    <ul>
      <li><a href="/documentation"><span>ZetaPush documentation</span><i class="fa fa-angle-right"></i></a></li>
      <li><a href="/documentation/getting-started.html"><span>Getting Started</span><i class="fa fa-angle-right"></i></a></li>
      <li><a href="/documentation/developer-manual.html"><span>Developer manual</span><i class="fa fa-angle-right"></i></a></li>
      <li><a href="/documentation/how-to.html"><span>How to guides</span><i class="fa fa-angle-right"></i></a></li>
      <li><a href="/documentation/tutorials.html"><span>Tutorials</span><i class="fa fa-angle-right"></i></a></li>
      <li><a href="/documentation/reference.html"><span>Reference</span><i class="fa fa-angle-right"></i></a></li>
      <li><a href="http://docv2.zetapush.com"><span>Documentation v2</span><i class="fa fa-angle-right"></i></a></li>
    </ul>
    <div>
      <div class="contact-us">
        <a href="https://www.zetapush.com/contact" target="_blank">Contact us</a>
      </div>
      <div class="github">
        <a href="https://github.com/zetapush" target="_blank">
          <span>Join us on</span><i class="fa fa-github-alt" title="Github"></i></a>
      </div>
      <div class="search">
        <input id="search-input" placeholder="Search for products">
        <div class="search-results">
          <div id="search-hits"></div>
        </div>
      </div>
      <div class="logo">
        <a href="https://www.zetapush.com"><span class="icon"></span></a>
      </div>
    </div>
  </nav>
</header>
</head>
<body class="book">
<div id="header">
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>ZetaPush manages scalability and redundancy of your <em>workers</em>. So there may have several workers that start at the same time. And if you initialize some data or configure some cloud services at the same time, it may have conflicts or duplicated data. To avoid that ZetaPush provides a way to initialize code that will ensure that is executed by only one worker.</p>
</div>
<div class="paragraph">
<p>For this, ZetaPush provides the <em>bootstrap</em> feature. To use it you need to implement the method <code>onApplicationBootstrap()</code> in your <em>custom cloud service</em>.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Bad practice for initialization code</div>
<div class="paragraph">
<p>You may want to put your initialization code in the constructor but this is a bad practice.
Indeed, even if in the most cases, a <em>custom cloud service</em> is a <a href="https://en.wikipedia.org/wiki/Singleton_pattern">singleton</a>, it may have several instances of your <em>custom cloud service</em> and your initialization code will be called many times. An other drawback is that the constructor is synchronous and the <code>onApplicationBootstrap</code> method is asynchronous (You can also put synchronous code in your <code>onApplicationBootstrap</code> with the <code>await</code> keyword).</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In the following example we will create a worker to store data in a database. The initialization code let you create a table in our database. Then we will create methods to add and list our data.</p>
</div>
<div class="listingblock">
<div class="title">Initialization code</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
</pre></td>
  <td class="code"><pre><span class="reserved">import</span> { Injectable, Bootstrappable } from <span class="string"><span class="delimiter">'</span><span class="content">@zetapush/core</span><span class="delimiter">'</span></span>;
<span class="reserved">import</span> { GdaConfigurer, Gda, GdaDataType } from <span class="string"><span class="delimiter">'</span><span class="content">@zetapush/platform-legacy</span><span class="delimiter">'</span></span>;

const NAME_TABLE = <span class="string"><span class="delimiter">'</span><span class="content">table</span><span class="delimiter">'</span></span>;
const NAME_COLUMN = <span class="string"><span class="delimiter">'</span><span class="content">column</span><span class="delimiter">'</span></span>;

<span class="error">@</span>Injectable()
<span class="reserved">export</span> <span class="keyword">default</span> <span class="reserved">class</span> <span class="reserved">implements</span> Bootstrappable {                              <i class="conum" data-value="1"></i><b>(1)</b>
  constructor(<span class="reserved">private</span> gdaConfigurer: GdaConfigurer, <span class="reserved">private</span> gda: Gda) {}

  async onApplicationBootstrap() {                                            <i class="conum" data-value="2"></i><b>(2)</b>
    <span class="local-variable">this</span>.gdaConfigurer.createTable({                                          <i class="conum" data-value="3"></i><b>(3)</b>
      <span class="key">name</span>: NAME_TABLE,
      <span class="key">columns</span>: [{
        <span class="key">name</span>: NAME_COLUMN,
        <span class="key">type</span>: GdaDataType.STRING
      }]
    });
  }

  async addData(data: string) {
    <span class="keyword">return</span> await <span class="local-variable">this</span>.gda.put({
      <span class="key">table</span>: NAME_TABLE,
      <span class="key">column</span>: NAME_COLUMN,
      data,
      <span class="key">key</span>: Date.now().toString()
    });
  }

  async getData() {
    <span class="keyword">return</span> await <span class="local-variable">this</span>.gda.list({
      <span class="key">table</span>: NAME_TABLE
    });
  }
}</pre></td>
</tr></table></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>We implement the <code>Bootstrappable</code> interface. This is optional (see below)</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The <code>onApplicationBootstrap()</code> method is always <em>asynchronous</em>, the <code>async</code> keyword is optional</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>In our initialization code we create a table in our database</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Bootstrappable interface</div>
<div class="paragraph">
<p>The implementation of the <code>Bootstrappable</code> interface is optional but it is a best practice, you just need to implement a method named <code>onApplicationBootstrap()</code>.
Indeed, implementing it avoids you to write wrong implementation of <code>onApplicationBootstrap()</code> method. It also indicates to other developers that you really wanted to add initialization code to your <em>cloud service</em> on purpose and it also provides documentation about <code>onApplicationBootstrap</code> method directly in code.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You can implement the <code>onApplicationBootstrap()</code> method in several <em>custom cloud services</em>.
A dependency tree will be created to execute all <code>onApplicationBootstrap()</code> methods in the proper order (regarding of the needed dependencies).</p>
</div>
<div class="paragraph">
<p>For example in the following scheme, we have 2 exposed API named <em>Dashboard</em> and <em>Mobile</em>.
For the case of the <em>Dashboard</em> API, it uses another service named <em>Admin</em>, that uses <em>User Management</em> and <em>Stock Management</em> services and so on.</p>
</div>
<div class="paragraph">
<p>So the services are initialized in a specific order :</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Utils</p>
</li>
<li>
<p>User Data / Stock Data</p>
</li>
<li>
<p>User Management / Stock Management / Stock Market</p>
</li>
<li>
<p>Admin / Client API / Guest Access</p>
</li>
<li>
<p>Dashboard / Mobile</p>
</li>
</ol>
</div>
<div class="imageblock center">
<div class="content">
<img src="../../images//schemas/bootstrap_order.png" alt="bootstrap order">
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2019-01-11 19:47:14 UTC
</div>
</div>
</body>
</html>