<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 1.5.6.1">
<title>Log using local console</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<link rel="stylesheet" href="./asciidoctor.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.min.css">
<link rel="stylesheet" href="./coderay-asciidoctor.css">
<script type="text/javascript" src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
<script type="text/javascript" src="//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/js/bootstrap.min.js"></script>
<script type="text/javascript" src="../..//javascripts/menu.js"></script>
<script type="text/javascript" src="../..//javascripts/sidebar.js"></script>
<script type="text/javascript" src="../..//javascripts/steps.js"></script>
<script type="text/javascript" src="../..//javascripts/sourcecode/source-utils.js"></script>
<script type="text/javascript" src="../..//javascripts/sourcecode/highlight-lines.js"></script>
<script type="text/javascript" src="../..//javascripts/sourcecode/collapse-lines.js"></script>
<script type="text/javascript" src="../..//javascripts/tabcontainer.js"></script>
<script type="text/javascript" src="//unpkg.com/clipboard@2.0.0/dist/clipboard.min.js"></script>
<script type="text/javascript" src="../..//javascripts/clipboard.js"></script>
<script src="https://cdn.jsdelivr.net/npm/instantsearch.js@2.3/dist/instantsearch.min.js"></script>
<script type="text/javascript" src="../..//javascripts/search.js"></script>
<!-- <link rel="stylesheet" type="text/css" href="http://netdna.bootstrapcdn.com/bootswatch/2.3.2/united/bootstrap.min.css" />
  <link rel="stylesheet" type="text/css" href="http://netdna.bootstrapcdn.com/twitter-bootstrap/2.3.1/css/bootstrap-responsive.min.css"
  /> -->
<link href="//fonts.googleapis.com/css?family=Open+Sans:300,400,600,800" rel="stylesheet">
<link rel="stylesheet" type="text/css" href="../..//styles/zetapush-styles.css" />
<link rel="stylesheet" type="text/css" href="../..//styles/custom-styles.css" />
<link rel="stylesheet" type="text/css" href="../..//styles/tabcontainer.css" />
<link rel="stylesheet" type="text/css" href="../..//styles/steps.css" />
<link rel="stylesheet" type="text/css" href="../..//styles/sourcecode/collapse-lines.css" />
<link rel="stylesheet" type="text/css" href="../..//styles/sourcecode/highlight-lines.css" />
<link rel="stylesheet" type="text/css" href="../..//styles/clipboard.css" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/instantsearch.js@2.3/dist/instantsearch.min.css">
<script type="text/html" id="hit-template">
  <div class="hit">
    <div class="hit-content">
      <div class="context">
        <a href="{{sourceFile.url}}">{{sourceFile.title}}</a>
        {{#parents}}
          <a href="{{url}}">{{title}}</a>
        {{/parents}}
        <a href="{{url}}">{{{_highlightResult.title.value}}}</a>
      </div>
      <pre class="hit-description">{{{_highlightResult.content.value}}}</pre>
    </div>
  </div>
</script>
<header>
  <nav>
    <div class="main-title"><span></span><i class="fa fa-caret-down"></i></div>
    <ul>
      <li><a href="/documentation"><span>ZetaPush documentation</span><i class="fa fa-angle-right"></i></a></li>
      <li><a href="/documentation/getting-started.html"><span>Getting Started</span><i class="fa fa-angle-right"></i></a></li>
      <li><a href="/documentation/developer-manual.html"><span>Developer manual</span><i class="fa fa-angle-right"></i></a></li>
      <li><a href="/documentation/how-to.html"><span>How to guides</span><i class="fa fa-angle-right"></i></a></li>
      <li><a href="/documentation/tutorials.html"><span>Tutorials</span><i class="fa fa-angle-right"></i></a></li>
      <li><a href="/documentation/reference.html"><span>Reference</span><i class="fa fa-angle-right"></i></a></li>
      <li><a href="http://docv2.zetapush.com"><span>Documentation v2</span><i class="fa fa-angle-right"></i></a></li>
    </ul>
    <div>
      <div class="contact-us">
        <a href="https://spectrum.chat/zetapush" target="_blank">Contact us</a>
      </div>
      <div class="github">
        <a href="https://github.com/zetapush" target="_blank">
          <span>Join us on</span><i class="fa fa-github-alt" title="Github"></i></a>
      </div>
      <div class="search">
        <input id="search-input" placeholder="Search for products">
        <div class="search-results">
          <div id="search-hits"></div>
        </div>
      </div>
      <div class="logo">
        <a href="https://zetapush.com"><span class="icon"></span></a>
      </div>
    </div>
  </nav>
</header>
</head>
<body class="book toc2 toc-left">
<div id="header">
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_log_using_local_console">Log using local console</a></li>
<li><a href="#_log_using_zetapush_em_built_in_cloud_service_em">Log using ZetaPush <em>built-in cloud service</em></a></li>
</ul>
</div>
</div>
<div id="content">
<div class="sect1">
<h2 id="_log_using_local_console"><a class="anchor" href="#_log_using_local_console"></a>Log using local console</h2>
<div class="sectionbody">
<div class="paragraph">
<p>NodeJS provides <code>console</code> object that you can use in your code. For example, update
the code of your <em>custom cloud service</em> to add some logs:</p>
</div>
<div class="listingblock highlight-lines:13,18,29">
<div class="title">worker/index.ts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
</pre></td>
  <td class="code"><pre><span class="reserved">import</span> { Injectable } from <span class="string"><span class="delimiter">'</span><span class="content">@zetapush/core</span><span class="delimiter">'</span></span>;
<span class="reserved">import</span> { Stack } from <span class="string"><span class="delimiter">'</span><span class="content">@zetapush/platform-legacy</span><span class="delimiter">'</span></span>;

<span class="error">@</span>Injectable()
<span class="reserved">export</span> <span class="keyword">default</span> <span class="reserved">class</span> HelloWorldAsCustomCloudService {
  constructor(<span class="reserved">private</span> stack: Stack) {}

  helloWorld() {
    <span class="keyword">return</span> <span class="string"><span class="delimiter">'</span><span class="content">Hello World</span><span class="delimiter">'</span></span>;
  }

  async saySomething(message: string, <span class="key">times</span>: number) {
    console.log(<span class="string"><span class="delimiter">'</span><span class="content">message=</span><span class="delimiter">'</span></span>, message, <span class="string"><span class="delimiter">'</span><span class="content">times=</span><span class="delimiter">'</span></span>, times);
    let fullMessage = <span class="string"><span class="delimiter">'</span><span class="delimiter">'</span></span>;
    <span class="keyword">for</span> (let i = <span class="integer">0</span>; i &lt; times; i++) {
      fullMessage += <span class="error">`</span><span class="predefined">$</span>{message}<span class="error">\</span>n<span class="error">`</span>;
    }
    console.debug(<span class="string"><span class="delimiter">'</span><span class="content">fullMessage=</span><span class="delimiter">'</span></span>, fullMessage);
    <span class="comment">// store source information (message and times)</span>
    <span class="comment">// and generated information (fullMessage)</span>
    const response = await <span class="local-variable">this</span>.stack.push({
      <span class="key">stack</span>: <span class="string"><span class="delimiter">'</span><span class="content">messages</span><span class="delimiter">'</span></span>,
      <span class="key">data</span>: {
        message,
        times,
        fullMessage
      }
    });
    console.debug(<span class="string"><span class="delimiter">'</span><span class="content">stack.push response=</span><span class="delimiter">'</span></span>, response);
    <span class="keyword">return</span> fullMessage;
  }

  async getStoredMessages() {
    <span class="comment">// get all values</span>
    const response = await <span class="local-variable">this</span>.stack.list({
      <span class="key">stack</span>: <span class="string"><span class="delimiter">'</span><span class="content">messages</span><span class="delimiter">'</span></span>
    });
    <span class="comment">// get only useful part (message, times, fullMessage)</span>
    <span class="keyword">return</span> response.result ? response.result.content.map((item) =&gt; item.data) : [];
  }
}</pre></td>
</tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>Running your application and hitting 'say something' button with a "hello" message and 5 repetitions,
your terminal will print something like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="console">[INFO] Worker is up!  â€Œ
message= hello -  times= 5                                                          <i class="conum" data-value="1"></i><b>(1)</b>
fullMessage= hello -                                                                <i class="conum" data-value="2"></i><b>(2)</b>
hello -
hello -
hello -
hello -

stack.push response= { contextId: '3303/4rU/4934',                                  <i class="conum" data-value="3"></i><b>(3)</b>
  owner: 'v79ivn00l:root',
  stack: 'messages',
  ts: 1544096927555,
  guid: '///+mHymsL1sq8jZZa1F2g==',
  data:
   { message: 'hello - ',
     times: 5,
     fullMessage: 'hello - \nhello - \nhello - \nhello - \nhello - \n' } }</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The first <code>console.log</code> that displays parameters</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The first <code>console.debug</code> that displays the generated message</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The second <code>console.debug</code> that displays the response of the <code>Stack</code> service</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>As you can see, you can have any number of parameters you want and of any type.
For objects, the <code>console</code> will display it as JSON string.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="title">Logs in production</div>
<div class="paragraph">
<p>Logging using <code>console</code> only logs in your terminal. It means that nothing is neither written to a file
nor sent to a logging server. You will then loose all logs if you close your terminal.</p>
</div>
<div class="paragraph">
<p>However, when you will later publish your application on the ZetaPush cloud, everything
written in standard and error outputs will be available in the
<a href="../../reference.html#logs_in_web_console">ZetaPush web console</a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Levels and colors in local console</div>
<div class="paragraph">
<p>ZetaPush also provides a logger object that can be useful to distinguish levels.
Levels are explicitly written (for example <code>[INFO]</code>). Each level has its own
name displayed in color and may have a color for the message too.
This is useful to quickly view what is important.</p>
</div>
<div class="paragraph">
<p>You can learn <a href="../../reference.html#local_logger">how to use the local logger</a>.</p>
</div>
<div class="paragraph">
<p>Moreover, thanks to levels you <a href="../../reference.html#verbosity_level">can start your application with a particular level</a>
so levels below the selected level are not displayed at all.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_log_using_zetapush_em_built_in_cloud_service_em"><a class="anchor" href="#_log_using_zetapush_em_built_in_cloud_service_em"></a>Log using ZetaPush <em>built-in cloud service</em></h2>
<div class="sectionbody">
<div class="paragraph">
<p>In order to provide a logger with more features, ZetaPush provides the <a href="../../reference.html#_logs"><code>Logs</code> cloud service</a>.
Thanks to this service you can provide more context to your log entries (a logger name, levels, tags or an identifier, &#8230;&#8203;).</p>
</div>
<div class="paragraph">
<p>The service <a href="../../reference.html#log_service">can be used directly</a> but code for logging may be a quite verbose if you provide
all information manually.</p>
</div>
<div class="paragraph">
<p>So ZetaPush also provides an automatic logging feature that magically adds:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>the name of the called <em>cloud function</em></p>
</li>
<li>
<p>the parameter values of the called <em>cloud function</em></p>
</li>
<li>
<p>the returned value of the called <em>cloud function</em></p>
</li>
<li>
<p>the current date</p>
</li>
<li>
<p>the unique identifier of the request</p>
</li>
<li>
<p>which user has made the call</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>It also automatically logs all calls to <em>builtin cloud services</em> that could be
made in the <em>cloud function</em>.</p>
</div>
<div class="listingblock highlight-lines:1,5,6,19,30">
<div class="title">worker/index.ts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
</pre></td>
  <td class="code"><pre><span class="reserved">import</span> { Injectable, RequestContextAware, RequestContext } from <span class="string"><span class="delimiter">'</span><span class="content">@zetapush/core</span><span class="delimiter">'</span></span>;     <i class="conum" data-value="1"></i><b>(1)</b>
<span class="reserved">import</span> { Stack } from <span class="string"><span class="delimiter">'</span><span class="content">@zetapush/platform-legacy</span><span class="delimiter">'</span></span>;

<span class="error">@</span>Injectable()
<span class="reserved">export</span> <span class="keyword">default</span> <span class="reserved">class</span> HelloWorldAsCustomCloudService <span class="reserved">implements</span> RequestContextAware {  <i class="conum" data-value="2"></i><b>(2)</b>
  requestContext!: RequestContext;                                                    <i class="conum" data-value="3"></i><b>(3)</b>

  constructor(<span class="reserved">private</span> stack: Stack) {}

  helloWorld() {
    <span class="keyword">return</span> <span class="string"><span class="delimiter">'</span><span class="content">Hello World</span><span class="delimiter">'</span></span>;
  }

  async saySomething(message: string, <span class="key">times</span>: number) {
    let fullMessage = <span class="string"><span class="delimiter">'</span><span class="delimiter">'</span></span>;
    <span class="keyword">for</span> (let i = <span class="integer">0</span>; i &lt; times; i++) {
      fullMessage += <span class="error">`</span><span class="predefined">$</span>{message}<span class="error">\</span>n<span class="error">`</span>;
    }
    <span class="local-variable">this</span>.requestContext.logger.debug(<span class="string"><span class="delimiter">'</span><span class="content">fullMessage=</span><span class="delimiter">'</span></span>, fullMessage);                           <i class="conum" data-value="4"></i><b>(4)</b>
    <span class="comment">// store source information (message and times)</span>
    <span class="comment">// and generated information (fullMessage)</span>
    const response = await <span class="local-variable">this</span>.stack.push({
      <span class="key">stack</span>: <span class="string"><span class="delimiter">'</span><span class="content">messages</span><span class="delimiter">'</span></span>,
      <span class="key">data</span>: {
        message,
        times,
        fullMessage
      }
    });
    <span class="local-variable">this</span>.requestContext.logger.debug(<span class="string"><span class="delimiter">'</span><span class="content">stack.push response=</span><span class="delimiter">'</span></span>, response);                      <i class="conum" data-value="5"></i><b>(5)</b>
    <span class="keyword">return</span> fullMessage;
  }

  async getStoredMessages() {
    <span class="comment">// get all values</span>
    const response = await <span class="local-variable">this</span>.stack.list({
      <span class="key">stack</span>: <span class="string"><span class="delimiter">'</span><span class="content">messages</span><span class="delimiter">'</span></span>
    });
    <span class="comment">// get only useful part (message, times, fullMessage)</span>
    <span class="keyword">return</span> response.result ? response.result.content.map((item) =&gt; item.data) : [];
  }
}</pre></td>
</tr></table></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Import <code>RequestContext</code> and <code>RequestContextAware</code> from <code>@zetapush/core</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Implements <code>RequestContextAware</code> to indicate that we use <code>requestContext</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td><code>requestContext</code> magic property that is automatically provided by the worker. No need to initialize it.
The <code>!</code> character is here to guide TypeScript otherwise there is a compilation error because
<code>requestContext</code> is not initialized.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Calls logger of <code>requestContext</code> to log <code>fullMessage</code></td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Calls logger of <code>requestContext</code> to log <code>response</code></td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">RequestContextAware</div>
<div class="paragraph">
<p>Implementing <code>RequestContextAware</code> is totally optional but recommended even if it works
without it.
If you work in team, it indicates to other developers that
the use of <code>requestContext</code> attribute is intentional and that it is not dead code.
Moreover, implementing this interface gives you some documentation about <code>requestContext</code>
attribute.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Definite Assignment Assertions</div>
<div class="paragraph">
<p>TypeScript checks that a
<a href="https://github.com/Microsoft/TypeScript/wiki/What&#8217;s-new-in-TypeScript#strict-class-initialization" target="_blank" rel="noopener">class attribute is initialized</a>.</p>
</div>
<div class="paragraph">
<p>As <code>requestContext</code> is an injected attribute, its value is not directly initialized in your class.
The <a href="https://github.com/Microsoft/TypeScript/wiki/What&#8217;s-new-in-TypeScript#definite-assignment-assertions" target="_blank" rel="noopener">Definite Assignment Assertions</a>
allows to explicitly indicate to TypeScript type checker that
the attribute is initialized outside of the class (using <code>!</code> character after attribute name).</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Internally, the logger uses the <em>Logs cloud service</em>. The logs are by default sent to
ZetaPush cloud and then available in ZetaPush web console. The ZetaPush worker is aware
of the current context. So every log entry is enhanced with current context call.</p>
</div>
<div class="paragraph">
<p>For the example, start your application and hit the 'say something' button.
Here is the result of the logs in the web console:</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Advanced usage</div>
<div class="paragraph">
<p>You can find more information about <a href="../../reference.html#log_with_requestcontext">advance usage of the logger provided by <code>RequestContext</code></a>
in reference documentation.</p>
</div>
<div class="paragraph">
<p>You can also learn how to <a href="../../reference.html#persist_logs">persist logs</a> and how to <a href="../../reference.html#custom_logging_server">send logs to a custom log server</a>.</p>
</div>
<div class="paragraph">
<p>You can learn how to <a href="../../reference.html#use_custom_tags">use custom tags</a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Integration with libraries</div>
<div class="paragraph">
<p>NodeJS community provides several logging libraries like <a href="https://github.com/winstonjs/winston" target="_blank" rel="noopener">winston</a>,
<a href="https://github.com/trentm/node-bunyan" target="_blank" rel="noopener">bunyan</a>, <a href="https://github.com/expressjs/morgan" target="_blank" rel="noopener">morgan</a>, &#8230;&#8203;</p>
</div>
<div class="paragraph">
<p>Currently, you can use them to log into the local console but as said before, the current
context is not automatically provided.
In the futur, ZetaPush will provide bridges to fully support those libraries to automatically
provide the current context.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2018-12-18 09:26:37 UTC
</div>
</div>
</body>
</html>