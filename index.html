<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 1.5.6.1">
<meta name="author" content="0.0.1-SNAPSHOT">
<title>ZetaPush documentation</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<link rel="stylesheet" href="./asciidoctor.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.min.css">
<link rel="stylesheet" href="./coderay-asciidoctor.css">
<script type="text/javascript" src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
<script type="text/javascript" src="//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/js/bootstrap.min.js"></script>
<script type="text/javascript" src=".//javascripts/menu.js"></script>
<script type="text/javascript" src=".//javascripts/sidebar.js"></script>
<script type="text/javascript" src=".//javascripts/steps.js"></script>
<script type="text/javascript" src=".//javascripts/sourcecode/source-utils.js"></script>
<script type="text/javascript" src=".//javascripts/sourcecode/highlight-lines.js"></script>
<script type="text/javascript" src=".//javascripts/sourcecode/collapse-lines.js"></script>
<script type="text/javascript" src=".//javascripts/tabcontainer.js"></script>
<script type="text/javascript" src="//unpkg.com/clipboard@2.0.0/dist/clipboard.min.js"></script>
<script type="text/javascript" src=".//javascripts/clipboard.js"></script>
<script src="https://cdn.jsdelivr.net/npm/instantsearch.js@2.3/dist/instantsearch.min.js"></script>
<script type="text/javascript" src=".//javascripts/search.js"></script>
<!-- <link rel="stylesheet" type="text/css" href="http://netdna.bootstrapcdn.com/bootswatch/2.3.2/united/bootstrap.min.css" />
  <link rel="stylesheet" type="text/css" href="http://netdna.bootstrapcdn.com/twitter-bootstrap/2.3.1/css/bootstrap-responsive.min.css"
  /> -->
<link href="//fonts.googleapis.com/css?family=Open+Sans:300,400,600,800" rel="stylesheet">
<link rel="stylesheet" type="text/css" href=".//styles/zetapush-styles.css" />
<link rel="stylesheet" type="text/css" href=".//styles/custom-styles.css" />
<link rel="stylesheet" type="text/css" href=".//styles/tabcontainer.css" />
<link rel="stylesheet" type="text/css" href=".//styles/steps.css" />
<link rel="stylesheet" type="text/css" href=".//styles/sourcecode/collapse-lines.css" />
<link rel="stylesheet" type="text/css" href=".//styles/sourcecode/highlight-lines.css" />
<link rel="stylesheet" type="text/css" href=".//styles/clipboard.css" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/instantsearch.js@2.3/dist/instantsearch.min.css">
<script type="text/html" id="hit-template">
  <div class="hit">
    <div class="hit-content">
      <div class="context">
        <a href="{{sourceFile.url}}">{{sourceFile.title}}</a>
        {{#parents}}
          <a href="{{url}}">{{title}}</a>
        {{/parents}}
        <a href="{{url}}">{{{_highlightResult.title.value}}}</a>
      </div>
      <pre class="hit-description">{{{_highlightResult.content.value}}}</pre>
    </div>
  </div>
</script>
<header>
  <nav>
    <div class="main-title"><span></span><i class="fa fa-caret-down"></i></div>
    <ul>
      <li><a href="/documentation"><span>ZetaPush documentation</span><i class="fa fa-angle-right"></i></a></li>
      <li><a href="/documentation/getting-started.html"><span>Getting Started</span><i class="fa fa-angle-right"></i></a></li>
      <li><a href="/documentation/developer-manual.html"><span>Developer manual</span><i class="fa fa-angle-right"></i></a></li>
      <li><a href="/documentation/how-to.html"><span>How to guides</span><i class="fa fa-angle-right"></i></a></li>
      <li><a href="/documentation/tutorials.html"><span>Tutorials</span><i class="fa fa-angle-right"></i></a></li>
      <li><a href="/documentation/reference.html"><span>Reference</span><i class="fa fa-angle-right"></i></a></li>
      <li><a href="http://docv2.zetapush.com"><span>Documentation v2</span><i class="fa fa-angle-right"></i></a></li>
    </ul>
    <div>
      <div class="contact-us">
        <a href="https://www.zetapush.com/contact" target="_blank">Contact us</a>
      </div>
      <div class="github">
        <a href="https://github.com/zetapush" target="_blank">
          <span>Join us on</span><i class="fa fa-github-alt" title="Github"></i></a>
      </div>
      <div class="search">
        <input id="search-input" placeholder="Search for products">
        <div class="search-results">
          <div id="search-hits"></div>
        </div>
      </div>
      <div class="logo">
        <a href="https://www.zetapush.com"><span class="icon"></span></a>
      </div>
    </div>
  </nav>
</header>
</head>
<body class="book toc2 toc-left">
<div id="header">
<h1>ZetaPush documentation</h1>
<div class="details">
<span id="author" class="author">0.0.1-SNAPSHOT</span><br>
</div>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel0">
<li><a href="#_introduction">Introduction</a>
<ul class="sectlevel1">
<li><a href="#_zetapush_celtia">1. ZetaPush Celtia</a></li>
<li><a href="#_sections">2. Sections</a></li>
<li><a href="#_terms_and_concepts">3. Terms and concepts</a></li>
</ul>
</li>
<li><a href="#_getting_started">Getting Started</a>
<ul class="sectlevel1">
<li><a href="#_system_requirements">4. System requirements</a></li>
<li><a href="#_create_your_first_application">5. Create your first application</a>
<ul class="sectlevel2">
<li><a href="#_from_the_command_line">5.1. From the command line</a></li>
<li><a href="#_generated_application">5.2. Generated application</a>
<ul class="sectlevel3">
<li><a href="#_what_it_does">5.2.1. What it does ?</a></li>
<li><a href="#_structure_of_generated_project">5.2.2. Structure of generated project</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_run_locally_your_first_application">6. Run locally your first application</a>
<ul class="sectlevel2">
<li><a href="#_what_is_run">6.1. What is run ?</a></li>
<li><a href="#_from_your_terminal">6.2. From your terminal</a></li>
<li><a href="#_how_it_works">6.3. How it works</a></li>
</ul>
</li>
<li><a href="#_push_your_first_application_in_the_cloud">7. Push your first application in the Cloud</a>
<ul class="sectlevel2">
<li><a href="#_what_is_push">7.1. What is push ?</a></li>
<li><a href="#_from_your_terminal_2">7.2. From your terminal</a></li>
<li><a href="#_how_it_works_2">7.3. How it works</a></li>
</ul>
</li>
<li><a href="#_what_s_next">8. What&#8217;s next</a></li>
</ul>
</li>
<li><a href="#_developer_manual">Developer manual</a>
<ul class="sectlevel1">
<li><a href="#_requirements">9. Requirements</a>
<ul class="sectlevel2">
<li><a href="#_system_requirements_2">9.1. System requirements</a></li>
<li><a href="#_using_cli">9.2. Using CLI</a>
<ul class="sectlevel3">
<li><a href="#_use_npm_script_aliases_to_run_the_em_cli_em">9.2.1. Use npm script aliases to run the <em>CLI</em></a></li>
<li><a href="#_use_em_cli_em_directly">9.2.2. Use <em>CLI</em> directly</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_zetapush_concepts">10. ZetaPush concepts</a>
<ul class="sectlevel2">
<li><a href="#_create_your_account">10.1. Create your account</a></li>
</ul>
</li>
<li><a href="#develop_front_with_zetapush">11. Develop your front with ZetaPush</a></li>
<li><a href="#develop_business_logic">12. Develop your business logic</a>
<ul class="sectlevel2">
<li><a href="#_what_is_a_em_custom_cloud_service_em">12.1. What is a <em>custom cloud service</em></a>
<ul class="sectlevel3">
<li><a href="#_architecture">12.1.1. Architecture</a></li>
</ul>
</li>
<li><a href="#_develop_a_em_custom_cloud_services_em">12.2. Develop a <em>custom cloud services</em></a>
<ul class="sectlevel3">
<li><a href="#_define_a_em_custom_cloud_service_em">12.2.1. Define a <em>custom cloud service</em></a></li>
<li><a href="#_expose_a_em_custom_cloud_service_em">12.2.2. Expose a <em>custom cloud service</em></a></li>
<li><a href="#_use_a_em_custom_cloud_service_em_in_your_front">12.2.3. Use a <em>custom cloud service</em> in your front</a></li>
<li><a href="#_run_application">12.2.4. Run application</a></li>
<li><a href="#_compose_cloud_services">12.2.5. Compose cloud services</a></li>
</ul>
</li>
<li><a href="#_develop_fast">12.3. Develop fast</a>
<ul class="sectlevel3">
<li><a href="#_hot_reload">12.3.1. Hot reload</a></li>
<li><a href="#_auto_completion">12.3.2. Auto-completion</a></li>
<li><a href="#_log_from_a_em_custom_cloud_service_em">12.3.3. Log from a <em>custom cloud service</em></a></li>
<li><a href="#_debug_a_em_custom_cloud_service_em">12.3.4. Debug a <em>custom cloud service</em></a></li>
<li><a href="#_test_a_em_custom_cloud_service_em">12.3.5. Test a <em>custom cloud service</em></a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_deploy_publish_your_application">13. Deploy/publish your application</a>
<ul class="sectlevel2">
<li><a href="#_what_will_be_deployed">13.1. What will be deployed ?</a>
<ul class="sectlevel3">
<li><a href="#_worker">13.1.1. Worker</a></li>
<li><a href="#_front_end">13.1.2. Front end</a></li>
</ul>
</li>
<li><a href="#_environments">13.2. Environments</a></li>
<li><a href="#_deploy_application_on_the_zetapush_cloud">13.3. Deploy application on the ZetaPush Cloud</a></li>
</ul>
</li>
<li><a href="#integrate_user_management">14. User management in your application</a>
<ul class="sectlevel2">
<li><a href="#_presentation">14.1. Presentation</a></li>
<li><a href="#_quick_start">14.2. Quick start</a>
<ul class="sectlevel3">
<li><a href="#_create_a_zetapush_application_as_usual">14.2.1. Create a ZetaPush application as usual</a></li>
<li><a href="#_import_and_use_the_standard_user_workflow_in_your_worker">14.2.2. Import and use the Standard User Workflow in your worker</a></li>
<li><a href="#_configure_some_properties">14.2.3. Configure some properties</a></li>
<li><a href="#_develop_your_front_by_calling_the_standard_user_workflow_api">14.2.4. Develop your front by calling the Standard User Workflow API</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_store_data_in_your_application">15. Store data in your application</a></li>
<li><a href="#_secure_your_application">16. Secure your application</a></li>
</ul>
</li>
<li><a href="#_tutorials">Tutorials</a>
<ul class="sectlevel1">
<li><a href="#_use_case">17. Use case</a>
<ul class="sectlevel2">
<li><a href="#_initialize_your_application">17.1. Initialize your application</a></li>
<li><a href="#_create_your_business_logic">17.2. Create your business logic</a>
<ul class="sectlevel3">
<li><a href="#_import_em_cloud_services_em_and_define_constants">17.2.1. Import <em>cloud services</em> and define constants</a></li>
<li><a href="#_create_the_class_with_its_constructor">17.2.2. Create the class with its constructor</a></li>
<li><a href="#_create_the_chat">17.2.3. Create the chat</a></li>
<li><a href="#_add_user_to_the_conversation">17.2.4. Add user to the conversation</a></li>
<li><a href="#_send_a_message">17.2.5. Send a message</a></li>
<li><a href="#_get_all_messages">17.2.6. Get all messages</a></li>
</ul>
</li>
<li><a href="#_use_your_em_custom_cloud_services_em">17.3. Use your <em>custom cloud services</em></a>
<ul class="sectlevel3">
<li><a href="#_launch_the_worker_locally">17.3.1. Launch the worker locally</a></li>
<li><a href="#_interaction_with_worker">17.3.2. Interaction with worker</a></li>
</ul>
</li>
<li><a href="#_deploy_your_application">17.4. Deploy your application</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_guides">Guides</a></li>
<li><a href="#_faq">FAQ</a>
<ul class="sectlevel2">
<li><a href="#_do_i_have_to_develop_em_custom_cloud_services_em">1.1. Do I have to develop <em>custom cloud services</em> ?</a></li>
<li><a href="#_can_i_use_zetapush_cli_with_and_npm_version_lower_than_6">1.2. Can I use ZetaPush CLI with and npm version lower than 6 ?</a></li>
<li><a href="#_what_is_the_nodejs_version_used_to_run_my_worker_remotely">1.3. What is the NodeJS version used to run my worker remotely ?</a></li>
<li><a href="#_can_i_use_a_nodejs_version_lower_than_10">1.4. Can I use a NodeJS version lower than 10 ?</a></li>
</ul>
</li>
<li><a href="#_reference">Reference</a>
<ul class="sectlevel1">
<li><a href="#_zetapush_management">18. ZetaPush management</a>
<ul class="sectlevel2">
<li><a href="#_manage_zetapush_account">18.1. Manage ZetaPush account</a>
<ul class="sectlevel3">
<li><a href="#_create_your_account_2">18.1.1. Create your account</a></li>
<li><a href="#_manage_your_profile">18.1.2. Manage your profile</a></li>
<li><a href="#_delete_your_account">18.1.3. Delete your account</a></li>
</ul>
</li>
<li><a href="#manage_organization">18.2. Manage your organization</a></li>
<li><a href="#_manage_applications">18.3. Manage applications</a>
<ul class="sectlevel3">
<li><a href="#add_application">18.3.1. Add an application</a></li>
<li><a href="#access_control_per_application">18.3.2. Access control per application</a></li>
</ul>
</li>
<li><a href="#manage_environments">18.4. Manage environments</a>
<ul class="sectlevel3">
<li><a href="#add_environment">18.4.1. Add an environment</a></li>
<li><a href="#access_control_per_environment">18.4.2. Access control per environment</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_architecture_2">19. Architecture</a>
<ul class="sectlevel2">
<li><a href="#_general_architecture">19.1. General architecture</a></li>
<li><a href="#_zetapush_choices">19.2. ZetaPush choices</a>
<ul class="sectlevel3">
<li><a href="#_high_availability">19.2.1. High availability</a></li>
<li><a href="#_load_balancing">19.2.2. Load-balancing</a></li>
<li><a href="#_scalability">19.2.3. Scalability</a></li>
<li><a href="#_supervision">19.2.4. Supervision</a></li>
<li><a href="#javascript_vs_typescript">19.2.5. JavaScript vs TypeScript</a></li>
</ul>
</li>
<li><a href="#_application_code_structure">19.3. Application code structure</a></li>
</ul>
</li>
<li><a href="#_zetapush_development_concepts">20. ZetaPush development concepts</a>
<ul class="sectlevel2">
<li><a href="#_npm_modules_provided_by_zetapush">20.1. Npm modules provided by ZetaPush</a></li>
<li><a href="#_dependency_injection_2">20.2. Dependency injection</a></li>
<li><a href="#modules">20.3. Modules</a></li>
<li><a href="#_current_running_context">20.4. Current running context</a>
<ul class="sectlevel3">
<li><a href="#_environment">20.4.1. Environment</a></li>
<li><a href="#_configurationproperties">20.4.2. ConfigurationProperties</a></li>
<li><a href="#_zetapushcontext">20.4.3. ZetaPushContext</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_develop_with_zetapush">21. Develop with ZetaPush</a>
<ul class="sectlevel2">
<li><a href="#_develop_your_front_only">21.1. Develop your front only</a>
<ul class="sectlevel3">
<li><a href="#client_types">21.1.1. ZetaPush client</a></li>
<li><a href="#_web_development">21.1.2. Web development</a></li>
<li><a href="#_mobile_development">21.1.3. Mobile development</a></li>
</ul>
</li>
<li><a href="#generate_sdks">21.2. Generate SDKs from custom cloud service code</a></li>
<li><a href="#_develop_custom_cloud_services">21.3. Develop custom cloud services</a></li>
<li><a href="#_advanced_usage_of_cloud_services">21.4. Advanced usage of cloud services</a>
<ul class="sectlevel3">
<li><a href="#several_custom_cloud_services">21.4.1. Several custom cloud services</a></li>
<li><a href="#shared_module">21.4.2. Create a shared module of cloud services</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_available_cloud_services">22. Available cloud services</a>
<ul class="sectlevel2">
<li><a href="#_standard_user_workflow">22.1. Standard User Workflow</a>
<ul class="sectlevel3">
<li><a href="#_usage">22.1.1. Usage</a></li>
<li><a href="#_api">22.1.2. API</a></li>
</ul>
</li>
<li><a href="#builtin_cloud_services">22.2. Technical cloud services</a>
<ul class="sectlevel3">
<li><a href="#_user_management">22.2.1. User Management</a></li>
<li><a href="#_data_management">22.2.2. Data Management</a></li>
<li><a href="#_file_management">22.2.3. File Management</a></li>
<li><a href="#_communication">22.2.4. Communication</a></li>
<li><a href="#_utilities_management">22.2.5. Utilities Management</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_command_line_interface">23. Command Line Interface</a>
<ul class="sectlevel2">
<li><a href="#_config">23.1. Config</a></li>
<li><a href="#_run">23.2. Run</a></li>
<li><a href="#_push_2">23.3. Push</a></li>
<li><a href="#verbosity_level">23.4. Change verbosity</a></li>
</ul>
</li>
<li><a href="#_configuration">24. Configuration</a>
<ul class="sectlevel2">
<li><a href="#_account_configuration">24.1. Account configuration</a></li>
<li><a href="#_code_structure_configuration">24.2. Code structure configuration</a></li>
<li><a href="#configuration_properties">24.3. Configuration properties</a></li>
<li><a href="#_customize_cloud_services">24.4. Customize cloud services</a>
<ul class="sectlevel3">
<li><a href="#_user_management_2">24.4.1. User Management</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_logs_2">25. Logs</a>
<ul class="sectlevel2">
<li><a href="#_console_log">25.1. Console.log</a></li>
<li><a href="#local_logger">25.2. Utility methods provided by @zetapush/common</a></li>
<li><a href="#log_service">25.3. Built-in log cloud service</a></li>
<li><a href="#_logs_using_requestcontext">Logs using requestContext</a></li>
<li><a href="#_use_another_logging_library">25.4. Use another logging library</a></li>
<li><a href="#logs_in_web_console">25.5. View logs in web console</a></li>
<li><a href="#_persist_logs">25.6. Persist logs</a></li>
<li><a href="#_external_log_visualization">25.7. External log visualization</a></li>
</ul>
</li>
<li><a href="#_tests">26. Tests</a>
<ul class="sectlevel2">
<li><a href="#_test_your_custom_cloud_services">26.1. Test your custom cloud services</a>
<ul class="sectlevel3">
<li><a href="#testing_utilities">26.1.1. Testing utilities provided by ZetaPush</a></li>
<li><a href="#_unit_testing_2">26.1.2. Unit testing</a></li>
<li><a href="#integration_testing">26.1.3. Integration testing</a></li>
<li><a href="#e2e_testing">26.1.4. Test your application (end to end)</a></li>
</ul>
</li>
<li><a href="#test_in_typescript">26.2. Write tests in TypeScript</a></li>
<li><a href="#advanced_mocks">26.3. Mocks</a></li>
<li><a href="#test_snapshot">26.4. Initialize test with data</a></li>
<li><a href="#_logs_in_tests">26.5. Logs in tests</a>
<ul class="sectlevel3">
<li><a href="#verbosity_level_in_tests">26.5.1. Verbosity level</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_advanced_run_of_your_application">27. Advanced run of your application</a>
<ul class="sectlevel2">
<li><a href="#run_worker_only">27.1. Run cloud services only</a></li>
<li><a href="#_run_front_only">27.2. Run front only</a></li>
</ul>
</li>
<li><a href="#_advanced_deployment_of_your_application">28. Advanced deployment of your application</a>
<ul class="sectlevel2">
<li><a href="#partial_deployment">28.1. Partial deployment</a></li>
<li><a href="#_environment_variables">28.2. Environment variables</a></li>
<li><a href="#_custom_npm_registry">28.3. Custom npm registry</a></li>
</ul>
</li>
<li><a href="#_http_server">29. HTTP server</a>
<ul class="sectlevel2">
<li><a href="#internal_http_server">29.1. HTTP server provided by ZetaPush</a></li>
<li><a href="#custom_http_server">29.2. Custom HTTP server</a></li>
</ul>
</li>
<li><a href="#_extend_a_cloud_service">30. Extend a cloud service</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<h1 id="_introduction" class="sect0"><a class="anchor" href="#_introduction"></a><a class="link" href="#_introduction">Introduction</a></h1>
<div class="sect1">
<h2 id="_zetapush_celtia"><a class="anchor" href="#_zetapush_celtia"></a><a class="link" href="#_zetapush_celtia">1. ZetaPush Celtia</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>ZetaPush accelerates the creation of connected applications by providing turnkey services. The developer consumes the services needed to run his application using development kits ready to be integrated into his front end code.</p>
</div>
<div class="paragraph">
<p>ZetaPush Celtia represents a major version of ZetaPush with a major change: the developer can write business code in languages such as JavaScript and TypeScript.</p>
</div>
<div class="paragraph">
<p>The developer will focus on his business code and ZetaPush will make his life easier by providing him with all the common components such as user management, data storage, etc.</p>
</div>
<div class="paragraph">
<p>In addition, ZetaPush hosts business code and front-end code.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_sections"><a class="anchor" href="#_sections"></a><a class="link" href="#_sections">2. Sections</a></h2>
<div class="sectionbody">
<table class="tableblock frame-all grid-all spread sections-shortcut">
<colgroup>
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="#_getting_started">Getting Started</a></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="#_tutorials">Tutorials</a></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="#_guides">Guides</a></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="#_developer_manual">Developer Manual</a></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="#_reference">Reference</a></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">If you want to start using ZetaPush quickly</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">If you want to learn how to use ZetaPush Celtia main features, you can begin here</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">If you want to go into some topics in depth</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">If you want to cover completely each topic</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">If you want to search for a particular piece of information</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect1">
<h2 id="_terms_and_concepts"><a class="anchor" href="#_terms_and_concepts"></a><a class="link" href="#_terms_and_concepts">3. Terms and concepts</a></h2>
<div class="sectionbody">
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 20%;">
<col style="width: 80%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-middle">Word</th>
<th class="tableblock halign-left valign-middle">Definition</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-middle"><p class="tableblock">ZetaPush Account</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">A developer account on the ZetaPush platform to create and manage applications.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-middle"><p class="tableblock">Credentials</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">A Login/Password pair of the developer ZetaPush account.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-middle"><p class="tableblock">Cloud function</p></td>
<td class="tableblock halign-left valign-middle"><div><div class="paragraph">
<p>A single operation that has a name, well-defined behavior, that can accept parameters and can produce an output.</p>
</div>
<div class="paragraph">
<p>This is equivalent to a function in any language except that it is run remotely.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-middle"><p class="tableblock">Cloud service</p></td>
<td class="tableblock halign-left valign-middle"><div><div class="paragraph">
<p>Several Cloud functions that are grouped together to cover a coherent set of features. You can consider this as a class (custom cloud service) with methods (cloud functions).</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>ZetaPush already provides ready-to-use cloud services.
For example we have: Chat, Groups, Messaging&#8230;&#8203;</p>
</div>
<div class="paragraph">
<p>In this documentation, we mention Cloud Services as a shortcut of ZetaPush Cloud Services.</p>
</div>
</td>
</tr>
</table>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-middle"><p class="tableblock">Custom Cloud Service</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">A set of features similar to ZetaPush Cloud Services but developed by you. The usage of your custom cloud services is exactly the same as ZetaPush cloud services.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-middle"><p class="tableblock">Front</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">Web pages developed by you (HTML / CSS / JS).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-middle"><p class="tableblock">Worker</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">A set of Custom cloud services that you have developed to mutualize your business logic.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-middle"><p class="tableblock">Organization</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">A group of ZetaPush accounts. Each organization may have several managers and several developers. Each person uses his own credentials
to interact with ZetaPush but actions are shared among the organization.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-middle"><p class="tableblock">Application</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">A logical container designed to perform a group of coordinated tasks or activities for the benefit of the user.</p>
<p class="tableblock">An application may have a front part and a worker.</p>
<p class="tableblock">An application has at least one environment.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-middle"><p class="tableblock">Environment</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">Your application may be deployed and executed in separate zones called Environments. Each environment is a particular zone that you can organize as you wish.
For example, you can have <code>prod</code>, <code>pre-prod</code>, <code>dev</code> environments for the same application.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-middle"><p class="tableblock">CLI</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">Command Line Interface: utility scripts that are usable in a terminal to run your code or deploy your application, for example.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-middle"><p class="tableblock">Console</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">The main website used to manage your ZetaPush account and applications, read the documentation, monitor your applications&#8230;&#8203;</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<h1 id="_getting_started" class="sect0"><a class="anchor" href="#_getting_started"></a><a class="link" href="#_getting_started">Getting Started</a></h1>
<div class="sect1">
<h2 id="_system_requirements"><a class="anchor" href="#_system_requirements"></a><a class="link" href="#_system_requirements">4. System requirements</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>To create a ZetaPush application you only need the Node.js ecosystem:</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="ulist">
<ul>
<li>
<p>Node.js version 10.3.0 (LTS) or higher</p>
</li>
<li>
<p>npm version &gt;= 6.4</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong>Install Node.js and npm</strong></p>
</div>
<div class="paragraph">
<p>Go to <a href="https://nodejs.org/en/download/" target="_blank" rel="noopener">Node.js Downloads</a> and follow the installation instructions.</p>
</div>
<div class="paragraph">
<p>You also need to install additional tools for Node.js:</p>
</div>
<div class="paragraph tab-container">
<p>Additional tools</p>
</div>
<div class="paragraph tab">
<p>Windows</p>
</div>
<div class="paragraph">
<p>You must install development tools on Windows (Visual Studio Build Tools and Python).
Fortunately, there is a npm tool that helps you to install all required dependencies.
You must run this command line using <strong>PowerShell</strong> as <strong>Administrator</strong>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="console">npm install --global --production windows-build-tools</code></pre>
</div>
</div>
<div class="paragraph">
<p>Be patient! It may take a while.</p>
</div>
<div class="paragraph tab">
<p>Debian/Ubuntu</p>
</div>
<div class="paragraph">
<p>Install build tools:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="console">sudo apt-get install -y build-essential</code></pre>
</div>
</div>
<div class="paragraph tab">
<p>Enterprise Linux and Fedora</p>
</div>
<div class="paragraph">
<p>Install build tools:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="console">sudo yum install gcc-c++ make
# or: sudo yum groupinstall 'Development Tools'</code></pre>
</div>
</div>
<div class="paragraph tab-container-end">
<p>-</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_create_your_first_application"><a class="anchor" href="#_create_your_first_application"></a><a class="link" href="#_create_your_first_application">5. Create your first application</a></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_from_the_command_line"><a class="anchor" href="#_from_the_command_line"></a><a class="link" href="#_from_the_command_line">5.1. From the command line</a></h3>
<div class="listingblock">
<div class="title">Generate application</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="console">$ npm init @zetapush hello-world <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><em>hello-world</em> is the name of the folder that will be created with all the generated files</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You will be prompted for a developer login and a developer password in order to communicate with the platform.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The developer login and the developer password will be stored in the <code>.zetarc</code> file.
By default, the <code>.gitignore</code> file is configured to not deploy this file.
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Manage account and applications</div>
<div class="paragraph">
<p>See <a href="#_zetapush_account_management">ZetaPush account management</a> to learn how to manage your account and your applications.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_generated_application"><a class="anchor" href="#_generated_application"></a><a class="link" href="#_generated_application">5.2. Generated application</a></h3>
<div class="imageblock center">
<div class="content">
<img src="./images//hello-world/result.png" alt="result">
</div>
<div class="title">Figure 1. Result of hello-world project</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Using web frameworks</div>
<div class="paragraph">
<p>The project <code>hello-world</code> generated by the CLI is available on <a href="https://github.com/zetapush/zetapush-examples/tree/master/hello-world/">Github</a>.
This sample is also available using different front frameworks:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://github.com/zetapush/zetapush-examples/tree/master/hello-world/hello-world-react">React</a></p>
</li>
<li>
<p><a href="https://github.com/zetapush/zetapush-examples/tree/master/hello-world/hello-world-vue">Vue.js</a></p>
</li>
<li>
<p><a href="https://github.com/zetapush/zetapush-examples/tree/master/hello-world/hello-world-angular">Angular</a></p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="_what_it_does"><a class="anchor" href="#_what_it_does"></a><a class="link" href="#_what_it_does">5.2.1. What it does ?</a></h4>
<div class="paragraph">
<p>The generated project is really simple. It is just a web page that uses some JavaScript to call a cloud function named <code>hello</code> when button is clicked.
The cloud function is a custom cloud function that simply returns a message with the current date.
The result is retrieved by the JavaScript code and displayed in the browser console (using <code>console.log</code>).</p>
</div>
</div>
<div class="sect3">
<h4 id="_structure_of_generated_project"><a class="anchor" href="#_structure_of_generated_project"></a><a class="link" href="#_structure_of_generated_project">5.2.2. Structure of generated project</a></h4>
<div class="paragraph">
<p>The files of the generated project are structured as followed:</p>
</div>
<div class="listingblock">
<div class="title">Generated tree structure</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="console">hello-world
├── .zetarc
├── .gitignore
├── front
│   ├── index.css
│   ├── index.html
│   ├── index.js
│   └── logo.png
├── worker
│   └── index.ts
├── package.json
├── README.md
└── tsconfig.json</code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 1. Definition of generated files</caption>
<colgroup>
<col style="width: 20%;">
<col style="width: 80%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">File / Folder</th>
<th class="tableblock halign-left valign-top">Definition</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>.zetarc</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Contains the developer&#8217;s credentials. Useful to deploy or run your code. The content is auto generated if the file is empty.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>.gitignore</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Standard file used by Git to prevent commiting some files. It is preconfigured to prevent publication of your developer credentials (on GitHub for example).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>package.json</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Standard file for NPM to handle a module. It contains the dependencies, the name of your application, the entry point of your <em>custom cloud services</em> (<code>main</code> property) and many useful other informations for your application.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>README.md</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Gives you some information about how to use your application.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>front/</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">By convention, the front end code of your application is in this folder. You can change it by editing <code>package.json</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>worker/</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">By convention, the back end code of your application is in this folder. You can change it by editing <code>package.json</code>.</p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_run_locally_your_first_application"><a class="anchor" href="#_run_locally_your_first_application"></a><a class="link" href="#_run_locally_your_first_application">6. Run locally your first application</a></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_what_is_run"><a class="anchor" href="#_what_is_run"></a><a class="link" href="#_what_is_run">6.1. What is run ?</a></h3>
<div class="paragraph">
<p>Run is used in development phase. You run your code locally on your development machine. You can then iterate on your code to provide new features quickly or even debug your code.</p>
</div>
</div>
<div class="sect2">
<h3 id="_from_your_terminal"><a class="anchor" href="#_from_your_terminal"></a><a class="link" href="#_from_your_terminal">6.2. From your terminal</a></h3>
<div class="paragraph">
<p>Go into the generated folder (<code>hello-world</code>):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="console">$ cd hello-world</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then run the following command:</p>
</div>
<div class="listingblock">
<div class="title">Start application (front and custom cloud services)</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="console">$ npm run start -- --serve-front</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p><code>npm run start</code> is a script alias defined in the <code>package.json</code> file.
The command that is executed under the hood is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="console">$ zeta run --serve-front</code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>This command launches both a local web server on <code>localhost:3000</code> and the custom cloud services.
You can open a web browser on <code>localhost:3000</code> and open the browser console.</p>
</div>
<div class="paragraph">
<p>You can click on the button and see the result of the custom cloud service call in the browser console.</p>
</div>
</div>
<div class="sect2">
<h3 id="_how_it_works"><a class="anchor" href="#_how_it_works"></a><a class="link" href="#_how_it_works">6.3. How it works</a></h3>
<div class="imageblock center">
<div class="content">
<img src="./images//schemas/run-locally.png" alt="run locally">
</div>
<div class="title">Figure 2. Exchanges between web page and custom cloud services</div>
</div>
<div class="paragraph">
<p><span class="exchange-call">➊</span> Clicking on the button triggers a call to the ZetaPush cloud. ZetaPush routes the call to the local Node.js (the Node.js has been registered automatically by the CLI)<br>
<span class="exchange-response">➋</span> The custom cloud service does its job and provides a response. ZetaPush routes the response to the connected web page</p>
</div>
<div class="paragraph">
<p>There are 3 parts that are working together:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The web page that initiates a connection to the ZetaPush cloud</p>
</li>
<li>
<p>The ZetaPush cloud</p>
</li>
<li>
<p>The worker that provides the custom cloud function implementation</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Firstly, the web page is loaded in the browser and a JavaScript code automatically connects the <em>ZetaPush client</em> to the <em>ZetaPush cloud</em>.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Client connection</div>
<div class="paragraph">
<p>The connection is requested with <code>client.connect()</code> in <code>hello-world/front/index.html</code>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="title">Bidirectional connection</div>
<div class="paragraph">
<p>The connection between <em>ZetaPush client</em> and the <em>ZetaPush cloud</em> is established and is bi-directional. Any message sent by <em>ZetaPush client</em> will go through this opened connection.
The <em>ZetaPush cloud</em> can also send messages to the <em>ZetaPush client</em> through this opened connection.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Then, when the user clicks on the button, a message is sent to the <em>ZetaPush cloud</em> in order to execute some code.
The <em>ZetaPush cloud</em> routes the message to the worker to call the custom cloud function.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Code to handle clicks on the button</div>
<div class="paragraph">
<p>The button is defined in <code>hello-world/front/index.html</code></p>
</div>
<div class="paragraph">
<p>The action of the button is done in <code>hello-world/front/index.js</code> and it calls <code>api.hello()</code>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The custom cloud function is simply a JavaScript or TypeScript function. This function is called and it generates a result that is returned to <em>ZetaPush cloud</em>.
<em>ZetaPush cloud</em> routes the response message to the <em>ZetaPush client</em> to send the result.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Code of the cloud function</div>
<div class="paragraph">
<p>The code of the cloud function is available in <code>hello-world/worker/index.ts</code></p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Finally, the <em>ZetaPush client</em> receives the result and the JavaScript code of the web page displays it in the browser console (using <code>console.log</code>).</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Code to handle the result</div>
<div class="paragraph">
<p>The result is handled in <code>hello-world/front/index.js</code>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="title">Everything goes through the Internet</div>
<div class="paragraph">
<p>Even if you run locally, the cloud functions defined by your worker are available on the Internet through <em>ZetaPush cloud</em>.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_push_your_first_application_in_the_cloud"><a class="anchor" href="#_push_your_first_application_in_the_cloud"></a><a class="link" href="#_push_your_first_application_in_the_cloud">7. Push your first application in the Cloud</a></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_what_is_push"><a class="anchor" href="#_what_is_push"></a><a class="link" href="#_what_is_push">7.1. What is push ?</a></h3>
<div class="paragraph">
<p>Push is used to make your code "public". It will publish your web page(s) and also upload the code of your worker on <em>ZetaPush cloud</em>.
You can push when you think that your code is ready to be used by your end-users.</p>
</div>
</div>
<div class="sect2">
<h3 id="_from_your_terminal_2"><a class="anchor" href="#_from_your_terminal_2"></a><a class="link" href="#_from_your_terminal_2">7.2. From your terminal</a></h3>
<div class="listingblock">
<div class="title">Deploy application (front and custom cloud services)</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="console">$ npm run deploy</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p><code>npm run deploy</code> is a script alias defined in the <code>package.json</code> file.
The command that is executed under the hood is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="console">$ zeta push</code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>This command uploads your code (front and worker) to the ZetaPush cloud. ZetaPush then handles the deployment
by publishing your front and your custom cloud services.</p>
</div>
<div class="paragraph">
<p>The CLI displays the URL to access the published web page.</p>
</div>
</div>
<div class="sect2">
<h3 id="_how_it_works_2"><a class="anchor" href="#_how_it_works_2"></a><a class="link" href="#_how_it_works_2">7.3. How it works</a></h3>
<div class="imageblock center">
<div class="content">
<img src="./images//schemas/run-in-cloud.png" alt="run in cloud">
</div>
<div class="title">Figure 3. Exchanges between web page and custom cloud services</div>
</div>
<div class="paragraph">
<p><span class="exchange-call">➊</span> Clicking on the button triggers a call to the ZetaPush cloud which in turn routes directly the call to the hosted Node.js<br>
<span class="exchange-response">➋</span> The custom cloud service does its job and provides a response that ZetaPush routes back to the hosted web page</p>
</div>
<div class="paragraph">
<p>Now, the web page (front) and the custom cloud functions (defined in a worker) are hosted directly on <em>ZetaPush cloud</em>.
The behavior remains the same as when code is executed local machine:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>There are still the same 3 parts working together (web page, <em>ZetaPush cloud</em> and custom cloud function)</p>
</li>
<li>
<p>There is still a connection established by the client from the web page</p>
</li>
<li>
<p>There is still a message sent by the client to <em>ZetaPush cloud</em> that is routed to call the custom cloud function</p>
</li>
<li>
<p>There is still a message sent by the <em>ZetaPush cloud</em> that is routed to the client with the result of the custom cloud function</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_what_s_next"><a class="anchor" href="#_what_s_next"></a><a class="link" href="#_what_s_next">8. What&#8217;s next</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>You have created a new application, executed it locally and then published it.</p>
</div>
<div class="paragraph">
<p>Now, you are ready to code your own application:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>See <a href="#develop_front_with_zetapush">how to use built-in ZetaPush cloud services</a></p>
</li>
<li>
<p>See <a href="#develop_business_logic">how to add your custom business logic</a></p>
</li>
<li>
<p>See <a href="#integrate_user_management">how to integrate user management to my application</a></p>
</li>
</ul>
</div>
</div>
</div>
<h1 id="_developer_manual" class="sect0"><a class="anchor" href="#_developer_manual"></a><a class="link" href="#_developer_manual">Developer manual</a></h1>
<div class="sect1">
<h2 id="_requirements"><a class="anchor" href="#_requirements"></a><a class="link" href="#_requirements">9. Requirements</a></h2>
<div class="sectionbody">
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If you already prepared your environment, you can skip this section.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="_system_requirements_2"><a class="anchor" href="#_system_requirements_2"></a><a class="link" href="#_system_requirements_2">9.1. System requirements</a></h3>
<div class="paragraph">
<p>To create a ZetaPush application you only need the Node.js ecosystem:</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="ulist">
<ul>
<li>
<p>Node.js version 10.3.0 (LTS) or higher</p>
</li>
<li>
<p>npm version &gt;= 6.4</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong>Install Node.js and npm</strong></p>
</div>
<div class="paragraph">
<p>Go to <a href="https://nodejs.org/en/download/" target="_blank" rel="noopener">Node.js Downloads</a> and follow the installation instructions.</p>
</div>
<div class="paragraph">
<p>You also need to install additional tools for Node.js:</p>
</div>
<div class="paragraph tab-container">
<p>Additional tools</p>
</div>
<div class="paragraph tab">
<p>Windows</p>
</div>
<div class="paragraph">
<p>You must install development tools on Windows (Visual Studio Build Tools and Python).
Fortunately, there is a npm tool that helps you to install all required dependencies.
You must run this command line using <strong>PowerShell</strong> as <strong>Administrator</strong>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="console">npm install --global --production windows-build-tools</code></pre>
</div>
</div>
<div class="paragraph">
<p>Be patient! It may take a while.</p>
</div>
<div class="paragraph tab">
<p>Debian/Ubuntu</p>
</div>
<div class="paragraph">
<p>Install build tools:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="console">sudo apt-get install -y build-essential</code></pre>
</div>
</div>
<div class="paragraph tab">
<p>Enterprise Linux and Fedora</p>
</div>
<div class="paragraph">
<p>Install build tools:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="console">sudo yum install gcc-c++ make
# or: sudo yum groupinstall 'Development Tools'</code></pre>
</div>
</div>
<div class="paragraph tab-container-end">
<p>-</p>
</div>
</div>
<div class="sect2">
<h3 id="_using_cli"><a class="anchor" href="#_using_cli"></a><a class="link" href="#_using_cli">9.2. Using CLI</a></h3>
<div class="paragraph">
<p>Once your have your application ready (see <a href="./quick-start.html">Quick start</a> if you don&#8217;t have created an application) you can:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Run the backend code (Worker) locally</p>
</li>
<li>
<p>Deploy your application</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To do this we provide a <em>CLI</em> (Command Line Interface) to help you focus on your code and not spend time on writing commands or scripts.</p>
</div>
<div class="paragraph">
<p>The <em>CLI</em> module is declared in the <code>package.json</code> of the project so it is installed by npm when you create your project
(see <a href="./quick-start.html#_create_your_first_application">how to create an application using npm</a> if you haven&#8217;t created a project).</p>
</div>
<div class="paragraph">
<p>When the project is created, we configure the <code>package.json</code> with a <code>scripts</code> section to make aliases that work
directly with npm.</p>
</div>
<div class="sect3">
<h4 id="_use_npm_script_aliases_to_run_the_em_cli_em"><a class="anchor" href="#_use_npm_script_aliases_to_run_the_em_cli_em"></a><a class="link" href="#_use_npm_script_aliases_to_run_the_em_cli_em">9.2.1. Use npm script aliases to run the <em>CLI</em></a></h4>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="console">$ npm run &lt;alias&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you want to run your worker locally using script alias, you can execute:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="console">$ npm run start</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The <code>start</code> alias calls <code>zeta run</code> under the hood.</p>
</div>
<div class="paragraph">
<p>The <code>start</code> alias is used because it is the standard alias to use in development.
We follow npm conventions so a user that is used to npm know which command to
execute to start is project locally.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If you want to deploy your application using script alias, you can execute:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="console">$ npm run deploy</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The <code>start</code> alias calls <code>zeta push</code> under the hood.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_use_em_cli_em_directly"><a class="anchor" href="#_use_em_cli_em_directly"></a><a class="link" href="#_use_em_cli_em_directly">9.2.2. Use <em>CLI</em> directly</a></h4>
<div class="paragraph">
<p>With the CLI, you can run your worker with:</p>
</div>
<div class="listingblock">
<div class="title">Run worker</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="console"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
</pre></td>
  <td class="code"><pre>$ zeta run</pre></td>
</tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>Or deploy your application with:</p>
</div>
<div class="listingblock">
<div class="title">Deploy the application</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="console"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
</pre></td>
  <td class="code"><pre>$ zeta push</pre></td>
</tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>There are 3 ways to use directly <code>zeta</code> commands provided by the <em>CLI</em>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Set an environment variable that points to your local <code>node_modules/.bin</code> (recommended)</p>
</li>
<li>
<p>Use <code>npx</code> tool</p>
</li>
<li>
<p>Install <em>CLI</em> as global (not recommended)</p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="_update_your_path_environment_variable_recommended"><a class="anchor" href="#_update_your_path_environment_variable_recommended"></a><a class="link" href="#_update_your_path_environment_variable_recommended">9.2.2.1. Update your PATH environment variable (recommended)</a></h5>
<div class="paragraph">
<p>In order to be able to run <code>zeta</code> commands directly, you need to update your PATH.</p>
</div>
<div class="paragraph tab-container">
<p>Update environement variables</p>
</div>
<div class="paragraph tab">
<p>Debian/Ubuntu/MacOSX</p>
</div>
<div class="paragraph">
<p>You need to add it to your shell config file <code>~/.zshrc</code>, <code>~/.profile</code> or <code>~/.bashrc</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="console">$ export PATH=./node_modules/.bin:$PATH</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that this will not automatically update your path for the remainder of the session. To do this, you should run:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="console">$ source ~/.zshrc
$ source ~/.profile
$ source ~/.bashrc</code></pre>
</div>
</div>
<div class="paragraph tab">
<p>Windows 10 and Windows 8</p>
</div>
<div class="ulist">
<ul>
<li>
<p>In Search, search for and then select: System (Control Panel)</p>
</li>
<li>
<p>Click the Advanced system settings link.</p>
</li>
<li>
<p>Click Environment Variables. In the section System Variables, find the PATH environment variable and select it. Click Edit. If the PATH environment variable does not exist, click New.</p>
</li>
<li>
<p>In the Edit System Variable (or New System Variable) window, specify the value of the PATH environment variable. Click OK. Close all remaining windows by clicking OK.</p>
</li>
<li>
<p>Reopen Command prompt window, and run zeta command.</p>
</li>
</ul>
</div>
<div class="paragraph tab">
<p>Windows 7</p>
</div>
<div class="ulist">
<ul>
<li>
<p>From the desktop, right click the Computer icon.</p>
</li>
<li>
<p>Choose Properties from the context menu.</p>
</li>
<li>
<p>Click the Advanced system settings link.</p>
</li>
<li>
<p>Click Environment Variables. In the section System Variables, find the PATH environment variable and select it. Click Edit. If the PATH environment variable does not exist, click New.</p>
</li>
<li>
<p>In the Edit System Variable (or New System Variable) window, specify the value of the PATH environment variable. Click OK. Close all remaining windows by clicking OK.</p>
</li>
<li>
<p>Reopen Command prompt window, and run zeta command.</p>
</li>
</ul>
</div>
<div class="paragraph tab">
<p>Windows Vista</p>
</div>
<div class="ulist">
<ul>
<li>
<p>From the desktop, right click the My Computer icon.</p>
</li>
<li>
<p>Choose Properties from the context menu.</p>
</li>
<li>
<p>Click the Advanced tab (Advanced system settings link in Vista).</p>
</li>
<li>
<p>Click Environment Variables. In the section System Variables, find the PATH environment variable and select it. Click Edit. If the PATH environment variable does not exist, click New.</p>
</li>
<li>
<p>In the Edit System Variable (or New System Variable) window, specify the value of the PATH environment variable. Click OK. Close all remaining windows by clicking OK.</p>
</li>
<li>
<p>Reopen Command prompt window, and run zeta command.</p>
</li>
</ul>
</div>
<div class="paragraph tab">
<p>Windows XP</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Select Start, select Control Panel. double click System, and select the Advanced tab.</p>
</li>
<li>
<p>Click Environment Variables. In the section System Variables, find the PATH environment variable and select it. Click Edit. If the PATH environment variable does not exist, click New.</p>
</li>
<li>
<p>In the Edit System Variable (or New System Variable) window, specify the value of the PATH environment variable. Click OK. Close all remaining windows by clicking OK.</p>
</li>
<li>
<p>Reopen Command prompt window, and run zeta command.</p>
</li>
</ul>
</div>
<div class="paragraph tab-container-end">
<p>-</p>
</div>
</div>
<div class="sect4">
<h5 id="_use_npx_tool"><a class="anchor" href="#_use_npx_tool"></a><a class="link" href="#_use_npx_tool">9.2.2.2. Use npx tool</a></h5>
<div class="paragraph">
<p>npx is shipped with npm standard install</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="console">$ npx zeta &lt;command&gt;</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_install_zetapush_cli_as_a_global_command_not_recommended"><a class="anchor" href="#_install_zetapush_cli_as_a_global_command_not_recommended"></a><a class="link" href="#_install_zetapush_cli_as_a_global_command_not_recommended">9.2.2.3. Install @zetapush/cli as a global command (not recommended)</a></h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="console">$ npm i -g @zetapush/cli</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_zetapush_concepts"><a class="anchor" href="#_zetapush_concepts"></a><a class="link" href="#_zetapush_concepts">10. ZetaPush concepts</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>In order to be able to use ZetaPush, you need a <strong>ZetaPush account</strong>. Your account is used when
you develop to run your project locally or to deploy it on ZetaPush cloud.</p>
</div>
<div class="paragraph">
<p>The code you produce is bound to an <strong>application</strong>.</p>
</div>
<div class="paragraph">
<p>An account belongs to an <strong>organization</strong>. An organization is useful to work in team.
You can have several applications for your organization.
You can manage access rights on applications according to members of your team.</p>
</div>
<div class="paragraph">
<p>As usual in development, you may need to run your application in different contexts (dev, continuous integration,
prod&#8230;&#8203;).
Each application may have several <strong>environments</strong>.
You can also manage access rights on environments according to members of your team.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Learn how to <a href="#add_application">add an application to your organization</a>.</p>
</div>
<div class="paragraph">
<p>Learn how to <a href="#add_environment">add an environment to your application</a>.</p>
</div>
<div class="paragraph">
<p>Learn how to <a href="#access_control_per_application">control access for an application</a>.</p>
</div>
<div class="paragraph">
<p>Learn how to <a href="#access_control_per_environment">control access for a particular environment</a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>For now, environments are not fully supported but this feature will be available soon.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="_create_your_account"><a class="anchor" href="#_create_your_account"></a><a class="link" href="#_create_your_account">10.1. Create your account</a></h3>
<div class="paragraph">
<p>Currently, the only way to get a ZetaPush account is by contacting us. The aim is to understand your needs
and to advise you even if you just want to test it:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://www.zetapush.com/sign-up-for-a-free-trial/">Signup for a free trial</a></p>
</li>
<li>
<p><a href="https://www.zetapush.com/contact">Contact us for more suitable account</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Your account will be created soon after the first contact and an application that fits your
needs will be available. Then you are ready to start working with ZetaPush.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Soon we will open access to everyone for free trial. Account creation will be available through
our CLI tool, from the main site and the web console.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="develop_front_with_zetapush"><a class="anchor" href="#develop_front_with_zetapush"></a><a class="link" href="#develop_front_with_zetapush">11. Develop your front with ZetaPush</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>You may want to quickly provide a web application by just focusing on the visible part and the user experience
instead of wasting time on technical concerns.</p>
</div>
<div class="paragraph">
<p>ZetaPush provides built-in <em>cloud services</em> to increase your productivity:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 2. List of ZetaPush cloud services</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Cloud service</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_standard_user_workflow">Standard User Workflow</a></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>The <code>StandardUserWorkflow</code> corresponds to the most common inscription process on the Internet. It handles:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Inscription of your end-users into your application: the user fills some information and <code>StandardUserWorkflow</code> sends an email
(or SMS or anything else) to the user in order to confirm its account. Once the user has confirmed its account, he can authenticate
himself and he is ready to use your application.</p>
</li>
<li>
<p>Authentication of your end-users</p>
</li>
<li>
<p>Lost password of your end-users: the user ask for resetting its password. <code>StandardUserWorkflow</code> sends an email (or SMS or anything else) to the user.
The user clicks the link in the email to choose another password. Once confirmed, its account is updated with the new password.</p>
</li>
<li>
<p>Profile edition: your end-users can update their information</p>
</li>
</ul>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_user_management">User management</a></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>This section describes several services that provide basic user management functions:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#_simple">Simple</a>: cloud functions to create a user, change credentials of a user, update a user or delete a user.</p>
</li>
<li>
<p><a href="#_weak">Weak</a>: cloud functions to control and release of weakly authenticated user sessions.</p>
</li>
<li>
<p><a href="#_userdir">Userdir</a>: cloud functions to retrieve and search users created by Simple.</p>
</li>
<li>
<p><a href="#_groups">Groups</a>: cloud functions to handle group of users.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>This APIs are available if <code>StandardUserWorkflow</code> doesn&#8217;t fit your needs or you want to go further.
Under the hood, <code>StandardUserWorkflow</code> use these services.</p>
</div>
</td>
</tr>
</table>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_data_management">Data management</a></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>This section describes several services that provide basic data management functions:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#_gda">Gda</a>: NoSQL database that can store values, objects and arrays as document in columns.</p>
</li>
<li>
<p><a href="#_stack">Stack</a>: Store values, objects and arrays in a stack. Each item is pushed in the stack and can be accessed later.</p>
</li>
<li>
<p><a href="#_search_2">Search</a>: Search engine to make full text searches.</p>
</li>
</ul>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_file_management">File management</a></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>This section describes several services that provide basic file management functions:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#_zpfs_hdfs">Zpfs_hdfs</a>: Store files on a file system.</p>
</li>
<li>
<p><a href="#_template">Template</a>: Define a template and then evaluate it with an execution context.</p>
</li>
</ul>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_communication">Communication</a></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>It is possible to interact with your end-users using these services:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#_messaging">Messaging</a>: Send messages to a particular user (or a group of users). This is the service you use for a chat.</p>
</li>
<li>
<p><a href="#_notif">Notif</a>: Send notifications to your end-users mobile phone (Android, iOS or Windows Phone).</p>
</li>
<li>
<p><a href="#_sendmail">Sendmail</a>: Send emails to your end-users.</p>
</li>
<li>
<p><a href="#_sms_ovh">Sms_ovh</a>: Send SMS to your end-users.</p>
</li>
</ul>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_utilities_management">Utilities</a></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>This section provides some utility tools:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#_cron">Cron</a>: Schedule a task to be executed periodically.</p>
</li>
<li>
<p><a href="#_logs">Logs</a>: Log some information. Logs will be available on ZetaPush cloud.</p>
</li>
<li>
<p><a href="#_trigger">Trigger</a>: Listen to some event that is triggered by ZetaPush cloud and react to that event.</p>
</li>
</ul>
</div></div></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>ZetaPush cloud services need to be "created" before being able to use them. This way, you
can choose which services are part of your application instead of having them all.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Currently, using a front to interact with ZetaPush cloud services directly is not really possible due to
this "creation" phase. For security reasons, service creation and configuration can&#8217;t be done via
a client.</p>
</div>
<div class="paragraph">
<p>When the web console will be fully ready, ZetaPush cloud services "creation" will be
available through the web console.</p>
</div>
<div class="paragraph">
<p>Hopefully, you can use a worker to declare the use of a ZetaPush cloud service and even configure it. The
"creation" process is automatically handled by the worker.</p>
</div>
<div class="paragraph">
<p>See the next section to know how to develop <em>custom cloud services</em> and use <em>ZetaPush cloud services</em>.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="develop_business_logic"><a class="anchor" href="#develop_business_logic"></a><a class="link" href="#develop_business_logic">12. Develop your business logic</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Even if ZetaPush provides ready to use cloud services, we know that any application needs some
specific behaviors. Instead of limiting your possibilities, we provide a way to help you develop
quickly your own business logic.</p>
</div>
<div class="sect2">
<h3 id="_what_is_a_em_custom_cloud_service_em"><a class="anchor" href="#_what_is_a_em_custom_cloud_service_em"></a><a class="link" href="#_what_is_a_em_custom_cloud_service_em">12.1. What is a <em>custom cloud service</em></a></h3>
<div class="paragraph">
<p>A <em>custom cloud service</em> combines many <em>cloud functions</em> like the <em>cloud services</em> exposed by ZetaPush. The only difference is that <strong>you</strong> create the <em>cloud functions</em>.
Generally, you will want to put the <strong>business logic</strong> of your application in the <em>custom cloud services</em>.</p>
</div>
<div class="sect3">
<h4 id="_architecture"><a class="anchor" href="#_architecture"></a><a class="link" href="#_architecture">12.1.1. Architecture</a></h4>
<div class="paragraph">
<p>You develop <em>cloud services</em> that are contained in a concept named <strong>worker</strong>. In your code it is
materialized by a folder named <code>worker</code>. The worker is the ZetaPush handler that starts your code (your <em>custom cloud services</em>).</p>
</div>
<div class="paragraph">
<p>Your application is composed of a logic part (the worker) and a UI part (the front).</p>
</div>
<div class="paragraph">
<p>There are two ways of running an application (worker and front):</p>
</div>
<div class="ulist">
<ul>
<li>
<p>You develop on your machine and iterate to provide features. Your application runs locally and interacts with ZetaPush Cloud.</p>
</li>
<li>
<p>Once you are ready to make the developed features available to your end-users, you publish your application. Your application runs directly in ZetaPush Cloud.</p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="_run_on_your_machine"><a class="anchor" href="#_run_on_your_machine"></a><a class="link" href="#_run_on_your_machine">12.1.1.1. Run on your machine</a></h5>
<div class="imageblock center">
<div class="content">
<img src="custom-cloud-service-dev.png" alt="custom cloud service dev" width="709" height="430">
</div>
<div class="title">Figure 4. Interactions during development phase</div>
</div>
<div class="paragraph">
<p>Both front and worker are running locally. The front interacts with <em>custom cloud services</em> contained in the worker through
ZetaPush Cloud.
As ZetaPush Cloud provides bidirectional connection, the <em>custom cloud services</em> can also interact with the front through
ZetaPush Cloud too.</p>
</div>
<div class="paragraph">
<p>A <em>custom cloud service</em> can interact with <em>built-in cloud services</em> provided by ZetaPush.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>When you start using ZetaPush, you only develop locally so from your point of vue,
your front seems to directly interact with your <em>custom cloud services</em>.</p>
</div>
<div class="paragraph">
<p>In fact, all messages go through the Internet and ZetaPush Cloud.
It means that a published front can interact with a worker that is running locally and vice versa.</p>
</div>
<div class="paragraph">
<p>See <a href="#mix_local_and_remote">how to mix local worker with worker running in cloud</a></p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_run_in_cloud"><a class="anchor" href="#_run_in_cloud"></a><a class="link" href="#_run_in_cloud">12.1.1.2. Run in cloud</a></h5>
<div class="imageblock center">
<div class="content">
<img src="custom-cloud-service-prod.png" alt="custom cloud service prod" width="681" height="387">
</div>
<div class="title">Figure 5. Custom Cloud Service in production phase</div>
</div>
<div class="paragraph">
<p>Once published, everything runs in the ZetaPush Cloud. However the behavior is the same.
Every interaction between the front and <em>custom cloud services</em> goes through the ZetaPush Cloud.</p>
</div>
<div class="paragraph">
<p>The only main difference is that ZetaPush Cloud manages the hosting, the scalability and the
high availability for you.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_develop_a_em_custom_cloud_services_em"><a class="anchor" href="#_develop_a_em_custom_cloud_services_em"></a><a class="link" href="#_develop_a_em_custom_cloud_services_em">12.2. Develop a <em>custom cloud services</em></a></h3>
<div class="sect3">
<h4 id="_define_a_em_custom_cloud_service_em"><a class="anchor" href="#_define_a_em_custom_cloud_service_em"></a><a class="link" href="#_define_a_em_custom_cloud_service_em">12.2.1. Define a <em>custom cloud service</em></a></h4>
<div class="paragraph">
<p>As a reminder worker is the ZetaPush container that will handle your code that defines <em>custom cloud services</em>.
By convention, the code of your <em>custom cloud services</em> is placed in files under <code>worker</code> directory:</p>
</div>
<div class="listingblock">
<div class="title">Tree structure convention</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="console">hello-world
├── <em>.zetarc</em>
├── <em>.gitignore</em>
├── <em>front</em>
│   ├── ...
│   └── ...
├── <strong>worker</strong>
│   ├── file1.ts
│   ├── file2.ts
│   ├── ...
│   ├── fileN.ts
│   └── index.ts
├── <em>package.json</em>
├── <em>README.md</em>
└── <em>tsconfig.json</em></code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Change directory structure</div>
<div class="paragraph">
<p>See more information about <a href="#different_directory_structures">directory structure convention and how to adapt the structure</a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Translated into code, a <em>custom cloud service</em> is just a <code>class</code> and its <code>methods</code> are the  <em>cloud functions</em>.
The code is written in any <code>ts</code> file defined in <code>worker</code> directory. For small application like a "hello world",
write your code directly in <code>index.ts</code> file.
So the most basic example of a <em>custom cloud service</em> is below:</p>
</div>
<div class="listingblock">
<div class="title">Basic custom cloud service</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
</pre></td>
  <td class="code"><pre><span class="reserved">class</span> HelloWorldAsCustomCloudService {     <i class="conum" data-value="1"></i><b>(1)</b>

    constructor() {}                       <i class="conum" data-value="2"></i><b>(2)</b>

    helloWorld() {                         <i class="conum" data-value="3"></i><b>(3)</b>
        <span class="keyword">return</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">Hello World</span><span class="delimiter">&quot;</span></span>;
    }
}</pre></td>
</tr></table></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>A custom cloud service is encapsulated in a JavaScript/TypeScript class. <strong>HelloWorldAsCustomCloudService</strong> is your first <em>custom cloud service</em>.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>A class can define a constructor. We will see later why it is important</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td><code>helloWorld</code> is your first <em>custom cloud function</em></td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
A <em>cloud function</em> is always asynchronous (with the <em>async</em> keyword or not)
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Change entry point</div>
<div class="paragraph">
<p>By default, the code above is directly written in <code>index.ts</code> file. This is done in order
to follow NodeJS conventions. Indeed, <code>index.ts</code> is the usually the file that imports
all other files.</p>
</div>
<div class="paragraph">
<p>You can write code of your <em>custom cloud services</em> in any other file named as you want.
You will see later how to indicate to ZetaPush worker how to find your files if you don&#8217;t
want to follow convention.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="_define_a_em_cloud_function_em"><a class="anchor" href="#_define_a_em_cloud_function_em"></a><a class="link" href="#_define_a_em_cloud_function_em">12.2.1.1. Define a <em>cloud function</em></a></h5>
<div class="paragraph">
<p>Each <em>cloud function</em> in a <em>custom cloud service</em> is a standard JavaScript/TypeScript
method.
For example, if you want a <em>cloud function</em> that receives two parameters you write:</p>
</div>
<div class="listingblock highlight-lines:8-14">
<div class="title">A more realistic <em>cloud function</em></div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre></td>
  <td class="code"><pre><span class="reserved">class</span> HelloWorldAsCustomCloudService {                            <i class="conum" data-value="1"></i><b>(1)</b>
    constructor() {}

    helloWorld() {
        <span class="keyword">return</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">Hello World</span><span class="delimiter">&quot;</span></span>;
    }

    saySomething(message: string, <span class="key">times</span>: number) {                <i class="conum" data-value="2"></i><b>(2)</b>
        let fullMessage = <span class="string"><span class="delimiter">'</span><span class="delimiter">'</span></span>;
        <span class="keyword">for</span>(let i=<span class="integer">0</span> ; i&lt;times ; i++) {                            <i class="conum" data-value="3"></i><b>(3)</b>
            fullMessage += <span class="error">`</span><span class="predefined">$</span>{message}<span class="error">\</span>n<span class="error">`</span>
        }
        <span class="keyword">return</span> fullMessage                                        <i class="conum" data-value="4"></i><b>(4)</b>
    }
}</pre></td>
</tr></table></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <em>custom cloud service</em> definition as seen before</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Declaration of a <em>cloud function</em> named <code>saySomething</code>. This <em>cloud function</em> accepts
two parameters. As <a href="#javascript_vs_typescript">TypeScript is the recommended way</a>, each parameter is typed.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Just for an example, the business logic consists in looping a number of times
and concatenating the message. You can obviously write any code you want here.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>The <em>custom cloud function</em> simply returns the contactenated string.</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Why typing ?</div>
<div class="paragraph">
<p>Typing is optional but recommended to have a well defined API. Thanks to typing,
ZetaPush is able to generate more accurate <a href="#generate_api_documentation">documentation based on your code</a> and also
<a href="#generate_sdks">generate mobile/web/IoT SDKs</a> from your code with the right types so it
makes developing your clients easier (for example, auto-completion can be used).</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Tips about cloud functions</div>
<div class="paragraph">
<p>A <em>custom cloud service</em> can have as many <em>custom cloud functions</em> as you want.</p>
</div>
<div class="paragraph">
<p>A <em>custom cloud function</em> can have as many parameters as you want. Parameters can be anything: <code>string</code>, <code>number</code>,
<code>boolean</code>, <code>array</code> or <code>object</code>. You can code your function as you always do.</p>
</div>
<div class="paragraph">
<p>A <em>custom cloud function</em> can return anything including a <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise">Promise</a>.
You can also write your code using <a href="https://javascript.info/async-await">async/await syntax</a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Define several <em>custom cloud services</em></div>
<div class="paragraph">
<p>Obviously when your application grows, you need to split your <em>custom cloud service</em> into several classes in order
to make your API more understandable and more maintainable.</p>
</div>
<div class="paragraph">
<p>You can learn <a href="#several_custom_cloud services">how to define several <em>custom cloud services</em></a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You have now a <em>custom cloud service</em> that provides two <em>cloud functions</em>.
But until it is exposed, it can&#8217;t be called from outside of the worker.</p>
</div>
<div class="paragraph">
<p>The next section describes how you can expose your <em>custom cloud service</em>.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_expose_a_em_custom_cloud_service_em"><a class="anchor" href="#_expose_a_em_custom_cloud_service_em"></a><a class="link" href="#_expose_a_em_custom_cloud_service_em">12.2.2. Expose a <em>custom cloud service</em></a></h4>
<div class="paragraph">
<p>When you define a <em>custom cloud service</em> that you want to expose to the client,
you need to declare it. There are 2 cases:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Only one <em>custom cloud service</em> exposed</p>
</li>
<li>
<p>Many <em>custom cloud services</em> exposed</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In this section we only address one <em>custom cloud service</em> exposed.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">How to expose several <em>custom cloud services</em></div>
<div class="paragraph">
<p>You can also learn <a href="#expose_several_custom_cloud_services">how to expose several <em>custom cloud services</em></a> in the advanced sections.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>We follow npm conventions to indicate the entry point of your worker. Indeed, the <code>package.json</code> defines a property named <code>main</code>.
We use this property to indicate which file is the main file that declares the exposed <em>custom cloud service</em>.
By default, the main file is named <code>index.ts</code> and this file is placed in <code>worker</code> directory. So the <code>main</code>
property is by default <code>worker/index.ts</code>.</p>
</div>
<div class="imageblock center">
<div class="content">
<img src="custom-cloud-service-entry-point.png" alt="custom cloud service entry point" width="678" height="161">
</div>
</div>
<div class="paragraph">
<p>Now that your <em>custom cloud service</em> is marked as the entry point, it can be exposed by ZetaPush.
However you still have a little change to make on your code:</p>
</div>
<div class="listingblock highlight-lines:1">
<div class="title">A more realistic <em>cloud function</em></div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre></td>
  <td class="code"><pre><span class="reserved">export</span> <span class="keyword">default</span> <span class="reserved">class</span> HelloWorldAsCustomCloudService {                    <i class="conum" data-value="1"></i><b>(1)</b> <i class="conum" data-value="2"></i><b>(2)</b>
    constructor() {}

    helloWorld() {
        <span class="keyword">return</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">Hello World</span><span class="delimiter">&quot;</span></span>;
    }

    saySomething(message: string, <span class="key">times</span>: number) {
        let fullMessage = <span class="string"><span class="delimiter">'</span><span class="delimiter">'</span></span>;
        <span class="keyword">for</span>(let i=<span class="integer">0</span> ; i&lt;times ; i++) {
            fullMessage += <span class="error">`</span><span class="predefined">$</span>{message}<span class="error">\</span>n<span class="error">`</span>
        }
        <span class="keyword">return</span> fullMessage
    }
}</pre></td>
</tr></table></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>export</code>: <a href="https://www.typescriptlang.org/docs/handbook/modules.html" target="_blank" rel="noopener">this is required by TypeScript</a>.
In fact, declaring a class in a file makes it private.
It means that if you have another <code>.ts</code> file and you want to import <code>HelloWorldAsCustomCloudService</code> declaration,
it won&#8217;t be possible without <code>export</code> keyword. This is for code encapsulation.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td><code>default</code>: <a href="https://www.typescriptlang.org/docs/handbook/modules.html#default-exports">TypeScript provides this keyword</a>.
When exposing only one <em>custom cloud service</em>, <code>default</code> tells the worker that there is only one class (only one
<em>custom cloud service</em> defined in the <code>index.ts</code>). So the worker can directly analyze it and instantiate it.</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">How to expose several <em>custom cloud services</em></div>
<div class="paragraph">
<p>As seen above, you can also learn <a href="#expose_several_custom_cloud_services">how to expose several <em>custom cloud services</em></a> in the advanced sections.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Now your <em>custom cloud service</em> can be loaded by the ZetaPush worker and your <em>custom cloud service</em>
is automatically exposed.
It means that now a client can call the <em>cloud functions</em> defined in your <em>custom cloud service</em>.</p>
</div>
<div class="paragraph">
<p>The next section shows how to call a <em>cloud function</em> from a web page using pure JavaScript.</p>
</div>
</div>
<div class="sect3">
<h4 id="_use_a_em_custom_cloud_service_em_in_your_front"><a class="anchor" href="#_use_a_em_custom_cloud_service_em_in_your_front"></a><a class="link" href="#_use_a_em_custom_cloud_service_em_in_your_front">12.2.3. Use a <em>custom cloud service</em> in your front</a></h4>
<div class="paragraph">
<p>In this chapter we will see how to consume our <em>cloud functions</em> from a web page.
At the end of this example, we will have one button to call <code>helloWorld</code> <em>cloud function</em> and
one section with a message, a number of repetitions and a button to call <code>saySomething</code> <em>cloud function</em>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Mobile applications</div>
<div class="paragraph">
<p>Here we show how to create a web page that consumes our <em>custom cloud service</em>.</p>
</div>
<div class="paragraph">
<p>You can also create a mobile application for Android, iOS and Windows Phone as well
as code for a device. You can use any language you want for the client part.</p>
</div>
<div class="paragraph">
<p>By default we target web because it is currently the most used technology (even to build
some mobile applications using hybrid technologies).</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>As a reminder, here is the code of <em>custom cloud service</em> named <code>HelloWorldAsCustomCloudService</code>:</p>
</div>
<div class="listingblock">
<div class="title">worker/index.ts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre></td>
  <td class="code"><pre><span class="reserved">export</span> <span class="keyword">default</span> <span class="reserved">class</span> HelloWorldAsCustomCloudService {
    constructor() {}

    helloWorld() {
        <span class="keyword">return</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">Hello World</span><span class="delimiter">&quot;</span></span>;
    }

    saySomething(message: string, <span class="key">times</span>: number) {
        let fullMessage = <span class="string"><span class="delimiter">'</span><span class="delimiter">'</span></span>;
        <span class="keyword">for</span>(let i=<span class="integer">0</span> ; i&lt;times ; i++) {
            fullMessage += <span class="error">`</span><span class="predefined">$</span>{message}<span class="error">\</span>n<span class="error">`</span>
        }
        <span class="keyword">return</span> fullMessage
    }
}</pre></td>
</tr></table></code></pre>
</div>
</div>
<div class="sect4">
<h5 id="_prepare_your_front_for_using_zetapush_client"><a class="anchor" href="#_prepare_your_front_for_using_zetapush_client"></a><a class="link" href="#_prepare_your_front_for_using_zetapush_client">12.2.3.1. Prepare your front for using ZetaPush client</a></h5>
<div class="paragraph">
<p>By convention the directory structure of a ZetaPush application is defined below. You place
the code of your web page in the <code>front</code> directory:</p>
</div>
<div class="listingblock">
<div class="title">Tree structure convention</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="console">hello-world
├── <em>.zetarc</em>
├── <em>.gitignore</em>
├── <strong>front</strong>
│   ├── ...
│   ├── <strong>index.js</strong>
│   └── <strong>index.html</strong>
├── <em>worker</em>
│   ├── ...
│   ├── ...
│   └── index.ts
├── <em>package.json</em>
├── <em>README.md</em>
└── <em>tsconfig.json</em></code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Other front files</div>
<div class="paragraph">
<p>For this example, we only need an HTML page and a JavaScript file. Needless to say that you can
have CSS files, images and anything you want too.</p>
</div>
<div class="paragraph">
<p>See more information about <a href="#different_directory_structures">directory structure convention and how to adapt the structure</a>.</p>
</div>
<div class="paragraph">
<p>Moreover, you are not limited to write pure JavaScript code. You can also use any framework you want:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#develop_with_angular">Angular</a></p>
</li>
<li>
<p><a href="#develop_with_react">React</a></p>
</li>
<li>
<p><a href="#develop_with_vue">Vue.js</a></p>
</li>
<li>
<p>&#8230;&#8203;</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>For the example, we create an HTML page with a button to display the <em>HelloWorld</em> message in the page each time
the button is clicked:</p>
</div>
<div class="listingblock">
<div class="title">front/index.html</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="html"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
</pre></td>
  <td class="code"><pre><span class="doctype">&lt;!DOCTYPE html&gt;</span>
<span class="tag">&lt;html</span> <span class="attribute-name">lang</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">en</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>

<span class="tag">&lt;head&gt;</span>
    <span class="tag">&lt;meta</span> <span class="attribute-name">charset</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">UTF-8</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
    <span class="tag">&lt;meta</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">viewport</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">content</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">width=device-width, initial-scale=1.0</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
    <span class="tag">&lt;title&gt;</span>Celtia<span class="tag">&lt;/title&gt;</span>
<span class="tag">&lt;/head&gt;</span>

<span class="tag">&lt;body&gt;</span>
    <span class="tag">&lt;button</span> <span class="attribute-name">onclick</span>=<span class="string"><span class="delimiter">&quot;</span>hello()<span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>hello<span class="tag">&lt;/button&gt;</span>                    <i class="conum" data-value="1"></i><b>(1)</b>
    <span class="tag">&lt;ul</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">result-container</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span><span class="tag">&lt;/ul&gt;</span>                             <i class="conum" data-value="2"></i><b>(2)</b>

    <span class="tag">&lt;script</span> <span class="attribute-name">src</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">https://unpkg.com/@zetapush/client</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span><span class="tag">&lt;/script&gt;</span>  <i class="conum" data-value="2"></i><b>(2)</b>
    <span class="tag">&lt;script</span> <span class="attribute-name">src</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">./index.js</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span><span class="tag">&lt;/script&gt;</span>                          <i class="conum" data-value="3"></i><b>(3)</b>
<span class="tag">&lt;/body&gt;</span>

<span class="tag">&lt;/html&gt;</span></pre></td>
</tr></table></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>We call <code>hello()</code> function that is defined later in <code>index.js</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Define a node that will display received messages</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>We include the <code>client</code> module provided by ZetaPush</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>We include a JavaScript file to distinguish HTML code from JavaScript code. All could be written in the HTML</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Then, in order to interact with ZetaPush cloud, we need to create a client instance
and to connect to the cloud:</p>
</div>
<div class="listingblock">
<div class="title">front/index.js</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
</pre></td>
  <td class="code"><pre><span class="comment">// Create new ZetaPush Client</span>
const client = <span class="keyword">new</span> ZetaPushClient.WeakClient();     <i class="conum" data-value="1"></i><b>(1)</b>
<span class="comment">// Create a proxy to invoked worker methods</span>
const api = client.createProxyTaskService();        <i class="conum" data-value="2"></i><b>(2)</b>
<span class="comment">// Handle connection</span>
client.connect()                                    <i class="conum" data-value="3"></i><b>(3)</b>
  .then(() =&gt; {                                     <i class="conum" data-value="4"></i><b>(4)</b>
    console.debug(<span class="string"><span class="delimiter">'</span><span class="content">onConnectionEstablished</span><span class="delimiter">'</span></span>);
  });</pre></td>
</tr></table></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Use ZetaPushClient factory to instantiate a client. In this example, we ask for an anonymous connection (it means that actions are not bound to a particular user of your application)</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Custom cloud service provides some functions that can be called from a client. For example, the <em>custom cloud service</em> exposes <code>helloWorld</code> and <code>saySomething</code> <em>cloud functions</em>.
Instead of having to write the signature of these functions in the client too, we simply use a JavaScript <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Proxy">Proxy</a>.
Therefore, you can directly interact with your custom cloud service without writing any pass-through code on the client side.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The client is ready, now connects it to the ZetaPush cloud.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Once the connection is established, the Promise is resolved and you can write some code in <code>then</code> callback.</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Available client types</div>
<div class="paragraph">
<p><code>ZetaPushClient</code> provides several factories to get instances of a client according to
what you want to do. Here we are using a <code>WeakClient</code> instance but there are other
<a href="#client_types">client types</a>.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_call_code_hello_code_em_cloud_function_em"><a class="anchor" href="#_call_code_hello_code_em_cloud_function_em"></a><a class="link" href="#_call_code_hello_code_em_cloud_function_em">12.2.3.2. Call <code>hello</code> <em>cloud function</em></a></h5>
<div class="paragraph">
<p>Our client is ready and now we want to call <em>cloud function</em> named <code>helloWorld</code>, we add the following code:</p>
</div>
<div class="listingblock highlight-lines:11-14">
<div class="title">front/index.js</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre></td>
  <td class="code"><pre><span class="comment">// Create new ZetaPush Client</span>
const client = <span class="keyword">new</span> ZetaPushClient.WeakClient();
<span class="comment">// Create a proxy to invoked worker methods</span>
const api = client.createProxyTaskService();
<span class="comment">// Handle connection</span>
client.connect()
  .then(() =&gt; {
    console.debug(<span class="string"><span class="delimiter">'</span><span class="content">onConnectionEstablished</span><span class="delimiter">'</span></span>);
  });
<span class="comment">// Handle DOM events</span>
async <span class="keyword">function</span> <span class="function">hello</span>() {                                                                          <i class="conum" data-value="1"></i><b>(1)</b>
  const messageFromCloudFunction = await api.helloWorld();                                        <i class="conum" data-value="2"></i><b>(2)</b>
  document.getElementById(<span class="string"><span class="delimiter">'</span><span class="content">result-container</span><span class="delimiter">'</span></span>).innerHTML += <span class="error">`</span><span class="tag">&lt;li&gt;</span>${messageFromCloudFunction}<span class="tag">&lt;/li&gt;</span><span class="error">`</span> <i class="conum" data-value="3"></i><b>(3)</b>
}</pre></td>
</tr></table></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Each time a user clicks on the button defined in the HTML, this method is called.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Calls the <code>helloWorld</code> <em>cloud function</em> and store the result in a variable.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Add a new list item in the HTML page</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Before running this sample, we improve our front in order to also understand
how to call a <em>cloud function</em> that has parameters.</p>
</div>
</div>
<div class="sect4">
<h5 id="_call_code_saysomething_code_em_cloud_function_em"><a class="anchor" href="#_call_code_saysomething_code_em_cloud_function_em"></a><a class="link" href="#_call_code_saysomething_code_em_cloud_function_em">12.2.3.3. Call <code>saySomething</code> <em>cloud function</em></a></h5>
<div class="paragraph">
<p>We add two inputs to be able to send values to the <code>saySomething</code> <em>cloud function</em>.
The first input is a text to repeat. The second input is the number of times to repeat the message.
Here is the updated code:</p>
</div>
<div class="listingblock highlight-lines:12-16">
<div class="title">front/index.html</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="html"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
</pre></td>
  <td class="code"><pre><span class="doctype">&lt;!DOCTYPE html&gt;</span>
<span class="tag">&lt;html</span> <span class="attribute-name">lang</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">en</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>

<span class="tag">&lt;head&gt;</span>
    <span class="tag">&lt;meta</span> <span class="attribute-name">charset</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">UTF-8</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
    <span class="tag">&lt;meta</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">viewport</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">content</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">width=device-width, initial-scale=1.0</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
    <span class="tag">&lt;title&gt;</span>Celtia<span class="tag">&lt;/title&gt;</span>
<span class="tag">&lt;/head&gt;</span>

<span class="tag">&lt;body&gt;</span>
    <span class="tag">&lt;button</span> <span class="attribute-name">onclick</span>=<span class="string"><span class="delimiter">&quot;</span>hello()<span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>hello<span class="tag">&lt;/button&gt;</span>
    <span class="tag">&lt;div</span> <span class="attribute-name">style</span>=<span class="string"><span class="delimiter">&quot;</span><span class="key">border</span>: <span class="float">1px</span> <span class="value">solid</span> <span class="color">#ccc</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
      Message: <span class="tag">&lt;input</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">text</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">message-input</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>             <i class="conum" data-value="1"></i><b>(1)</b>
      Repeat: <span class="tag">&lt;input</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">text</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">1</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">repeat-input</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>     <i class="conum" data-value="2"></i><b>(2)</b>
      <span class="tag">&lt;button</span> <span class="attribute-name">onclick</span>=<span class="string"><span class="delimiter">&quot;</span>saySeveralTimes()<span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>say something<span class="tag">&lt;/button&gt;</span>    <i class="conum" data-value="3"></i><b>(3)</b>
    <span class="tag">&lt;/div&gt;</span>
    <span class="tag">&lt;ul</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">result-container</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span><span class="tag">&lt;/ul&gt;</span>

    <span class="tag">&lt;script</span> <span class="attribute-name">src</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">https://unpkg.com/@zetapush/client</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span><span class="tag">&lt;/script&gt;</span>
    <span class="tag">&lt;script</span> <span class="attribute-name">src</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">./index.js</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span><span class="tag">&lt;/script&gt;</span>
<span class="tag">&lt;/body&gt;</span>

<span class="tag">&lt;/html&gt;</span></pre></td>
</tr></table></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The first input to enter a message</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The second input to enter the number of times to repeat the message</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>A new button to call <code>saySeveralTimes()</code> function defined in <code>index.js</code></td>
</tr>
</table>
</div>
<div class="listingblock highlight-lines:15-20">
<div class="title">front/index.js</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
</pre></td>
  <td class="code"><pre><span class="comment">// Create new ZetaPush Client</span>
const client = <span class="keyword">new</span> ZetaPushClient.WeakClient();
<span class="comment">// Create a proxy to invoked worker methods</span>
const api = client.createProxyTaskService();
<span class="comment">// Handle connection</span>
client.connect()
  .then(() =&gt; {
    console.debug(<span class="string"><span class="delimiter">'</span><span class="content">onConnectionEstablished</span><span class="delimiter">'</span></span>);
  });
<span class="comment">// Handle DOM events</span>
async <span class="keyword">function</span> <span class="function">hello</span>() {
  const messageFromCloudFunction = await api.helloWorld();
  document.getElementById(<span class="string"><span class="delimiter">'</span><span class="content">result-container</span><span class="delimiter">'</span></span>).innerHTML += <span class="error">`</span><span class="tag">&lt;li&gt;</span>${messageFromCloudFunction}<span class="tag">&lt;/li&gt;</span><span class="error">`</span>
}
async <span class="keyword">function</span> <span class="function">saySeveralTimes</span>() {                                                <i class="conum" data-value="1"></i><b>(1)</b>
  const message = document.getElementById(<span class="string"><span class="delimiter">'</span><span class="content">message-input</span><span class="delimiter">'</span></span>).value;                 <i class="conum" data-value="2"></i><b>(2)</b>
  const repeat = document.getElementById(<span class="string"><span class="delimiter">'</span><span class="content">repeat-input</span><span class="delimiter">'</span></span>).value;                   <i class="conum" data-value="3"></i><b>(3)</b>
  const messages = await api.saySomething(message, parseInt(repeat));             <i class="conum" data-value="4"></i><b>(4)</b>
  document.getElementById(<span class="string"><span class="delimiter">'</span><span class="content">result-container</span><span class="delimiter">'</span></span>).innerHTML += <span class="error">`</span><span class="tag">&lt;li&gt;</span>${messages}<span class="tag">&lt;/li&gt;</span><span class="error">`</span> <i class="conum" data-value="5"></i><b>(5)</b>
}</pre></td>
</tr></table></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Each time a user clicks on the button 'say something' defined in the HTML, this method is called.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Reads the value of the input for getting the message.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Reads the value of the input for getting the number of times to display the message.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Calls <code>saySomething</code> <em>cloud function</em> with parameters. Note that as second parameter is a number, we have to convert the string from
the input to a number using <code>parseInt</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Add a new list item in the HTML page containing the repeated messages</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Now everything is ready to run our application.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
When you call a <em>cloud function</em> from the client, the result is always a Promise even if the <em>custom cloud function</em> is synchronous
because everything goes through the network.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_run_application"><a class="anchor" href="#_run_application"></a><a class="link" href="#_run_application">12.2.4. Run application</a></h4>
<div class="paragraph">
<p>You have now defined a <em>custom cloud service</em> with one or several <em>cloud function(s)</em>. You
have also exposed your <em>custom cloud service</em>. So it is ready to be called from a client.
Your client is also ready to call the <em>custom cloud service</em>.</p>
</div>
<div class="paragraph">
<p>The next step is to start the project (both front and worker) using the ZetaPush <em>CLI</em>
on your computer.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Npm script aliases</div>
<div class="paragraph">
<p>Npm provides a handy feature
to run scripts provided by dependencies without needing to change your computer settings or
install the tool. ZetaPush defines npm <a href="https://medium.com/@mxstbr/npm-scripts-explained-f125e85eb378" target="_blank" rel="noopener">script aliases</a>
to run the ZetaPush <em>CLI</em> through npm.</p>
</div>
<div class="paragraph">
<p>See <a href="#_using_cli">for more information about the ways of using the CLI</a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To start your worker and you front using the ZetaPush <em>CLI</em> through npm, you simply run:</p>
</div>
<div class="listingblock">
<div class="title">Start application (front and custom cloud services)</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="console">$ npm run start -- --serve-front</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p><code>npm run start</code> is a script alias defined in the <code>package.json</code> file.
The command that is executed under the hood is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="console">$ zeta run --serve-front</code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Run only the worker</div>
<div class="paragraph">
<p>It is also possible to <a href="#run_worker_only">run only your worker</a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="title">Automatic injection of ZetaPush information in your front</div>
<div class="paragraph">
<p>If you look closely to the code we have written, there is no information about your application at all in this sample code (the <code>appName</code> defined in <code>.zetarc</code> is neither in HTML nor in JavaScript).
However, in order to interact with your application through the ZetaPush cloud, you need to provide the <code>appName</code>.</p>
</div>
<div class="paragraph">
<p>The ZetaPush <em>CLI</em> automatically injects the <code>appName</code> from <code>.zetarc</code>.</p>
</div>
<div class="paragraph">
<p>When you run your project locally, the local HTTP server that exposes the HTML page is lightly modified to include the <code>appName</code>.
This information is then automatically read by the ZetaPush client.</p>
</div>
<div class="paragraph">
<p>When your project is run in the cloud, the same principle is applied.</p>
</div>
<div class="paragraph">
<p>This way, you just use <code>.zetarc</code> file for your credentials and <code>appName</code> and avoid having to write them twice. This also avoids conflicts when you work
in team if you want different ZetaPush <code>appName</code> per developer.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong>Now when we click the "hello" button, "Hello World" is displayed on the page.</strong></p>
</div>
<div class="imageblock center">
<div class="content">
<img src="call-zetapush-cloud-service.png" alt="call zetapush cloud service" width="739" height="431">
</div>
<div class="title">Figure 6. How it works ?</div>
</div>
<div class="paragraph">
<p>When you start your project locally, the first thing that happens is that your worker connects himself automatically to the ZetaPush cloud <span class="sequence-step">1</span> <span class="sequence-step">2</span>.</p>
</div>
<div class="paragraph">
<p>Then when you open your web browser, the connection from the client is established between the web page and the ZetaPush cloud <span class="sequence-step">3</span> <span class="sequence-step">4</span>.</p>
</div>
<div class="paragraph">
<p>When you click on the button, a message is sent through the opened connection in order to tell ZetaPush cloud to execute some
remote code <span class="sequence-step">5</span>. ZetaPush cloud routes the message to your worker <span class="sequence-step">6</span> (that is running on your machine here). The worker receives the message
and calls the <code>hello</code> <em>cloud function</em> <span class="sequence-step">7</span>.</p>
</div>
<div class="paragraph">
<p>The <em>cloud function</em> generates a result <span class="sequence-step">8</span>. The worker picks this result and transform it to a message <span class="sequence-step">9</span>. This message is then sent
to the ZetaPush cloud <span class="sequence-step">10</span>. The ZetaPush cloud routes the response message to the calling client <span class="sequence-step">11</span>. The client receives the message
and the response is parsed <span class="sequence-step">12</span> and available in your JavaScript.</p>
</div>
<div class="paragraph">
<p><strong>You can also try to enter a message and a number of repetitions and hit the "say something" button.</strong></p>
</div>
<div class="paragraph">
<p>The behavior is exactly the same. This time a message is sent to call the <em>cloud function</em> with also the parameters.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Serialization/deserailization between client and <em>custom cloud service</em></div>
<div class="paragraph">
<p>When you call a <em>cloud function</em> from the client, under the hood, the values are serialized in JSON.
This is understandable because everything goes through the network.</p>
</div>
<div class="paragraph">
<p>On the worker side, everything is deserialized by the worker and your <em>custom cloud service</em>
receives the values as they were written in the front side.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_compose_cloud_services"><a class="anchor" href="#_compose_cloud_services"></a><a class="link" href="#_compose_cloud_services">12.2.5. Compose cloud services</a></h4>
<div class="paragraph">
<p>You can compose <em>cloud services</em> either by using <em>built-in cloud services</em> provided by ZetaPush or
by using another of your <em>custom cloud services</em>.</p>
</div>
<div class="sect4">
<h5 id="_dependency_injection"><a class="anchor" href="#_dependency_injection"></a><a class="link" href="#_dependency_injection">12.2.5.1. Dependency injection</a></h5>
<div class="paragraph">
<p><a href="https://en.wikipedia.org/wiki/Dependency_injection" target="_blank" rel="noopener">Dependency injection</a> is a powerful software technique that is
totally managed by the worker.</p>
</div>
<div class="paragraph">
<p>You don&#8217;t need to manage the creation of neither <em>built-in cloud services</em> nor your <em>custom cloud services</em>.
You just indicate in your code that you need a dependency and ZetaPush instantiates it
for you. The instantiated dependency is then injected everywhere the dependency is needed.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The dependency injection of ZetaPush uses Angular <a href="https://github.com/mgechev/injection-js" target="_blank" rel="noopener">injection-js</a> library.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To mark a <em>custom cloud service</em> injectable (meaning that can be automatically created by ZetaPush
and then injected everywhere the dependency is aksed),
you need to import the package <code>@zetapush/core</code> in order to use <code>Injectable</code> decorator.</p>
</div>
<div class="listingblock">
<div class="title">Install @zetapush/core using npm</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="console"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
</pre></td>
  <td class="code"><pre>$ npm install --save @zetapush/core</pre></td>
</tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>Once the npm package is installed, you can import <code>Injectable</code> decorator and place it on your <em>custom cloud service</em>:</p>
</div>
<div class="listingblock highlight-lines:1,3">
<div class="title">Use @Injectable on a <em>custom cloud service</em></div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
</pre></td>
  <td class="code"><pre><span class="reserved">import</span> { Injectable } from <span class="string"><span class="delimiter">'</span><span class="content">@zetapush/core</span><span class="delimiter">'</span></span>;            <i class="conum" data-value="1"></i><b>(1)</b>

<span class="error">@</span>Injectable()                                           <i class="conum" data-value="2"></i><b>(2)</b>
<span class="reserved">export</span> <span class="keyword">default</span> <span class="reserved">class</span> HelloWorldAsCustomCloudService {
  constructor() {}

  helloWorld() {
      <span class="keyword">return</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">Hello World</span><span class="delimiter">&quot;</span></span>;
  }

  saySomething(message: string, <span class="key">times</span>: number) {
      let fullMessage = <span class="string"><span class="delimiter">'</span><span class="delimiter">'</span></span>;
      <span class="keyword">for</span>(let i=<span class="integer">0</span> ; i&lt;times ; i++) {
          fullMessage += <span class="error">`</span><span class="predefined">$</span>{message}<span class="error">\</span>n<span class="error">`</span>
      }
      <span class="keyword">return</span> fullMessage
  }
}</pre></td>
</tr></table></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Import the ZetaPush module that contains core features for <em>custom cloud services</em> such as <code>injectable</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Mark you <em>custom cloud service</em> candidate for dependency injection</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Here we just indicate that this <em>custom cloud service</em> can have dependencies that
will be automatically injected and also that this <em>custom cloud service</em> can be injected
anywhere it is needed.</p>
</div>
<div class="paragraph">
<p>In the next sections, we will see in concrete terms how to use it to reuse either a <em>built-in cloud service</em>
or one of your <em>custom cloud services</em>.</p>
</div>
</div>
<div class="sect4">
<h5 id="_use_built_in_em_cloud_service_em"><a class="anchor" href="#_use_built_in_em_cloud_service_em"></a><a class="link" href="#_use_built_in_em_cloud_service_em">12.2.5.2. Use built-in <em>cloud service</em></a></h5>
<div class="paragraph">
<p>ZetaPush <em>built-in cloud services</em> are available in <code>@zetapush/platform-legacy</code> module.
Add this module to your <code>package.json</code> by running the following command:</p>
</div>
<div class="listingblock">
<div class="title">Install @zetapush/platform-legacy using npm</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="console"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
</pre></td>
  <td class="code"><pre>$ npm install --save @zetapush/platform-legacy</pre></td>
</tr></table></code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">List of <em>cloud services</em> provided by ZetaPush</div>
<div class="paragraph">
<p>As a reminder, here is the <a href="#builtin_cloud_services">list of <em>built-in cloud services</em></a></p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In the following example, we will use the <code>Stack</code> <em>cloud service</em> provided by ZetaPush.
In our use-case, we want to put some data associated with the current timestamp and be able to list all stored data.</p>
</div>
<div class="paragraph">
<p>To do this, the <code>Stack</code> service already provides some methods:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>push({ <em>stack</em>: string, <em>data</em>: object });</code></p>
</li>
<li>
<p><code>list({ <em>stack</em>: string });</code></p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">MyStorageService</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
</pre></td>
  <td class="code"><pre><span class="reserved">import</span> { Injectable } from <span class="string"><span class="delimiter">'</span><span class="content">@zetapush/core</span><span class="delimiter">'</span></span>;
<span class="reserved">import</span> { Stack } from <span class="string"><span class="delimiter">'</span><span class="content">@zetapush/platform-legacy</span><span class="delimiter">'</span></span>;  <i class="conum" data-value="1"></i><b>(1)</b>

<span class="error">@</span>Injectable()
<span class="reserved">export</span> <span class="keyword">default</span> <span class="reserved">class</span> MyStorageService {
  <span class="reserved">private</span> stackName = <span class="string"><span class="delimiter">'</span><span class="content">stack-example</span><span class="delimiter">'</span></span>;

  constructor(<span class="reserved">private</span> stack: Stack) {}              <i class="conum" data-value="2"></i><b>(2)</b>

  <span class="comment">/**
   *  Store data with associated timestamp
   */</span>
  storeWithTimestamp(value: any) {
    <span class="keyword">return</span> <span class="local-variable">this</span>.stack.push({                        <i class="conum" data-value="3"></i><b>(3)</b>
      <span class="key">stack</span>: <span class="local-variable">this</span>.stackName,
      <span class="key">data</span>: {
        value,
        <span class="key">timestamp</span>: Date.now()
      }
    });
  }

  <span class="comment">/**
   * List all stored data
   */</span>
  getAllData() {
    <span class="keyword">return</span> <span class="local-variable">this</span>.stack.list({                        <i class="conum" data-value="4"></i><b>(4)</b>
      <span class="key">stack</span>: <span class="local-variable">this</span>.stackName
    });
  }
}</pre></td>
</tr></table></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>We import the <code>Stack</code> service so that TypeScript knows it</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>We ask ZetaPush to inject a dependency of type <code>Stack</code> (<code>stack</code> is an instance of <code>Stack</code>).
Here we use the <a href="https://kendaleiv.com/typescript-constructor-assignment-public-and-private-keywords/" target="_blank" rel="noopener">shorthand syntax</a> for declaring a constructor parameter as well as a property.
So the property <code>this.stack</code> is defined and is initialized with <code>stack</code> parameter.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Calls the <code>Stack</code> service to store data (method <code>push</code>)</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Calls the <code>Stack</code> service to list data (method <code>list</code>)</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The example defines a <em>custom cloud service</em> named <code>MyStorageService</code> that provides two <em>cloud functions</em>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>storeWithTimestamp</code> that receives a value from a client and calls the <code>Stack</code> service to
store received value (<code>value</code> parameter) as well as the current timestamp (using <code>Date.now()</code>)</p>
</li>
<li>
<p><code>getAllData</code> that has no parameters and calls <code>Stack</code> service to get all previsouly stored
pairs of <code>&lt;value, timestamp&gt;</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The most important part to understand is in the <code>constructor</code>. As described before,
the example uses dependency injection. You simply tell ZetaPush that you need a dependency of type <code>Stack</code>.
You don&#8217;t create it in your <em>custom cloud service</em> because it is not the responsibility of
your <em>custom cloud service</em> to create the <code>Stack</code> service. Instead, you let ZetaPush
handle the creation. Thanks to <code>@Injectable</code> decorator, ZetaPush detects that you have
a <em>custom cloud services</em> with needed dependencies. ZetaPush understands that you need a <code>Stack</code>
instance so it instantiates it before instantiating your <em>custom cloud service</em>. Then
ZetaPush instantiates your <em>custom cloud service</em> by providing, as the first argument of your
constructor here, the instance of <code>Stack</code>.</p>
</div>
<div class="paragraph">
<p>This behavior avoids you to have complex code to instantiate <em>built-in cloud services</em>. Moreover,
if you have several <em>custom cloud services</em> that are using the <code>Stack</code> service, thanks to
dependency injection, there will be only one instance shared between your <em>custom cloud services</em>.</p>
</div>
</div>
<div class="sect4">
<h5 id="_use_another_em_custom_cloud_service_em"><a class="anchor" href="#_use_another_em_custom_cloud_service_em"></a><a class="link" href="#_use_another_em_custom_cloud_service_em">12.2.5.3. Use another <em>custom cloud service</em></a></h5>
<div class="paragraph">
<p>In this example, we will have 2 <em>custom cloud services</em>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>Calendar</code>: Utils function to return the current date</p>
</li>
<li>
<p><code>HelloWorldService</code>: Basic example using <code>Calendar</code> <em>cloud function</em></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The first <em>custom cloud service</em> (<code>Calendar</code>) is defined in the file <code>worker/calendar.js</code>.</p>
</div>
<div class="listingblock">
<div class="title">worker/calendar.ts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
</pre></td>
  <td class="code"><pre><span class="reserved">export</span> <span class="reserved">class</span> Calendar {
  getNow() { <i class="conum" data-value="1"></i><b>(1)</b>
    <span class="keyword">return</span> <span class="keyword">new</span> Date().toLocalDateString(<span class="string"><span class="delimiter">'</span><span class="content">fr-FR</span><span class="delimiter">'</span></span>);
  }
}</pre></td>
</tr></table></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The only <em>cloud function</em> of the <code>Calendar</code> service</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Then, we have the <code>HelloWorldWithDateService</code> that use our <code>Calendar</code> service. It is defined in the file <code>worker/index.ts</code>.</p>
</div>
<div class="listingblock highlight-lines:7,13">
<div class="title">worker/index.ts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre></td>
  <td class="code"><pre><span class="reserved">import</span> { Injectable } from <span class="string"><span class="delimiter">'</span><span class="content">@zetapush/core</span><span class="delimiter">'</span></span>;
<span class="reserved">import</span> { Calendar } from <span class="string"><span class="delimiter">'</span><span class="content">./calendar</span><span class="delimiter">'</span></span>;        <i class="conum" data-value="1"></i><b>(1)</b>

<span class="error">@</span>Injectable()
<span class="reserved">export</span> <span class="keyword">default</span> <span class="reserved">class</span> HelloWorldWithDateService {
  constructor(                                <i class="conum" data-value="2"></i><b>(2)</b>
    <span class="reserved">private</span> calendar: Calendar
  ) {}
  <span class="comment">/**
   * Return 'Hello World' with current date
   */</span>
  helloWorldWithDate() {
    <span class="keyword">return</span> <span class="error">`</span>Hello world at <span class="predefined">$</span>{<span class="local-variable">this</span>.calendar.getNow()}<span class="error">`</span>;
 }
}</pre></td>
</tr></table></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>We import the <code>Calendar</code> service from the <code>worker/calendar.ts</code> file</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td><code>calendar</code> is an instance of <code>Calendar</code> and <code>this.calendar</code> is initialized with <code>calendar</code> value</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>As for <em>built-in cloud services</em>, dependency injection works for your <em>custom cloud services</em>.
Here it was an example</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Private <em>custom cloud service</em></div>
<div class="paragraph">
<p>In this example, we still have only one <em>custom cloud service</em> exposed.</p>
</div>
<div class="paragraph">
<p>One <code>HelloWorldWithDateService</code> is exposed and delegates some work to <code>Calendar</code>.
<code>Calendar</code> is not exposed and can&#8217;t be directly called from a client. So it can be considered
as a private <em>custom cloud service</em>.</p>
</div>
<div class="paragraph">
<p>Sometimes you may want to <a href="#expose_several_cloud_services">expose several <em>custom cloud services</em></a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Shared module of <em>custom cloud services</em></div>
<div class="paragraph">
<p>As you can see, a <em>custom cloud service</em> is no more than just a standard class with methods written
in TypeScript. If you want to develop reusable <em>custom cloud services</em> that could be
used in different applications, you can do it easily by following standards.
Actually, you can <a href="#shared_module">just create a npm module</a> and import it like we do with <code>@zetapush/core</code> or
<code>@zetapush/platform-legacy</code>.</p>
</div>
<div class="paragraph">
<p>You can also import any existing library that is available in the community.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_develop_fast"><a class="anchor" href="#_develop_fast"></a><a class="link" href="#_develop_fast">12.3. Develop fast</a></h3>
<div class="sect3">
<h4 id="_hot_reload"><a class="anchor" href="#_hot_reload"></a><a class="link" href="#_hot_reload">12.3.1. Hot reload</a></h4>
<div class="paragraph">
<p>In order to improve productivity, ZetaPush provides <strong>hot reload</strong> feature.
Once you have started your application on your computer, you just focus on writing your code.</p>
</div>
<div class="paragraph">
<p>Each time you make a change in your <em>custom cloud services</em> code, ZetaPush detects the change
and reload your <em>custom cloud services</em> code. The time to wait for code to be ready is drastically reduced so
you can develop really faster thanks to this feature.</p>
</div>
<div class="paragraph">
<p>As front part is simply HTML and JavaScript, the local HTTP server always serves the
latest version of your code. The cache is explicitly disabled in local development.</p>
</div>
<div class="sect4">
<h5 id="_test_the_feature"><a class="anchor" href="#_test_the_feature"></a><a class="link" href="#_test_the_feature">12.3.1.1. Test the feature</a></h5>
<div class="paragraph">
<p>To test this feature, we will reuse the <strong>HelloWorldAsCustomCloudService</strong> sample.
As a reminder, here is the code:</p>
</div>
<div class="paragraph tab-container">
<p>HelloWorldAsCustomCloudService</p>
</div>
<div class="paragraph tab">
<p>worker/index.ts</p>
</div>
<div class="listingblock">
<div class="title">worker/index.ts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
</pre></td>
  <td class="code"><pre><span class="reserved">import</span> { Injectable } from <span class="string"><span class="delimiter">'</span><span class="content">@zetapush/core</span><span class="delimiter">'</span></span>;

<span class="error">@</span>Injectable()
<span class="reserved">export</span> <span class="keyword">default</span> <span class="reserved">class</span> HelloWorldAsCustomCloudService {
    constructor() {}

    helloWorld() {
        <span class="keyword">return</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">Hello World</span><span class="delimiter">&quot;</span></span>;
    }

    saySomething(message: string, <span class="key">times</span>: number) {
        let fullMessage = <span class="string"><span class="delimiter">'</span><span class="delimiter">'</span></span>;
        <span class="keyword">for</span>(let i=<span class="integer">0</span> ; i&lt;times ; i++) {
            fullMessage += <span class="error">`</span><span class="predefined">$</span>{message}<span class="error">\</span>n<span class="error">`</span>
        }
        <span class="keyword">return</span> fullMessage
    }
}</pre></td>
</tr></table></code></pre>
</div>
</div>
<div class="paragraph tab">
<p>front/index.html</p>
</div>
<div class="listingblock">
<div class="title">front/index.html</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="html"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
</pre></td>
  <td class="code"><pre><span class="doctype">&lt;!DOCTYPE html&gt;</span>
<span class="tag">&lt;html</span> <span class="attribute-name">lang</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">en</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>

<span class="tag">&lt;head&gt;</span>
    <span class="tag">&lt;meta</span> <span class="attribute-name">charset</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">UTF-8</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
    <span class="tag">&lt;meta</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">viewport</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">content</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">width=device-width, initial-scale=1.0</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
    <span class="tag">&lt;title&gt;</span>Celtia<span class="tag">&lt;/title&gt;</span>
<span class="tag">&lt;/head&gt;</span>

<span class="tag">&lt;body&gt;</span>
    <span class="tag">&lt;button</span> <span class="attribute-name">onclick</span>=<span class="string"><span class="delimiter">&quot;</span>hello()<span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>hello<span class="tag">&lt;/button&gt;</span>
    <span class="tag">&lt;div</span> <span class="attribute-name">style</span>=<span class="string"><span class="delimiter">&quot;</span><span class="key">border</span>: <span class="float">1px</span> <span class="value">solid</span> <span class="color">#ccc</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
      Message: <span class="tag">&lt;input</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">text</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">message-input</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
      Repeat: <span class="tag">&lt;input</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">text</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">1</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">repeat-input</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
      <span class="tag">&lt;button</span> <span class="attribute-name">onclick</span>=<span class="string"><span class="delimiter">&quot;</span>saySeveralTimes()<span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>say something<span class="tag">&lt;/button&gt;</span>
    <span class="tag">&lt;/div&gt;</span>
    <span class="tag">&lt;ul</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">result-container</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span><span class="tag">&lt;/ul&gt;</span>

    <span class="tag">&lt;script</span> <span class="attribute-name">src</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">https://unpkg.com/@zetapush/client</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span><span class="tag">&lt;/script&gt;</span>
    <span class="tag">&lt;script</span> <span class="attribute-name">src</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">./index.js</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span><span class="tag">&lt;/script&gt;</span>
<span class="tag">&lt;/body&gt;</span>

<span class="tag">&lt;/html&gt;</span></pre></td>
</tr></table></code></pre>
</div>
</div>
<div class="paragraph tab">
<p>front/index.js</p>
</div>
<div class="listingblock">
<div class="title">front/index.js</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
</pre></td>
  <td class="code"><pre><span class="comment">// Create new ZetaPush Client</span>
const client = <span class="keyword">new</span> ZetaPushClient.WeakClient();
<span class="comment">// Create a proxy to invoked worker methods</span>
const api = client.createProxyTaskService();
<span class="comment">// Handle connection</span>
client.connect()
  .then(() =&gt; {
    console.debug(<span class="string"><span class="delimiter">'</span><span class="content">onConnectionEstablished</span><span class="delimiter">'</span></span>);
  });
<span class="comment">// Handle DOM events</span>
async <span class="keyword">function</span> <span class="function">hello</span>() {
  const messageFromCloudFunction = await api.helloWorld();
  document.getElementById(<span class="string"><span class="delimiter">'</span><span class="content">result-container</span><span class="delimiter">'</span></span>).innerHTML += <span class="error">`</span><span class="tag">&lt;li&gt;</span>${messageFromCloudFunction}<span class="tag">&lt;/li&gt;</span><span class="error">`</span>
}
async <span class="keyword">function</span> <span class="function">saySeveralTimes</span>() {
  const message = document.getElementById(<span class="string"><span class="delimiter">'</span><span class="content">message-input</span><span class="delimiter">'</span></span>).value;
  const repeat = document.getElementById(<span class="string"><span class="delimiter">'</span><span class="content">repeat-input</span><span class="delimiter">'</span></span>).value;
  const messages = await api.saySomething(message, parseInt(repeat));
  document.getElementById(<span class="string"><span class="delimiter">'</span><span class="content">result-container</span><span class="delimiter">'</span></span>).innerHTML += <span class="error">`</span><span class="tag">&lt;li&gt;</span>${messages}<span class="tag">&lt;/li&gt;</span><span class="error">`</span>
}</pre></td>
</tr></table></code></pre>
</div>
</div>
<div class="paragraph tab-container-end">
<p>-</p>
</div>
<div class="paragraph">
<p>Now start your application by running:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="console">$ npm run start -- --serve-front</code></pre>
</div>
</div>
<div class="paragraph">
<p>Click on 'hello' button, the message "Hello World" appears in the web page.</p>
</div>
<div class="sect5">
<h6 id="_simple_change_in_code_of_your_em_custom_cloud_service_em"><a class="anchor" href="#_simple_change_in_code_of_your_em_custom_cloud_service_em"></a><a class="link" href="#_simple_change_in_code_of_your_em_custom_cloud_service_em">Simple change in code of your <em>custom cloud service</em></a></h6>
<div class="paragraph">
<p>Your application is started locally. Now we will test this feature by updating your code.
Update the <code>worker/index.ts</code> file as following:</p>
</div>
<div class="listingblock highlight-lines:8 collapse-lines:10-17">
<div class="title">worker/index.ts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
</pre></td>
  <td class="code"><pre><span class="reserved">import</span> { Injectable } from <span class="string"><span class="delimiter">'</span><span class="content">@zetapush/core</span><span class="delimiter">'</span></span>;

<span class="error">@</span>Injectable()
<span class="reserved">export</span> <span class="keyword">default</span> <span class="reserved">class</span> HelloWorldAsCustomCloudService {
    constructor() {}

    helloWorld() {
        <span class="keyword">return</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">Hello World !!!</span><span class="delimiter">&quot;</span></span>;                       <i class="conum" data-value="1"></i><b>(1)</b>
    }

    saySomething(message: string, <span class="key">times</span>: number) {
        let fullMessage = <span class="string"><span class="delimiter">'</span><span class="delimiter">'</span></span>;
        <span class="keyword">for</span>(let i=<span class="integer">0</span> ; i&lt;times ; i++) {
            fullMessage += <span class="error">`</span><span class="predefined">$</span>{message}<span class="error">\</span>n<span class="error">`</span>
        }
        <span class="keyword">return</span> fullMessage
    }
}</pre></td>
</tr></table></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Add " !!!" at the end of the string</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Save the file and check your terminal. You should see something like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="console">⠋ Reloading worker...
[INFO] Worker is up!</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can check that the code is really updated by clicking on the 'hello' button.
Now you see that "Hello World !!!" is displayed in the web page.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">No change is needed on the front</div>
<div class="paragraph">
<p>You don&#8217;t need to reload the web page or to reconnect the client to the ZetaPush cloud.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect5">
<h6 id="_change_code_of_your_front"><a class="anchor" href="#_change_code_of_your_front"></a><a class="link" href="#_change_code_of_your_front">Change code of your front</a></h6>
<div class="paragraph">
<p>To demonstrate a change in your front, we will update the code of the
<code>saySeveralTimes</code> function:</p>
</div>
<div class="listingblock highlight-lines:18 collapse-lines:1-14">
<div class="title">front/index.js</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
</pre></td>
  <td class="code"><pre><span class="comment">// Create new ZetaPush Client</span>
const client = <span class="keyword">new</span> ZetaPushClient.WeakClient();
<span class="comment">// Create a proxy to invoked worker methods</span>
const api = client.createProxyTaskService();
<span class="comment">// Handle connection</span>
client.connect()
  .then(() =&gt; {
    console.debug(<span class="string"><span class="delimiter">'</span><span class="content">onConnectionEstablished</span><span class="delimiter">'</span></span>);
  });
<span class="comment">// Handle DOM events</span>
async <span class="keyword">function</span> <span class="function">hello</span>() {
  const messageFromCloudFunction = await api.helloWorld();
  document.getElementById(<span class="string"><span class="delimiter">'</span><span class="content">result-container</span><span class="delimiter">'</span></span>).innerHTML += <span class="error">`</span><span class="tag">&lt;li&gt;</span>${messageFromCloudFunction}<span class="tag">&lt;/li&gt;</span><span class="error">`</span>
}
async <span class="keyword">function</span> <span class="function">saySeveralTimes</span>() {
  const message = document.getElementById(<span class="string"><span class="delimiter">'</span><span class="content">message-input</span><span class="delimiter">'</span></span>).value;
  const repeat = document.getElementById(<span class="string"><span class="delimiter">'</span><span class="content">repeat-input</span><span class="delimiter">'</span></span>).value;
  const messages = await api.saySomething(message + <span class="string"><span class="delimiter">'</span><span class="content"> - </span><span class="delimiter">'</span></span>, parseInt(repeat));               <i class="conum" data-value="1"></i><b>(1)</b>
  document.getElementById(<span class="string"><span class="delimiter">'</span><span class="content">result-container</span><span class="delimiter">'</span></span>).innerHTML += <span class="error">`</span><span class="tag">&lt;li&gt;</span>${messages}<span class="tag">&lt;/li&gt;</span><span class="error">`</span>
}</pre></td>
</tr></table></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>We add ' - ' on the message parameter</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Save your file and reload your web page. Enter a message ("hello" for example) and click on 'say something' button.
You should see "hello - hello - " (if you have chosen 2 repetitions).</p>
</div>
</div>
<div class="sect5">
<h6 id="_use_a_em_cloud_service_em_on_the_fly"><a class="anchor" href="#_use_a_em_cloud_service_em_on_the_fly"></a><a class="link" href="#_use_a_em_cloud_service_em_on_the_fly">Use a <em>cloud service</em> on the fly</a></h6>
<div class="paragraph">
<p>As your application grows, you will need to use other <em>built-in cloud services</em> or <em>custom cloud services</em>.</p>
</div>
<div class="paragraph">
<p>We will improve our <em>custom cloud service</em> to use the <code>Stack</code> <em>built-in cloud service</em> to store messages.
First <code>Stack</code> service is provided by <code>@zetapush/platform-legacy</code> module. So you have to install it.
You can keep your application running in your terminal and open another terminal in the same folder.
Execute this command in the new terminal:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="console">$ npm install --save @zetapush/platform-legacy</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can now import <code>Stack</code> service in your code and use it:</p>
</div>
<div class="listingblock highlight-lines:2,6,17-26,30-37">
<div class="title">worker/index.ts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
</pre></td>
  <td class="code"><pre><span class="reserved">import</span> { Injectable } from <span class="string"><span class="delimiter">'</span><span class="content">@zetapush/core</span><span class="delimiter">'</span></span>;
<span class="reserved">import</span> { Stack } from <span class="string"><span class="delimiter">'</span><span class="content">@zetapush/platform-legacy</span><span class="delimiter">'</span></span>;          <i class="conum" data-value="1"></i><b>(1)</b>

<span class="error">@</span>Injectable()
<span class="reserved">export</span> <span class="keyword">default</span> <span class="reserved">class</span> HelloWorldAsCustomCloudService {
  constructor(<span class="reserved">private</span> stack: Stack) {}                      <i class="conum" data-value="2"></i><b>(2)</b>

  helloWorld() {
    <span class="keyword">return</span> <span class="string"><span class="delimiter">'</span><span class="content">Hello World</span><span class="delimiter">'</span></span>;
  }

  async saySomething(message: string, <span class="key">times</span>: number) {
    let fullMessage = <span class="string"><span class="delimiter">'</span><span class="delimiter">'</span></span>;
    <span class="keyword">for</span> (let i = <span class="integer">0</span>; i &lt; times; i++) {
      fullMessage += <span class="error">`</span><span class="predefined">$</span>{message}<span class="error">\</span>n<span class="error">`</span>;
    }
    <span class="comment">// store source information (message and times)</span>
    <span class="comment">// and generated information (fullMessage)</span>
    await <span class="local-variable">this</span>.stack.push({                                 <i class="conum" data-value="3"></i><b>(3)</b>
      <span class="key">stack</span>: <span class="string"><span class="delimiter">'</span><span class="content">messages</span><span class="delimiter">'</span></span>,
      <span class="key">data</span>: {
        message,
        times,
        fullMessage
      }
    });
    <span class="keyword">return</span> fullMessage;
  }

  async getStoredMessages() {                               <i class="conum" data-value="4"></i><b>(4)</b>
    <span class="comment">// get all values</span>
    const response = await <span class="local-variable">this</span>.stack.list({
      <span class="key">stack</span>: <span class="string"><span class="delimiter">'</span><span class="content">messages</span><span class="delimiter">'</span></span>
    });
    <span class="comment">// get only useful part (message, times, fullMessage)</span>
    <span class="keyword">return</span> response.result ? response.result.content.map((item) =&gt; item.data) : [];
  }
}</pre></td>
</tr></table></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Import the module <code>@zetapush/platform-legacy</code> that we just installed with npm</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Indicate that we need a dependency of type <code>Stack</code> that will be provided by ZetaPush worker</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Add some code to store the messages. Here we store both received parameters and the generated message</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>A new <em>cloud function</em> in order to display what&#8217;s in the database</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You can save your file and if you look in your terminal, you can see something like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="console">⠋ Reloading worker...
[INFO] Create services [ [ { itemId: 'stack',
      businessId: 'v79ivn00l',
      deploymentId: 'stack_0',
      description: 'stack',
      options: {},
      forbiddenVerbs: [Array],
⠴ Reloading worker...
[INFO] Worker is up!</code></pre>
</div>
</div>
<div class="paragraph">
<p>To ensure that everything works fine, you need to update your front:</p>
</div>
<div class="listingblock highlight-lines:8,19,21-25 collapse-lines:1-4">
<div class="title">front/index.js</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
</pre></td>
  <td class="code"><pre><span class="comment">// Create new ZetaPush Client</span>
const client = <span class="keyword">new</span> ZetaPushClient.WeakClient();
<span class="comment">// Create a proxy to invoked worker methods</span>
const api = client.createProxyTaskService();
<span class="comment">// Handle connection</span>
client.connect().then(() =&gt; {
  console.debug(<span class="string"><span class="delimiter">'</span><span class="content">onConnectionEstablished</span><span class="delimiter">'</span></span>);
  <span class="keyword">return</span> displayAllMessages();                                                                 <i class="conum" data-value="1"></i><b>(1)</b>
});
<span class="comment">// Handle DOM events</span>
async <span class="keyword">function</span> <span class="function">hello</span>() {
  const messageFromCloudFunction = await api.helloWorld();
  document.getElementById(<span class="string"><span class="delimiter">'</span><span class="content">result-container</span><span class="delimiter">'</span></span>).innerHTML += <span class="error">`</span><span class="tag">&lt;li&gt;</span>${messageFromCloudFunction}<span class="tag">&lt;/li&gt;</span><span class="error">`</span>;
}
async <span class="keyword">function</span> <span class="function">saySeveralTimes</span>() {
  const message = document.getElementById(<span class="string"><span class="delimiter">'</span><span class="content">message-input</span><span class="delimiter">'</span></span>).value;
  const repeat = document.getElementById(<span class="string"><span class="delimiter">'</span><span class="content">repeat-input</span><span class="delimiter">'</span></span>).value;
  const messages = await api.saySomething(message + <span class="string"><span class="delimiter">'</span><span class="content"> - </span><span class="delimiter">'</span></span>, parseInt(repeat));
  await displayAllMessages();                                                                  <i class="conum" data-value="2"></i><b>(2)</b>
}
async <span class="keyword">function</span> <span class="function">displayAllMessages</span>() {                                                          <i class="conum" data-value="3"></i><b>(3)</b>
  const storedMessages = await api.getStoredMessages();                                        <i class="conum" data-value="4"></i><b>(4)</b>
  const messagesAsString = storedMessages.map((msg) =&gt; <span class="error">`</span><span class="tag">&lt;li&gt;</span>${JSON.stringify(msg)}<span class="tag">&lt;/li&gt;</span><span class="error">`</span>);     <i class="conum" data-value="5"></i><b>(5)</b>
  document.getElementById(<span class="string"><span class="delimiter">'</span><span class="content">result-container</span><span class="delimiter">'</span></span>).innerHTML = messagesAsString.join(<span class="string"><span class="delimiter">'</span><span class="delimiter">'</span></span>);           <i class="conum" data-value="6"></i><b>(6)</b>
}</pre></td>
</tr></table></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Load all messages once connected.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Replace code that writes <code>fullMessage</code> in the HTML by a call to the function below.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Define another function to display all messages.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Call the <em>cloud function</em> to retrieve all stored messages in database. This is the
important part of the code because it calls a <em>cloud function</em> freshly written.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Convert object of values to a JSON string.</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>Write all stored messages in the HTML.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Save your file and reload your web page. You can enter a message ("foo" for example) and a number
of repetitions (5 for example). Then hit the 'say something' button. Now you will see something like:</p>
</div>
<div class="paragraph">
<p><code>{"message":"foo - ","times":5,"fullMessage":"foo - foo - foo - foo - foo - "}</code></p>
</div>
<div class="paragraph">
<p>This means that your <em>custom cloud service</em> has been reloaded and the <code>Stack</code> service
is really used. You can ensure that by reloading the web page, you will see the message
displayed in the web page.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Import npm module</div>
<div class="paragraph">
<p>As you can see, you can add a npm module even if your application is running
and then import it in your code. The hot reload takes effect only when
you update the code handled by the ZetaPush worker (i.e. your <em>custom cloud services</em> code).</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Hot reload with <em>built-in cloud services</em></div>
<div class="paragraph">
<p>Thanks to dependency injection, ZetaPush worker can detect if a <em>built-in cloud service</em>
is newly needed as a dependency. In fact, the worker keeps tracking of all dependencies to <em>built-in cloud services</em>
and check if a new service is asked. If so, the worker creates it on ZetaPush cloud,
instantiates it, and injects it everywhere it is needed.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<i class="fa icon-caution" title="Caution"></i>
</td>
<td class="content">
<div class="title">Hot reload on other files</div>
<div class="paragraph">
<p>Currently, if you update <code>.zetarc</code> or you update a configuration file or any other file
that is not code loaded by the worker, your <em>custom cloud services</em> won&#8217;t be automatically reloaded.</p>
</div>
<div class="paragraph">
<p>This feature will be supported in a future version.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_auto_completion"><a class="anchor" href="#_auto_completion"></a><a class="link" href="#_auto_completion">12.3.2. Auto-completion</a></h4>
<div class="paragraph">
<p>You can use an IDE for speeding up your development:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://code.visualstudio.com/" target="_blank" rel="noopener">Visual Studio Code</a></p>
</li>
<li>
<p><a href="https://www.jetbrains.com/webstorm/" target="_blank" rel="noopener">WebStorm</a></p>
</li>
<li>
<p><a href="https://atom.io/" target="_blank" rel="noopener">Atom</a></p>
</li>
<li>
<p>&#8230;&#8203;</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Thanks to typing provided by TypeScript, these IDE can provide accurate auto-completion when
you develop your <em>custom cloud services</em>.</p>
</div>
<div class="paragraph">
<p>That&#8217;s why auto-completion also works with ZetaPush <em>built-in cloud services</em>:</p>
</div>
<div class="imageblock center">
<div class="content">
<img src="./images//auto-completion/method.png" alt="method">
</div>
<div class="title">Figure 7. Auto-completion on <em>cloud functions</em></div>
</div>
<div class="imageblock center">
<div class="content">
<img src="./images//auto-completion/parameters.png" alt="parameters">
</div>
<div class="title">Figure 8. Auto-completion on <em>cloud functions</em> parameters</div>
</div>
<div class="imageblock center">
<div class="content">
<img src="./images//auto-completion/returned-values.png" alt="returned values">
</div>
<div class="title">Figure 9. Auto-completion on <em>cloud functions</em> return value</div>
</div>
<div class="paragraph">
<p>As you can see, in addition to auto-completion, documentation of <em>cloud services</em> is
also available.</p>
</div>
</div>
<div class="sect3">
<h4 id="_log_from_a_em_custom_cloud_service_em"><a class="anchor" href="#_log_from_a_em_custom_cloud_service_em"></a><a class="link" href="#_log_from_a_em_custom_cloud_service_em">12.3.3. Log from a <em>custom cloud service</em></a></h4>
<div class="sect4">
<h5 id="_log_using_local_console"><a class="anchor" href="#_log_using_local_console"></a><a class="link" href="#_log_using_local_console">12.3.3.1. Log using local console</a></h5>
<div class="paragraph">
<p>NodeJS provides <code>console</code> object that you can use in your code. For example, update
the code of your <em>custom cloud service</em> to add some logs:</p>
</div>
<div class="listingblock highlight-lines:13,18,29">
<div class="title">worker/index.ts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
</pre></td>
  <td class="code"><pre><span class="reserved">import</span> { Injectable } from <span class="string"><span class="delimiter">'</span><span class="content">@zetapush/core</span><span class="delimiter">'</span></span>;
<span class="reserved">import</span> { Stack } from <span class="string"><span class="delimiter">'</span><span class="content">@zetapush/platform-legacy</span><span class="delimiter">'</span></span>;

<span class="error">@</span>Injectable()
<span class="reserved">export</span> <span class="keyword">default</span> <span class="reserved">class</span> HelloWorldAsCustomCloudService {
  constructor(<span class="reserved">private</span> stack: Stack) {}

  helloWorld() {
    <span class="keyword">return</span> <span class="string"><span class="delimiter">'</span><span class="content">Hello World</span><span class="delimiter">'</span></span>;
  }

  async saySomething(message: string, <span class="key">times</span>: number) {
    console.log(<span class="string"><span class="delimiter">'</span><span class="content">message=</span><span class="delimiter">'</span></span>, message, <span class="string"><span class="delimiter">'</span><span class="content">times=</span><span class="delimiter">'</span></span>, times);
    let fullMessage = <span class="string"><span class="delimiter">'</span><span class="delimiter">'</span></span>;
    <span class="keyword">for</span> (let i = <span class="integer">0</span>; i &lt; times; i++) {
      fullMessage += <span class="error">`</span><span class="predefined">$</span>{message}<span class="error">\</span>n<span class="error">`</span>;
    }
    console.debug(<span class="string"><span class="delimiter">'</span><span class="content">fullMessage=</span><span class="delimiter">'</span></span>, fullMessage);
    <span class="comment">// store source information (message and times)</span>
    <span class="comment">// and generated information (fullMessage)</span>
    const response = await <span class="local-variable">this</span>.stack.push({
      <span class="key">stack</span>: <span class="string"><span class="delimiter">'</span><span class="content">messages</span><span class="delimiter">'</span></span>,
      <span class="key">data</span>: {
        message,
        times,
        fullMessage
      }
    });
    console.debug(<span class="string"><span class="delimiter">'</span><span class="content">stack.push response=</span><span class="delimiter">'</span></span>, response);
    <span class="keyword">return</span> fullMessage;
  }

  async getStoredMessages() {
    <span class="comment">// get all values</span>
    const response = await <span class="local-variable">this</span>.stack.list({
      <span class="key">stack</span>: <span class="string"><span class="delimiter">'</span><span class="content">messages</span><span class="delimiter">'</span></span>
    });
    <span class="comment">// get only useful part (message, times, fullMessage)</span>
    <span class="keyword">return</span> response.result ? response.result.content.map((item) =&gt; item.data) : [];
  }
}</pre></td>
</tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>Running your application and hitting 'say something' button with a "hello" message and 5 repetitions,
your terminal will print something like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="console">[INFO] Worker is up!  ‌
message= hello -  times= 5                                                          <i class="conum" data-value="1"></i><b>(1)</b>
fullMessage= hello -                                                                <i class="conum" data-value="2"></i><b>(2)</b>
hello -
hello -
hello -
hello -

stack.push response= { contextId: '3303/4rU/4934',                                  <i class="conum" data-value="3"></i><b>(3)</b>
  owner: 'v79ivn00l:root',
  stack: 'messages',
  ts: 1544096927555,
  guid: '///+mHymsL1sq8jZZa1F2g==',
  data:
   { message: 'hello - ',
     times: 5,
     fullMessage: 'hello - \nhello - \nhello - \nhello - \nhello - \n' } }</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The first <code>console.log</code> that displays parameters</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The first <code>console.debug</code> that displays the generated message</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The second <code>console.debug</code> that displays the response of the <code>Stack</code> service</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>As you can see, you can have any number of parameters you want and of any type.
For objects, the <code>console</code> will display it as JSON string.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="title">Logs in production</div>
<div class="paragraph">
<p>Logging using <code>console</code> only logs in your terminal. It means that nothing is neither written to a file
nor sent to a logging server. You will then loose all logs if you close your terminal.</p>
</div>
<div class="paragraph">
<p>However, when you will later publish your application on the ZetaPush cloud, everything
written in standard and error outputs will be available in the
<a href="#logs_in_web_console">ZetaPush web console</a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Levels and colors in local console</div>
<div class="paragraph">
<p>ZetaPush also provides a logger object that can be useful to distinguish levels.
Levels are explicitly written (for example <code>[INFO]</code>). Each level has its own
name displayed in color and may have a color for the message too.
This is useful to quickly view what is important.</p>
</div>
<div class="paragraph">
<p>You can learn <a href="#local_logger">how to use the local logger</a>.</p>
</div>
<div class="paragraph">
<p>Moreover, thanks to levels you <a href="#verbosity_level">can start your application with a particular level</a>
so levels below the selected level are not displayed at all.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_log_using_zetapush_em_built_in_cloud_service_em"><a class="anchor" href="#_log_using_zetapush_em_built_in_cloud_service_em"></a><a class="link" href="#_log_using_zetapush_em_built_in_cloud_service_em">12.3.3.2. Log using ZetaPush <em>built-in cloud service</em></a></h5>
<div class="paragraph">
<p>In order to provide a logger with more features, ZetaPush provides the <a href="#_logs"><code>Logs</code> cloud service</a>.
Thanks to this service you can provide more context to your log entries (a logger name, levels, tags or an identifier, &#8230;&#8203;).</p>
</div>
<div class="paragraph">
<p>The service <a href="#log_service">can be used directly</a> but code for logging may be a quite verbose if you provide
all information manually.</p>
</div>
<div class="paragraph">
<p>So ZetaPush also provides an automatic logging feature that magically adds:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>the name of the called <em>cloud function</em></p>
</li>
<li>
<p>the parameter values of the called <em>cloud function</em></p>
</li>
<li>
<p>the returned value of the called <em>cloud function</em></p>
</li>
<li>
<p>the current date</p>
</li>
<li>
<p>the unique identifier of the request</p>
</li>
<li>
<p>which user has made the call</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>It also automatically logs all calls to <em>builtin cloud services</em> that could be
made in the <em>cloud function</em>.</p>
</div>
<div class="listingblock highlight-lines:1,5,6,19,30">
<div class="title">worker/index.ts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
</pre></td>
  <td class="code"><pre><span class="reserved">import</span> { Injectable, RequestContextAware, RequestContext } from <span class="string"><span class="delimiter">'</span><span class="content">@zetapush/core</span><span class="delimiter">'</span></span>;     <i class="conum" data-value="1"></i><b>(1)</b>
<span class="reserved">import</span> { Stack } from <span class="string"><span class="delimiter">'</span><span class="content">@zetapush/platform-legacy</span><span class="delimiter">'</span></span>;

<span class="error">@</span>Injectable()
<span class="reserved">export</span> <span class="keyword">default</span> <span class="reserved">class</span> HelloWorldAsCustomCloudService <span class="reserved">implements</span> RequestContextAware {  <i class="conum" data-value="2"></i><b>(2)</b>
  requestContext!: RequestContext;                                                    <i class="conum" data-value="3"></i><b>(3)</b>

  constructor(<span class="reserved">private</span> stack: Stack) {}

  helloWorld() {
    <span class="keyword">return</span> <span class="string"><span class="delimiter">'</span><span class="content">Hello World</span><span class="delimiter">'</span></span>;
  }

  async saySomething(message: string, <span class="key">times</span>: number) {
    let fullMessage = <span class="string"><span class="delimiter">'</span><span class="delimiter">'</span></span>;
    <span class="keyword">for</span> (let i = <span class="integer">0</span>; i &lt; times; i++) {
      fullMessage += <span class="error">`</span><span class="predefined">$</span>{message}<span class="error">\</span>n<span class="error">`</span>;
    }
    <span class="local-variable">this</span>.requestContext.logger.debug(<span class="string"><span class="delimiter">'</span><span class="content">fullMessage=</span><span class="delimiter">'</span></span>, fullMessage);                           <i class="conum" data-value="4"></i><b>(4)</b>
    <span class="comment">// store source information (message and times)</span>
    <span class="comment">// and generated information (fullMessage)</span>
    const response = await <span class="local-variable">this</span>.stack.push({
      <span class="key">stack</span>: <span class="string"><span class="delimiter">'</span><span class="content">messages</span><span class="delimiter">'</span></span>,
      <span class="key">data</span>: {
        message,
        times,
        fullMessage
      }
    });
    <span class="local-variable">this</span>.requestContext.logger.debug(<span class="string"><span class="delimiter">'</span><span class="content">stack.push response=</span><span class="delimiter">'</span></span>, response);                      <i class="conum" data-value="5"></i><b>(5)</b>
    <span class="keyword">return</span> fullMessage;
  }

  async getStoredMessages() {
    <span class="comment">// get all values</span>
    const response = await <span class="local-variable">this</span>.stack.list({
      <span class="key">stack</span>: <span class="string"><span class="delimiter">'</span><span class="content">messages</span><span class="delimiter">'</span></span>
    });
    <span class="comment">// get only useful part (message, times, fullMessage)</span>
    <span class="keyword">return</span> response.result ? response.result.content.map((item) =&gt; item.data) : [];
  }
}</pre></td>
</tr></table></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Import <code>RequestContext</code> and <code>RequestContextAware</code> from <code>@zetapush/core</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Implements <code>RequestContextAware</code> to indicate that we use <code>requestContext</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td><code>requestContext</code> magic property that is automatically provided by the worker. No need to initialize it.
The <code>!</code> character is here to guide TypeScript otherwise there is a compilation error because
<code>requestContext</code> is not initialized.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Calls logger of <code>requestContext</code> to log <code>fullMessage</code></td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Calls logger of <code>requestContext</code> to log <code>response</code></td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">RequestContextAware</div>
<div class="paragraph">
<p>Implementing <code>RequestContextAware</code> is totally optional but recommended even if it works
without it.
If you work in team, it indicates to other developers that
the use of <code>requestContext</code> attribute is intentional and that it is not dead code.
Moreover, implementing this interface gives you some documentation about <code>requestContext</code>
attribute.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Definite Assignment Assertions</div>
<div class="paragraph">
<p>TypeScript checks that a
<a href="https://github.com/Microsoft/TypeScript/wiki/What&#8217;s-new-in-TypeScript#strict-class-initialization" target="_blank" rel="noopener">class attribute is initialized</a>.</p>
</div>
<div class="paragraph">
<p>As <code>requestContext</code> is an injected attribute, its value is not directly initialized in your class.
The <a href="https://github.com/Microsoft/TypeScript/wiki/What&#8217;s-new-in-TypeScript#definite-assignment-assertions" target="_blank" rel="noopener">Definite Assignment Assertions</a>
allows to explicitly indicate to TypeScript type checker that
the attribute is initialized outside of the class (using <code>!</code> character after attribute name).</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Internally, the logger uses the <em>Logs cloud service</em>. The logs are by default sent to
ZetaPush cloud and then available in ZetaPush web console. The ZetaPush worker is aware
of the current context. So every log entry is enhanced with current context call.</p>
</div>
<div class="paragraph">
<p>For the example, start your application and hit the 'say something' button.
Here is the result of the logs in the web console:</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Advanced usage</div>
<div class="paragraph">
<p>You can find more information about <a href="#log_with_requestcontext">advance usage of the logger provided by <code>RequestContext</code></a>
in reference documentation.</p>
</div>
<div class="paragraph">
<p>You can also learn how to <a href="#persist_logs">persist logs</a> and how to <a href="#custom_logging_server">send logs to a custom log server</a>.</p>
</div>
<div class="paragraph">
<p>You can learn how to <a href="#use_custom_tags">use custom tags</a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Integration with libraries</div>
<div class="paragraph">
<p>NodeJS community provides several logging libraries like <a href="https://github.com/winstonjs/winston" target="_blank" rel="noopener">winston</a>,
<a href="https://github.com/trentm/node-bunyan" target="_blank" rel="noopener">bunyan</a>, <a href="https://github.com/expressjs/morgan" target="_blank" rel="noopener">morgan</a>, &#8230;&#8203;</p>
</div>
<div class="paragraph">
<p>Currently, you can use them to log into the local console but as said before, the current
context is not automatically provided.
In the futur, ZetaPush will provide bridges to fully support those libraries to automatically
provide the current context.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_debug_a_em_custom_cloud_service_em"><a class="anchor" href="#_debug_a_em_custom_cloud_service_em"></a><a class="link" href="#_debug_a_em_custom_cloud_service_em">12.3.4. Debug a <em>custom cloud service</em></a></h4>
<div class="sect4">
<h5 id="_debug_your_application_with_vscode"><a class="anchor" href="#_debug_your_application_with_vscode"></a><a class="link" href="#_debug_your_application_with_vscode">12.3.4.1. Debug your application with VSCode</a></h5>
<div class="paragraph">
<p>VSCode provide a powerfull debugging feature <a href="https://code.visualstudio.com/docs/editor/debugging" class="bare">https://code.visualstudio.com/docs/editor/debugging</a>.</p>
</div>
<div class="paragraph">
<p>Add a launch configuration with the following structure.</p>
</div>
<div class="listingblock">
<div class="title">Configure .vscode/launch.json file</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
</pre></td>
  <td class="code"><pre>{
  <span class="key"><span class="delimiter">&quot;</span><span class="content">version</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">0.2.0</span><span class="delimiter">&quot;</span></span>,
  <span class="key"><span class="delimiter">&quot;</span><span class="content">configurations</span><span class="delimiter">&quot;</span></span>: [
    {
      <span class="key"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">zeta run</span><span class="delimiter">&quot;</span></span>,                                       <i class="conum" data-value="1"></i><b>(1)</b>
      <span class="key"><span class="delimiter">&quot;</span><span class="content">type</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">node</span><span class="delimiter">&quot;</span></span>,
      <span class="key"><span class="delimiter">&quot;</span><span class="content">request</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">launch</span><span class="delimiter">&quot;</span></span>,
      <span class="key"><span class="delimiter">&quot;</span><span class="content">program</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">${workspaceRoot}/node_modules/.bin/zeta</span><span class="delimiter">&quot;</span></span>,     <i class="conum" data-value="2"></i><b>(2)</b>
      <span class="key"><span class="delimiter">&quot;</span><span class="content">stopOnEntry</span><span class="delimiter">&quot;</span></span>: <span class="value">false</span>,
      <span class="key"><span class="delimiter">&quot;</span><span class="content">sourceMaps</span><span class="delimiter">&quot;</span></span>: <span class="value">true</span>,
      <span class="key"><span class="delimiter">&quot;</span><span class="content">args</span><span class="delimiter">&quot;</span></span>: [                                                 <i class="conum" data-value="3"></i><b>(3)</b>
        <span class="string"><span class="delimiter">&quot;</span><span class="content">run</span><span class="delimiter">&quot;</span></span>,
        <span class="string"><span class="delimiter">&quot;</span><span class="content">--serve-front</span><span class="delimiter">&quot;</span></span>
      ],
      <span class="key"><span class="delimiter">&quot;</span><span class="content">cwd</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">${workspaceRoot}</span><span class="delimiter">&quot;</span></span>,
      <span class="key"><span class="delimiter">&quot;</span><span class="content">console</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">internalConsole</span><span class="delimiter">&quot;</span></span>
    }
  ]
}</pre></td>
</tr></table></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Launch configuration name (the name you want)</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Path to local zeta <em>CLI</em></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>zeta command arguments</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Under the hood, VSCode runs a NodeJS process that runs <code>node_modules/.bin/zeta</code> script
with two parameters <code>run</code> and <code>--serve-front</code>.</p>
</div>
<div class="paragraph">
<p>It is exactly the same as doing:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="console">$ node_modules/.bin/zeta run --serve-front</code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>VSCode may use a different version of the NodeJS you use in an external terminal.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Once the configuration is ready, you can start your application in debug mode as indicated
in <a href="https://code.visualstudio.com/docs/editor/debugging" target="_blank" rel="noopener">VSCode documentation</a>.</p>
</div>
<div class="paragraph">
<p>In the following picture, we show that the debugger stops in the code of your <em>custom cloud service</em>.
You can also see the values of the parameters and now you can execute the code step by step.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images//debug/run-vscode-debugger.png" alt="Run VSCode debugger">
</div>
</div>
</div>
<div class="sect4">
<h5 id="_debug_your_application_with_intellij_based_ide"><a class="anchor" href="#_debug_your_application_with_intellij_based_ide"></a><a class="link" href="#_debug_your_application_with_intellij_based_ide">12.3.4.2. Debug your application with IntelliJ based IDE</a></h5>
<div class="paragraph">
<p>Intellij&#8217;s WebStorm provides a powerfull debugging feature <a href="https://blog.jetbrains.com/webstorm/2018/01/how-to-debug-with-webstorm/" class="bare">https://blog.jetbrains.com/webstorm/2018/01/how-to-debug-with-webstorm/</a>.</p>
</div>
<div class="paragraph">
<p>On the top menu, select Run &#8594; Edit Configurations</p>
</div>
<div class="paragraph">
<p>then select a new NodeJs Template :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Node interpreter : path to nodeJS executable.</p>
</li>
<li>
<p>Node parameters : must be "node_modules/.bin/zeta".</p>
</li>
<li>
<p>Working directory : path to your project.</p>
</li>
<li>
<p>Javascript file : should be blank.</p>
</li>
<li>
<p>Application parameters : zeta command to launch, with optionals flags.</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="./images//debug/webstorm-debug.png" alt="Configure WebStorm Debug">
</div>
</div>
<div class="paragraph">
<p>You can now use Intellij in debug mode with breakpoints and all the debugs features.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_test_a_em_custom_cloud_service_em"><a class="anchor" href="#_test_a_em_custom_cloud_service_em"></a><a class="link" href="#_test_a_em_custom_cloud_service_em">12.3.5. Test a <em>custom cloud service</em></a></h4>
<div class="sect4">
<h5 id="_test_your_em_custom_cloud_service_em"><a class="anchor" href="#_test_your_em_custom_cloud_service_em"></a><a class="link" href="#_test_your_em_custom_cloud_service_em">12.3.5.1. Test your <em>custom cloud service</em></a></h5>
<div class="paragraph">
<p>Testing not only ensures that you don&#8217;t make regression but also can help you code faster.</p>
</div>
<div class="sect5">
<h6 id="_unit_testing"><a class="anchor" href="#_unit_testing"></a><a class="link" href="#_unit_testing">Unit testing</a></h6>
<div class="paragraph">
<p>Unit testing is a great way to provide quickly a feature without losing time
on going back to the right execution context. The component (or <code>class</code> here)
is tested alone (all dependencies are mocked).</p>
</div>
<div class="paragraph">
<p>This section shows that you don&#8217;t need ZetaPush for unit testing and that you can
use any testing library you want. For the example, we use <a href="https://jasmine.github.io/" target="_blank" rel="noopener">jasmine</a> because
in addition to testing tools, it also provides basic mocking features.
For the example, we will reuse our <strong>HelloWorldAsCustomCloudService</strong> and we will improve it.</p>
</div>
<div class="paragraph">
<p>As a reminder, here is the complete code of the <em>custom cloud service</em> and front:</p>
</div>
<div class="paragraph tab-container">
<p>HelloWorldAsCustomCloudService</p>
</div>
<div class="paragraph tab">
<p>worker/index.ts</p>
</div>
<div class="listingblock">
<div class="title">worker/index.ts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
</pre></td>
  <td class="code"><pre><span class="reserved">import</span> { Injectable, RequestContextAware, RequestContext } from <span class="string"><span class="delimiter">'</span><span class="content">@zetapush/core</span><span class="delimiter">'</span></span>;
<span class="reserved">import</span> { Stack } from <span class="string"><span class="delimiter">'</span><span class="content">@zetapush/platform-legacy</span><span class="delimiter">'</span></span>;

<span class="error">@</span>Injectable()
<span class="reserved">export</span> <span class="keyword">default</span> <span class="reserved">class</span> HelloWorldAsCustomCloudService <span class="reserved">implements</span> RequestContextAware {
  requestContext!: RequestContext;

  constructor(<span class="reserved">private</span> stack: Stack) {}

  helloWorld() {
    <span class="keyword">return</span> <span class="string"><span class="delimiter">'</span><span class="content">Hello World</span><span class="delimiter">'</span></span>;
  }

  async saySomething(message: string, <span class="key">times</span>: number) {
    let fullMessage = <span class="string"><span class="delimiter">'</span><span class="delimiter">'</span></span>;
    <span class="keyword">for</span> (let i = <span class="integer">0</span>; i &lt; times; i++) {
      fullMessage += <span class="error">`</span><span class="predefined">$</span>{message}<span class="error">\</span>n<span class="error">`</span>;
    }
    <span class="local-variable">this</span>.requestContext.logger.debug(<span class="string"><span class="delimiter">'</span><span class="content">fullMessage=</span><span class="delimiter">'</span></span>, fullMessage);
    <span class="comment">// store source information (message and times)</span>
    <span class="comment">// and generated information (fullMessage)</span>
    const response = await <span class="local-variable">this</span>.stack.push({
      <span class="key">stack</span>: <span class="string"><span class="delimiter">'</span><span class="content">messages</span><span class="delimiter">'</span></span>,
      <span class="key">data</span>: {
        message,
        times,
        fullMessage
      }
    });
    <span class="local-variable">this</span>.requestContext.logger.debug(<span class="string"><span class="delimiter">'</span><span class="content">stack.push response=</span><span class="delimiter">'</span></span>, response);
    <span class="keyword">return</span> fullMessage;
  }

  async getStoredMessages() {
    <span class="comment">// get all values</span>
    const response = await <span class="local-variable">this</span>.stack.list({
      <span class="key">stack</span>: <span class="string"><span class="delimiter">'</span><span class="content">messages</span><span class="delimiter">'</span></span>
    });
    <span class="comment">// get only useful part (message, times, fullMessage)</span>
    <span class="keyword">return</span> response.result ? response.result.content.map((item) =&gt; item.data) : [];
  }
}</pre></td>
</tr></table></code></pre>
</div>
</div>
<div class="paragraph tab">
<p>front/index.html</p>
</div>
<div class="listingblock">
<div class="title">front/index.html</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="html"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
</pre></td>
  <td class="code"><pre><span class="doctype">&lt;!DOCTYPE html&gt;</span>
<span class="tag">&lt;html</span> <span class="attribute-name">lang</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">en</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;head&gt;</span>
    <span class="tag">&lt;meta</span> <span class="attribute-name">charset</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">UTF-8</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
    <span class="tag">&lt;meta</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">viewport</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">content</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">width=device-width, initial-scale=1.0</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
    <span class="tag">&lt;title&gt;</span>Celtia<span class="tag">&lt;/title&gt;</span>
  <span class="tag">&lt;/head&gt;</span>

  <span class="tag">&lt;body&gt;</span>
    <span class="tag">&lt;button</span> <span class="attribute-name">onclick</span>=<span class="string"><span class="delimiter">&quot;</span>hello()<span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>hello<span class="tag">&lt;/button&gt;</span>
    <span class="tag">&lt;div</span> <span class="attribute-name">style</span>=<span class="string"><span class="delimiter">&quot;</span><span class="key">border</span>: <span class="float">1px</span> <span class="value">solid</span> <span class="color">#ccc</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
      Message: <span class="tag">&lt;input</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">text</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">message-input</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span> Repeat: <span class="tag">&lt;input</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">text</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">1</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">repeat-input</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
      <span class="tag">&lt;button</span> <span class="attribute-name">onclick</span>=<span class="string"><span class="delimiter">&quot;</span>saySeveralTimes()<span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>say something<span class="tag">&lt;/button&gt;</span>
    <span class="tag">&lt;/div&gt;</span>
    <span class="tag">&lt;ul</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">result-container</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span><span class="tag">&lt;/ul&gt;</span>

    <span class="tag">&lt;script</span> <span class="attribute-name">src</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">https://unpkg.com/@zetapush/client</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span><span class="tag">&lt;/script&gt;</span>
    <span class="tag">&lt;script</span> <span class="attribute-name">src</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">./index.js</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span><span class="tag">&lt;/script&gt;</span>
  <span class="tag">&lt;/body&gt;</span>
<span class="tag">&lt;/html&gt;</span></pre></td>
</tr></table></code></pre>
</div>
</div>
<div class="paragraph tab">
<p>front/index.js</p>
</div>
<div class="listingblock">
<div class="title">front/index.js</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
</pre></td>
  <td class="code"><pre><span class="comment">// Create new ZetaPush Client</span>
const client = <span class="keyword">new</span> ZetaPushClient.WeakClient();
<span class="comment">// Create a proxy to invoked worker methods</span>
const api = client.createProxyTaskService();
<span class="comment">// Handle connection</span>
client.connect().then(() =&gt; {
  console.debug(<span class="string"><span class="delimiter">'</span><span class="content">onConnectionEstablished</span><span class="delimiter">'</span></span>);
  <span class="keyword">return</span> updateAllMessages();
});
<span class="comment">// Handle DOM events</span>
async <span class="keyword">function</span> <span class="function">hello</span>() {
  const messageFromCloudFunction = await api.helloWorld();
  document.getElementById(<span class="string"><span class="delimiter">'</span><span class="content">result-container</span><span class="delimiter">'</span></span>).innerHTML += <span class="error">`</span><span class="tag">&lt;li&gt;</span>${messageFromCloudFunction}<span class="tag">&lt;/li&gt;</span><span class="error">`</span>;
}
async <span class="keyword">function</span> <span class="function">saySeveralTimes</span>() {
  const message = document.getElementById(<span class="string"><span class="delimiter">'</span><span class="content">message-input</span><span class="delimiter">'</span></span>).value;
  const repeat = document.getElementById(<span class="string"><span class="delimiter">'</span><span class="content">repeat-input</span><span class="delimiter">'</span></span>).value;
  const messages = await api.saySomething(message + <span class="string"><span class="delimiter">'</span><span class="content"> - </span><span class="delimiter">'</span></span>, parseInt(repeat));
  await updateAllMessages();
}
async <span class="keyword">function</span> <span class="function">updateAllMessages</span>() {
  const storedMessages = await api.getStoredMessages();
  const messagesAsString = storedMessages.map((msg) =&gt; <span class="error">`</span><span class="tag">&lt;li&gt;</span>${JSON.stringify(msg)}<span class="tag">&lt;/li&gt;</span><span class="error">`</span>);
  document.getElementById(<span class="string"><span class="delimiter">'</span><span class="content">result-container</span><span class="delimiter">'</span></span>).innerHTML = messagesAsString.join(<span class="string"><span class="delimiter">'</span><span class="delimiter">'</span></span>);
}</pre></td>
</tr></table></code></pre>
</div>
</div>
<div class="paragraph tab-container-end">
<p>-</p>
</div>
<div class="paragraph">
<p>Firstly, we add <code>jasmine</code> by running:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="console">$ npm install --save-dev jasmine                    <i class="conum" data-value="1"></i><b>(1)</b>
$ node node_modules/jasmine/bin/jasmine init        <i class="conum" data-value="2"></i><b>(2)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Add <code>jasmine</code> module in your project (save it in <code>devDependencies</code> using <code>--save-dev</code> argument)</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Add some files required by jasmine to your project (<code>spec</code> folder is created)</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>We want to test <code>saySomething</code> <em>cloud function</em> to ensure that the generated message
corresponds to what we really want. Let&#8217;s start by writing the skeleton of the tests. Create the file
<code>spec/hello-world-custom-cloud-service/say-something.spec.js</code> with the following content:</p>
</div>
<div class="listingblock">
<div class="title">spec/hellp-world-custom-cloud-service/say-something.spec.js</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
</pre></td>
  <td class="code"><pre>describe(<span class="string"><span class="delimiter">&quot;</span><span class="content">HelloWorldCustomCloudService.</span><span class="delimiter">&quot;</span></span>, () =&gt; {
  beforeEach(() =&gt; {
    <span class="local-variable">this</span>.helloWorldService = <span class="predefined-constant">null</span>;                                          <i class="conum" data-value="1"></i><b>(1)</b>
  });

  <span class="comment">/**
   * Nominal case with a message repeated 1 time
   */</span>
  describe(<span class="string"><span class="delimiter">&quot;</span><span class="content">saySomething('hello', 1)</span><span class="delimiter">&quot;</span></span>, () =&gt; {
    it(<span class="string"><span class="delimiter">&quot;</span><span class="content">returns the message written 1 time</span><span class="delimiter">&quot;</span></span>, async () =&gt; {
      const result = await <span class="local-variable">this</span>.helloWorldService.saySomething(<span class="string"><span class="delimiter">'</span><span class="content">hello</span><span class="delimiter">'</span></span>, <span class="integer">1</span>);
      expect(result).toBe(<span class="string"><span class="delimiter">'</span><span class="content">hello</span><span class="delimiter">'</span></span>);
    });
  });

  <span class="comment">/**
   * Nominal case with a message repeated 5 times
   */</span>
  describe(<span class="string"><span class="delimiter">&quot;</span><span class="content">saySomething('hello', 5)</span><span class="delimiter">&quot;</span></span>, () =&gt; {
    it(<span class="string"><span class="delimiter">&quot;</span><span class="content">returns the message written 5 times separated by new lines</span><span class="delimiter">&quot;</span></span>, async () =&gt; {
      const result = await <span class="local-variable">this</span>.helloWorldService.saySomething(<span class="string"><span class="delimiter">'</span><span class="content">hello</span><span class="delimiter">'</span></span>, <span class="integer">5</span>);
      expect(result).toBe(<span class="string"><span class="delimiter">'</span><span class="content">hello</span><span class="content">\n</span><span class="content">hello</span><span class="content">\n</span><span class="content">hello</span><span class="content">\n</span><span class="content">hello</span><span class="content">\n</span><span class="content">hello</span><span class="delimiter">'</span></span>);
    });
  });

  <span class="comment">/**
   * Edge case with a message but nothing written due to no repetition
   */</span>
  describe(<span class="string"><span class="delimiter">&quot;</span><span class="content">saySomething('hello', 0)</span><span class="delimiter">&quot;</span></span>, () =&gt; {
    it(<span class="string"><span class="delimiter">&quot;</span><span class="content">returns empty message</span><span class="delimiter">&quot;</span></span>, async () =&gt; {
      const result = await <span class="local-variable">this</span>.helloWorldService.saySomething(<span class="string"><span class="delimiter">'</span><span class="content">hello</span><span class="delimiter">'</span></span>, <span class="integer">0</span>);
      expect(result).toBe(<span class="string"><span class="delimiter">'</span><span class="delimiter">'</span></span>);
    });
  });

  <span class="comment">/**
   * Edge case with a message that is not a string
   */</span>
  describe(<span class="string"><span class="delimiter">&quot;</span><span class="content">saySomething(5, 2)</span><span class="delimiter">&quot;</span></span>, () =&gt; {
    it(<span class="string"><span class="delimiter">&quot;</span><span class="content">returns the message written 2 times</span><span class="delimiter">&quot;</span></span>, async () =&gt; {
      const result = await <span class="local-variable">this</span>.helloWorldService.saySomething(<span class="integer">5</span>, <span class="integer">2</span>);
      expect(result).toBe(<span class="string"><span class="delimiter">'</span><span class="content">5</span><span class="content">\n</span><span class="content">5</span><span class="delimiter">'</span></span>);
    });
  });

  <span class="comment">/**
   * Exception case with a string for the number of repetitions
   */</span>
  describe(<span class="string"><span class="delimiter">&quot;</span><span class="content">saySomething('hello', '5')</span><span class="delimiter">&quot;</span></span>, () =&gt; {
    it(<span class="string"><span class="delimiter">&quot;</span><span class="content">returns the message written 5 times separated by new lines</span><span class="delimiter">&quot;</span></span>, async () =&gt; {
      <span class="keyword">try</span> {
        await <span class="local-variable">this</span>.helloWorldService.saySomething(<span class="string"><span class="delimiter">'</span><span class="content">hello</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">5</span><span class="delimiter">'</span></span>);
        fail(<span class="string"><span class="delimiter">'</span><span class="content">should have failed</span><span class="delimiter">'</span></span>);
      } <span class="keyword">catch</span>(e) {
        expect(e.message).toBe(<span class="string"><span class="delimiter">'</span><span class="content">Only integer values are allowed for number of repetitions</span><span class="delimiter">'</span></span>);
      }
    });
  });
});</pre></td>
</tr></table></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>We need an instance of your <em>custom cloud service</em> here. We will see later how to do that
in unit testing</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>We have prepared the tests and the expectations. Now we need to instantiate
the <strong>HelloWorldCustomCloudService</strong> for testing it. However this function has a
dependency to the <code>Stack</code> <em>built-in cloud service</em>.
So normally, to test it we need the ZetaPush worker and the ZetaPush cloud to instantiate
this service. But in unit testing, we mock <strong>all</strong> dependencies to test only
<strong>HelloWorldCustomCloudService</strong>:</p>
</div>
<div class="listingblock highlight-lines:1-2,6-11">
<div class="title">spec/hellp-world-custom-cloud-service/say-something.spec.js</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
</pre></td>
  <td class="code"><pre>const customCloudService = require(<span class="string"><span class="delimiter">'</span><span class="content">../../worker/index</span><span class="delimiter">'</span></span>);                         <i class="conum" data-value="1"></i><b>(1)</b>
const HelloWorldAsCustomCloudService = customCloudService[<span class="string"><span class="delimiter">'</span><span class="content">default</span><span class="delimiter">'</span></span>];             <i class="conum" data-value="2"></i><b>(2)</b>

describe(<span class="string"><span class="delimiter">'</span><span class="content">HelloWorldCustomCloudService.</span><span class="delimiter">'</span></span>, () =&gt; {
  beforeEach(() =&gt; {
    const mockedStack = jasmine.createSpyObj(<span class="string"><span class="delimiter">'</span><span class="content">Stack</span><span class="delimiter">'</span></span>, [<span class="string"><span class="delimiter">'</span><span class="content">push</span><span class="delimiter">'</span></span>]);                  <i class="conum" data-value="3"></i><b>(3)</b>
    const mockedRequestContext = {                                                <i class="conum" data-value="4"></i><b>(4)</b>
      <span class="key">logger</span>: jasmine.createSpyObj(<span class="string"><span class="delimiter">'</span><span class="content">RequestContextLogger</span><span class="delimiter">'</span></span>, [<span class="string"><span class="delimiter">'</span><span class="content">debug</span><span class="delimiter">'</span></span>])
    };
    <span class="local-variable">this</span>.helloWorldService = <span class="keyword">new</span> HelloWorldAsCustomCloudService(mockedStack);     <i class="conum" data-value="5"></i><b>(5)</b>
    <span class="local-variable">this</span>.helloWorldService.requestContext = mockedRequestContext;                 <i class="conum" data-value="6"></i><b>(6)</b>
  });

  <span class="comment">/**
   * Nominal case with a message repeated 1 time
   */</span>
  describe(<span class="string"><span class="delimiter">&quot;</span><span class="content">saySomething('hello', 1)</span><span class="delimiter">&quot;</span></span>, () =&gt; {
    it(<span class="string"><span class="delimiter">&quot;</span><span class="content">returns the message written 1 time</span><span class="delimiter">&quot;</span></span>, async () =&gt; {
      const result = await <span class="local-variable">this</span>.helloWorldService.saySomething(<span class="string"><span class="delimiter">'</span><span class="content">hello</span><span class="delimiter">'</span></span>, <span class="integer">1</span>);
      expect(result).toBe(<span class="string"><span class="delimiter">'</span><span class="content">hello</span><span class="delimiter">'</span></span>);
    });
  });

  <span class="comment">/**
   * Nominal case with a message repeated 5 times
   */</span>
  describe(<span class="string"><span class="delimiter">&quot;</span><span class="content">saySomething('hello', 5)</span><span class="delimiter">&quot;</span></span>, () =&gt; {
    it(<span class="string"><span class="delimiter">&quot;</span><span class="content">returns the message written 5 times separated by new lines</span><span class="delimiter">&quot;</span></span>, async () =&gt; {
      const result = await <span class="local-variable">this</span>.helloWorldService.saySomething(<span class="string"><span class="delimiter">'</span><span class="content">hello</span><span class="delimiter">'</span></span>, <span class="integer">5</span>);
      expect(result).toBe(<span class="string"><span class="delimiter">'</span><span class="content">hello</span><span class="content">\n</span><span class="content">hello</span><span class="content">\n</span><span class="content">hello</span><span class="content">\n</span><span class="content">hello</span><span class="content">\n</span><span class="content">hello</span><span class="delimiter">'</span></span>);
    });
  });

  <span class="comment">/**
   * Edge case with a message but nothing written due to no repetition
   */</span>
  describe(<span class="string"><span class="delimiter">&quot;</span><span class="content">saySomething('hello', 0)</span><span class="delimiter">&quot;</span></span>, () =&gt; {
    it(<span class="string"><span class="delimiter">&quot;</span><span class="content">returns empty message</span><span class="delimiter">&quot;</span></span>, async () =&gt; {
      const result = await <span class="local-variable">this</span>.helloWorldService.saySomething(<span class="string"><span class="delimiter">'</span><span class="content">hello</span><span class="delimiter">'</span></span>, <span class="integer">0</span>);
      expect(result).toBe(<span class="string"><span class="delimiter">'</span><span class="delimiter">'</span></span>);
    });
  });

  <span class="comment">/**
   * Edge case with a message that is not a string
   */</span>
  describe(<span class="string"><span class="delimiter">&quot;</span><span class="content">saySomething(5, 2)</span><span class="delimiter">&quot;</span></span>, () =&gt; {
    it(<span class="string"><span class="delimiter">&quot;</span><span class="content">returns the message written 2 times</span><span class="delimiter">&quot;</span></span>, async () =&gt; {
      const result = await <span class="local-variable">this</span>.helloWorldService.saySomething(<span class="integer">5</span>, <span class="integer">2</span>);
      expect(result).toBe(<span class="string"><span class="delimiter">'</span><span class="content">5</span><span class="content">\n</span><span class="content">5</span><span class="delimiter">'</span></span>);
    });
  });

  <span class="comment">/**
   * Exception case with a string for the number of repetitions
   */</span>
  describe(<span class="string"><span class="delimiter">&quot;</span><span class="content">saySomething('hello', '5')</span><span class="delimiter">&quot;</span></span>, () =&gt; {
    it(<span class="string"><span class="delimiter">&quot;</span><span class="content">returns the message written 5 times separated by new lines</span><span class="delimiter">&quot;</span></span>, async () =&gt; {
      <span class="keyword">try</span> {
        await <span class="local-variable">this</span>.helloWorldService.saySomething(<span class="string"><span class="delimiter">'</span><span class="content">hello</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">5</span><span class="delimiter">'</span></span>);
        fail(<span class="string"><span class="delimiter">'</span><span class="content">should have failed</span><span class="delimiter">'</span></span>);
      } <span class="keyword">catch</span>(e) {
        expect(e.message).toBe(<span class="string"><span class="delimiter">'</span><span class="content">Only integer values are allowed for number of repetitions</span><span class="delimiter">'</span></span>);
      }
    });
  });
});</pre></td>
</tr></table></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Import code of your <em>custom cloud service</em>. As it is declared in <code>index.ts</code> with <code>export default</code>,
the <code>require</code> imports an object <code>{default: HelloWorldCustomCloudService}</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Get only a reference to <code>HelloWorldCustomCloudService</code> class</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Use jasmine to create a mock object of <code>Stack</code> <em>cloud service</em> with a method <code>push</code> that does nothing</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Create an object that has a property <code>logger</code> with a mocked <code>debug</code> method. This object is used
to mock <code>requestContext</code> attribute.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Instantiate the <code>HelloWorldCustomCloudService</code> <em>cloud service</em> with the mocked instance of <code>Stack</code></td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>Manually inject the mocked <code>requestContext</code> (as the worker would do automatically in ZetaPush context)</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Now our cloud service is ready to be tested. We can run jasmine but as the <em>custom cloud service</em>
is written in TypeScript, we need to run jasmine with <a href="https://github.com/TypeStrong/ts-node" target="_blank" rel="noopener">ts-node</a>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="console">$ node -r ts-node/register node_modules/jasmine/bin/jasmine</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">TypeScript</div>
<div class="paragraph">
<p>As your project is initialized for using TypeScript, <code>ts-node</code> is already available
in your project (imported by the <code>@zetapush/cli</code> module).</p>
</div>
<div class="paragraph">
<p>You can also write your <a href="#test_in_typescript">tests directly in TypeScript</a> to benefit from auto-completion and
type checking in your test suites too.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Run directly from VSCode</div>
<div class="paragraph">
<p>You can configure VSCode to run your tests. In the main menu, click on <span class="menuseq"><b class="menu">Debug</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Add Configuration&#8230;&#8203;</b></span>:</p>
</div>
<div class="imageblock center">
<div class="content">
<img src="./images//debug/add-debug-menu.png" alt="add debug menu">
</div>
</div>
<div class="paragraph">
<p>Add these lines in the <code>launch.json</code> file:</p>
</div>
<div class="listingblock highlight-lines:7-22">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json">{
  <span class="error">/</span><span class="error">/</span> <span class="error">U</span><span class="error">s</span><span class="error">e</span> <span class="error">I</span><span class="error">n</span><span class="error">t</span><span class="error">e</span><span class="error">l</span><span class="error">l</span><span class="error">i</span><span class="error">S</span><span class="error">e</span><span class="error">n</span><span class="error">s</span><span class="error">e</span> <span class="error">t</span><span class="error">o</span> <span class="error">l</span><span class="error">e</span><span class="error">a</span><span class="error">r</span><span class="error">n</span> <span class="error">a</span><span class="error">b</span><span class="error">o</span><span class="error">u</span><span class="error">t</span> <span class="error">p</span><span class="error">o</span><span class="error">s</span><span class="error">s</span><span class="error">i</span><span class="error">b</span><span class="error">l</span><span class="error">e</span> <span class="error">a</span><span class="error">t</span><span class="error">t</span><span class="error">r</span><span class="error">i</span><span class="error">b</span><span class="error">u</span><span class="error">t</span><span class="error">e</span><span class="error">s</span><span class="error">.</span>
  <span class="error">/</span><span class="error">/</span> <span class="error">H</span><span class="error">o</span><span class="error">v</span><span class="error">e</span><span class="error">r</span> <span class="error">t</span><span class="error">o</span> <span class="error">v</span><span class="error">i</span><span class="error">e</span><span class="error">w</span> <span class="error">d</span><span class="error">e</span><span class="error">s</span><span class="error">c</span><span class="error">r</span><span class="error">i</span><span class="error">p</span><span class="error">t</span><span class="error">i</span><span class="error">o</span><span class="error">n</span><span class="error">s</span> <span class="error">o</span><span class="error">f</span> <span class="error">e</span><span class="error">x</span><span class="error">i</span><span class="error">s</span><span class="error">t</span><span class="error">i</span><span class="error">n</span><span class="error">g</span> <span class="error">a</span><span class="error">t</span><span class="error">t</span><span class="error">r</span><span class="error">i</span><span class="error">b</span><span class="error">u</span><span class="error">t</span><span class="error">e</span><span class="error">s</span><span class="error">.</span>
  <span class="error">/</span><span class="error">/</span> <span class="error">F</span><span class="error">o</span><span class="error">r</span> <span class="error">m</span><span class="error">o</span><span class="error">r</span><span class="error">e</span> <span class="error">i</span><span class="error">n</span><span class="error">f</span><span class="error">o</span><span class="error">r</span><span class="error">m</span><span class="error">a</span><span class="error">t</span><span class="error">i</span><span class="error">o</span><span class="error">n</span>, <span class="error">v</span><span class="error">i</span><span class="error">s</span><span class="error">i</span><span class="error">t</span>: <span class="error">h</span><span class="error">t</span><span class="error">t</span><span class="error">p</span><span class="error">s</span>:<span class="error">/</span><span class="error">/</span><span class="error">g</span><span class="error">o</span><span class="error">.</span><span class="error">m</span><span class="error">i</span><span class="error">c</span><span class="error">r</span><span class="error">o</span><span class="error">s</span><span class="error">o</span><span class="error">f</span><span class="error">t</span><span class="error">.</span><span class="error">c</span><span class="error">o</span><span class="error">m</span><span class="error">/</span><span class="error">f</span><span class="error">w</span><span class="error">l</span><span class="error">i</span><span class="error">n</span><span class="error">k</span><span class="error">/</span><span class="error">?</span><span class="error">l</span><span class="error">i</span><span class="error">n</span><span class="error">k</span><span class="error">i</span><span class="error">d</span><span class="error">=</span><span class="integer">830387</span>
  <span class="key"><span class="delimiter">&quot;</span><span class="content">version</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">0.2.0</span><span class="delimiter">&quot;</span></span>,
  <span class="key"><span class="delimiter">&quot;</span><span class="content">configurations</span><span class="delimiter">&quot;</span></span>: [
    {
      <span class="key"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">tests</span><span class="delimiter">&quot;</span></span>,
      <span class="key"><span class="delimiter">&quot;</span><span class="content">type</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">node</span><span class="delimiter">&quot;</span></span>,
      <span class="key"><span class="delimiter">&quot;</span><span class="content">request</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">launch</span><span class="delimiter">&quot;</span></span>,
      <span class="key"><span class="delimiter">&quot;</span><span class="content">stopOnEntry</span><span class="delimiter">&quot;</span></span>: <span class="value">false</span>,
      <span class="key"><span class="delimiter">&quot;</span><span class="content">sourceMaps</span><span class="delimiter">&quot;</span></span>: <span class="value">true</span>,
      <span class="key"><span class="delimiter">&quot;</span><span class="content">runtimeArgs</span><span class="delimiter">&quot;</span></span>: [
        <span class="string"><span class="delimiter">&quot;</span><span class="content">-r</span><span class="delimiter">&quot;</span></span>,
        <span class="string"><span class="delimiter">&quot;</span><span class="content">ts-node/register</span><span class="delimiter">&quot;</span></span>
      ],
      <span class="key"><span class="delimiter">&quot;</span><span class="content">args</span><span class="delimiter">&quot;</span></span>: [
        <span class="string"><span class="delimiter">&quot;</span><span class="content">node_modules/jasmine/bin/jasmine.js</span><span class="delimiter">&quot;</span></span>
      ],
      <span class="key"><span class="delimiter">&quot;</span><span class="content">cwd</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">${workspaceRoot}</span><span class="delimiter">&quot;</span></span>,
      <span class="key"><span class="delimiter">&quot;</span><span class="content">console</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">integratedTerminal</span><span class="delimiter">&quot;</span></span>
    }
  ]
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then you can select the <code>tests</code> launch configuration and hit <kbd>F5</kbd>. You can
have every information directly in your editor.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If you run the tests, you will see that only one test succeeds. This is normal because if you
look closely at the tests, you can see that the expected behavior is to have no
new line at the end of the string. So the code of the <em>custom cloud service</em> doesn&#8217;t
match the expected behavior. Let&#8217;s fix the code of the <em>cloud function</em>:</p>
</div>
<div class="listingblock highlight-lines:15-19">
<div class="title">worker/index.ts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
</pre></td>
  <td class="code"><pre><span class="reserved">import</span> { Injectable, RequestContextAware, RequestContext } from <span class="string"><span class="delimiter">'</span><span class="content">@zetapush/core</span><span class="delimiter">'</span></span>;
<span class="reserved">import</span> { Stack } from <span class="string"><span class="delimiter">'</span><span class="content">@zetapush/platform-legacy</span><span class="delimiter">'</span></span>;

<span class="error">@</span>Injectable()
<span class="reserved">export</span> <span class="keyword">default</span> <span class="reserved">class</span> HelloWorldAsCustomCloudService <span class="reserved">implements</span> RequestContextAware {
  requestContext!: RequestContext;

  constructor(<span class="reserved">private</span> stack: Stack) {}

  helloWorld() {
    <span class="keyword">return</span> <span class="string"><span class="delimiter">'</span><span class="content">Hello World</span><span class="delimiter">'</span></span>;
  }

  async saySomething(message: string, <span class="key">times</span>: number) {
    let parts = [];
    <span class="keyword">for</span> (let i = <span class="integer">0</span>; i &lt; times; i++) {
      parts.push(<span class="error">`</span><span class="predefined">$</span>{message}<span class="error">`</span>);
    }
    let fullMessage = parts.join(<span class="string"><span class="delimiter">'</span><span class="content">\n</span><span class="delimiter">'</span></span>);
    <span class="local-variable">this</span>.requestContext.logger.debug(<span class="string"><span class="delimiter">'</span><span class="content">fullMessage=</span><span class="delimiter">'</span></span>, fullMessage);
    <span class="comment">// store source information (message and times)</span>
    <span class="comment">// and generated information (fullMessage)</span>
    const response = await <span class="local-variable">this</span>.stack.push({
      <span class="key">stack</span>: <span class="string"><span class="delimiter">'</span><span class="content">messages</span><span class="delimiter">'</span></span>,
      <span class="key">data</span>: {
        message,
        times,
        fullMessage
      }
    });
    <span class="local-variable">this</span>.requestContext.logger.debug(<span class="string"><span class="delimiter">'</span><span class="content">stack.push response=</span><span class="delimiter">'</span></span>, response);
    <span class="keyword">return</span> fullMessage;
  }

  async getStoredMessages() {
    <span class="comment">// get all values</span>
    const response = await <span class="local-variable">this</span>.stack.list({
      <span class="key">stack</span>: <span class="string"><span class="delimiter">'</span><span class="content">messages</span><span class="delimiter">'</span></span>
    });
    <span class="comment">// get only useful part (message, times, fullMessage)</span>
    <span class="keyword">return</span> response.result ? response.result.content.map((item) =&gt; item.data) : [];
  }
}</pre></td>
</tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>Now if you run again the tests, you can see that 4 tests are succeeding and only 1 left in
failure. The test in failure is normal because we expect a particular message if
times parameter is not a number.
We can fix it by updating the code of the <em>cloud function</em> like this:</p>
</div>
<div class="listingblock highlight-lines:15-17">
<div class="title">worker/index.ts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
</pre></td>
  <td class="code"><pre><span class="reserved">import</span> { Injectable, RequestContextAware, RequestContext } from <span class="string"><span class="delimiter">'</span><span class="content">@zetapush/core</span><span class="delimiter">'</span></span>;
<span class="reserved">import</span> { Stack } from <span class="string"><span class="delimiter">'</span><span class="content">@zetapush/platform-legacy</span><span class="delimiter">'</span></span>;

<span class="error">@</span>Injectable()
<span class="reserved">export</span> <span class="keyword">default</span> <span class="reserved">class</span> HelloWorldAsCustomCloudService <span class="reserved">implements</span> RequestContextAware {
  requestContext!: RequestContext;

  constructor(<span class="reserved">private</span> stack: Stack) {}

  helloWorld() {
    <span class="keyword">return</span> <span class="string"><span class="delimiter">'</span><span class="content">Hello World</span><span class="delimiter">'</span></span>;
  }

  async saySomething(message: string, <span class="key">times</span>: number) {
    <span class="keyword">if</span> (<span class="keyword">typeof</span> times !== <span class="string"><span class="delimiter">'</span><span class="content">number</span><span class="delimiter">'</span></span>) {
      <span class="keyword">throw</span> <span class="keyword">new</span> Error(<span class="string"><span class="delimiter">'</span><span class="content">Only integer values are allowed for number of repetitions</span><span class="delimiter">'</span></span>);
    }
    let parts = [];
    <span class="keyword">for</span> (let i = <span class="integer">0</span>; i &lt; times; i++) {
      parts.push(<span class="error">`</span><span class="predefined">$</span>{message}<span class="error">`</span>);
    }
    let fullMessage = parts.join(<span class="string"><span class="delimiter">'</span><span class="content">\n</span><span class="delimiter">'</span></span>);
    <span class="local-variable">this</span>.requestContext.logger.debug(<span class="string"><span class="delimiter">'</span><span class="content">fullMessage=</span><span class="delimiter">'</span></span>, fullMessage);
    <span class="comment">// store source information (message and times)</span>
    <span class="comment">// and generated information (fullMessage)</span>
    const response = await <span class="local-variable">this</span>.stack.push({
      <span class="key">stack</span>: <span class="string"><span class="delimiter">'</span><span class="content">messages</span><span class="delimiter">'</span></span>,
      <span class="key">data</span>: {
        message,
        times,
        fullMessage
      }
    });
    <span class="local-variable">this</span>.requestContext.logger.debug(<span class="string"><span class="delimiter">'</span><span class="content">stack.push response=</span><span class="delimiter">'</span></span>, response);
    <span class="keyword">return</span> fullMessage;
  }

  async getStoredMessages() {
    <span class="comment">// get all values</span>
    const response = await <span class="local-variable">this</span>.stack.list({
      <span class="key">stack</span>: <span class="string"><span class="delimiter">'</span><span class="content">messages</span><span class="delimiter">'</span></span>
    });
    <span class="comment">// get only useful part (message, times, fullMessage)</span>
    <span class="keyword">return</span> response.result ? response.result.content.map((item) =&gt; item.data) : [];
  }
}</pre></td>
</tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>Now you can run again the tests and everything is ok.
You can notice that running unit tests allows to develop faster because you just
need to run everything at once instead of entering messages and number of repeats
manually in your web browser several times.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Provide behavior to mocks</div>
<div class="paragraph">
<p>In this sample, we only show how to define objects and methods that do nothing.
Obviously mocking systems also allow to define a <a href="#advanced_mocks">behavior for calls on mock objects</a>.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect5">
<h6 id="_local_integration_test"><a class="anchor" href="#_local_integration_test"></a><a class="link" href="#_local_integration_test">Local integration test</a></h6>
<div class="paragraph">
<p>Testing a <em>custom cloud service</em> alone is good but you often need to tests
interactions between several <em>cloud services</em> or interaction with <em>built-in cloud services</em>.
ZetaPush provides tools to help you write integration tests and to setup
a ZetaPush context for your tests.</p>
</div>
<div class="paragraph">
<p>First, you need to install the <code>@zetapush/testing</code> module:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="console">$ npm install --save-dev @zetapush/testing</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then, as done before we will write the skeleton of the tests.
Create a new test file <code>spec/hellp-world-custom-cloud-service/say-something.it.spec.js</code> with the following content:</p>
</div>
<div class="listingblock">
<div class="title">spec/hellp-world-custom-cloud-service/say-something.it.spec.js</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
</pre></td>
  <td class="code"><pre>describe(<span class="string"><span class="delimiter">'</span><span class="content">HelloWorldAsCustomCloudService.</span><span class="delimiter">'</span></span>, () =&gt; {
  beforeEach(async () =&gt; {                                                          <i class="conum" data-value="1"></i><b>(1)</b>
  }, <span class="integer">30</span> * <span class="integer">1000</span>);                                                                    <i class="conum" data-value="2"></i><b>(2)</b>

  <span class="comment">/**
   * Nominal case with a message repeated 5 times
   */</span>
  describe(<span class="string"><span class="delimiter">&quot;</span><span class="content">saySomething('hello', 5)</span><span class="delimiter">&quot;</span></span>, () =&gt; {
    it(<span class="string"><span class="delimiter">'</span><span class="content">stores the message, the number of repetitions and the generated message</span><span class="delimiter">'</span></span>,
      async () =&gt; {                                                                 <i class="conum" data-value="3"></i><b>(3)</b>
          <span class="comment">// call the method to test</span>
          await helloWorldService.saySomething(<span class="string"><span class="delimiter">'</span><span class="content">hello</span><span class="delimiter">'</span></span>, <span class="integer">5</span>);                         <i class="conum" data-value="4"></i><b>(4)</b>

          <span class="comment">// check that everything works fine</span>
          const storedMessages = await helloWorldService.getStoredMessages();       <i class="conum" data-value="5"></i><b>(5)</b>
          expect(storedMessages.length).toBe(<span class="integer">1</span>);                                    <i class="conum" data-value="6"></i><b>(6)</b>
          expect(storedMessages[<span class="integer">0</span>]).toEqual({                                       <i class="conum" data-value="7"></i><b>(7)</b>
            <span class="key">message</span>: <span class="string"><span class="delimiter">'</span><span class="content">hello</span><span class="delimiter">'</span></span>,
            <span class="key">times</span>: <span class="integer">5</span>,
            <span class="key">fullMessage</span>: <span class="string"><span class="delimiter">'</span><span class="content">hello</span><span class="content">\n</span><span class="content">hello</span><span class="content">\n</span><span class="content">hello</span><span class="content">\n</span><span class="content">hello</span><span class="content">\n</span><span class="content">hello</span><span class="delimiter">'</span></span>
          });
      },
      <span class="integer">5</span> * <span class="integer">60</span> * <span class="integer">1000</span>                                                                 <i class="conum" data-value="8"></i><b>(8)</b>
    );
  });
});</pre></td>
</tr></table></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Empty for now, we will fill it later. Don&#8217;t forget the <code>async</code> keyword.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Change the default timeout of jasmine for test preparation (we will see why later)</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Run the test using async/await syntax to have a cleaner code</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>The call to the <em>cloud function</em> to test</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Retrieve all previously stored messages</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>Assertion to ensure there is exactly one entry</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>Assertion to ensure that the stored value is correct</td>
</tr>
<tr>
<td><i class="conum" data-value="8"></i><b>8</b></td>
<td>Change the default timeout of jasmine for this test (we will see why later)</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>We have defined what we need to test. Now to make it work, we need to run
the test in a ZetaPush worker. As a reminder, using ZetaPush <em>built-in cloud services</em>
requires a creation of the services on the ZetaPush cloud. As a reminder too,
ZetaPush worker detects needed dependencies and instantiate them.
In the context of a test, we also need these mechanisms in order to instantiate
the dependencies and to inject them in our test.</p>
</div>
<div class="paragraph">
<p>ZetaPush testing module provides several utilities to define an execution context
and to run the test in that context. Add the following code to your test:</p>
</div>
<div class="listingblock highlight-lines:1-4,8-18,27-29,42">
<div class="title">spec/hellp-world-custom-cloud-service/say-something.spec.js</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
</pre></td>
  <td class="code"><pre>const { given, runInWorker } = require(<span class="string"><span class="delimiter">'</span><span class="content">@zetapush/testing</span><span class="delimiter">'</span></span>);
const customCloudService = require(<span class="string"><span class="delimiter">'</span><span class="content">../../worker/index</span><span class="delimiter">'</span></span>);
const HelloWorldAsCustomCloudService = customCloudService[<span class="string"><span class="delimiter">'</span><span class="content">default</span><span class="delimiter">'</span></span>];
const { Stack } = require(<span class="string"><span class="delimiter">'</span><span class="content">@zetapush/platform-legacy</span><span class="delimiter">'</span></span>);

describe(<span class="string"><span class="delimiter">'</span><span class="content">HelloWorldAsCustomCloudService.</span><span class="delimiter">'</span></span>, () =&gt; {
  beforeEach(async () =&gt; {
    await given()                                                       <i class="conum" data-value="1"></i><b>(1)</b>
      <span class="comment">/**/</span> .credentials()                                               <i class="conum" data-value="2"></i><b>(2)</b>
      <span class="comment">/*   */</span> .fromZetarc()                                             <i class="conum" data-value="3"></i><b>(3)</b>
      <span class="comment">/*   */</span> .and()
      <span class="comment">/**/</span> .worker()                                                    <i class="conum" data-value="4"></i><b>(4)</b>
      <span class="comment">/*   */</span> .testModule(() =&gt; ({                                      <i class="conum" data-value="5"></i><b>(5)</b>
        <span class="key">expose</span>: [HelloWorldAsCustomCloudService]
      }))
      <span class="comment">/*   */</span> .dependencies(HelloWorldAsCustomCloudService, Stack)      <i class="conum" data-value="6"></i><b>(6)</b>
      <span class="comment">/**/</span> .and()
      .apply(<span class="local-variable">this</span>);                                                     <i class="conum" data-value="7"></i><b>(7)</b>
  }, <span class="integer">5</span> * <span class="integer">60</span> * <span class="integer">1000</span>);

  <span class="comment">/**
   * Nominal case with a message repeated 5 times
   */</span>
  describe(<span class="string"><span class="delimiter">&quot;</span><span class="content">saySomething('hello', 5)</span><span class="delimiter">&quot;</span></span>, () =&gt; {
    it(<span class="string"><span class="delimiter">'</span><span class="content">stores the message, the number of repetitions and the generated message</span><span class="delimiter">'</span></span>,
      async () =&gt; {
        await runInWorker(<span class="local-variable">this</span>, async (helloWorldService, stack) =&gt; {   <i class="conum" data-value="8"></i><b>(8)</b>
          <span class="comment">// clean the stack before adding into it</span>
          await stack.purge({ <span class="key">stack</span>: <span class="string"><span class="delimiter">'</span><span class="content">messages</span><span class="delimiter">'</span></span> });                     <i class="conum" data-value="9"></i><b>(9)</b>

          <span class="comment">// call the method to test</span>
          await helloWorldService.saySomething(<span class="string"><span class="delimiter">'</span><span class="content">hello</span><span class="delimiter">'</span></span>, <span class="integer">5</span>);

          <span class="comment">// check that everything works fine</span>
          const storedMessages = await helloWorldService.getStoredMessages();
          expect(storedMessages.length).toBe(<span class="integer">1</span>);
          expect(storedMessages[<span class="integer">0</span>]).toEqual({
            <span class="key">message</span>: <span class="string"><span class="delimiter">'</span><span class="content">hello</span><span class="delimiter">'</span></span>,
            <span class="key">times</span>: <span class="integer">5</span>,
            <span class="key">fullMessage</span>: <span class="string"><span class="delimiter">'</span><span class="content">hello</span><span class="content">\n</span><span class="content">hello</span><span class="content">\n</span><span class="content">hello</span><span class="content">\n</span><span class="content">hello</span><span class="content">\n</span><span class="content">hello</span><span class="delimiter">'</span></span>
          });
        });
      },
      <span class="integer">5</span> * <span class="integer">60</span> * <span class="integer">1000</span>
    );
  });

  afterEach(async () =&gt; {                                               <i class="conum" data-value="10"></i><b>(10)</b>
    await autoclean(<span class="local-variable">this</span>);                                              <i class="conum" data-value="11"></i><b>(11)</b>
  });
});</pre></td>
</tr></table></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>given</code> utility is designed to prepare the test context. This is the entry
point to a fluent API</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td><code>credentials</code> is used to configure the source of the ZetaPush credentials and application information.
This information is required in order to be able to connect to the ZetaPush cloud</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td><code>fromZetarc</code> indicates that the test must load <code>developerLogin</code>, <code>developerPassword</code>, <code>platformUrl</code> and <code>appName</code>
from your <code>.zetarc</code> file. It means that it automatically loads the credentials you are using
in development</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td><code>worker</code> is used to configure the ZetaPush worker context for the test</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td><code>testModule</code> indicates that the worker context must provide a standalone module.
For now, we have only seen a <em>custom cloud service</em> exposed. But in fact, it is an implicit
<a href="#modules">ZetaPush module</a>. In our test, we define a really simple module that exposes the
<em>custom cloud service</em>. Basically, it means that your test is exactly like your <code>index.ts</code></td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>Indicate which dependencies will be injected in the test (see parameters of <code>runInWorker</code>).</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>Now all the preparation of the test context is ready, <code>apply</code> really executes building of test context.
It also stores some information needed by the test in <code>this</code> (the current jasmine test context)</td>
</tr>
<tr>
<td><i class="conum" data-value="8"></i><b>8</b></td>
<td><code>runInWorker</code> as its name says, runs the code in the worker context started for the test.
Note the <code>this</code> as first argument that is used to retrieve information set by <code>given().apply(this)</code>.
The callback takes here two parameters. Those parameters correspond to the dependencies declared
in <code>given().worker().dependencies()</code></td>
</tr>
<tr>
<td><i class="conum" data-value="9"></i><b>9</b></td>
<td>As <code>Stack</code> service is the same between the development and every test execution,
the <code>Stack</code> may already contain some items. That&#8217;s why we force to empty the stack before executing the real test.</td>
</tr>
<tr>
<td><i class="conum" data-value="10"></i><b>10</b></td>
<td>After each test don&#8217;t forget to clean everything</td>
</tr>
<tr>
<td><i class="conum" data-value="11"></i><b>11</b></td>
<td>ZetaPush provides test utility to automatically remove everything that has been done
by the <code>given()</code> (like stopping properly the worker).</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Timeouts</div>
<div class="paragraph">
<p>As execution context needs the ZetaPush worker to create <em>built-in cloud services</em>,
the default jasmine timeout is too low: 5 seconds only for both preparation of the test
(<code>beforeEach</code>) and the execution of the test (<code>it</code>). We need to increase it because
the creation may take more than 5 seconds.</p>
</div>
<div class="paragraph">
<p>In the example, we set to 30 seconds for preparation and 5 minutes for the test.
Hopefully, ZetaPush worker doesn&#8217;t need 5 minutes to start and execute code.
But 5 minutes can be useful to place a debugger in the code and to
debug the test execution.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Now you can run the test using jasmine too:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="console">$ node -r ts-node/register node_modules/jasmine/bin/jasmine</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can see that contrary to unit testing, the worker prepares the test context.
You should see something like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="console">[TRACE] register [ 'queue_0', { port: 2999, type: 'queue_0' } ] ‌
[TRACE] register [ 'ZETAPUSH_HTTP_SERVER', { port: 2999, type: 'queue_0' } ] ‌
[TRACE] confPath [ '/tmp/foobar/' ] ‌
[TRACE] externalConfPath [ undefined ] ‌
[TRACE] env [ LocalServerRegistryZetaPushContext {
    config:
     { developerLogin: '*******',
       developerPassword: '*******',
       platformUrl: 'https://celtia.zetapush.com/zbo/pub/business',
       appName: '********' },
    registry: LocalServerRegistry { servers: [Object] },
    urlProvider: [Function] } ] ‌
[TRACE] analyzed providers [ [ { provide: [Function: TestDeclarationWrapper],
      useClass: [Function: TestDeclarationWrapper] },
    { provide: [Function: Environment], useValue: [Object] },
    { provide: [Function: ConfigurationProperties],
      useValue: [PriorizedConfigurationProperties] },
    { provide: [Function: ZetaPushContext],
      useValue: [LocalServerRegistryZetaPushContext] },
    { provide: [Function: Stack], useValue: [Stack] },
    { provide: [Function: HelloWorldAsCustomCloudService],
      useClass: [Function: HelloWorldAsCustomCloudService] },
    { provide: [Function: Wrapper],
      useFactory: [Function: useFactory],
      deps: [Array] } ] ] ‌
[TRACE] analyzed platformServices [ [ [Function: Stack] ] ] ‌
[TRACE] bootstrap layers [ [ [ [Function: HelloWorldAsCustomCloudService],
      [Function: Wrapper],
      [Function: TestDeclarationWrapper] ],
    [],
    [ [Function: HelloWorldAsCustomCloudService],
      [Function: Stack] ] ] ] ‌
[LOG] GET [ 'https://celtia.zetapush.com:/zbo/orga/item/list/v79ivn00l',
  undefined ] ‌
[LOG] Provisioning [ [Function: Stack] ] ‌
[TRACE] instantiate [ { '0':
     HelloWorldAsCustomCloudService {
       stack: [Stack],
       [Symbol(ZetaPush.CloudServiceInstance)]: true },
    ZetaTest:
     TestDeclarationWrapper {
       wrapper: [Wrapper],
       [Symbol(ZetaPush.CloudServiceInstance)]: true },
    bootLayers: [ [Array], [], [Array] ] } ] ‌
[TRACE] Worker successfully started</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Verbosity level in tests</div>
<div class="paragraph">
<p>The test is by default started with high verbosity in order to let you know
what happens in ZetaPush worker. Therefore, if something fails you can have enough information
to know where and why it has failed.</p>
</div>
<div class="paragraph">
<p>You can <a href="#verbosity_level_in_tests">change the verbosity level</a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The following sequence diagram explains how it works:</p>
</div>
<div class="imageblock center">
<div class="content">
<img src="local-integration-testing.png" alt="local integration testing" width="1306" height="1592">
</div>
<div class="title">Figure 10. How it works ?</div>
</div>
<div class="paragraph">
<p>Jasmine executes the code of the test and starts by running code of the <code>beforeEach</code> function.
<code>given()</code> fluent API is called <span class="sequence-step">1</span> but does nothing. In fact, <code>given()</code> is just the
entry point to the fluent API.
<code>given().credentials()</code>, <code>given().project()</code> and <code>given().worker()</code> only store information
about what you need for your test <span class="sequence-step">3</span> <span class="sequence-step">4</span>
<span class="sequence-step">5</span> <span class="sequence-step">6</span> <span class="sequence-step">7</span> <span class="sequence-step">8</span>. Nothing is initialized here. We don&#8217;t show
all calls to the fluent API in the sequence diagram because it is the same principle, we just
store information about what you need in your test.
As all needed information is grabbed, you ask the testing utilities to prepare the
context by calling <code>apply(this)</code> <span class="sequence-step">9</span>. The testing utilities prepare the context
by asking to the worker to start your "virtual" module defined with <code>testModule</code> <span class="sequence-step">10</span>.
The worker connects to the ZetaPush cloud using your credentials <span class="sequence-step">11</span>
<span class="sequence-step">12</span>.
As a reminder, we used <code>given().credentials().fromZetarc()</code> so it will use
the credentials defined in the <code>.zetarc</code> file directly.
Then the worker resolves all needed dependencies (for dependency injection)
and for each <em>built-in cloud service</em>, it sends a message to the ZetaPush cloud
to create the service <span class="sequence-step">13</span> <span class="sequence-step">14</span>. Once all <em>built-in cloud services</em> are ready, the worker
instantiates all <em>built-in cloud services</em> and <em>custom cloud services</em> needed for
the test (indicated by <code>given().worker().dependencies()</code>) <span class="sequence-step">15</span>
<span class="sequence-step">16</span> <span class="sequence-step">17</span> <span class="sequence-step">18</span>.
Once everything is instantiated, your <em>custom cloud service</em> is ready to be called.
At the end of the <code>apply</code> function of the testing utilities, the information
about the execution context (credentials, dependencies, instances, &#8230;&#8203;) are stored
in <code>this</code> <span class="sequence-step">19</span>. <code>this</code> refers to the current test execution context in jasmine.</p>
</div>
<div class="paragraph">
<p>Now, everything is ready to really start the test. The <code>it</code> function provided by jasmine is
executed. This function calls <code>runInWorker(this, callback)</code> <span class="sequence-step">20</span>. As said above, <code>this</code> refers
to the current test execution context in jasmine. So everything stored in <code>this</code> in
<code>beforeEach</code> is available in <code>this</code> of <code>it</code>. <code>runInWorker</code> starts the worker using
the code written in the <code>callback</code> as source code for a "virtual" <em>cloud function</em> <span class="sequence-step">21</span>.
The "virtual" <em>cloud function</em> (<code>callback</code>) receives parameters. Each parameter
is the instance of a needed dependency (defined with <code>given().worker().dependencies()</code>
in the <strong>same order</strong>).
As it is like a real <em>cloud function</em>, the code is executed by the worker <span class="sequence-step">22</span>.
Then each line of code is executed. In our test, we first empty the <code>Stack</code> by calling
<code>purge()</code> <span class="sequence-step">23</span> <span class="sequence-step">26</span>. This sends a message to
the ZetaPush cloud <span class="sequence-step">24</span> <span class="sequence-step">25</span>.
The test then calls <code>helloWorldService.saySomething('hello', 5)</code> <em>cloud function</em>
<span class="sequence-step">27</span> <span class="sequence-step">28</span>.
<code>helloWorldService.getStoredMessages()</code> <em>cloud function</em> is called to retrieve all
stored messages <span class="sequence-step">29</span> <span class="sequence-step">30</span>.
At the end of the test we use <code>expect</code> function provided by jasmine in order to ensure
that results correspond to what we expect.</p>
</div>
<div class="paragraph">
<p>The test is now finished (either successfully or with failure). <code>afterEach</code> is called by jasmine
which calls <code>autoclean(this)</code> utility <span class="sequence-step">31</span>. As the worker has been started locally and
it has instantiated dependencies, we need to clean everything. <code>autoclean</code> will
use information stored in <code>this</code> to know exactly what it has to do. In our case,
we just need to stop the worker properly <span class="sequence-step">32</span>
<span class="sequence-step">33</span> <span class="sequence-step">34</span> <span class="sequence-step">35</span>.</p>
</div>
<div class="paragraph">
<p>Notice that local tests allow to test part of your application.
You don&#8217;t need to develop all your <em>custom cloud services</em> before testing them partially.
This is a great advantage for developing fast because you can define a closed and
well defined context that doesn&#8217;t depend directly on the code you write in your
<em>custom cloud services</em>. Maintainability is easier because even if your
code change, the context dedicated to the test may be the same.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Advanced integration testing</div>
<div class="paragraph">
<p>For more advanced usage, you can find information about
<a href="#testing_utilities">testing utilities</a> and
<a href="#integration_testing">integration testing</a></p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="title">Trial account</div>
<div class="paragraph">
<p>If you have a free trial account, you have only one environment shared between
local development, published application and tests.</p>
</div>
<div class="paragraph">
<p>The execution of the tests may impact the published application because there
are two workers started in the same time on the same environment.
So the load-balancer may send request either to the worker running on ZetaPush cloud
or to the local worker started in tests. You could also have false positives
in your tests due to the load-balancing (because worker running in the ZetaPush
cloud could answer in place of the runner in tests).</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Remote integration testing</div>
<div class="paragraph">
<p>Running tests locally may differ a little compared to running the tests in the cloud.
Indeed, the running context is different especially when working with HTTP because
URLs, load-balancing and network infrastructure are different.</p>
</div>
<div class="paragraph">
<p>ZetaPush also provides tools to run your <a href="#tests_in_cloud">tests with a worker running in the ZetaPush cloud</a>.
This is totally transparent for you.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect5">
<h6 id="_local_end_to_end_test"><a class="anchor" href="#_local_end_to_end_test"></a><a class="link" href="#_local_end_to_end_test">Local end-to-end test</a></h6>
<div class="paragraph">
<p>Here the tests are run exclusively in a worker context. ZetaPush also provides
a way to write end-to-end (often named e2e) tests. This means that a client
really make requests to the <em>cloud service</em> instead of calling directly a method.</p>
</div>
<div class="paragraph">
<p>You can copy the file <code>.spec/hellp-world-custom-cloud-service/say-something.it.spec.js</code>
into the new file <code>.spec/hellp-world-custom-cloud-service/say-something.e2e.spec.js</code>
and transform code to an e2e test:</p>
</div>
<div class="listingblock highlight-lines:1,9-14,25-27">
<div class="title">spec/hellp-world-custom-cloud-service/say-something.e2e.spec.js</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
</pre></td>
  <td class="code"><pre>const { given, frontAction, autoclean } = require(<span class="string"><span class="delimiter">'</span><span class="content">@zetapush/testing</span><span class="delimiter">'</span></span>);

describe(<span class="string"><span class="delimiter">'</span><span class="content">HelloWorldAsCustomCloudService.</span><span class="delimiter">'</span></span>, () =&gt; {
  beforeEach(async () =&gt; {
    await given()
      <span class="comment">/**/</span> .credentials()
      <span class="comment">/*   */</span> .fromZetarc()
      <span class="comment">/*   */</span> .and()
      <span class="comment">/**/</span> .project()                                               <i class="conum" data-value="1"></i><b>(1)</b>
      <span class="comment">/*   */</span> .currentProject()                                     <i class="conum" data-value="2"></i><b>(2)</b>
      <span class="comment">/*     */</span> .and()
      <span class="comment">/*   */</span> .and()
      <span class="comment">/**/</span> .worker()                                                <i class="conum" data-value="3"></i><b>(3)</b>
      <span class="comment">/*   */</span> .up()                                                 <i class="conum" data-value="4"></i><b>(4)</b>
      <span class="comment">/*   */</span> .and()
      .apply(<span class="local-variable">this</span>);
  }, <span class="integer">5</span> * <span class="integer">60</span> * <span class="integer">1000</span>);

  <span class="comment">/**
   * Nominal case with a message repeated 5 times
   */</span>
  describe(<span class="string"><span class="delimiter">&quot;</span><span class="content">saySomething('hello', 5)</span><span class="delimiter">&quot;</span></span>, () =&gt; {
    it(<span class="string"><span class="delimiter">'</span><span class="content">stores the message, the number of repetitions and the generated message</span><span class="delimiter">'</span></span>,
      async () =&gt; {
        await frontAction(<span class="local-variable">this</span>)                                     <i class="conum" data-value="5"></i><b>(5)</b>
          .name(<span class="string"><span class="delimiter">'</span><span class="content">call saySomething</span><span class="delimiter">'</span></span>)                                <i class="conum" data-value="6"></i><b>(6)</b>
          .execute(async (api) =&gt; {                                 <i class="conum" data-value="7"></i><b>(7)</b>
            <span class="comment">// call the method to test</span>
            await api.saySomething(<span class="string"><span class="delimiter">'</span><span class="content">hello</span><span class="delimiter">'</span></span>, <span class="integer">5</span>);                     <i class="conum" data-value="8"></i><b>(8)</b>

            <span class="comment">// check that everything works fine</span>
            const storedMessages = await api.getStoredMessages();   <i class="conum" data-value="9"></i><b>(9)</b>
            expect(storedMessages.length).toBe(<span class="integer">1</span>);
            expect(storedMessages[<span class="integer">0</span>]).toEqual({
              <span class="key">message</span>: <span class="string"><span class="delimiter">'</span><span class="content">hello</span><span class="delimiter">'</span></span>,
              <span class="key">times</span>: <span class="integer">5</span>,
              <span class="key">fullMessage</span>: <span class="string"><span class="delimiter">'</span><span class="content">hello</span><span class="content">\n</span><span class="content">hello</span><span class="content">\n</span><span class="content">hello</span><span class="content">\n</span><span class="content">hello</span><span class="content">\n</span><span class="content">hello</span><span class="delimiter">'</span></span>
            });
          });
      },
      <span class="integer">5</span> * <span class="integer">60</span> * <span class="integer">1000</span>
    );
  });

  afterEach(async () =&gt; {
    await autoclean(<span class="local-variable">this</span>);
  });
});</pre></td>
</tr></table></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Instead of defining a module that contains a part of your application to test (using <code>worker().testModule()</code>),
here you need the full application. That&#8217;s the purpose of <code>project()</code> fluent API.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Indicate that the source project is your current project.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>There is a <code>worker</code> section too&#8230;&#8203;</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>But this time, we just ask for testing utility to start the worker with
your <em>custom cloud service</em> defined in <code>index.ts</code> and wait until
the worker is really started before executing the test.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Instead of running in the context of the worker, now we run code directly from
a client point of vue. Like <code>runInWorker</code>, <code>frontAction</code> needs the test context (<code>this</code>)
to retrieve information initialized by the <code>given()</code> utility.</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>Give a name to the action (useful for logs)</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>Execute code in front context. The function that is executed receives the parameter <code>api</code>.
Under the hood, the test utility creates a client (<code>const client = new ZetaPushClient.WeakClient()</code>) and then
creates the proxy to the API (<code>api = client.createProxyTaskService()</code>). So <code>api</code> parameter is the object you can use
to directly call your <em>cloud functions</em> from a client.</td>
</tr>
<tr>
<td><i class="conum" data-value="8"></i><b>8</b></td>
<td>Call the <em>cloud function</em> we want to test.</td>
</tr>
<tr>
<td><i class="conum" data-value="9"></i><b>9</b></td>
<td>Retrieve all stored messages and make assertions on the result.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>As always, you run the tests by running jasmine:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="console">$ node -r ts-node/register node_modules/jasmine/bin/jasmine</code></pre>
</div>
</div>
<div class="paragraph">
<p>Running the test may fail and it is normal because the <code>Stack</code> may already contain data.
As said before here we are in the context of a client so we don&#8217;t have access to <code>Stack</code>
service to empty it before running the test.
To empty the <code>Stack</code> you have to either add a <em>cloud function</em> that can empty the stack or use
<a href="#test-snapshot">ZetaPush snapshots</a> to restore your application
to a particular state before running your tests.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="title">Snapshots</div>
<div class="paragraph">
<p>The snapshot feature is already available in ZetaPush but it is not currently
exposed for use directly in tests.</p>
</div>
<div class="paragraph">
<p>This feature will be available soon.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The following sequence diagram explains how it works:</p>
</div>
<div class="imageblock center">
<div class="content">
<img src="local-e2e-testing.png" alt="local e2e testing" width="1425" height="2446">
</div>
<div class="title">Figure 11. How it works ?</div>
</div>
<div class="paragraph">
<p>Context initialization done by <code>given()</code> <span class="sequence-step">1</span> utility has exactly the same behavior as
integration testing. The only difference is that instead of creating a "virtual"
module to define a "virtual" <em>custom cloud service</em>, <code>given().project().currentProject()</code>
<span class="sequence-step">2</span> <span class="sequence-step">3</span>
indicates that you want directly the code of your application to be tested.
<code>given().worker().up()</code> <span class="sequence-step">4</span> <span class="sequence-step">5</span> indicates that you need the worker fully started
before running the test.</p>
</div>
<div class="paragraph">
<p><code>it()</code> code now uses <code>front(this)</code> <span class="sequence-step">20</span> that is a fluent API to
create a client based on what you need. <code>front(this).name()</code> <span class="sequence-step">22</span> is used to
add an information message in logs during test execution. It is useful if you
want to separate several calls to simulate several end-users for example.
Until now, no client is created.
It is <code>front(this).execute(callback)</code> <span class="sequence-step">24</span> that uses information
defined before (name and current test context in this case) in order to create
a client instance <span class="sequence-step">26</span>. The testing utilities connect the client
to the ZetaPush cloud <span class="sequence-step">27</span> <span class="sequence-step">28</span> using information provided in <code>given().credentials()</code>.
In addition to a client, this function also creates the client
API (<code>api</code>) <span class="sequence-step">29</span> by calling <code>client.createProxyTaskService</code> under the hood. As a
reminder, <code>api</code> created with <code>client.createProxyTaskService</code> provides directly
same methods to the client that the <em>cloud functions</em> defined in the <em>custom cloud service</em>
without writing a single line of code (no need to manually define a function <code>saySomething</code>
on the client side). Once the client is ready, the code defined inside the <code>callback</code>
is executed <span class="sequence-step">30</span> <span class="sequence-step">31</span>.
In the test, the <em>cloud function</em> <code>saySomething</code> is called through <code>api</code> <span class="sequence-step">32</span>.
Contrary to integration testing which calls <em>cloud functions</em> directly, calls to
<code>api</code> sends messages through network from the client to the ZetaPush cloud <span class="sequence-step">33</span>.
ZetaPush cloud routes the message to the worker started by testing utilities <span class="sequence-step">34</span>.
The worker receives the request and calls the <em>cloud function</em> <span class="sequence-step">35</span>.
The result is sent by the worker to the ZetaPush cloud <span class="sequence-step">37</span> which routes the result
to the client <span class="sequence-step">38</span>. The client receives the result and can use it <span class="sequence-step">39</span>.
The same process applies when calling <code>getStoredMessages()</code> <span class="sequence-step">40</span> <span class="sequence-step">41</span>
<span class="sequence-step">42</span> <span class="sequence-step">43</span> <span class="sequence-step">44</span> <span class="sequence-step">45</span>
<span class="sequence-step">46</span> <span class="sequence-step">47</span>.</p>
</div>
<div class="paragraph">
<p>The <code>autoclean(this)</code> works exactly the same as in integration tests.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Client authentication</div>
<div class="paragraph">
<p>In the example, the <em>custom cloud service</em> exposes <em>cloud functions</em> that
don&#8217;t need authentication and that don&#8217;t have any security restrictions.
So implicitly we can use an anonymous connection using <code>WeakClient</code>.</p>
</div>
<div class="paragraph">
<p>But in a real application you may need to authenticate as a real user in your
tests. Hopefully, you can <a href="#testing_utilities">provide end-user credentials</a>
when using <code>front(this)</code>. In this case, a <code>Simple</code> client instance is automatically
used.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Advanced e2e testing</div>
<div class="paragraph">
<p>For more advanced usage, you can find information about
<a href="#testing_utilities">testing utilities</a> and
<a href="#e2e_testing">integration testing</a></p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_deploy_publish_your_application"><a class="anchor" href="#_deploy_publish_your_application"></a><a class="link" href="#_deploy_publish_your_application">13. Deploy/publish your application</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Once you have developed your application and tested it, you may want to deploy it on the ZetaPush cloud.
Deploying means that your code is sent to the ZetaPush cloud and your application
runs directly on it. The ZetaPush cloud
hosts your application and makes it available on the Internet for your end-users.</p>
</div>
<div class="paragraph">
<p>Usually, you deploy/publish your application when you are ready to promote it in production.</p>
</div>
<div class="paragraph">
<p>Unlike in standard development of an application, with ZetaPush you don&#8217;t need to bother to
buy, install, configure and manage the machines anymore.
Everything is already provided by the ZetaPush cloud. Moreover, the ZetaPush cloud
guarantees that your application is always available. You don&#8217;t need
to worry about how to handle technical complexities like:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://en.wikipedia.org/wiki/Redundancy_(engineering)" target="_blank" rel="noopener">Redundancy</a> (duplication of your application to increase reliability)</p>
</li>
<li>
<p><a href="https://en.wikipedia.org/wiki/Load_balancing_(computing)" target="_blank" rel="noopener">Load-balancing</a> (automatic distribution of tasks accross several workers)</p>
</li>
<li>
<p><a href="https://en.wikipedia.org/wiki/High_availability" target="_blank" rel="noopener">High availability</a> (ensure that your application is always up)</p>
</li>
<li>
<p><a href="https://en.wikipedia.org/wiki/Scalability" target="_blank" rel="noopener">Scalability</a> (increase the number of worker instances when the application usage increases)</p>
</li>
<li>
<p>Supervision (monitor machines and your application to alert you in case of a performance, machine or availability issue)</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>ZetaPush already monitors the machines and your applications. However, the supervision is currently
not direclty available to you.</p>
</div>
<div class="paragraph">
<p>Soon the <a href="https://console-celtia.zetapush.com" target="_blank" rel="noopener">ZetaPush web console</a> will display monitoring
information.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>With a free trial account there is no scalability, high availability and load-balancing
because the trial plan only allows one worker per application.</p>
</div>
<div class="paragraph">
<p>You can <a href="https://www.zetapush.com/contact" target="_blank" rel="noopener">contact us</a> if you want to test those features.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="_what_will_be_deployed"><a class="anchor" href="#_what_will_be_deployed"></a><a class="link" href="#_what_will_be_deployed">13.1. What will be deployed ?</a></h3>
<div class="paragraph">
<p>When you <em>deploy</em> your application on the ZetaPush cloud,
actually your application is split in two parts:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The worker that contains your <em>custom cloud services</em></p>
</li>
<li>
<p>The static files for the front end</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="_worker"><a class="anchor" href="#_worker"></a><a class="link" href="#_worker">13.1.1. Worker</a></h4>
<div class="paragraph">
<p>When you deploy the worker (<em>custom cloud services</em>) of your application, we take care of the hosting of your code.
In addition we manage the redundancy, the load-balancing,
the high availability and the automatic scability of your <em>custom cloud services</em>.</p>
</div>
<div class="paragraph">
<p>A worker may also provide HTTP endpoints in addition to bidirectionnal connection provided as-is by ZetaPush.
If so, once published on the ZetaPush cloud, the HTTP url is displayed in your terminal.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>URLs to access your worker in HTTP(s) are also available in the <a href="https://console-celtia.zetapush.com" target="_blank" rel="noopener">ZetaPush web console</a>.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_front_end"><a class="anchor" href="#_front_end"></a><a class="link" href="#_front_end">13.1.2. Front end</a></h4>
<div class="paragraph">
<p>For the front end part, the ZetaPush cloud hosts your application.
ZetaPush also manages redundancy of the static files in order to ensure
the high availability of you front end application.</p>
</div>
<div class="paragraph">
<p>The URL to access to your application is displayed in your terminal.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>URLs to access your front end are also available in the <a href="https://console-celtia.zetapush.com" target="_blank" rel="noopener">ZetaPush web console</a>.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_environments"><a class="anchor" href="#_environments"></a><a class="link" href="#_environments">13.2. Environments</a></h3>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p>This section will describe how to deploy your application
in the ZetaPush cloud for a particular environment.</p>
</div>
<div class="paragraph">
<p>It will also give you information about configuration properties
and property override per environment.</p>
</div>
<div class="paragraph">
<p>see <a href="https://github.com/zetapush/documentation/issues/54" class="bare">https://github.com/zetapush/documentation/issues/54</a></p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_deploy_application_on_the_zetapush_cloud"><a class="anchor" href="#_deploy_application_on_the_zetapush_cloud"></a><a class="link" href="#_deploy_application_on_the_zetapush_cloud">13.3. Deploy application on the ZetaPush Cloud</a></h3>
<div class="paragraph">
<p>The deployment is very easy, to do this you only need to launch this command in your application directory:</p>
</div>
<div class="listingblock">
<div class="title">Deploy the application</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="console">$ npm run deploy</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Npm script alias</div>
<div class="paragraph">
<p><code>npm run deploy</code> is a script alias defined in the <code>package.json</code> file.
The command that is executed under the hood is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="console">$ zeta push</code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The command will read the <code>.zetarc</code> file. If there is no <em>appName</em>, <em>developerLogin</em> and <em>developerPassword</em> properties or if the ZetaPush account is not validated, you will not be able to push your application.</p>
</div>
<div class="paragraph">
<p>When you deploy your application (Front + Worker), the CLI displays the URLs to use it.
Run the command and you should see something like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="console">&gt; zeta push

[INFO] Using application defined in configuration: v79ivn00l  ‌
[INFO] Bundle your application components  ‌
[INFO] ▇▇▇▇▇▇▇▇▇▇▇▇▇▇▇▇▇▇▇▇ Upload code                                       <i class="conum" data-value="1"></i><b>(1)</b>
[INFO] ▇▇▇▇▇▇▇▇▇▇░░░░░░░░░░ Prepare environment
[INFO] ░░░░░░░░░░░░░░░░░░░░ Publish web application
[INFO] ░░░░░░░░░░░░░░░░░░░░ Preparing custom cloud services for deployment
[INFO] ░░░░░░░░░░░░░░░░░░░░ Publish custom cloud service on worker instance</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <em>CLI</em> displays progress bars to indicate all deployment tasks and
which tasks are currently being executed</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Once the deployment has succeeded, you should see the URLs where your worker and
front are available:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="console">&gt; zeta push

[INFO] Using application defined in configuration: v79ivn00l  ‌
[INFO] Bundle your application components  ‌
[INFO] ▇▇▇▇▇▇▇▇▇▇▇▇▇▇▇▇▇▇▇▇ Upload code
[INFO] ▇▇▇▇▇▇▇▇▇▇▇▇▇▇▇▇▇▇▇▇ Prepare environment
[INFO] ▇▇▇▇▇▇▇▇▇▇▇▇▇▇▇▇▇▇▇▇ Publish web application
[INFO] ▇▇▇▇▇▇▇▇▇▇▇▇▇▇▇▇▇▇▇▇ Preparing custom cloud services for deployment
[INFO] ▇▇▇▇▇▇▇▇▇▇▇▇▇▇▇▇▇▇▇▇ Publish custom cloud service on worker instance
[INFO] Web application front is available at http://front-v79ivn00l.celtia.zetapush.app:80/  ‌      <i class="conum" data-value="1"></i><b>(1)</b>
[INFO] Worker application queue_0 is available at http://queuea0-v79ivn00l.test.zetapush.app  ‌     <i class="conum" data-value="2"></i><b>(2)</b>
[INFO] Worker applications works only if you listen process.env.HTTP_PORT  ‌</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The URL for your front available on the Internet</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The URL for the HTTP endpoint of your worker (if you have one)</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You can click (<span class="keyseq"><kbd>Ctrl</kbd>+<kbd>click</kbd></span>) in the terminal on the front URL (or open a web browser
and enter the front URL).
You can see that your application is deployed.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Redeploy</div>
<div class="paragraph">
<p>Obviously, you can publish your application again anytime you want to update it.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Shared <em>built-in cloud services</em></div>
<div class="paragraph">
<p>You can notice that the data that was stored when you were running your application
locally is also available once the application is deployed.</p>
</div>
<div class="paragraph">
<p>This is normal because this is the same application.
So the application uses the same <em>built-in cloud services</em>.</p>
</div>
<div class="paragraph">
<p>If you want to separate data between your local development and the deployed application,
you need to define several <a href="#manage_environments">environments</a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Partial deployment</div>
<div class="paragraph">
<p>It is possible to <a href="#partial_deployment">deploy only one part of your application</a> (only the front or only the worker).</p>
</div>
<div class="paragraph">
<p>This can be useful for example when there is a bug that is fixed by exclusively patching the front part.
So you just want to deploy your front but not deploy the same worker code again (and vice versa).</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">How to have initialization code</div>
<div class="paragraph">
<p>A <em>custom cloud service</em> may have initialization code to configure and prepare your application.</p>
</div>
<div class="paragraph">
<p>As said before, once published in the ZetaPush cloud, ZetaPush handles scalability and
high availability. So several worker instances will run in the same time and ZetaPush will
load-balance traffic between worker instances. In order to ensure that <strong>only one worker</strong> executes
some initialization code, ZetaPush provides <a href="#onapplicationbootstrap"><code>onApplicationBootstrap</code> special method</a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Snapshot and rollback</div>
<div class="paragraph">
<p>In future version, every deployment will trigger a <a href="#snapshots">snapshot</a> to store
the whole application state and data. The aim is to provide you a tool to
quickly restore the previous version.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="integrate_user_management"><a class="anchor" href="#integrate_user_management"></a><a class="link" href="#integrate_user_management">14. User management in your application</a></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_presentation"><a class="anchor" href="#_presentation"></a><a class="link" href="#_presentation">14.1. Presentation</a></h3>
<div class="paragraph">
<p>In a software application, we (almost) always need to manage users. The <strong>Standard User Workflow</strong> helps you to do this, in the most common use case (for
business to customer application on the Internet). This cloud service helps you to:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Signup a user</p>
</li>
<li>
<p>Log in a user</p>
</li>
<li>
<p>Log out a user</p>
</li>
<li>
<p>Manage a forgotten password</p>
</li>
<li>
<p>Manage permissions of users</p>
</li>
<li>
<p>etc&#8230;&#8203;</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Authentication</div>
<div class="paragraph">
<p>At this moment, the connection and the disconnection of a user is done through the ZetaPush SDK (We will see below how to do this).</p>
</div>
<div class="paragraph">
<p>In the future, the connection and disconnection will be handled by <code>StandardUserWorkflow</code> in order to provide you
a clearer API.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>For us, the most common use case is when a user can create its own account using a login and a password and needs to confirm his account via a link in an email.
Once its account is validated, he can login and use the application.</p>
</div>
<div class="paragraph">
<p><strong>Sign up: </strong></p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images//schemas/standarduserworkflow-signup.png" alt="standarduserworkflow signup">
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The user creates his account using a login, a password and an email. When the user submits the form, the account is created on the ZetaPush platform. In order to ensure that the user is not a bot, the account has to be confirmed before the user is authorized to login.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>An email is sent to the user in order to confirm its account. The email contains the confirmation link. He needs to confirm his account before connection.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>When the user clicks on the link in the email, he is authorized to login.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong>Log in: </strong></p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images//schemas/standarduserworkflow-login.png" alt="standarduserworkflow login">
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>When the user account is confirmed, he can log in the application using the his login and his password.</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Account not confirmed</div>
<div class="paragraph">
<p>If the user tries to log into the application before he confirmed his account, an error will be returned to explain that the account needs to be confirmed via the link in the confirmation email.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_quick_start"><a class="anchor" href="#_quick_start"></a><a class="link" href="#_quick_start">14.2. Quick start</a></h3>
<div class="paragraph">
<p>In this part we will explain how to use the <strong>Standard User Workflow</strong> in the default behavior, i.e. using the default implementations of each parts of the workflow.</p>
</div>
<div class="paragraph">
<p>To use the Standard User Workflow, you just need 4 steps :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Create a ZetaPush application as usual</p>
</li>
<li>
<p>Import and use the Standard User Workflow in your worker</p>
</li>
<li>
<p>Configure some properties</p>
</li>
<li>
<p>Develop your front by calling the Standard User Workflow API</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="_create_a_zetapush_application_as_usual"><a class="anchor" href="#_create_a_zetapush_application_as_usual"></a><a class="link" href="#_create_a_zetapush_application_as_usual">14.2.1. Create a ZetaPush application as usual</a></h4>
<div class="paragraph">
<p>In this Quickstart, we begin with a generated application using the CLI. So you can run:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="console">$ npm init @zetapush app-with-user-management</code></pre>
</div>
</div>
<div class="paragraph">
<p>We import the library <code>@zetapush/user-management</code> that provides the Standard User Workflow using NPM:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="console">$ npm install --save @zetapush/user-management</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_import_and_use_the_standard_user_workflow_in_your_worker"><a class="anchor" href="#_import_and_use_the_standard_user_workflow_in_your_worker"></a><a class="link" href="#_import_and_use_the_standard_user_workflow_in_your_worker">14.2.2. Import and use the Standard User Workflow in your worker</a></h4>
<div class="paragraph">
<p>Change the code of the <em>custom cloud service</em> defined in <code>worker/index.ts</code> file:</p>
</div>
<div class="listingblock">
<div class="title">worker/index.ts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre></td>
  <td class="code"><pre><span class="reserved">import</span> {
  StandardUserWorkflow,                       <i class="conum" data-value="1"></i><b>(1)</b>
  StandardUserManagementModule,               <i class="conum" data-value="2"></i><b>(2)</b>
  ConfirmationUrlHttpHandler                  <i class="conum" data-value="3"></i><b>(3)</b>
} from <span class="string"><span class="delimiter">'</span><span class="content">@zetapush/user-management</span><span class="delimiter">'</span></span>;
<span class="reserved">import</span> { Module } from <span class="string"><span class="delimiter">'</span><span class="content">@zetapush/core</span><span class="delimiter">'</span></span>;      <i class="conum" data-value="4"></i><b>(4)</b>

<span class="error">@</span>Module({                                     <i class="conum" data-value="5"></i><b>(5)</b>
  <span class="key">imports</span>: [StandardUserManagementModule],    <i class="conum" data-value="6"></i><b>(6)</b>
  <span class="key">expose</span>: {
    <span class="key">user</span>: StandardUserWorkflow,               <i class="conum" data-value="7"></i><b>(7)</b>
    <span class="key">http</span>: ConfirmationUrlHttpHandler          <i class="conum" data-value="8"></i><b>(8)</b>
  }
})
<span class="reserved">export</span> <span class="keyword">default</span> <span class="reserved">class</span> Api {}                   <i class="conum" data-value="9"></i><b>(9)</b></pre></td>
</tr></table></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>StandardUserWorkflow</code> is the <em>cloud service</em> we want to use. It is this class
that provides the <em>cloud functions</em> to handle user registration, password reset, login and logout.
Here we just import the TypeScript class.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The <code>StandardUserWorkflow</code> <em>cloud service</em> is encapsulated in the <code>StandardUserManagementModule</code> module.
We also need to import TypeScript class for later use.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The <code>StandardUserManagementModule</code> module also provides <code>ConfirmationUrlHttpHandler</code> in
order to provide an HTTP endpoint to handle the confirmation link that will be clicked in the email.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Import the <code>Module</code> annotation for TypeScript.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>The <code>@Module</code> annotation is used here to indicate to the worker
which <em>cloud services</em> you want to use and how you want to use it
in your <em>custom cloud service</em>.</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>We indicate to the worker that we import the module <code>StandardUserManagementModule</code>.
It means that everything provided by the module is now available to
your <em>custom cloud service</em>.</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>We indicate that we directly expose <code>StandardUserWorkflow</code> <em>cloud service</em>. It means that
<em>cloud functions</em> defined by <code>StandardUserWorkflow</code> are directly callable from a client.</td>
</tr>
<tr>
<td><i class="conum" data-value="8"></i><b>8</b></td>
<td>We indicate that we also expose <code>ConfirmationUrlHttpHandler</code>. It means that
the HTTP endpoint is directly callable by opening the confirmation URL in a web browser.</td>
</tr>
<tr>
<td><i class="conum" data-value="9"></i><b>9</b></td>
<td>As usual we export the entry point of your <em>custom cloud services</em>.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong>That all for the worker code !</strong></p>
</div>
<div class="paragraph">
<p>The code above basically declares your <em>custom cloud service</em> as a new <a href="#modules">ZetaPush module</a>.
In this case, we don&#8217;t need to create a module but the <code>@Module</code> is needed to import another module.
Importing a module (using <code>imports</code> option) only indicates that you want to use a module somewhere in your <em>custom cloud service</em>.
It doesn&#8217;t automatically expose anything. This is deliberate because you may want to not directly
expose the <code>StandardUserWorkflow</code> <em>cloud functions</em> to the client. You could then define a <em>custom cloud service</em>
that is exposed and delegate user management to the <code>StandardUserWorkflow</code> <em>cloud functions</em>.</p>
</div>
<div class="paragraph">
<p>The quickest way to benefit from user management is to directly expose <code>StandardUserWorflow</code> to the client.
It means that the <em>cloud functions</em> provided by <code>StandardUserWorkflow</code> are directly callable from a client.
So you don&#8217;t need to code anything in your <em>custom cloud service</em> and you can focus on the front side.
To expose the <code>StandardUserWorkflow</code> you simply need to add the <code>expose</code> option on the <code>@Module</code>
annotation. In addition to exposing <code>StandardUserWorkflow</code> to a client that uses the bidirectional
connection to interact with <code>StandardUserWorflow</code> <em>cloud functions</em>, we also expose <code>ConfirmationUrlHttpHandler</code>
in order to start a web server that listens to HTTP requests done on the account confirmation URL.
The aim is to directly provide you the verification of the confirmation of the account when the user clicks
on the confirmation link in the email. You don&#8217;t need to bother to check if the confirmation token
is valid and to handle token expiration.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Modules</div>
<div class="paragraph">
<p>ZetaPush provides <a href="#modules">modules</a> to encapsulate
several <em>cloud services</em> and to be able to reuse them.</p>
</div>
<div class="paragraph">
<p>As seen before, when you have a really simple <em>custom cloud service</em>,
you just expose a class (without <code>@Module</code> annotation). In this case,
ZetaPush worker defines an implicit module that imports nothing and
exposes your class.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Expose several <em>cloud services</em></div>
<div class="paragraph">
<p>As we expose several classes, we define a map:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript">expose: {
  <span class="key">user</span>: StandardUserWorflow,
  <span class="key">http</span>: ConfirmationUrlHttpHandler
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The keys of the map correspond to <a href="#namespaces">namespaces</a>.
ZetaPush provides namespaces in order to be able to expose several
<em>cloud services</em> each isolated by a name. The aim is to be able to have
for example two <em>cloud functions</em> named <code>hello</code> in two different
<em>cloud services</em> that are exposed. So on the client side, the name
is used to specify which <em>cloud service</em> to use when we call
the <em>cloud function</em> <code>hello</code>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Listen to HTTP requests</div>
<div class="paragraph">
<p>ZetaPush uses a bidirectional connection to interact between client and <em>cloud services</em> (and vice versa).
But in some cases, the bidirectional connection can&#8217;t be used as for the confirmation link.
Indeed the confirmation link is just an URL that opens a web browser when it is clicked by the
end-user. The web browser performs an HTTP <code>GET</code> request on that URL.
That&#8217;s why ZetaPush also handles HTTP.</p>
</div>
<div class="paragraph">
<p>You can even provide your own HTTP routes to listen to:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Either by registering a route in the <a href="#internal_http_server">ZetaPush web server</a></p>
</li>
<li>
<p>Or by using your <a href="#custom_http_server">own HTTP server</a> (you can even use any library
or framework you want like <a href="http://expressjs.com/" target="_blank" rel="noopener">express</a> for example)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In this example, <code>ConfirmationUrlHttpHandler</code> registers a route for the confirmation URL in the ZetaPush web server.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_configure_some_properties"><a class="anchor" href="#_configure_some_properties"></a><a class="link" href="#_configure_some_properties">14.2.3. Configure some properties</a></h4>
<div class="paragraph">
<p>The code is ready but in order to adapt the workflow to your needs, some configuration properties are required.
To configure those properties, you need to create a file named <code>application.json</code> at the root of your application:</p>
</div>
<div class="listingblock">
<div class="title">application.json</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
</pre></td>
  <td class="code"><pre>{
  <span class="key"><span class="delimiter">&quot;</span><span class="content">email</span><span class="delimiter">&quot;</span></span>: {
    <span class="key"><span class="delimiter">&quot;</span><span class="content">from</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">no-reply@your-application-name.com</span><span class="delimiter">&quot;</span></span>    <i class="conum" data-value="1"></i><b>(1)</b>
  },
  <span class="key"><span class="delimiter">&quot;</span><span class="content">smtp</span><span class="delimiter">&quot;</span></span>: {
    <span class="key"><span class="delimiter">&quot;</span><span class="content">host</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">smtp.mailtrap.io</span><span class="delimiter">&quot;</span></span>,                     <i class="conum" data-value="2"></i><b>(2)</b>
    <span class="key"><span class="delimiter">&quot;</span><span class="content">port</span><span class="delimiter">&quot;</span></span>: <span class="integer">2525</span>,                                   <i class="conum" data-value="3"></i><b>(3)</b>
    <span class="key"><span class="delimiter">&quot;</span><span class="content">username</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="delimiter">&quot;</span></span>,                                 <i class="conum" data-value="4"></i><b>(4)</b>
    <span class="key"><span class="delimiter">&quot;</span><span class="content">password</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="delimiter">&quot;</span></span>,                                 <i class="conum" data-value="5"></i><b>(5)</b>
    <span class="key"><span class="delimiter">&quot;</span><span class="content">ssl</span><span class="delimiter">&quot;</span></span>: <span class="value">false</span>,                                   <i class="conum" data-value="6"></i><b>(6)</b>
    <span class="key"><span class="delimiter">&quot;</span><span class="content">starttls</span><span class="delimiter">&quot;</span></span>: <span class="value">false</span>                               <i class="conum" data-value="7"></i><b>(7)</b>
  }
}</pre></td>
</tr></table></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>As an email is sent to the end user for confirming its account,
you need to configure the email sender. The email sender address
may not be totally what you want and may depend on your email
provider. For the example, we use a testing service that allows
any email address as email sender (see tip about Mailtrap below).</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Configure the domain or the host for the SMTP server</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Configure the port of the SMTP server</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Configure username used to authenticate on the SMTP server</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Configure password used to authenticate on the SMTP server</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>Set to true if your SMTP server requires SSL</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>Set to true if your SMTP server requires TLS</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In this example, we provide only the minimal required configuration. We only need to configure email
sending. All other configuration properties are optional.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Test inscription and confirmation using Mailtrap</div>
<div class="paragraph">
<p>For the example, we show the usage of <a href="https://mailtrap.io/" target="_blank" rel="noopener">mailtrap</a>. This is an online
service that provides a SMTP server. There is a free plan to test email sending.</p>
</div>
<div class="paragraph">
<p>If you want to test, just signup to mailtrap and fill <code>username</code> and <code>password</code> in <code>application.json</code>.</p>
</div>
<div class="paragraph">
<p>If you already have your own SMTP server, you can directly enter your SMTP configuration in <code>application.json</code>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Configuration properties</div>
<div class="paragraph">
<p>The <code>application.json</code> file is not pure JSON. In fact, it accepts comments. This can
be useful to document some properties.</p>
</div>
<div class="paragraph">
<p>You can learn more about <a href="#configuration_properties"><code>application.json</code> and how to use configuration properties</a>.</p>
</div>
<div class="paragraph">
<p>You can also learn <a href="#configuration-of-standard-user-workflow">how to deeply configure the Standard User Workflow</a>.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_develop_your_front_by_calling_the_standard_user_workflow_api"><a class="anchor" href="#_develop_your_front_by_calling_the_standard_user_workflow_api"></a><a class="link" href="#_develop_your_front_by_calling_the_standard_user_workflow_api">14.2.4. Develop your front by calling the Standard User Workflow API</a></h4>
<div class="paragraph">
<p>Finally, we just need to call the <em>cloud function</em> to create a user account, log in and log out from the client part.</p>
</div>
<div class="paragraph tab-container">
<p>Front code</p>
</div>
<div class="paragraph tab">
<p>index.js</p>
</div>
<div class="paragraph">
<p>You can replace the <code>front/index.js</code> file by the following content :</p>
</div>
<div class="listingblock">
<div class="title">front/index.js</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
</pre></td>
  <td class="code"><pre><span class="comment">// Create the ZetaPush API</span>
const client = <span class="keyword">new</span> ZetaPushClient.SmartClient();
const userApi = client.createProxyTaskService({                               <i class="conum" data-value="1"></i><b>(1)</b>
  <span class="key">namespace</span>: <span class="string"><span class="delimiter">'</span><span class="content">user</span><span class="delimiter">'</span></span>
});

async <span class="keyword">function</span> <span class="function">signUpUser</span>(form) {                                             <i class="conum" data-value="2"></i><b>(2)</b>
  const login = form[<span class="integer">0</span>].value;
  const password = form[<span class="integer">1</span>].value;
  const email = form[<span class="integer">2</span>].value;
  <span class="comment">// First connection as anonymous user to allow us to create a user</span>
  await client.connect();

  <span class="comment">// Creation of the user account</span>
  <span class="keyword">try</span> {
    await userApi.signup({
      <span class="key">credentials</span>: {
        login,
        password
      },
      <span class="key">profile</span>: {
        email
      }
    });
    console.log(<span class="string"><span class="delimiter">'</span><span class="content">User account created</span><span class="delimiter">'</span></span>);
  } <span class="keyword">catch</span> (err) {
    console.error(<span class="string"><span class="delimiter">'</span><span class="content">Failed to create user account : </span><span class="delimiter">'</span></span>, err);
  }
}

<span class="comment">/**
 * Connection of a user
 */</span>
async <span class="keyword">function</span> <span class="function">loginUser</span>(form) {                                              <i class="conum" data-value="3"></i><b>(3)</b>
  const login = form[<span class="integer">0</span>].value;
  const password = form[<span class="integer">1</span>].value;

  await client.setCredentials({ login, password });
  client
    .connect()
    .then(() =&gt; {
      console.log(<span class="string"><span class="delimiter">'</span><span class="content">User connected</span><span class="delimiter">'</span></span>);
    })
    .<span class="keyword">catch</span>(err =&gt; {
      console.error(<span class="string"><span class="delimiter">'</span><span class="content">Failed to connect user : </span><span class="delimiter">'</span></span>, err);
    });
}

<span class="comment">/**
 * Disconnection of a user
 */</span>
async <span class="keyword">function</span> <span class="function">logoutUser</span>() {                                                 <i class="conum" data-value="4"></i><b>(4)</b>
  await client.disconnect();
  console.log(<span class="string"><span class="delimiter">'</span><span class="content">User disconnected</span><span class="delimiter">'</span></span>);
}</pre></td>
</tr></table></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>We created a ZetaPush client and his API to call our cloud functions.
We use the namespace <code>user</code> to call the <code>StandardUserWorkflow</code> <em>cloud functions</em>.
Remember the <code>expose</code> option on <code>@Module</code> configuration and the <code>user</code> key in the map.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Function to create an account of the ZetaPush platform for this application.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Function to connect a user.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Function to disconnect a user.</td>
</tr>
</table>
</div>
<div class="paragraph tab">
<p>index.html</p>
</div>
<div class="paragraph">
<p>Here is a very basic HTML page with two forms (one to create an account, the other to login):</p>
</div>
<div class="listingblock">
<div class="title">front/index.html</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="html"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
</pre></td>
  <td class="code"><pre><span class="doctype">&lt;!DOCTYPE html&gt;</span>
<span class="tag">&lt;html</span> <span class="attribute-name">lang</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">en</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>

<span class="tag">&lt;head&gt;</span>
  <span class="tag">&lt;meta</span> <span class="attribute-name">charset</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">UTF-8</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
  <span class="tag">&lt;meta</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">viewport</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">content</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">width=device-width, initial-scale=1.0</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
  <span class="tag">&lt;title&gt;</span>Standard User Workflow<span class="tag">&lt;/title&gt;</span>
<span class="tag">&lt;/head&gt;</span>

<span class="tag">&lt;body&gt;</span>
  <span class="tag">&lt;h1&gt;</span>Signup<span class="tag">&lt;/h1&gt;</span>
  <span class="tag">&lt;form</span> <span class="attribute-name">onsubmit</span>=<span class="string"><span class="delimiter">&quot;</span>event.preventDefault(); signUpUser(<span class="local-variable">this</span>);<span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>   <i class="conum" data-value="1"></i><b>(1)</b>
    Login: <span class="tag">&lt;input</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">text</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">login</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
    Password: <span class="tag">&lt;input</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">password</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">password</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
    Email: <span class="tag">&lt;input</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">email</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">email</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
    <span class="tag">&lt;button</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">submit</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>Sign up<span class="tag">&lt;/button&gt;</span>
  <span class="tag">&lt;/form&gt;</span>

  <span class="tag">&lt;h1&gt;</span>Login<span class="tag">&lt;/h1&gt;</span>
  <span class="tag">&lt;form</span> <span class="attribute-name">onsubmit</span>=<span class="string"><span class="delimiter">&quot;</span>event.preventDefault(); loginUser(<span class="local-variable">this</span>);<span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>    <i class="conum" data-value="2"></i><b>(2)</b>
    Login: <span class="tag">&lt;input</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">text</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">login</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
    Password: <span class="tag">&lt;input</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">password</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">password</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
    <span class="tag">&lt;button</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">submit</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>Login<span class="tag">&lt;/button&gt;</span>
  <span class="tag">&lt;/form&gt;</span>

  <span class="tag">&lt;script</span> <span class="attribute-name">src</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">https://unpkg.com/@zetapush/client</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span><span class="tag">&lt;/script&gt;</span>
  <span class="tag">&lt;script</span> <span class="attribute-name">src</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">./index.js</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span><span class="tag">&lt;/script&gt;</span>
<span class="tag">&lt;/body&gt;</span>

<span class="tag">&lt;/html&gt;</span></pre></td>
</tr></table></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Form to create a new user</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Form to login a user</td>
</tr>
</table>
</div>
<div class="paragraph tab-container-end">
<p>-</p>
</div>
<div class="paragraph">
<p>Run the following command to run your application in local and serve the front part :</p>
</div>
<div class="listingblock">
<div class="title">Run the application</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="console">$ npm run start -- --serve-front</code></pre>
</div>
</div>
<div class="paragraph">
<p>To test the workflow, just enter a login, a password and an email in the "Signup" part.
Then if you use <a href="https://mailtrap.io/" target="_blank" rel="noopener">mailtrap</a> for email sending, you can go
into the inbox provided by mailtrap and check that email has been received.
You can click on the link provided in the email. The account is then confirmed and
you are automatically redirected to something like <code><a href="http://localhost:2999#login" class="bare">http://localhost:2999#login</a></code>.
Now you can login using the same login and password pair (open your web browser console
to see connection messages).</p>
</div>
<div class="paragraph">
<p>You can also check that if you try to connect with wrong login or password, it doesn&#8217;t work
as expected. You can also create a new user but do not click on the link in the email.
You can check that you are not allowed to login.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="title">Automatic configuration according to execution context</div>
<div class="paragraph">
<p>You can notice that you didn&#8217;t configure any URL for confirmation link and for
redirection to <code><a href="http://localhost:2999/#login" class="bare">http://localhost:2999/#login</a></code> once the account is confirmed.
Actually, ZetaPush automatically provides base URL of your front and your worker.
So you don&#8217;t bother to configure the base URLs. This is particularly useful
when your application is published on the ZetaPush cloud because you don&#8217;t
need to change configuration at all.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Automatic adaptation of the implementations</div>
<div class="paragraph">
<p>In the example, we use a SMTP server to send the confirmation email.
But you may want to use something else like <a href="https://fr.mailjet.com/" target="_blank" rel="noopener">Mailjet</a>.
ZetaPush provides an auto-adaptation system based on configuration.</p>
</div>
<div class="paragraph">
<p>In concrete terms, if you don&#8217;t configure <code>smtp</code> part in <code>application.json</code>
but instead you configure <code>mailjet</code> part, <code>StandardUserWorkflow</code> will
<a href="#auto_implementation_selection">automatically switch implementation</a> used for sending email and will
use Mailjet instead of SMTP.</p>
</div>
<div class="paragraph">
<p>In future versions, other providers will be directly integrated.
The advantage is to configure the minimum as for Mailjet which
you only need to provide your Mailjet credentials.</p>
</div>
<div class="paragraph">
<p>Moreover, you could also choose to change the workflow by replacing
email by a <a href="#extension-of-standard-user-workflow">SMS or anything else</a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Extend and adapt the default workflow</div>
<div class="paragraph">
<p>The default behavior is totally adaptable. You can replace default implementations
provided by ZetaPush by your own implementations (for exemple, change token generation
algorithm, replace email by something else, replace templating system, &#8230;&#8203;).</p>
</div>
<div class="paragraph">
<p>You can learn <a href="#extension-of-standard-user-workflow">how to extend this cloud service</a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">User management samples</div>
<div class="paragraph">
<p>For a more real-world sample with a complete UI (signup form and login form) you can
go to <a href="https://github.com/zetapush/zetapush-examples/tree/master/standard-user-workflow" target="_blank" rel="noopener">GitHub ZetaPush Examples</a>.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_store_data_in_your_application"><a class="anchor" href="#_store_data_in_your_application"></a><a class="link" href="#_store_data_in_your_application">15. Store data in your application</a></h2>
<div class="sectionbody">
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p>ZetaPush provides several technical services to manipulate data.
These services have the same complexity as the databases that are used
underneath. For example, you can use Elastic Search to index and search
but you have to understand how Elastic Search works. This can be time consuming.</p>
</div>
<div class="paragraph">
<p>ZetaPush wants to provide you the best developer experience in order to
focus on the functional and not technical issues. We want to offer
a way to quickly store, retrieve, search data. We aim to cover about 80%
of usages with our system. For example, you could write something like this in your
code:</p>
</div>
<div class="listingblock">
<div class="title">Data object</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript"><span class="error">@</span>Storable()
<span class="error">@</span>Searchable({<span class="key">name</span>: [<span class="string"><span class="delimiter">'</span><span class="content">firstname</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">lastname</span><span class="delimiter">'</span></span>]})
<span class="reserved">class</span> User {
  <span class="reserved">private</span> firstname: string;
  <span class="reserved">private</span> lastname: string;
  <span class="reserved">private</span> birthdate: Date;
  <span class="error">@</span>Searchable()
  <span class="error">@</span>Unique()
  <span class="reserved">private</span> email: EmailAddress;
  <span class="error">@</span>Searchable()
  <span class="error">@</span>Unique()
  <span class="reserved">private</span> phoneNumber: PhoneNumber;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then you could save data using:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript">userRepository.save(user);</code></pre>
</div>
</div>
<div class="paragraph">
<p>You could also retrieve users:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript"><span class="comment">// get all users that exactly match the lastname</span>
userRepository.findAll({<span class="key">lastname</span>: <span class="string"><span class="delimiter">'</span><span class="content">Doe</span><span class="delimiter">'</span></span>});</code></pre>
</div>
</div>
<div class="paragraph">
<p>You could also search users:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript"><span class="comment">// search for users that combination of firstname and lastname</span>
<span class="comment">// matches the search terms</span>
userRepository.search(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">Jo Do</span><span class="delimiter">'</span></span>);
<span class="comment">// search for users which email that partially matches the search terms</span>
userRepository.search(<span class="string"><span class="delimiter">'</span><span class="content">email</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">@yopmail</span><span class="delimiter">'</span></span>);</code></pre>
</div>
</div>
<div class="paragraph">
<p>This feature is under construction and the API is not
fixed for the moment</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_secure_your_application"><a class="anchor" href="#_secure_your_application"></a><a class="link" href="#_secure_your_application">16. Secure your application</a></h2>
<div class="sectionbody">
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p>ZetaPush wants to provide you the best developer experience in order to
focus on the functional and not technical issues. We want to offer
a way to quickly secure your application. We aim to cover about 80%
of usages with our system. For example, you could write something like this in your
code:</p>
</div>
<div class="listingblock">
<div class="title">Cloud service</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript"><span class="error">@</span>Injectable()
<span class="reserved">export</span> <span class="keyword">default</span> <span class="reserved">class</span> MyCustomCloudService {
  <span class="error">@</span>CanChangePassword
  changePassword(user) {
    <span class="comment">// code for changing a password of a user</span>
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Instead of using technical annotations or calls, we want
to provide you the possibility to define your own security
annotations. It makes the code easier to read and to maintain.</p>
</div>
<div class="paragraph">
<p>Here is an example of the code a custom annotation:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript"><span class="reserved">import</span> { isAdmin, isCurrentUser, SecurityException } from <span class="string"><span class="delimiter">'</span><span class="content">@zetapush/security</span><span class="delimiter">'</span></span>;

<span class="reserved">export</span> const CanChangePassword = (user) =&gt; {
  <span class="comment">// an admin can change password of anyone</span>
  <span class="keyword">if</span>(isAdmin()) {
    <span class="keyword">return</span>;
  }
  <span class="comment">// a user can change only its own password</span>
  <span class="keyword">if</span>(isCurrentUser(user)) {
    <span class="keyword">return</span>;
  }
  <span class="comment">// not allowed</span>
  <span class="keyword">throw</span> <span class="keyword">new</span> SecurityException(<span class="error">`</span>You are not allowed to change password of <span class="predefined">$</span>{user.login}<span class="error">`</span>, user);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In addition to control who can execute actions, we want
to provide a simple way to retrieve filtered data that comes from
database. For example, an admin could view everything while
a user could only see his friends.</p>
</div>
<div class="listingblock">
<div class="title">Data object</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript"><span class="error">@</span>CanSeeAccount()
<span class="error">@</span>Storable()
<span class="error">@</span>Searchable({<span class="key">name</span>: [<span class="string"><span class="delimiter">'</span><span class="content">firstname</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">lastname</span><span class="delimiter">'</span></span>]})
<span class="reserved">class</span> User {
  <span class="reserved">private</span> firstname: string;
  <span class="reserved">private</span> lastname: string;
  <span class="reserved">private</span> birthdate: Date;
  <span class="error">@</span>Searchable()
  <span class="reserved">private</span> email: EmailAddress;
  <span class="error">@</span>Searchable()
  <span class="error">@</span>Sensitive()
  <span class="reserved">private</span> phoneNumber: PhoneNumber;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Here is an example of the code a custom annotation:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript"><span class="reserved">import</span> { isAdmin, isCurrentUser, currentUser } from <span class="string"><span class="delimiter">'</span><span class="content">@zetapush/security</span><span class="delimiter">'</span></span>;

const areFriends = (userFromDatabase, otherUser) =&gt; {
  <span class="comment">// ... (your code to check if the users are friends)</span>
}

<span class="reserved">export</span> const CanSeeAccount = (userFromDatabase) =&gt; {
  <span class="comment">// an admin can see all accounts</span>
  <span class="keyword">if</span>(isAdmin()) {
    <span class="keyword">return</span> <span class="predefined-constant">true</span>;
  }
  <span class="comment">// a user can see its account</span>
  <span class="keyword">if</span>(isCurrentUser(userFromDatabase)) {
    <span class="keyword">return</span> <span class="predefined-constant">true</span>;
  }
  <span class="comment">// a user can see accounts of his friends</span>
  <span class="keyword">if</span>(areFriends(currentUser(), userFromDatabase)) {
    <span class="keyword">return</span> <span class="predefined-constant">true</span>;
  }
  <span class="comment">// not allowed to see</span>
  <span class="keyword">return</span> <span class="predefined-constant">false</span>;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Moreover, you could filter fields for example to prevent some sensitive
information to be visible to other users. Here we want to make phone
number only visible for an admin and the user that owns the phone number
(look at <code>@Sensitive()</code> annotation that indicates that the data
must not be visible unless we explicitly want it):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript"><span class="reserved">import</span> { isAdmin, isCurrentUser, currentUser, accessSensitiveField } from <span class="string"><span class="delimiter">'</span><span class="content">@zetapush/security</span><span class="delimiter">'</span></span>;

const areFriends = (userFromDatabase, otherUser) =&gt; {
  <span class="comment">// ... (your code to check if the users are friends)</span>
}

<span class="reserved">export</span> const CanSeeAccount = (userFromDatabase) =&gt; {
  <span class="comment">// an admin can see all accounts</span>
  <span class="keyword">if</span>(isAdmin()) {
    <span class="keyword">return</span> accessSensitiveField(<span class="string"><span class="delimiter">'</span><span class="content">phoneNumber</span><span class="delimiter">'</span></span>);
  }
  <span class="comment">// a user can see its account</span>
  <span class="keyword">if</span>(isCurrentUser(userFromDatabase)) {
    <span class="keyword">return</span> <span class="predefined-constant">true</span>;
  }
  <span class="comment">// a user can see accounts of his friends</span>
  <span class="keyword">if</span>(areFriends(currentUser(), userFromDatabase)) {
    <span class="keyword">return</span> <span class="predefined-constant">true</span>;
  }
  <span class="comment">// not allowed to see</span>
  <span class="keyword">return</span> <span class="predefined-constant">false</span>;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>These features are under construction and the API is not
fixed for the moment</p>
</div>
</div>
</div>
</div>
</div>
<h1 id="_tutorials" class="sect0"><a class="anchor" href="#_tutorials"></a><a class="link" href="#_tutorials">Tutorials</a></h1>
<div class="openblock partintro">
<div class="content">
<div class="paragraph">
<p>In this tutorial, you will create an application with ZetaPush, from the initialization to the deployment.
You will learn to:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Add business logic with ZetaPush</p>
</li>
<li>
<p>Use <em>cloud services</em> provided by ZetaPush</p>
</li>
<li>
<p>Run your code locally</p>
</li>
<li>
<p>Deploy your application</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_use_case"><a class="anchor" href="#_use_case"></a><a class="link" href="#_use_case">17. Use case</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>You will create a realtime chat application, but it will be particular: This will be an <strong>Avengers Chat</strong> !</p>
</div>
<div class="paragraph">
<p>At the beginning, the user of the chat can choose an Avenger. Each character has many skills and they can use them on the chat to attack the others Avengers.</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 3. List of skills by Avenger</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-middle">Avenger</th>
<th class="tableblock halign-center valign-middle">Skill</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-middle"><p class="tableblock">Captain America</p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock">Shoot of shield / Cure</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"><p class="tableblock">Falcon</p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock">Archery / Super vision</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"><p class="tableblock">Iron Man</p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock">Flight / Missile launcher</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"><p class="tableblock">Hulk</p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock">Punch / Regeneration</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"><p class="tableblock">Thor</p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock">Hammer hit / Lightning strike</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"><p class="tableblock">Spider Man</p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock">Shoot of cobweb / Jump with cobweb</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"><p class="tableblock">Wolverine</p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock">Scratch / Regeneration</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>You will create this application in few steps:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a href="#_initialize_your_application">Initialize a new application</a></p>
</li>
<li>
<p><a href="#_create_your_business_logic">Create the business logic in a <em>custom cloud service</em></a></p>
</li>
<li>
<p><a href="#_use_your_em_custom_cloud_services_em">Use your <em>custom cloud service</em> in your UI</a></p>
</li>
<li>
<p><a href="#_deploy_your_application">Deploy your application</a></p>
</li>
</ol>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
We recommend to use <em>TypeScript</em> so in this tutorial all of your code will be in this language.
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="_initialize_your_application"><a class="anchor" href="#_initialize_your_application"></a><a class="link" href="#_initialize_your_application">17.1. Initialize your application</a></h3>
<div class="paragraph">
<p>In the first step, you need to create your application. To do this you can run:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="console"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
</pre></td>
  <td class="code"><pre>npm init @zetapush myApp</pre></td>
</tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>This command will ask you your developer login and password.</p>
</div>
<div class="paragraph">
<p>This command will create you an account on the ZetaPush platform and will create your first application in the <em>myApp</em> directory.
An email will be sent to confirm your account.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
To use your application, you need to validate your account. To do this, click on the link in the received email
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In this tutorial, we are focusing on the ZetaPush development. So, to begin, get all resources and add them to your application (css, assets, &#8230;&#8203;):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="console"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
</pre></td>
  <td class="code"><pre>$ cd myApp/front/
$ rm -r ./*
$ curl -X GET 'http://github-download-subfolder.zpush.io/?owner=zetapush&amp;repository=zetapush-tutorials&amp;path=avengersChat/front' --output front.zip
$ unzip front.zip &amp;&amp; rm front.zip
</pre></td>
</tr></table></code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
If you are using <em>Windows</em>, you can download the file with all resources and unzip it in the front directory. Link: <a href="http://github-download-subfolder.zpush.io/?owner=zetapush&amp;repository=zetapush-tutorials&amp;path=avengersChat/front" class="bare">http://github-download-subfolder.zpush.io/?owner=zetapush&amp;repository=zetapush-tutorials&amp;path=avengersChat/front</a>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>So you already have the style and the frontend logic in the folders <code>assets</code> and <code>utils</code>. You can browse these files to understand this code.</p>
</div>
<div class="paragraph">
<p>In this tutorial, you need to:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Create the business logic with a <em>custom cloud service</em></p>
</li>
<li>
<p>Implement the interaction with the <em>custom cloud service</em> (front side)</p>
</li>
<li>
<p>Deploy your application</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_create_your_business_logic"><a class="anchor" href="#_create_your_business_logic"></a><a class="link" href="#_create_your_business_logic">17.2. Create your business logic</a></h3>
<div class="paragraph">
<p>Now, you will create the business logic of your application. To do this, you will use a <em>custom cloud service</em>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
A <em>custom cloud service</em> is a class where you develop a business logic. You can create several <em>custom cloud services</em> inside one application. Each <em>custom cloud service</em> can use the <em>cloud services</em> provided by ZetaPush.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In your existing application you already have a <em>custom cloud service</em> on the file <code>worker/index.ts</code> (The entry point of the service is defined in the <code>package.json</code> with the property <code>main</code>).</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
To use your <em>custom cloud services</em> you need to export them. To do this, the property <code>main</code> in your <code>package.json</code> define the path of the file where you export all of your <em>custom cloud services</em>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You can delete the content of the file <code>worker/index.ts</code> and fill it with the following content step by step.</p>
</div>
<div class="sect3">
<h4 id="_import_em_cloud_services_em_and_define_constants"><a class="anchor" href="#_import_em_cloud_services_em_and_define_constants"></a><a class="link" href="#_import_em_cloud_services_em_and_define_constants">17.2.1. Import <em>cloud services</em> and define constants</a></h4>
<div class="paragraph">
<p>First, you need to import the <em>cloud services</em> provided by ZetaPush, used in this application:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>Stack</em> (Save data in a stack)</p>
</li>
<li>
<p><em>Messaging</em> (Send and receive messages)</p>
</li>
<li>
<p><em>Groups</em> (Manage group of users)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You also need to import <em>Injectable</em> that is useful for the dependencies injection.</p>
</div>
<div class="listingblock">
<div class="title">Imports and constants</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="typescript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
</pre></td>
  <td class="code"><pre>import { Injectable } from '@zetapush/core';
import { Stack, Messaging, Groups } from '@zetapush/platform-legacy';

const CONVERSATION_ID = 'avengersChat';
const CHANNEL_MESSAGING = 'avengersChannel'; <i class="conum" data-value="1"></i><b>(1)</b></pre></td>
</tr></table></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Channel on which the users send and listen to the messages</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_create_the_class_with_its_constructor"><a class="anchor" href="#_create_the_class_with_its_constructor"></a><a class="link" href="#_create_the_class_with_its_constructor">17.2.2. Create the class with its constructor</a></h4>
<div class="paragraph">
<p>A <em>custom cloud service</em> is a class, so you need to create it.</p>
</div>
<div class="listingblock">
<div class="title">Class and constructor</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="typescript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
</pre></td>
  <td class="code"><pre>@Injectable() <i class="conum" data-value="1"></i><b>(1)</b>
export default class AvengersApi {
  /**
   * Constructor of our API
   */
  constructor(
    private stack: Stack,
    private messaging: Messaging,
    private groups: Groups
  ) {
  }
}</pre></td>
</tr></table></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>We expose our custom cloud service with only one annotation</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The dependencies injection of ZetaPush use <code>injection-js</code>.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_create_the_chat"><a class="anchor" href="#_create_the_chat"></a><a class="link" href="#_create_the_chat">17.2.3. Create the chat</a></h4>
<div class="paragraph">
<p>To create our chat, we use the <em>Groups cloud service</em> provided by ZetaPush. The created group includes all users of the conversation.
So we add a method to our class to create this conversation.</p>
</div>
<div class="listingblock">
<div class="title">Create conversation</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="typescript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
</pre></td>
  <td class="code"><pre>/**
 * Create the conversation of the chat, if doesn't already exists
 */
async createConversation() {
  const { exists } = await this.groups.exists({
    group: CONVERSATION_ID
  });
  if (!exists) {
    await this.groups.createGroup({
      group: CONVERSATION_ID
    });
  }
}</pre></td>
</tr></table></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_add_user_to_the_conversation"><a class="anchor" href="#_add_user_to_the_conversation"></a><a class="link" href="#_add_user_to_the_conversation">17.2.4. Add user to the conversation</a></h4>
<div class="paragraph">
<p>When an user comes to the chat, we need to add it to the conversation.
So we create a method in our class to add the current user to the conversation.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="typescript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
</pre></td>
  <td class="code"><pre>/**
* Add the current user to the conversation
*/
addMeToConversation(parameters: any, context: any) { <i class="conum" data-value="1"></i><b>(1)</b>
  return this.groups.addUser({
    group: CONVERSATION_ID,
      user: context.owner <i class="conum" data-value="2"></i><b>(2)</b>
  });
}</pre></td>
</tr></table></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Each <em>custom cloud function</em> takes only one (client-provided) parameter. The second is the context, injected by the SDK</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>We get the caller (owner) of the <em>cloud function</em> from the context.</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_send_a_message"><a class="anchor" href="#_send_a_message"></a><a class="link" href="#_send_a_message">17.2.5. Send a message</a></h4>
<div class="paragraph">
<p>No we want to send a message on our chat. To do this, we need to follow 3 steps:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Get all users in the conversation</p>
</li>
<li>
<p>Send the message of all users in the conversation</p>
</li>
<li>
<p>Store the message in a stack</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="typescript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
</pre></td>
  <td class="code"><pre>/**
* Send a message on the chat
* @param {Object} message
*/
async sendMessage(message = {}) {
  // Get all users inside the conversation
  const group = await this.groups.groupUsers({
    group: CONVERSATION_ID
  });
  const users = group.users || [];

  // Send the message to each user in the conversation
  this.messaging.send({
    target: users,
    channel: CHANNEL_MESSAGING,
    data: { message }
  });

  // Store the message in a stack
  await this.stack.push({
    stack: CONVERSATION_ID,
    data: message
  });

  return group;
}</pre></td>
</tr></table></code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
There is no specific method to launch an attack, to do this, we only send a specific message throught <code>sendMessage</code>.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_get_all_messages"><a class="anchor" href="#_get_all_messages"></a><a class="link" href="#_get_all_messages">17.2.6. Get all messages</a></h4>
<div class="paragraph">
<p>To complete our business logic, we need to have an other method in our class to get all messages (when we enter the chat).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="typescript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
</pre></td>
  <td class="code"><pre>/**
* Get all messages in the conversation
*/
async getMessages() {
  const { result } = await this.stack.list({
    stack: CONVERSATION_ID
  });
  return result;
}</pre></td>
</tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>Now your <em>custom cloud service</em> is ready with this following content:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="typescript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
</pre></td>
  <td class="code"><pre>import { Injectable } from '@zetapush/core';
import { Stack, Messaging, Groups } from &quot;@zetapush/platform-legacy&quot;;

const CONVERSATION_ID = &quot;avengersChat&quot;;
const CHANNEL_MESSAGING = &quot;avengersChannel&quot;;

@Injectable()
export default class AvengersApi {
  /**
   * Constructor of our API
   */
  constructor(
    private stack: Stack,
    private messaging: Messaging,
    private groups: Groups
  ) {}

  /**
   * Create the conversation of the chat, if doesn't already exists
   */
  async createConversation() {
    const { exists } = await this.groups.exists({
      group: CONVERSATION_ID
    });
    if (!exists) {
      await this.groups.createGroup({
        group: CONVERSATION_ID
      });
    }
  }

  /**
   * Add the current user in the conversation
   */
  addMeToConversation(parameters: any, context: any) {
    return this.groups.addUser({
      group: CONVERSATION_ID,
      user: context.owner
    });
  }

  /**
   * Send a message on the chat
   * @param {Object} message
   */
  async sendMessage(message = {}) {
    // Get all users inside the conversation
    const group = await this.groups.groupUsers({
      group: CONVERSATION_ID
    });
    const users = group.users || [];

    // Send the message to each user in the conversation
    this.messaging.send({
      target: users,
      channel: CHANNEL_MESSAGING,
      data: { message }
    });

    // Store the message in a stack
    await this.stack.push({
      stack: CONVERSATION_ID,
      data: message
    });

    return group;
  }

  /**
   * Get all messages in the conversation
   */
  async getMessages() {
    const { result } = await this.stack.list({
      stack: CONVERSATION_ID
    });
    return result;
  }
}
</pre></td>
</tr></table></code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_use_your_em_custom_cloud_services_em"><a class="anchor" href="#_use_your_em_custom_cloud_services_em"></a><a class="link" href="#_use_your_em_custom_cloud_services_em">17.3. Use your <em>custom cloud services</em></a></h3>
<div class="paragraph">
<p>Once we have our <em>custom cloud service</em>, we need to create the frontend of our application.</p>
</div>
<div class="sect3">
<h4 id="_launch_the_worker_locally"><a class="anchor" href="#_launch_the_worker_locally"></a><a class="link" href="#_launch_the_worker_locally">17.3.1. Launch the worker locally</a></h4>
<div class="paragraph">
<p>When we work on the frontend part, we often want to test our interaction with the backend logic.
With ZetaPush, you can launch your worker locally to test this interaction.
To do this you need to use the <em>CLI</em> and run: <code>zeta run</code>.
But in this project, the <em>CLI</em> is imported and a script is created with npm, so you just need to launch:</p>
</div>
<div class="listingblock">
<div class="title">Run worker locally</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="console">// In the root of the application
$ npm run start -- --serve-front</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
If you want to install the <em>ZetaPush CLI</em> you can run <code>npm install -g @zetapush/cli</code>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Then you have access to your application on <code><a href="http://localhost:3000" class="bare">http://localhost:3000</a></code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_interaction_with_worker"><a class="anchor" href="#_interaction_with_worker"></a><a class="link" href="#_interaction_with_worker">17.3.2. Interaction with worker</a></h4>
<div class="paragraph">
<p>Now you just need to add the interaction with the <em>custom cloud service</em>. To do this, fill the file <code>front/index.js</code>:</p>
</div>
<div class="listingblock">
<div class="title">Interaction with worker</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
</pre></td>
  <td class="code"><pre><span class="reserved">import</span> AvengersController from <span class="string"><span class="delimiter">'</span><span class="content">./utils/controller.js</span><span class="delimiter">'</span></span>; <i class="conum" data-value="1"></i><b>(1)</b>

<span class="comment">// Create the ZetaPush Client</span>
const client = <span class="keyword">new</span> ZetaPushClient.WeakClient();
<span class="comment">/**
 * Create service to listen incoming messages
 */</span>
const service = client.createService({
  <span class="key">Type</span>: ZetaPushPlatform.Messaging,
  <span class="key">listener</span>: {
    <span class="comment">// Listen incoming messages from the channel 'avengersChannel'</span>
    <span class="key">avengersChannel</span>: ({ data }) =&gt; controller.onAvengersMessage(data), <i class="conum" data-value="2"></i><b>(2)</b>
  },
});

const controller = <span class="keyword">new</span> AvengersController(client);

(async <span class="keyword">function</span> <span class="function">main</span>() {
  <span class="comment">// Expose to template</span>
  window.<span class="predefined">$controller</span> = controller;
  <span class="comment">// Connect to ZetaPush</span>
  await client.connect();
  <span class="comment">// Notify client connected</span>
  controller.onConnectionEstablished();
})();</pre></td>
</tr></table></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Import the frontend logic (in the controller)</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Cloud service provided by ZetaPush to listen to incoming messages</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_deploy_your_application"><a class="anchor" href="#_deploy_your_application"></a><a class="link" href="#_deploy_your_application">17.4. Deploy your application</a></h3>
<div class="paragraph">
<p>Your application is working but only locally. To deploy your application you just need to launch <code>zeta push</code>. In this application you already have a npm script so you can run:</p>
</div>
<div class="listingblock">
<div class="title">Deploy the application</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="console">$ npm run deploy</code></pre>
</div>
</div>
<div class="paragraph">
<p>This command deploys all in once (Front and Worker). It will return you an unique URL to access to your application.</p>
</div>
<div class="paragraph">
<p>Enjoy ! Your Avengers Chat is working and deployed !</p>
</div>
</div>
</div>
</div>
<h1 id="_guides" class="sect0"><a class="anchor" href="#_guides"></a><a class="link" href="#_guides">Guides</a></h1>

<h1 id="_faq" class="sect0"><a class="anchor" href="#_faq"></a><a class="link" href="#_faq">FAQ</a></h1>
<div class="sect2">
<h3 id="_do_i_have_to_develop_em_custom_cloud_services_em"><a class="anchor" href="#_do_i_have_to_develop_em_custom_cloud_services_em"></a><a class="link" href="#_do_i_have_to_develop_em_custom_cloud_services_em">1.1. Do I have to develop <em>custom cloud services</em> ?</a></h3>
<div class="paragraph">
<p>No. Developing <em>custom cloud services</em> is not required. You can use <em>cloud services</em> that are already provided by ZetaPush. You may need to develop <em>custom cloud services</em> in different situations:
  - You have several devices so you want to mutualize your business code
  - ZetaPush services are not fully compatible with your business needs</p>
</div>
</div>
<div class="sect2">
<h3 id="_can_i_use_zetapush_cli_with_and_npm_version_lower_than_6"><a class="anchor" href="#_can_i_use_zetapush_cli_with_and_npm_version_lower_than_6"></a><a class="link" href="#_can_i_use_zetapush_cli_with_and_npm_version_lower_than_6">1.2. Can I use ZetaPush CLI with and npm version lower than 6 ?</a></h3>
<div class="paragraph">
<p>You can either upgrade your npm version or use npx utility.</p>
</div>
<div class="paragraph tab-container">
<p>npm 5-</p>
</div>
<div class="paragraph tab">
<p>Upgrade npm</p>
</div>
<div class="listingblock">
<div class="title">➊ - Upgrade npm</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="console">$ npm install -g npm@latest</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">➋ - Use npm init</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="console">$ npm init @zetapush hello-world</code></pre>
</div>
</div>
<div class="paragraph tab">
<p>Use <em>npx</em> to launch the script</p>
</div>
<div class="listingblock">
<div class="title">Launch with npx</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="console">$ npx @zetapush/create hello-world</code></pre>
</div>
</div>
<div class="paragraph tab-container-end">
<p>-</p>
</div>
</div>
<div class="sect2">
<h3 id="_what_is_the_nodejs_version_used_to_run_my_worker_remotely"><a class="anchor" href="#_what_is_the_nodejs_version_used_to_run_my_worker_remotely"></a><a class="link" href="#_what_is_the_nodejs_version_used_to_run_my_worker_remotely">1.3. What is the NodeJS version used to run my worker remotely ?</a></h3>
<div class="paragraph">
<p>Your worker run with a <code>NodeJS</code> lts/dubnium version.</p>
</div>
</div>
<div class="sect2">
<h3 id="_can_i_use_a_nodejs_version_lower_than_10"><a class="anchor" href="#_can_i_use_a_nodejs_version_lower_than_10"></a><a class="link" href="#_can_i_use_a_nodejs_version_lower_than_10">1.4. Can I use a NodeJS version lower than 10 ?</a></h3>
<div class="paragraph">
<p>We recommend to use the same version of <code>NodeJS</code> in local development as the version that runs your code remotely. For now, it is not possible to choose a different <code>NodeJS</code> version for remote run. This feature will be available in a future version.</p>
</div>
</div>
<h1 id="_reference" class="sect0"><a class="anchor" href="#_reference"></a><a class="link" href="#_reference">Reference</a></h1>
<div class="sect1">
<h2 id="_zetapush_management"><a class="anchor" href="#_zetapush_management"></a><a class="link" href="#_zetapush_management">18. ZetaPush management</a></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_manage_zetapush_account"><a class="anchor" href="#_manage_zetapush_account"></a><a class="link" href="#_manage_zetapush_account">18.1. Manage ZetaPush account</a></h3>
<div class="paragraph">
<p>The ZetaPush account gives you access to the ZetaPush cloud.
As a developer, you need an account to be authorized to develop your product.
As a manager, you need an account to <a href="#manage_organization">organize your teams</a>.</p>
</div>
<div class="sect3">
<h4 id="_create_your_account_2"><a class="anchor" href="#_create_your_account_2"></a><a class="link" href="#_create_your_account_2">18.1.1. Create your account</a></h4>
<div class="paragraph">
<p>Currently, the only way to get a ZetaPush account is by contacting us. The aim is to understand your needs
and to advise you even if you just want to test it:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://www.zetapush.com/sign-up-for-a-free-trial/">Signup for a free trial</a></p>
</li>
<li>
<p><a href="https://www.zetapush.com/contact">Contact us for more suitable account</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Your account will be created soon after the first contact and an application that fits your
needs will be available. Then you are ready to start working with ZetaPush.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Soon we will open access to everyone for free trial. Account creation will be available through
our CLI tool, from the main site and the web console.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_manage_your_profile"><a class="anchor" href="#_manage_your_profile"></a><a class="link" href="#_manage_your_profile">18.1.2. Manage your profile</a></h4>
<div class="paragraph">
<p>The management of your ZetaPush account and profile will soon be available on the web console.
Now you can <a href="https://www.zetapush.com/contact">contact us</a> if you want us to manage your informations.</p>
</div>
</div>
<div class="sect3">
<h4 id="_delete_your_account"><a class="anchor" href="#_delete_your_account"></a><a class="link" href="#_delete_your_account">18.1.3. Delete your account</a></h4>
<div class="paragraph">
<p>If you want to delete your ZetaPush account, you can contact us:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://www.zetapush.com/contact">Contact us for delete your accounts</a></p>
</li>
</ul>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="title">Permanent deletion</div>
<div class="paragraph">
<p>The removal is irreversible and permanent. All of your applications will be deleted.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="manage_organization"><a class="anchor" href="#manage_organization"></a><a class="link" href="#manage_organization">18.2. Manage your organization</a></h3>
<div class="paragraph">
<p>An <strong>organization</strong> is a concept to let you work in team.</p>
</div>
<div class="paragraph">
<p>The organization commonly groups all <strong>ZetaPush accounts</strong> of your company.
You can have several applications for your organization and you can manage access rights on applications according to members of your team.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">What is an application</div>
<div class="paragraph">
<p>An application is a logical container designed to perform a group of coordinated tasks or activities for the benefit of the user.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>For example, if you are in the company named "MyCompany" which has two applications named "MyApplication1" and "MyApplication2" :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>One organization is created with the name "MyCompany"</p>
</li>
<li>
<p>Two applications are created and named "MyApplication1" and "MyApplication2"</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The <strong>ZetaPush administrator account</strong> of this organization can access to these two applications. He can also change the access rights  <a href="#access_control_per_application">by application</a>.</p>
</div>
<div class="imageblock center">
<div class="content">
<img src="manage-organization.png" alt="manage organization" width="641" height="377">
</div>
</div>
<div class="paragraph">
<p>In the above example, we have one organization which contains two separate applications.
Each application has 3 users. The users of one application cannot work on the other application.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Manage access rights from web console</div>
<div class="paragraph">
<p>The access rights are managed by ZetaPush for now in order to fit your needs. Thereafter, you will be able to manage them via the <a href="https://console-celtia.zetapush.com"><strong>web console</strong></a>.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_manage_applications"><a class="anchor" href="#_manage_applications"></a><a class="link" href="#_manage_applications">18.3. Manage applications</a></h3>
<div class="paragraph">
<p>An <strong>application</strong> is a logical container designed to perform a group of coordinated tasks or activities for the benefit of the user.</p>
</div>
<div class="sect3">
<h4 id="add_application"><a class="anchor" href="#add_application"></a><a class="link" href="#add_application">18.3.1. Add an application</a></h4>
<div class="paragraph">
<p>There are several ways to create a new application :</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://www.zetapush.com/sign-up-for-a-free-trial/">Signup for a free trial</a></p>
</li>
<li>
<p><a href="https://www.zetapush.com/contact">Contact us for more suitable application</a></p>
</li>
<li>
<p>Via the <strong>web console</strong> (not available yet)</p>
</li>
<li>
<p>Via the <strong>CLI</strong> (not available yet)</p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="_sign_up_for_a_free_trial"><a class="anchor" href="#_sign_up_for_a_free_trial"></a><a class="link" href="#_sign_up_for_a_free_trial">18.3.1.1. Sign up for a free trial</a></h5>
<div class="paragraph">
<p>When you ask for a free trial, a <strong>ZetaPush account</strong> and an <strong>application</strong> are provided to you.</p>
</div>
<div class="paragraph">
<p>You can ask for a free trial via <a href="https://www.zetapush.com/sign-up-for-a-free-trial/">our web site</a>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Get free trial</div>
<div class="paragraph">
<p>Now, when you asking for a free trial, the <strong>ZetaPush account</strong> and the <strong>application</strong> are created by ZetaPush to fit your needs. Soon we will open access to everyone for get a free trial of 30 days. In this case the account and the application will be automatically created.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_create_application_via_web_console"><a class="anchor" href="#_create_application_via_web_console"></a><a class="link" href="#_create_application_via_web_console">18.3.1.2. Create application via web console</a></h5>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Create application via web console</div>
<div class="paragraph">
<p>For now, the creation of an application via the <strong>web console</strong> is not available because we want to assist you.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_create_application_via_cli"><a class="anchor" href="#_create_application_via_cli"></a><a class="link" href="#_create_application_via_cli">18.3.1.3. Create application via CLI</a></h5>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Create application via CLI</div>
<div class="paragraph">
<p>For now, the creation of an application via the <strong>CLI</strong> is not available because we want to assist you.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="access_control_per_application"><a class="anchor" href="#access_control_per_application"></a><a class="link" href="#access_control_per_application">18.3.2. Access control per application</a></h4>
<div class="paragraph">
<p>As <a href="#manage_organization">seen previously</a>, an <strong>organization</strong> can have several teams or/and several applications. So you may want to control who can work on which application.</p>
</div>
<div class="sect4">
<h5 id="_grant_access_rights"><a class="anchor" href="#_grant_access_rights"></a><a class="link" href="#_grant_access_rights">18.3.2.1. Grant access rights</a></h5>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Contact us to manage access rights</div>
<div class="paragraph">
<p>Security per application is not currently available to our clients. Instead we prefer that you <a href="https://www.zetapush.com/contact">contact us</a> to understand your needs and to guide you how to organize your teams and application.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_remove_access_rights"><a class="anchor" href="#_remove_access_rights"></a><a class="link" href="#_remove_access_rights">18.3.2.2. Remove access rights</a></h5>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Contact us to remove access rights</div>
<div class="paragraph">
<p>Security per application is not currently available to our clients. Instead we prefer that you <a href="https://www.zetapush.com/contact">contact us</a> to understand your needs and to guide you how to organize your teams and application.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="manage_environments"><a class="anchor" href="#manage_environments"></a><a class="link" href="#manage_environments">18.4. Manage environments</a></h3>
<div class="paragraph">
<p>An <strong>application</strong> is a logical container designed to perform a group of coordinated tasks or activities for the benefit of the user.</p>
</div>
<div class="sect3">
<h4 id="add_environment"><a class="anchor" href="#add_environment"></a><a class="link" href="#add_environment">18.4.1. Add an environment</a></h4>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Environment support</div>
<div class="paragraph">
<p>The <strong>environment</strong> support is not completely done. It will be soon because it is our next high priority. The management of this environments will be done via the <strong>web console</strong>. If you want to use environments you can anyway <a href="https://www.zetapush.com/contact">contact us</a> to manage them for you.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="access_control_per_environment"><a class="anchor" href="#access_control_per_environment"></a><a class="link" href="#access_control_per_environment">18.4.2. Access control per environment</a></h4>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Environment support</div>
<div class="paragraph">
<p>The <strong>environment</strong> support is not completely done. It will be soon because it is our next high priority. The access control of the environments will be done via the <strong>web console</strong>. If you want to use environments you can anyway <a href="https://www.zetapush.com/contact">contact us</a> to manage them for you.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_architecture_2"><a class="anchor" href="#_architecture_2"></a><a class="link" href="#_architecture_2">19. Architecture</a></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_general_architecture"><a class="anchor" href="#_general_architecture"></a><a class="link" href="#_general_architecture">19.1. General architecture</a></h3>
<div class="paragraph">
<p>One of the most important thing to understand with ZetaPush is that you can use it in two steps: The <strong>run</strong> and the <strong>push</strong>. The <code>run</code> mode is when you develop your application, your <strong>worker</strong> is running locally and the <code>push</code> mode is when you have pushed your application on the <strong>ZetaPush Cloud</strong> and that your worker is running on it.</p>
</div>
<div class="imageblock center">
<div class="content">
<img src="process-dev-run-and-push.png" alt="process dev run and push" width="993" height="337">
</div>
<div class="title">Figure 12. Process of development with ZetaPush</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="title">Data between the two phases</div>
<div class="paragraph">
<p>Whether you run or push your application, you use the same data. For example, if you store data during your development phase (using the <code>zeta run</code> command), They will always be present in the database when you will deploy your application with <code>zeta push</code>. For a more comprehensive working, look that scheme below :</p>
</div>
</td>
</tr>
</table>
</div>
<div class="imageblock center">
<div class="content">
<img src="custom-cloud-service-dev.png" alt="custom cloud service dev" width="709" height="430">
</div>
<div class="title">Figure 13. Interactions during development phase</div>
</div>
<div class="paragraph">
<p>Both front and worker are running locally. The front interacts with <em>custom cloud services</em> contained in the worker through
ZetaPush Cloud.
As ZetaPush Cloud provides bidirectional connection, the <em>custom cloud services</em> can also interact with the front through
ZetaPush Cloud too.</p>
</div>
<div class="paragraph">
<p>A <em>custom cloud service</em> can interact with <em>built-in cloud services</em> provided by ZetaPush.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>When you start using ZetaPush, you only develop locally so from your point of vue,
your front seems to directly interact with your <em>custom cloud services</em>.</p>
</div>
<div class="paragraph">
<p>In fact, all messages go through the Internet and ZetaPush Cloud.
It means that a published front can interact with a worker that is running locally and vice versa.</p>
</div>
<div class="paragraph">
<p>See <a href="#mix_local_and_remote">how to mix local worker with worker running in cloud</a></p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_zetapush_choices"><a class="anchor" href="#_zetapush_choices"></a><a class="link" href="#_zetapush_choices">19.2. ZetaPush choices</a></h3>
<div class="sect3">
<h4 id="_high_availability"><a class="anchor" href="#_high_availability"></a><a class="link" href="#_high_availability">19.2.1. High availability</a></h4>

</div>
<div class="sect3">
<h4 id="_load_balancing"><a class="anchor" href="#_load_balancing"></a><a class="link" href="#_load_balancing">19.2.2. Load-balancing</a></h4>

</div>
<div class="sect3">
<h4 id="_scalability"><a class="anchor" href="#_scalability"></a><a class="link" href="#_scalability">19.2.3. Scalability</a></h4>

</div>
<div class="sect3">
<h4 id="_supervision"><a class="anchor" href="#_supervision"></a><a class="link" href="#_supervision">19.2.4. Supervision</a></h4>

</div>
<div class="sect3">
<h4 id="javascript_vs_typescript"><a class="anchor" href="#javascript_vs_typescript"></a><a class="link" href="#javascript_vs_typescript">19.2.5. JavaScript vs TypeScript</a></h4>

</div>
</div>
<div class="sect2">
<h3 id="_application_code_structure"><a class="anchor" href="#_application_code_structure"></a><a class="link" href="#_application_code_structure">19.3. Application code structure</a></h3>

</div>
</div>
</div>
<div class="sect1">
<h2 id="_zetapush_development_concepts"><a class="anchor" href="#_zetapush_development_concepts"></a><a class="link" href="#_zetapush_development_concepts">20. ZetaPush development concepts</a></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_npm_modules_provided_by_zetapush"><a class="anchor" href="#_npm_modules_provided_by_zetapush"></a><a class="link" href="#_npm_modules_provided_by_zetapush">20.1. Npm modules provided by ZetaPush</a></h3>

</div>
<div class="sect2">
<h3 id="_dependency_injection_2"><a class="anchor" href="#_dependency_injection_2"></a><a class="link" href="#_dependency_injection_2">20.2. Dependency injection</a></h3>
<div class="paragraph">
<p><strong>Dependency Injection</strong> is a technique whereby one component supplies the dependencies of another component. A dependency is a component that can be used. An injection is the passing of a dependency to a dependent component that would use it.</p>
</div>
<div class="paragraph">
<p>In our case, we the <strong>Dependency Injection</strong> to provides the <em>cloud services</em> (builtin or not) and other classes. The benefic is that you don&#8217;t need to instanciate a dependency. You ask it and you have it.</p>
</div>
<div class="paragraph">
<p>In the following example we need to have the <em>GDA builtin cloud service</em> (database). We ask the dependency injection to provide one.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre></td>
  <td class="code"><pre><span class="reserved">import</span> { Gda } from <span class="string"><span class="delimiter">'</span><span class="content">@zetapush/platform-legacy</span><span class="delimiter">'</span></span>;

<span class="error">@</span>Injectable()                       <i class="conum" data-value="1"></i><b>(1)</b>
<span class="reserved">export</span> <span class="keyword">default</span> <span class="reserved">class</span> MyApi {
  constructor(<span class="reserved">private</span> gda: Gda) {}  <i class="conum" data-value="2"></i><b>(2)</b>

  putData(name: string) {
    <span class="keyword">return</span> await <span class="local-variable">this</span>.gda.put({     <i class="conum" data-value="3"></i><b>(3)</b>
      <span class="key">table</span>: <span class="string"><span class="delimiter">'</span><span class="content">my-table</span><span class="delimiter">'</span></span>,
      <span class="key">column</span>: <span class="string"><span class="delimiter">'</span><span class="content">my-column</span><span class="delimiter">'</span></span>,
      <span class="key">key</span>: Date.now().toString(),
      <span class="key">data</span>: name
    });
  }
}</pre></td>
</tr></table></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Say to the dependency injection that it should provide some dependencies in this class</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>I just say that I need a <code>GDA</code> instance in my class</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>I use my dependency. I know that my dependency is automatically instantiated by the <strong>Dependency Injection</strong>.</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Dependencies are singletons by default</div>
<div class="paragraph">
<p>By default, when you use the dependency injection, each component that is instanciated is a <a href="https://en.wikipedia.org/wiki/Singleton_pattern">singleton</a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>ZetaPush uses <a href="https://github.com/mgechev/injection-js">Injection JS</a> library for manage the <strong>Dependency Injection</strong>. It is an extraction of the Angular&#8217;s dependency injection.</p>
</div>
<div class="paragraph">
<p>You can have more information about the dependency injection in the <a href="https://angular.io/guide/dependency-injection">Angular Dependency Injection Documentation</a></p>
</div>
</div>
<div class="sect2">
<h3 id="modules"><a class="anchor" href="#modules"></a><a class="link" href="#modules">20.3. Modules</a></h3>

</div>
<div class="sect2">
<h3 id="_current_running_context"><a class="anchor" href="#_current_running_context"></a><a class="link" href="#_current_running_context">20.4. Current running context</a></h3>
<div class="sect3">
<h4 id="_environment"><a class="anchor" href="#_environment"></a><a class="link" href="#_environment">20.4.1. Environment</a></h4>

</div>
<div class="sect3">
<h4 id="_configurationproperties"><a class="anchor" href="#_configurationproperties"></a><a class="link" href="#_configurationproperties">20.4.2. ConfigurationProperties</a></h4>

</div>
<div class="sect3">
<h4 id="_zetapushcontext"><a class="anchor" href="#_zetapushcontext"></a><a class="link" href="#_zetapushcontext">20.4.3. ZetaPushContext</a></h4>

</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_develop_with_zetapush"><a class="anchor" href="#_develop_with_zetapush"></a><a class="link" href="#_develop_with_zetapush">21. Develop with ZetaPush</a></h2>
<div class="sectionbody">
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p>Intro</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_develop_your_front_only"><a class="anchor" href="#_develop_your_front_only"></a><a class="link" href="#_develop_your_front_only">21.1. Develop your front only</a></h3>
<div class="sect3">
<h4 id="client_types"><a class="anchor" href="#client_types"></a><a class="link" href="#client_types">21.1.1. ZetaPush client</a></h4>

</div>
<div class="sect3">
<h4 id="_web_development"><a class="anchor" href="#_web_development"></a><a class="link" href="#_web_development">21.1.2. Web development</a></h4>
<div class="sect4">
<h5 id="develop_with_angular"><a class="anchor" href="#develop_with_angular"></a><a class="link" href="#develop_with_angular">21.1.2.1. Angular</a></h5>

</div>
<div class="sect4">
<h5 id="develop_with_react"><a class="anchor" href="#develop_with_react"></a><a class="link" href="#develop_with_react">21.1.2.2. React</a></h5>

</div>
<div class="sect4">
<h5 id="develop_with_vue"><a class="anchor" href="#develop_with_vue"></a><a class="link" href="#develop_with_vue">21.1.2.3. Vue.js</a></h5>

</div>
</div>
<div class="sect3">
<h4 id="_mobile_development"><a class="anchor" href="#_mobile_development"></a><a class="link" href="#_mobile_development">21.1.3. Mobile development</a></h4>
<div class="sect4">
<h5 id="_android_java"><a class="anchor" href="#_android_java"></a><a class="link" href="#_android_java">21.1.3.1. Android (Java)</a></h5>

</div>
<div class="sect4">
<h5 id="_android_kotlin"><a class="anchor" href="#_android_kotlin"></a><a class="link" href="#_android_kotlin">21.1.3.2. Android (Kotlin)</a></h5>

</div>
<div class="sect4">
<h5 id="_ios"><a class="anchor" href="#_ios"></a><a class="link" href="#_ios">21.1.3.3. iOS</a></h5>

</div>
</div>
</div>
<div class="sect2">
<h3 id="generate_sdks"><a class="anchor" href="#generate_sdks"></a><a class="link" href="#generate_sdks">21.2. Generate SDKs from custom cloud service code</a></h3>

</div>
<div class="sect2">
<h3 id="_develop_custom_cloud_services"><a class="anchor" href="#_develop_custom_cloud_services"></a><a class="link" href="#_develop_custom_cloud_services">21.3. Develop custom cloud services</a></h3>

</div>
<div class="sect2">
<h3 id="_advanced_usage_of_cloud_services"><a class="anchor" href="#_advanced_usage_of_cloud_services"></a><a class="link" href="#_advanced_usage_of_cloud_services">21.4. Advanced usage of cloud services</a></h3>
<div class="sect3">
<h4 id="several_custom_cloud_services"><a class="anchor" href="#several_custom_cloud_services"></a><a class="link" href="#several_custom_cloud_services">21.4.1. Several custom cloud services</a></h4>

</div>
<div class="sect3">
<h4 id="shared_module"><a class="anchor" href="#shared_module"></a><a class="link" href="#shared_module">21.4.2. Create a shared module of cloud services</a></h4>

</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_available_cloud_services"><a class="anchor" href="#_available_cloud_services"></a><a class="link" href="#_available_cloud_services">22. Available cloud services</a></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_standard_user_workflow"><a class="anchor" href="#_standard_user_workflow"></a><a class="link" href="#_standard_user_workflow">22.1. Standard User Workflow</a></h3>
<div class="sect3">
<h4 id="_usage"><a class="anchor" href="#_usage"></a><a class="link" href="#_usage">22.1.1. Usage</a></h4>

</div>
<div class="sect3">
<h4 id="_api"><a class="anchor" href="#_api"></a><a class="link" href="#_api">22.1.2. API</a></h4>

</div>
</div>
<div class="sect2">
<h3 id="builtin_cloud_services"><a class="anchor" href="#builtin_cloud_services"></a><a class="link" href="#builtin_cloud_services">22.2. Technical cloud services</a></h3>
<div class="sect3">
<h4 id="_user_management"><a class="anchor" href="#_user_management"></a><a class="link" href="#_user_management">22.2.1. User Management</a></h4>
<div class="sect4">
<h5 id="_simple"><a class="anchor" href="#_simple"></a><a class="link" href="#_simple">22.2.1.1. Simple</a></h5>
<div class="paragraph">
<p>End-user API for the simple local authentication</p>
</div>
<div class="paragraph">
<p>These API verbs allow end-users to manage their account(s).</p>
</div>
<div class="sect5">
<h6 id="_createuser"><a class="anchor" href="#_createuser"></a><a class="link" href="#_createuser">createUser</a></h6>
<div class="paragraph">
<p>Creates a new account in this 'simple' authentication realm.
Returns a map of account fields, including a field named &lt;i&gt;zetapushKey&lt;/i&gt; containing the global user key of the user (value of the &lt;b&gt;__userKey&lt;/b&gt; pseudo-constant when this new account will be used)</p>
</div>
<div class="listingblock">
<div class="title">createUser(parameters: <a href="./common/cloud-services-types/basic-authenticated-user.html">BasicAuthenticatedUser</a>): Promise&lt;<a href="./common/cloud-services-types/map&.html#8592;string">-object&gt;.adoc#,Map&lt;String,Object</a>&gt;&gt;</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="typescript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
</pre></td>
  <td class="code"><pre>const response = await this.simple.createUser(parameters);</pre></td>
</tr></table></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_credentials"><a class="anchor" href="#_credentials"></a><a class="link" href="#_credentials">credentials</a></h6>
<div class="paragraph">
<p>Returns the list of account credentials in this service for the asking user.
Might return an empty list.</p>
</div>
<div class="listingblock">
<div class="title">credentials(parameters: <a href="./common/cloud-services-types/impersonated-traceable-request.html">ImpersonatedTraceableRequest</a>): Promise&lt;<a href="./common/cloud-services-types/all-credentials.html">AllCredentials</a>&gt;</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="typescript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
</pre></td>
  <td class="code"><pre>const response = await this.simple.credentials(parameters);</pre></td>
</tr></table></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_updatekey"><a class="anchor" href="#_updatekey"></a><a class="link" href="#_updatekey">updateKey</a></h6>
<div class="paragraph">
<p>Updates an existing account primary key (login, NOT &lt;b&gt;__userKey&lt;/b&gt;) in this 'simple' authentication realm.
The updated account MUST belong to the user making the call.
The configured login field MUST be given, as a user (identified by his zetapush userKey) might possess several accounts.
Returns a map of account fields</p>
</div>
<div class="listingblock">
<div class="title">updateKey(parameters: <a href="./common/cloud-services-types/user-loginchange.html">UserLoginchange</a>): Promise&lt;<a href="./common/cloud-services-types/map&.html#8592;string">-object&gt;.adoc#,Map&lt;String,Object</a>&gt;&gt;</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="typescript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
</pre></td>
  <td class="code"><pre>const response = await this.simple.updateKey(parameters);</pre></td>
</tr></table></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_updateuser"><a class="anchor" href="#_updateuser"></a><a class="link" href="#_updateuser">updateUser</a></h6>
<div class="paragraph">
<p>Updates an existing account in this 'simple' authentication realm.
The updated account MUST belong to the user making the call.
The configured login field MUST be given, as a user (identified by his zetapush userKey) might possess several accounts.
Returns a map of account fields</p>
</div>
<div class="listingblock">
<div class="title">updateUser(parameters: <a href="./common/cloud-services-types/basic-authenticated-user.html">BasicAuthenticatedUser</a>): Promise&lt;<a href="./common/cloud-services-types/map&.html#8592;string">-object&gt;.adoc#,Map&lt;String,Object</a>&gt;&gt;</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="typescript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
</pre></td>
  <td class="code"><pre>const response = await this.simple.updateUser(parameters);</pre></td>
</tr></table></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_deleteuser"><a class="anchor" href="#_deleteuser"></a><a class="link" href="#_deleteuser">deleteUser</a></h6>
<div class="paragraph">
<p>Deletes an existing account in this 'simple' authentication realm.</p>
</div>
<div class="listingblock">
<div class="title">deleteUser(parameters: <a href="./common/cloud-services-types/existence-check.html">ExistenceCheck</a>): Promise&lt;<a href="./common/cloud-services-types/existence-check.html">ExistenceCheck</a>&gt;</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="typescript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
</pre></td>
  <td class="code"><pre>const response = await this.simple.deleteUser(parameters);</pre></td>
</tr></table></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_checkuser"><a class="anchor" href="#_checkuser"></a><a class="link" href="#_checkuser">checkUser</a></h6>
<div class="paragraph">
<p>Checks whether the given account already exists in this 'simple' authentication realm.
This verb returns all the information about the user, including non public fields.</p>
</div>
<div class="listingblock">
<div class="title">checkUser(parameters: <a href="./common/cloud-services-types/existence-check.html">ExistenceCheck</a>): Promise&lt;<a href="./common/cloud-services-types/map&.html#8592;string">-object&gt;.adoc#,Map&lt;String,Object</a>&gt;&gt;</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="typescript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
</pre></td>
  <td class="code"><pre>const response = await this.simple.checkUser(parameters);</pre></td>
</tr></table></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_requestreset"><a class="anchor" href="#_requestreset"></a><a class="link" href="#_requestreset">requestReset</a></h6>
<div class="paragraph">
<p>Requests a password reset for the given unique account key.
The account key must exist and must be given, as it cannot obviously be deduced from the currently logged in user.
The returned token needs to be sent to the intended recipient only. The typical use case is to define a macro that requests a reset, generates a email template and emails the user. The macro can then be safely called by a weakly authenticated user.
Requesting a reset does not invalidate the password.
Requesting a reset again invalidates previous reset requests (only the last token is usable)</p>
</div>
<div class="listingblock">
<div class="title">requestReset(parameters: <a href="./common/cloud-services-types/reset-request.html">ResetRequest</a>): Promise&lt;<a href="./common/cloud-services-types/reset-info.html">ResetInfo</a>&gt;</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="typescript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
</pre></td>
  <td class="code"><pre>const response = await this.simple.requestReset(parameters);</pre></td>
</tr></table></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_changepassword"><a class="anchor" href="#_changepassword"></a><a class="link" href="#_changepassword">changePassword</a></h6>
<div class="paragraph">
<p>Changes a user password for this authentication realm.
The user can be either explicit, implicit (one of the current user&#8217;s accounts) or deduced from the token.
You should provide at least one of 'key' and 'token'. If you do not, the server will try and find any key for the current user.
The change is effective immediately. However, already logged in users might stay connected.
The password and token fields are always null in the output.</p>
</div>
<div class="listingblock">
<div class="title">changePassword(parameters: <a href="./common/cloud-services-types/change-password-request.html">ChangePasswordRequest</a>): Promise&lt;<a href="./common/cloud-services-types/change-password-request.html">ChangePasswordRequest</a>&gt;</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="typescript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
</pre></td>
  <td class="code"><pre>const response = await this.simple.changePassword(parameters);</pre></td>
</tr></table></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_checkpassword"><a class="anchor" href="#_checkpassword"></a><a class="link" href="#_checkpassword">checkPassword</a></h6>
<div class="listingblock">
<div class="title">checkPassword(parameters: <a href="./common/cloud-services-types/check-password-request.html">CheckPasswordRequest</a>): Promise&lt;<a href="./common/cloud-services-types/check-password-result.html">CheckPasswordResult</a>&gt;</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="typescript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
</pre></td>
  <td class="code"><pre>const response = await this.simple.checkPassword(parameters);</pre></td>
</tr></table></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_how_to_use_it"><a class="anchor" href="#_how_to_use_it"></a><a class="link" href="#_how_to_use_it">How to use it ?</a></h6>
<div class="listingblock">
<div class="title">worker/index.ts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="typescript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
</pre></td>
  <td class="code"><pre>import { Injectable } from '@zetapush/core';
import { Simple, BasicAuthenticatedUser } from '@zetapush/platform-legacy'; <i class="conum" data-value="1"></i><b>(1)</b>

@Injectable()
export default class Api {
  constructor(
    private simple: Simple <i class="conum" data-value="2"></i><b>(2)</b>
  ) {}
  async doStuff(parameters: BasicAuthenticatedUser) {
    const response = await this.simple.createUser(parameters); <i class="conum" data-value="3"></i><b>(3)</b>
    return response;
  }
}</pre></td>
</tr></table></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Import <code>Simple</code> from platform</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Declare injected service</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Call injected service</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_weak"><a class="anchor" href="#_weak"></a><a class="link" href="#_weak">22.2.1.2. Weak</a></h5>
<div class="paragraph">
<p>User API for weak devices control</p>
</div>
<div class="paragraph">
<p>User API for control and release of weakly authenticated user sessions.</p>
</div>
<div class="sect5">
<h6 id="_control"><a class="anchor" href="#_control"></a><a class="link" href="#_control">control</a></h6>
<div class="paragraph">
<p>Takes control of a weak user session, identified by the given public token.
The public token has been previously made available by the controlled device, for example by displaying a QRCode.
Upon control notification, the client SDK of the controlled session is expected to re-handshake.</p>
</div>
<div class="listingblock">
<div class="title">control(parameters: <a href="./common/cloud-services-types/user-control-request.html">UserControlRequest</a>): Promise&lt;<a href="./common/cloud-services-types/user-control-status.html">UserControlStatus</a>&gt;</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="typescript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
</pre></td>
  <td class="code"><pre>const response = await this.weak.control(parameters);</pre></td>
</tr></table></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_release"><a class="anchor" href="#_release"></a><a class="link" href="#_release">release</a></h6>
<div class="paragraph">
<p>Releases control of a weak user session, identified by the given public token.
The weak user session must have been previously controlled by a call to 'control'.</p>
</div>
<div class="listingblock">
<div class="title">release(parameters: <a href="./common/cloud-services-types/user-control-request.html">UserControlRequest</a>): Promise&lt;<a href="./common/cloud-services-types/user-control-status.html">UserControlStatus</a>&gt;</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="typescript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
</pre></td>
  <td class="code"><pre>const response = await this.weak.release(parameters);</pre></td>
</tr></table></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_provision"><a class="anchor" href="#_provision"></a><a class="link" href="#_provision">provision</a></h6>
<div class="paragraph">
<p>Provisions an arbitrary number of accounts.
The maximum number of accounts that you can create in one single call is configured per server.</p>
</div>
<div class="listingblock">
<div class="title">provision(parameters: <a href="./common/cloud-services-types/provisioning-request.html">ProvisioningRequest</a>): Promise&lt;<a href="./common/cloud-services-types/provisioning-result.html">ProvisioningResult</a>&gt;</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="typescript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
</pre></td>
  <td class="code"><pre>const response = await this.weak.provision(parameters);</pre></td>
</tr></table></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_gettoken"><a class="anchor" href="#_gettoken"></a><a class="link" href="#_gettoken">getToken</a></h6>
<div class="paragraph">
<p>Returns your current session&#8217;s private token. The token field may be null, if you did not log in with this authentication.
The token can be used to log in as the same weak user another time.</p>
</div>
<div class="listingblock">
<div class="title">getToken(parameters: <a href="./common/cloud-services-types/.html">undefined</a>): Promise&lt;<a href="./common/cloud-services-types/user-token.html">UserToken</a>&gt;</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="typescript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
</pre></td>
  <td class="code"><pre>const response = await this.weak.getToken(parameters);</pre></td>
</tr></table></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_how_to_use_it_2"><a class="anchor" href="#_how_to_use_it_2"></a><a class="link" href="#_how_to_use_it_2">How to use it ?</a></h6>
<div class="listingblock">
<div class="title">worker/index.ts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="typescript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
</pre></td>
  <td class="code"><pre>import { Injectable } from '@zetapush/core';
import { Weak, UserControlRequest } from '@zetapush/platform-legacy'; <i class="conum" data-value="1"></i><b>(1)</b>

@Injectable()
export default class Api {
  constructor(
    private weak: Weak <i class="conum" data-value="2"></i><b>(2)</b>
  ) {}
  async doStuff(parameters: UserControlRequest) {
    const response = await this.weak.control(parameters); <i class="conum" data-value="3"></i><b>(3)</b>
    return response;
  }
}</pre></td>
</tr></table></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Import <code>Weak</code> from platform</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Declare injected service</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Call injected service</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_userdir"><a class="anchor" href="#_userdir"></a><a class="link" href="#_userdir">22.2.1.3. Userdir</a></h5>
<div class="paragraph">
<p>User API for user information</p>
</div>
<div class="sect5">
<h6 id="_userinfo"><a class="anchor" href="#_userinfo"></a><a class="link" href="#_userinfo">userInfo</a></h6>
<div class="listingblock">
<div class="title">userInfo(parameters: <a href="./common/cloud-services-types/user-info-request.html">UserInfoRequest</a>): Promise&lt;<a href="./common/cloud-services-types/user-info-response.html">UserInfoResponse</a>&gt;</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="typescript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
</pre></td>
  <td class="code"><pre>const response = await this.userdir.userInfo(parameters);</pre></td>
</tr></table></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_search"><a class="anchor" href="#_search"></a><a class="link" href="#_search">search</a></h6>
<div class="listingblock">
<div class="title">search(parameters: <a href="./common/cloud-services-types/user-search-request.html">UserSearchRequest</a>): Promise&lt;<a href="./common/cloud-services-types/user-search-response.html">UserSearchResponse</a>&gt;</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="typescript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
</pre></td>
  <td class="code"><pre>const response = await this.userdir.search(parameters);</pre></td>
</tr></table></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_how_to_use_it_3"><a class="anchor" href="#_how_to_use_it_3"></a><a class="link" href="#_how_to_use_it_3">How to use it ?</a></h6>
<div class="listingblock">
<div class="title">worker/index.ts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="typescript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
</pre></td>
  <td class="code"><pre>import { Injectable } from '@zetapush/core';
import { Userdir, UserInfoRequest } from '@zetapush/platform-legacy'; <i class="conum" data-value="1"></i><b>(1)</b>

@Injectable()
export default class Api {
  constructor(
    private userdir: Userdir <i class="conum" data-value="2"></i><b>(2)</b>
  ) {}
  async doStuff(parameters: UserInfoRequest) {
    const response = await this.userdir.userInfo(parameters); <i class="conum" data-value="3"></i><b>(3)</b>
    return response;
  }
}</pre></td>
</tr></table></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Import <code>Userdir</code> from platform</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Declare injected service</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Call injected service</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_groups"><a class="anchor" href="#_groups"></a><a class="link" href="#_groups">22.2.1.4. Groups</a></h5>
<div class="paragraph">
<p>User API for groups and rights.</p>
</div>
<div class="paragraph">
<p>Groups are stored per user.
This means that two users can own a group with the same identifier. A couple (owner, group) is needed to uniquely identify a group inside a group management service.
The triplet (deploymentId, owner, group) is actually needed to fully qualify a group outside of the scope of this service.</p>
</div>
<div class="sect5">
<h6 id="_grant"><a class="anchor" href="#_grant"></a><a class="link" href="#_grant">grant</a></h6>
<div class="paragraph">
<p>The granting API does not do any check when storing permissions.
In particular when granting rights on a verb and resource of another API, the existence of said verb and resource is not checked.</p>
</div>
<div class="listingblock">
<div class="title">grant(parameters: <a href="./common/cloud-services-types/grant.html">Grant</a>): Promise&lt;<a href="./common/cloud-services-types/grant.html">Grant</a>&gt;</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="typescript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
</pre></td>
  <td class="code"><pre>const response = await this.groups.grant(parameters);</pre></td>
</tr></table></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_creategroup"><a class="anchor" href="#_creategroup"></a><a class="link" href="#_creategroup">createGroup</a></h6>
<div class="paragraph">
<p>Creates a group owned by the current user.
Group creation may fail if the group already exists.</p>
</div>
<div class="listingblock">
<div class="title">createGroup(parameters: <a href="./common/cloud-services-types/group-info.html">GroupInfo</a>): Promise&lt;<a href="./common/cloud-services-types/group-info.html">GroupInfo</a>&gt;</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="typescript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
</pre></td>
  <td class="code"><pre>const response = await this.groups.createGroup(parameters);</pre></td>
</tr></table></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_listownedgroups"><a class="anchor" href="#_listownedgroups"></a><a class="link" href="#_listownedgroups">listOwnedGroups</a></h6>
<div class="paragraph">
<p>Returns the whole list of groups owned by the current user</p>
</div>
<div class="listingblock">
<div class="title">listOwnedGroups(parameters: <a href="./common/cloud-services-types/traceable-paginated-impersonated-request.html">TraceablePaginatedImpersonatedRequest</a>): Promise&lt;<a href="./common/cloud-services-types/owned-groups.html">OwnedGroups</a>&gt;</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="typescript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
</pre></td>
  <td class="code"><pre>const response = await this.groups.listOwnedGroups(parameters);</pre></td>
</tr></table></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_listdetailedownedgroups"><a class="anchor" href="#_listdetailedownedgroups"></a><a class="link" href="#_listdetailedownedgroups">listDetailedOwnedGroups</a></h6>
<div class="paragraph">
<p>Returns the whole list of groups owned by the current user, with their members</p>
</div>
<div class="listingblock">
<div class="title">listDetailedOwnedGroups(parameters: <a href="./common/cloud-services-types/traceable-paginated-impersonated-request.html">TraceablePaginatedImpersonatedRequest</a>): Promise&lt;<a href="./common/cloud-services-types/owned-groups-with-details.html">OwnedGroupsWithDetails</a>&gt;</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="typescript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
</pre></td>
  <td class="code"><pre>const response = await this.groups.listDetailedOwnedGroups(parameters);</pre></td>
</tr></table></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_mygroups"><a class="anchor" href="#_mygroups"></a><a class="link" href="#_mygroups">myGroups</a></h6>
<div class="paragraph">
<p>Returns the whole list of groups the current user is part of.
Groups may be owned by anyone, including the current user.</p>
</div>
<div class="listingblock">
<div class="title">myGroups(parameters: <a href="./common/cloud-services-types/impersonated-request.html">ImpersonatedRequest</a>): Promise&lt;<a href="./common/cloud-services-types/group-info.html">GroupInfo</a>[]&gt;</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="typescript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
</pre></td>
  <td class="code"><pre>const response = await this.groups.myGroups(parameters);</pre></td>
</tr></table></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_listjoinedgroups"><a class="anchor" href="#_listjoinedgroups"></a><a class="link" href="#_listjoinedgroups">listJoinedGroups</a></h6>
<div class="paragraph">
<p>Returns the whole list of groups the current user is part of.
Groups may be owned by anyone, including the current user.</p>
</div>
<div class="listingblock">
<div class="title">listJoinedGroups(parameters: <a href="./common/cloud-services-types/traceable-paginated-impersonated-request.html">TraceablePaginatedImpersonatedRequest</a>): Promise&lt;<a href="./common/cloud-services-types/joined-groups.html">JoinedGroups</a>&gt;</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="typescript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
</pre></td>
  <td class="code"><pre>const response = await this.groups.listJoinedGroups(parameters);</pre></td>
</tr></table></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_delgroup"><a class="anchor" href="#_delgroup"></a><a class="link" href="#_delgroup">delGroup</a></h6>
<div class="paragraph">
<p>Removes the given group owned by the current user or the given owner.
Also removes all grants to that group.</p>
</div>
<div class="listingblock">
<div class="title">delGroup(parameters: <a href="./common/cloud-services-types/group-related.html">GroupRelated</a>): Promise&lt;<a href="./common/cloud-services-types/group-related.html">GroupRelated</a>&gt;</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="typescript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
</pre></td>
  <td class="code"><pre>const response = await this.groups.delGroup(parameters);</pre></td>
</tr></table></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_addme"><a class="anchor" href="#_addme"></a><a class="link" href="#_addme">addMe</a></h6>
<div class="paragraph">
<p>Adds me (the caller) to a group.
This verb exists so that group owners may grant the right to join their groups without granting the right to add other users to those groups.
The 'user' field is implicitly set to the current user&#8217;s key.</p>
</div>
<div class="listingblock">
<div class="title">addMe(parameters: <a href="./common/cloud-services-types/user-group.html">UserGroup</a>): Promise&lt;<a href="./common/cloud-services-types/user-group.html">UserGroup</a>&gt;</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="typescript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
</pre></td>
  <td class="code"><pre>const response = await this.groups.addMe(parameters);</pre></td>
</tr></table></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_memberof"><a class="anchor" href="#_memberof"></a><a class="link" href="#_memberof">memberOf</a></h6>
<div class="paragraph">
<p>Tests whether I (the caller) am a member of the given group.
This verb exists so that users can determine if they are part of a group without being granted particular rights.
The 'user' field is implicitly set to the current user&#8217;s key.</p>
</div>
<div class="listingblock">
<div class="title">memberOf(parameters: <a href="./common/cloud-services-types/user-membership.html">UserMembership</a>): Promise&lt;<a href="./common/cloud-services-types/user-group-membership.html">UserGroupMembership</a>&gt;</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="typescript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
</pre></td>
  <td class="code"><pre>const response = await this.groups.memberOf(parameters);</pre></td>
</tr></table></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_addusers"><a class="anchor" href="#_addusers"></a><a class="link" href="#_addusers">addUsers</a></h6>
<div class="paragraph">
<p>Users are processed in the given order
In case of failure in the middle of a user list, this verb may have succeeded to add the first users, but will not continue processing the end of the list.</p>
</div>
<div class="listingblock">
<div class="title">addUsers(parameters: <a href="./common/cloud-services-types/group-users.html">GroupUsers</a>): Promise&lt;<a href="./common/cloud-services-types/void.html">void</a>&gt;</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="typescript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
</pre></td>
  <td class="code"><pre>const response = await this.groups.addUsers(parameters);</pre></td>
</tr></table></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_delusers"><a class="anchor" href="#_delusers"></a><a class="link" href="#_delusers">delUsers</a></h6>
<div class="listingblock">
<div class="title">delUsers(parameters: <a href="./common/cloud-services-types/group-users.html">GroupUsers</a>): Promise&lt;<a href="./common/cloud-services-types/void.html">void</a>&gt;</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="typescript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
</pre></td>
  <td class="code"><pre>const response = await this.groups.delUsers(parameters);</pre></td>
</tr></table></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_mgrant"><a class="anchor" href="#_mgrant"></a><a class="link" href="#_mgrant">mgrant</a></h6>
<div class="paragraph">
<p>Grant several rights at once.</p>
</div>
<div class="listingblock">
<div class="title">mgrant(parameters: <a href="./common/cloud-services-types/grants.html">Grants</a>): Promise&lt;<a href="./common/cloud-services-types/grants.html">Grants</a>&gt;</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="typescript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
</pre></td>
  <td class="code"><pre>const response = await this.groups.mgrant(parameters);</pre></td>
</tr></table></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_mrevoke"><a class="anchor" href="#_mrevoke"></a><a class="link" href="#_mrevoke">mrevoke</a></h6>
<div class="listingblock">
<div class="title">mrevoke(parameters: <a href="./common/cloud-services-types/grants.html">Grants</a>): Promise&lt;<a href="./common/cloud-services-types/grants.html">Grants</a>&gt;</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="typescript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
</pre></td>
  <td class="code"><pre>const response = await this.groups.mrevoke(parameters);</pre></td>
</tr></table></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_listgrants"><a class="anchor" href="#_listgrants"></a><a class="link" href="#_listgrants">listGrants</a></h6>
<div class="paragraph">
<p>This API lists explicitly configured rights.
Effective rights include configured rights, implicit rights and inherited rights.</p>
</div>
<div class="listingblock">
<div class="title">listGrants(parameters: <a href="./common/cloud-services-types/group-related.html">GroupRelated</a>): Promise&lt;<a href="./common/cloud-services-types/grant-list.html">GrantList</a>&gt;</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="typescript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
</pre></td>
  <td class="code"><pre>const response = await this.groups.listGrants(parameters);</pre></td>
</tr></table></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_listgroupgrants"><a class="anchor" href="#_listgroupgrants"></a><a class="link" href="#_listgroupgrants">listGroupGrants</a></h6>
<div class="paragraph">
<p>This API lists explicitly configured rights.
Effective rights include configured rights, implicit rights and inherited rights.</p>
</div>
<div class="listingblock">
<div class="title">listGroupGrants(parameters: <a href="./common/cloud-services-types/group-related-and-paged.html">GroupRelatedAndPaged</a>): Promise&lt;<a href="./common/cloud-services-types/paged-grant-list.html">PagedGrantList</a>&gt;</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="typescript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
</pre></td>
  <td class="code"><pre>const response = await this.groups.listGroupGrants(parameters);</pre></td>
</tr></table></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_listpresences"><a class="anchor" href="#_listpresences"></a><a class="link" href="#_listpresences">listPresences</a></h6>
<div class="paragraph">
<p>Returns the list of members of the given groups, along with their actual and current presence on the zetapush server.
The current implementation does not include information about the particular devices users are connected with.
If a user is connected twice with two different devices, two identical entries will be returned.</p>
</div>
<div class="listingblock">
<div class="title">listPresences(parameters: <a href="./common/cloud-services-types/group-related.html">GroupRelated</a>): Promise&lt;<a href="./common/cloud-services-types/group-presence.html">GroupPresence</a>&gt;</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="typescript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
</pre></td>
  <td class="code"><pre>const response = await this.groups.listPresences(parameters);</pre></td>
</tr></table></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_listgrouppresences"><a class="anchor" href="#_listgrouppresences"></a><a class="link" href="#_listgrouppresences">listGroupPresences</a></h6>
<div class="paragraph">
<p>Returns the list of members of the given groups, along with their actual and current presence on the zetapush server.
The current implementation does not include information about the particular devices users are connected with.
If a user is connected twice with two different devices, two identical entries will be returned.</p>
</div>
<div class="listingblock">
<div class="title">listGroupPresences(parameters: <a href="./common/cloud-services-types/group-related-and-paged.html">GroupRelatedAndPaged</a>): Promise&lt;<a href="./common/cloud-services-types/paged-group-presence.html">PagedGroupPresence</a>&gt;</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="typescript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
</pre></td>
  <td class="code"><pre>const response = await this.groups.listGroupPresences(parameters);</pre></td>
</tr></table></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_adduser"><a class="anchor" href="#_adduser"></a><a class="link" href="#_adduser">addUser</a></h6>
<div class="paragraph">
<p>Adds the given user to the given group.
Addition may fail if the given group does not already exist.</p>
</div>
<div class="listingblock">
<div class="title">addUser(parameters: <a href="./common/cloud-services-types/user-group.html">UserGroup</a>): Promise&lt;<a href="./common/cloud-services-types/user-group.html">UserGroup</a>&gt;</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="typescript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
</pre></td>
  <td class="code"><pre>const response = await this.groups.addUser(parameters);</pre></td>
</tr></table></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_deluser"><a class="anchor" href="#_deluser"></a><a class="link" href="#_deluser">delUser</a></h6>
<div class="listingblock">
<div class="title">delUser(parameters: <a href="./common/cloud-services-types/user-group.html">UserGroup</a>): Promise&lt;<a href="./common/cloud-services-types/user-group.html">UserGroup</a>&gt;</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="typescript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
</pre></td>
  <td class="code"><pre>const response = await this.groups.delUser(parameters);</pre></td>
</tr></table></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_groupusers"><a class="anchor" href="#_groupusers"></a><a class="link" href="#_groupusers">groupUsers</a></h6>
<div class="paragraph">
<p>Returns the whole list of users configured inside the given group.</p>
</div>
<div class="listingblock">
<div class="title">groupUsers(parameters: <a href="./common/cloud-services-types/group-related.html">GroupRelated</a>): Promise&lt;<a href="./common/cloud-services-types/group-users.html">GroupUsers</a>&gt;</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="typescript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
</pre></td>
  <td class="code"><pre>const response = await this.groups.groupUsers(parameters);</pre></td>
</tr></table></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_revoke"><a class="anchor" href="#_revoke"></a><a class="link" href="#_revoke">revoke</a></h6>
<div class="listingblock">
<div class="title">revoke(parameters: <a href="./common/cloud-services-types/grant.html">Grant</a>): Promise&lt;<a href="./common/cloud-services-types/grant.html">Grant</a>&gt;</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="typescript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
</pre></td>
  <td class="code"><pre>const response = await this.groups.revoke(parameters);</pre></td>
</tr></table></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_allgroups"><a class="anchor" href="#_allgroups"></a><a class="link" href="#_allgroups">allGroups</a></h6>
<div class="paragraph">
<p>Returns the whole list of groups owned by the current user, with their members</p>
</div>
<div class="listingblock">
<div class="title">allGroups(parameters: <a href="./common/cloud-services-types/impersonated-request.html">ImpersonatedRequest</a>): Promise&lt;<a href="./common/cloud-services-types/group-users.html">GroupUsers</a>[]&gt;</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="typescript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
</pre></td>
  <td class="code"><pre>const response = await this.groups.allGroups(parameters);</pre></td>
</tr></table></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_groups_2"><a class="anchor" href="#_groups_2"></a><a class="link" href="#_groups_2">groups</a></h6>
<div class="paragraph">
<p>Returns the whole list of groups owned by the current user</p>
</div>
<div class="listingblock">
<div class="title">groups(parameters: <a href="./common/cloud-services-types/impersonated-request.html">ImpersonatedRequest</a>): Promise&lt;<a href="./common/cloud-services-types/group-info.html">GroupInfo</a>[]&gt;</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="typescript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
</pre></td>
  <td class="code"><pre>const response = await this.groups.groups(parameters);</pre></td>
</tr></table></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_check"><a class="anchor" href="#_check"></a><a class="link" href="#_check">check</a></h6>
<div class="paragraph">
<p>This API checks if the given user has the proper authorizations to perform the given action on the owner&#8217;s resource.
If you give the same value for 'user' and 'owner', the check always passes.</p>
</div>
<div class="listingblock">
<div class="title">check(parameters: <a href="./common/cloud-services-types/grant-check-request.html">GrantCheckRequest</a>): Promise&lt;<a href="./common/cloud-services-types/grant-check-result.html">GrantCheckResult</a>&gt;</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="typescript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
</pre></td>
  <td class="code"><pre>const response = await this.groups.check(parameters);</pre></td>
</tr></table></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_exists"><a class="anchor" href="#_exists"></a><a class="link" href="#_exists">exists</a></h6>
<div class="paragraph">
<p>Returns whether a group exists or not.</p>
</div>
<div class="listingblock">
<div class="title">exists(parameters: <a href="./common/cloud-services-types/group-related.html">GroupRelated</a>): Promise&lt;<a href="./common/cloud-services-types/group-existence.html">GroupExistence</a>&gt;</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="typescript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
</pre></td>
  <td class="code"><pre>const response = await this.groups.exists(parameters);</pre></td>
</tr></table></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_how_to_use_it_4"><a class="anchor" href="#_how_to_use_it_4"></a><a class="link" href="#_how_to_use_it_4">How to use it ?</a></h6>
<div class="listingblock">
<div class="title">worker/index.ts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="typescript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
</pre></td>
  <td class="code"><pre>import { Injectable } from '@zetapush/core';
import { Groups, Grant } from '@zetapush/platform-legacy'; <i class="conum" data-value="1"></i><b>(1)</b>

@Injectable()
export default class Api {
  constructor(
    private groups: Groups <i class="conum" data-value="2"></i><b>(2)</b>
  ) {}
  async doStuff(parameters: Grant) {
    const response = await this.groups.grant(parameters); <i class="conum" data-value="3"></i><b>(3)</b>
    return response;
  }
}</pre></td>
</tr></table></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Import <code>Groups</code> from platform</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Declare injected service</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Call injected service</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_data_management"><a class="anchor" href="#_data_management"></a><a class="link" href="#_data_management">22.2.2. Data Management</a></h4>
<div class="sect4">
<h5 id="_gda"><a class="anchor" href="#_gda"></a><a class="link" href="#_gda">22.2.2.1. Gda</a></h5>
<div class="paragraph">
<p>GDA User API</p>
</div>
<div class="paragraph">
<p>User API for Generic Data Access.
The data are stored on a per-user basis.
Users can put, get, list their data.</p>
</div>
<div class="sect5">
<h6 id="_puts"><a class="anchor" href="#_puts"></a><a class="link" href="#_puts">puts</a></h6>
<div class="paragraph">
<p>Creates or replaces the (maybe partial) contents of a collection of rows.
This method only creates or replaces cells for non-null input values.</p>
</div>
<div class="listingblock">
<div class="title">puts(parameters: <a href="./common/cloud-services-types/gda-puts.html">GdaPuts</a>): Promise&lt;<a href="./common/cloud-services-types/gda-puts-result.html">GdaPutsResult</a>&gt;</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="typescript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
</pre></td>
  <td class="code"><pre>const response = await this.gda.puts(parameters);</pre></td>
</tr></table></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_inc"><a class="anchor" href="#_inc"></a><a class="link" href="#_inc">inc</a></h6>
<div class="paragraph">
<p>Increments a cell 64-bit signed integer value and returns the result in the data field.
The increment is atomic : if you concurrently increment 10 times a value by 1, the final result will be the initial value plus 10. The actual individual resulting values seen by the 10 concurrent callers may vary discontinuously, with duplicates : at least one of them will see the final (+10) result.</p>
</div>
<div class="listingblock">
<div class="title">inc(parameters: <a href="./common/cloud-services-types/gda-put.html">GdaPut</a>): Promise&lt;<a href="./common/cloud-services-types/gda-put.html">GdaPut</a>&gt;</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="typescript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
</pre></td>
  <td class="code"><pre>const response = await this.gda.inc(parameters);</pre></td>
</tr></table></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_removerow"><a class="anchor" href="#_removerow"></a><a class="link" href="#_removerow">removeRow</a></h6>
<div class="paragraph">
<p>Removes all columns of the given row from the given table.</p>
</div>
<div class="listingblock">
<div class="title">removeRow(parameters: <a href="./common/cloud-services-types/gda-row-request.html">GdaRowRequest</a>): Promise&lt;<a href="./common/cloud-services-types/gda-row-request.html">GdaRowRequest</a>&gt;</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="typescript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
</pre></td>
  <td class="code"><pre>const response = await this.gda.removeRow(parameters);</pre></td>
</tr></table></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_removecolumn"><a class="anchor" href="#_removecolumn"></a><a class="link" href="#_removecolumn">removeColumn</a></h6>
<div class="paragraph">
<p>Removes all cells of the given column of the given row from the given table.</p>
</div>
<div class="listingblock">
<div class="title">removeColumn(parameters: <a href="./common/cloud-services-types/gda-column-request.html">GdaColumnRequest</a>): Promise&lt;<a href="./common/cloud-services-types/gda-column-request.html">GdaColumnRequest</a>&gt;</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="typescript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
</pre></td>
  <td class="code"><pre>const response = await this.gda.removeColumn(parameters);</pre></td>
</tr></table></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_removecell"><a class="anchor" href="#_removecell"></a><a class="link" href="#_removecell">removeCell</a></h6>
<div class="paragraph">
<p>Removes only one cell of the given column of the given row from the given table.</p>
</div>
<div class="listingblock">
<div class="title">removeCell(parameters: <a href="./common/cloud-services-types/gda-cell-request.html">GdaCellRequest</a>): Promise&lt;<a href="./common/cloud-services-types/gda-cell-request.html">GdaCellRequest</a>&gt;</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="typescript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
</pre></td>
  <td class="code"><pre>const response = await this.gda.removeCell(parameters);</pre></td>
</tr></table></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_mget"><a class="anchor" href="#_mget"></a><a class="link" href="#_mget">mget</a></h6>
<div class="paragraph">
<p>Returns full data rows, in the order they were asked.</p>
</div>
<div class="listingblock">
<div class="title">mget(parameters: <a href="./common/cloud-services-types/gda-multi-get-request.html">GdaMultiGetRequest</a>): Promise&lt;<a href="./common/cloud-services-types/gda-multi-get-result.html">GdaMultiGetResult</a>&gt;</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="typescript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
</pre></td>
  <td class="code"><pre>const response = await this.gda.mget(parameters);</pre></td>
</tr></table></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_getcells"><a class="anchor" href="#_getcells"></a><a class="link" href="#_getcells">getCells</a></h6>
<div class="paragraph">
<p>Returns a precise list of cells from a column in a data row.</p>
</div>
<div class="listingblock">
<div class="title">getCells(parameters: <a href="./common/cloud-services-types/gda-cells-request.html">GdaCellsRequest</a>): Promise&lt;<a href="./common/cloud-services-types/gda-cells-result.html">GdaCellsResult</a>&gt;</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="typescript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
</pre></td>
  <td class="code"><pre>const response = await this.gda.getCells(parameters);</pre></td>
</tr></table></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_get"><a class="anchor" href="#_get"></a><a class="link" href="#_get">get</a></h6>
<div class="paragraph">
<p>Returns a full data row.</p>
</div>
<div class="listingblock">
<div class="title">get(parameters: <a href="./common/cloud-services-types/gda-get.html">GdaGet</a>): Promise&lt;<a href="./common/cloud-services-types/gda-get-result.html">GdaGetResult</a>&gt;</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="typescript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
</pre></td>
  <td class="code"><pre>const response = await this.gda.get(parameters);</pre></td>
</tr></table></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_put"><a class="anchor" href="#_put"></a><a class="link" href="#_put">put</a></h6>
<div class="paragraph">
<p>Creates or replaces the contents of a particular cell.</p>
</div>
<div class="listingblock">
<div class="title">put(parameters: <a href="./common/cloud-services-types/gda-put.html">GdaPut</a>): Promise&lt;<a href="./common/cloud-services-types/gda-put.html">GdaPut</a>&gt;</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="typescript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
</pre></td>
  <td class="code"><pre>const response = await this.gda.put(parameters);</pre></td>
</tr></table></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_list"><a class="anchor" href="#_list"></a><a class="link" href="#_list">list</a></h6>
<div class="paragraph">
<p>Returns a paginated list of rows from the given table.</p>
</div>
<div class="listingblock">
<div class="title">list(parameters: <a href="./common/cloud-services-types/gda-list.html">GdaList</a>): Promise&lt;<a href="./common/cloud-services-types/gda-list-result.html">GdaListResult</a>&gt;</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="typescript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
</pre></td>
  <td class="code"><pre>const response = await this.gda.list(parameters);</pre></td>
</tr></table></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_removerange"><a class="anchor" href="#_removerange"></a><a class="link" href="#_removerange">removeRange</a></h6>
<div class="paragraph">
<p>Removes the specified columns of the given range of rows from the given table.</p>
</div>
<div class="listingblock">
<div class="title">removeRange(parameters: <a href="./common/cloud-services-types/gda-remove-range.html">GdaRemoveRange</a>): Promise&lt;<a href="./common/cloud-services-types/gda-remove-range.html">GdaRemoveRange</a>&gt;</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="typescript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
</pre></td>
  <td class="code"><pre>const response = await this.gda.removeRange(parameters);</pre></td>
</tr></table></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_filter"><a class="anchor" href="#_filter"></a><a class="link" href="#_filter">filter</a></h6>
<div class="paragraph">
<p>Similar to range, but rows can be filtered out according to a developer-supplied predicate.
A range consists of consecutive rows from the start key (inclusive) to the stop key (exclusive).
You can specify partial keys for the start and stop fields.</p>
</div>
<div class="listingblock">
<div class="title">filter(parameters: <a href="./common/cloud-services-types/gda-filter-request.html">GdaFilterRequest</a>): Promise&lt;<a href="./common/cloud-services-types/gda-filter-result.html">GdaFilterResult</a>&gt;</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="typescript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
</pre></td>
  <td class="code"><pre>const response = await this.gda.filter(parameters);</pre></td>
</tr></table></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_range"><a class="anchor" href="#_range"></a><a class="link" href="#_range">range</a></h6>
<div class="paragraph">
<p>Returns a paginated range of rows from the given table.
A range consists of consecutive rows from the start key (inclusive) to the stop key (exclusive).
You can specify partial keys for the start and stop fields.</p>
</div>
<div class="listingblock">
<div class="title">range(parameters: <a href="./common/cloud-services-types/gda-range.html">GdaRange</a>): Promise&lt;<a href="./common/cloud-services-types/gda-range-result.html">GdaRangeResult</a>&gt;</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="typescript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
</pre></td>
  <td class="code"><pre>const response = await this.gda.range(parameters);</pre></td>
</tr></table></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_reduce"><a class="anchor" href="#_reduce"></a><a class="link" href="#_reduce">reduce</a></h6>
<div class="paragraph">
<p>Returns a computed single reduced result from a range of rows from the given table.
A range consists of consecutive rows from the start key (inclusive) to the stop key (exclusive).
You can specify partial keys for the start and stop fields.</p>
</div>
<div class="listingblock">
<div class="title">reduce(parameters: <a href="./common/cloud-services-types/gda-reduce-request.html">GdaReduceRequest</a>): Promise&lt;<a href="./common/cloud-services-types/gda-reduce-result.html">GdaReduceResult</a>&gt;</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="typescript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
</pre></td>
  <td class="code"><pre>const response = await this.gda.reduce(parameters);</pre></td>
</tr></table></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_how_to_use_it_5"><a class="anchor" href="#_how_to_use_it_5"></a><a class="link" href="#_how_to_use_it_5">How to use it ?</a></h6>
<div class="listingblock">
<div class="title">worker/index.ts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="typescript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
</pre></td>
  <td class="code"><pre>import { Injectable } from '@zetapush/core';
import { Gda, GdaPuts } from '@zetapush/platform-legacy'; <i class="conum" data-value="1"></i><b>(1)</b>

@Injectable()
export default class Api {
  constructor(
    private gda: Gda <i class="conum" data-value="2"></i><b>(2)</b>
  ) {}
  async doStuff(parameters: GdaPuts) {
    const response = await this.gda.puts(parameters); <i class="conum" data-value="3"></i><b>(3)</b>
    return response;
  }
}</pre></td>
</tr></table></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Import <code>Gda</code> from platform</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Declare injected service</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Call injected service</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_stack"><a class="anchor" href="#_stack"></a><a class="link" href="#_stack">22.2.2.2. Stack</a></h5>
<div class="paragraph">
<p>Data stack user API</p>
</div>
<div class="paragraph">
<p>Data is stored on a per user basis. However, notifications can be sent to a configurable set of listeners.
Stack names are arbitrary and do not need to be explicitly initialized.</p>
</div>
<div class="sect5">
<h6 id="_purge"><a class="anchor" href="#_purge"></a><a class="link" href="#_purge">purge</a></h6>
<div class="paragraph">
<p>Removes all items from the given stack.</p>
</div>
<div class="listingblock">
<div class="title">purge(parameters: <a href="./common/cloud-services-types/stack-request.html">StackRequest</a>): Promise&lt;<a href="./common/cloud-services-types/stack-request.html">StackRequest</a>&gt;</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="typescript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
</pre></td>
  <td class="code"><pre>const response = await this.stack.purge(parameters);</pre></td>
</tr></table></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_getlisteners"><a class="anchor" href="#_getlisteners"></a><a class="link" href="#_getlisteners">getListeners</a></h6>
<div class="paragraph">
<p>Returns the whole list of listeners for the given stack.</p>
</div>
<div class="listingblock">
<div class="title">getListeners(parameters: <a href="./common/cloud-services-types/stack-request.html">StackRequest</a>): Promise&lt;<a href="./common/cloud-services-types/stack-listeners.html">StackListeners</a>&gt;</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="typescript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
</pre></td>
  <td class="code"><pre>const response = await this.stack.getListeners(parameters);</pre></td>
</tr></table></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_setlisteners"><a class="anchor" href="#_setlisteners"></a><a class="link" href="#_setlisteners">setListeners</a></h6>
<div class="paragraph">
<p>Sets the listeners for the given stack.</p>
</div>
<div class="listingblock">
<div class="title">setListeners(parameters: <a href="./common/cloud-services-types/stack-listeners.html">StackListeners</a>): Promise&lt;<a href="./common/cloud-services-types/stack-listeners.html">StackListeners</a>&gt;</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="typescript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
</pre></td>
  <td class="code"><pre>const response = await this.stack.setListeners(parameters);</pre></td>
</tr></table></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_remove"><a class="anchor" href="#_remove"></a><a class="link" href="#_remove">remove</a></h6>
<div class="paragraph">
<p>Removes the item with the given guid from the given stack.</p>
</div>
<div class="listingblock">
<div class="title">remove(parameters: <a href="./common/cloud-services-types/stack-item-remove.html">StackItemRemove</a>): Promise&lt;<a href="./common/cloud-services-types/stack-item-remove.html">StackItemRemove</a>&gt;</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="typescript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
</pre></td>
  <td class="code"><pre>const response = await this.stack.remove(parameters);</pre></td>
</tr></table></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_update"><a class="anchor" href="#_update"></a><a class="link" href="#_update">update</a></h6>
<div class="paragraph">
<p>Updates an existing item of the given stack.
The item MUST exist prior to the call.</p>
</div>
<div class="listingblock">
<div class="title">update(parameters: <a href="./common/cloud-services-types/stack-item-add.html">StackItemAdd</a>): Promise&lt;<a href="./common/cloud-services-types/stack-item-add.html">StackItemAdd</a>&gt;</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="typescript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
</pre></td>
  <td class="code"><pre>const response = await this.stack.update(parameters);</pre></td>
</tr></table></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_push"><a class="anchor" href="#_push"></a><a class="link" href="#_push">push</a></h6>
<div class="paragraph">
<p>Pushes an item onto the given stack.
The stack does not need to be created.</p>
</div>
<div class="listingblock">
<div class="title">push(parameters: <a href="./common/cloud-services-types/stack-item-add.html">StackItemAdd</a>): Promise&lt;<a href="./common/cloud-services-types/stack-item-add.html">StackItemAdd</a>&gt;</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="typescript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
</pre></td>
  <td class="code"><pre>const response = await this.stack.push(parameters);</pre></td>
</tr></table></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_list_2"><a class="anchor" href="#_list_2"></a><a class="link" href="#_list_2">list</a></h6>
<div class="paragraph">
<p>Returns a paginated list of contents for the given stack.
Content is sorted according to the statically configured order.</p>
</div>
<div class="listingblock">
<div class="title">list(parameters: <a href="./common/cloud-services-types/stack-list-request.html">StackListRequest</a>): Promise&lt;<a href="./common/cloud-services-types/stack-list-response.html">StackListResponse</a>&gt;</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="typescript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
</pre></td>
  <td class="code"><pre>const response = await this.stack.list(parameters);</pre></td>
</tr></table></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_how_to_use_it_6"><a class="anchor" href="#_how_to_use_it_6"></a><a class="link" href="#_how_to_use_it_6">How to use it ?</a></h6>
<div class="listingblock">
<div class="title">worker/index.ts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="typescript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
</pre></td>
  <td class="code"><pre>import { Injectable } from '@zetapush/core';
import { Stack, StackRequest } from '@zetapush/platform-legacy'; <i class="conum" data-value="1"></i><b>(1)</b>

@Injectable()
export default class Api {
  constructor(
    private stack: Stack <i class="conum" data-value="2"></i><b>(2)</b>
  ) {}
  async doStuff(parameters: StackRequest) {
    const response = await this.stack.purge(parameters); <i class="conum" data-value="3"></i><b>(3)</b>
    return response;
  }
}</pre></td>
</tr></table></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Import <code>Stack</code> from platform</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Declare injected service</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Call injected service</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_search_2"><a class="anchor" href="#_search_2"></a><a class="link" href="#_search_2">22.2.2.3. Search</a></h5>
<div class="paragraph">
<p>ElasticSearch Service</p>
</div>
<div class="paragraph">
<p>This API is a very thin wrapper around ElasticSearch&#8217;s API.</p>
</div>
<div class="sect5">
<h6 id="_index"><a class="anchor" href="#_index"></a><a class="link" href="#_index">index</a></h6>
<div class="paragraph">
<p>Inserts or updates a document into the elasticsearch engine.</p>
</div>
<div class="listingblock">
<div class="title">index(parameters: <a href="./common/cloud-services-types/search-data.html">SearchData</a>): Promise&lt;<a href="./common/cloud-services-types/void.html">void</a>&gt;</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="typescript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
</pre></td>
  <td class="code"><pre>const response = await this.search.index(parameters);</pre></td>
</tr></table></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_get_2"><a class="anchor" href="#_get_2"></a><a class="link" href="#_get_2">get</a></h6>
<div class="paragraph">
<p>Retrieves a document from the elasticsearch engine by id.</p>
</div>
<div class="listingblock">
<div class="title">get(parameters: <a href="./common/cloud-services-types/search-document-id.html">SearchDocumentId</a>): Promise&lt;<a href="./common/cloud-services-types/search-data.html">SearchData</a>&gt;</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="typescript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
</pre></td>
  <td class="code"><pre>const response = await this.search.get(parameters);</pre></td>
</tr></table></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_delete"><a class="anchor" href="#_delete"></a><a class="link" href="#_delete">delete</a></h6>
<div class="paragraph">
<p>Deletes a document from the elasticsearch engine by id.</p>
</div>
<div class="listingblock">
<div class="title">delete(parameters: <a href="./common/cloud-services-types/search-document-id.html">SearchDocumentId</a>): Promise&lt;<a href="./common/cloud-services-types/void.html">void</a>&gt;</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="typescript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
</pre></td>
  <td class="code"><pre>const response = await this.search.delete(parameters);</pre></td>
</tr></table></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_search_3"><a class="anchor" href="#_search_3"></a><a class="link" href="#_search_3">search</a></h6>
<div class="listingblock">
<div class="title">search(parameters: <a href="./common/cloud-services-types/search-request.html">SearchRequest</a>): Promise&lt;<a href="./common/cloud-services-types/search-results.html">SearchResults</a>&gt;</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="typescript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
</pre></td>
  <td class="code"><pre>const response = await this.search.search(parameters);</pre></td>
</tr></table></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_how_to_use_it_7"><a class="anchor" href="#_how_to_use_it_7"></a><a class="link" href="#_how_to_use_it_7">How to use it ?</a></h6>
<div class="listingblock">
<div class="title">worker/index.ts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="typescript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
</pre></td>
  <td class="code"><pre>import { Injectable } from '@zetapush/core';
import { Search, SearchData } from '@zetapush/platform-legacy'; <i class="conum" data-value="1"></i><b>(1)</b>

@Injectable()
export default class Api {
  constructor(
    private search: Search <i class="conum" data-value="2"></i><b>(2)</b>
  ) {}
  async doStuff(parameters: SearchData) {
    const response = await this.search.index(parameters); <i class="conum" data-value="3"></i><b>(3)</b>
    return response;
  }
}</pre></td>
</tr></table></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Import <code>Search</code> from platform</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Declare injected service</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Call injected service</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_file_management"><a class="anchor" href="#_file_management"></a><a class="link" href="#_file_management">22.2.3. File Management</a></h4>
<div class="sect4">
<h5 id="_zpfs_hdfs"><a class="anchor" href="#_zpfs_hdfs"></a><a class="link" href="#_zpfs_hdfs">22.2.3.1. Zpfs_hdfs</a></h5>
<div class="paragraph">
<p>User API for local file management</p>
</div>
<div class="paragraph">
<p>User API for file content manipulation
User API for virtual file management and http file upload
This API contains all the verbs needed to browse, upload and remove files.
Files are stored on a per-user basis: each user has his or her own whole virtual filesystem.
Uploading a file is a 3-step process : request an upload URL, upload via HTTP, notify this service of completion.</p>
</div>
<div class="sect5">
<h6 id="_readtoken"><a class="anchor" href="#_readtoken"></a><a class="link" href="#_readtoken">readToken</a></h6>
<div class="paragraph">
<p>Requests a token. This token can be used to retrieve a compressed folder via HTTP.</p>
</div>
<div class="listingblock">
<div class="title">readToken(parameters: <a href="./common/cloud-services-types/zpfs-request.html">ZpfsRequest</a>): Promise&lt;<a href="./common/cloud-services-types/zpfs-token.html">ZpfsToken</a>&gt;</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="typescript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
</pre></td>
  <td class="code"><pre>const response = await this.zpfs_hdfs.readToken(parameters);</pre></td>
</tr></table></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_create"><a class="anchor" href="#_create"></a><a class="link" href="#_create">create</a></h6>
<div class="paragraph">
<p>Creates a file, writes content and closes the file as a single operation.
Calling this verb is functionnally equivalent to successively calling 'newUploadUrl', posting the content and calling 'newFile'</p>
</div>
<div class="listingblock">
<div class="title">create(parameters: <a href="./common/cloud-services-types/file-creation-request.html">FileCreationRequest</a>): Promise&lt;<a href="./common/cloud-services-types/listing-entry-info.html">ListingEntryInfo</a>&gt;</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="typescript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
</pre></td>
  <td class="code"><pre>const response = await this.zpfs_hdfs.create(parameters);</pre></td>
</tr></table></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_open"><a class="anchor" href="#_open"></a><a class="link" href="#_open">open</a></h6>
<div class="paragraph">
<p>Opens a file for reading.</p>
</div>
<div class="listingblock">
<div class="title">open(parameters: <a href="./common/cloud-services-types/zpfs-request.html">ZpfsRequest</a>): Promise&lt;<a href="./common/cloud-services-types/zpfs-file-handler.html">ZpfsFileHandler</a>&gt;</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="typescript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
</pre></td>
  <td class="code"><pre>const response = await this.zpfs_hdfs.open(parameters);</pre></td>
</tr></table></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_link"><a class="anchor" href="#_link"></a><a class="link" href="#_link">link</a></h6>
<div class="paragraph">
<p>Links a file or folder to another location.
May fail if the target location is not empty.</p>
</div>
<div class="listingblock">
<div class="title">link(parameters: <a href="./common/cloud-services-types/created-file.html">CreatedFile</a>): Promise&lt;<a href="./common/cloud-services-types/created-file.html">CreatedFile</a>&gt;</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="typescript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
</pre></td>
  <td class="code"><pre>const response = await this.zpfs_hdfs.link(parameters);</pre></td>
</tr></table></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_stat"><a class="anchor" href="#_stat"></a><a class="link" href="#_stat">stat</a></h6>
<div class="paragraph">
<p>Returns information about a single file.
The entry field will be null if the path does not exist</p>
</div>
<div class="listingblock">
<div class="title">stat(parameters: <a href="./common/cloud-services-types/file-stat-request.html">FileStatRequest</a>): Promise&lt;<a href="./common/cloud-services-types/file-stat-result.html">FileStatResult</a>&gt;</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="typescript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
</pre></td>
  <td class="code"><pre>const response = await this.zpfs_hdfs.stat(parameters);</pre></td>
</tr></table></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_cp"><a class="anchor" href="#_cp"></a><a class="link" href="#_cp">cp</a></h6>
<div class="paragraph">
<p>Copies a file or folder (recursively) to a new location.
May fail if the target location is not empty.</p>
</div>
<div class="listingblock">
<div class="title">cp(parameters: <a href="./common/cloud-services-types/created-file.html">CreatedFile</a>): Promise&lt;<a href="./common/cloud-services-types/created-file.html">CreatedFile</a>&gt;</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="typescript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
</pre></td>
  <td class="code"><pre>const response = await this.zpfs_hdfs.cp(parameters);</pre></td>
</tr></table></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_ls"><a class="anchor" href="#_ls"></a><a class="link" href="#_ls">ls</a></h6>
<div class="paragraph">
<p>Returns a paginated list of the folder&#8217;s content.</p>
</div>
<div class="listingblock">
<div class="title">ls(parameters: <a href="./common/cloud-services-types/folder-listing-request.html">FolderListingRequest</a>): Promise&lt;<a href="./common/cloud-services-types/folder-listing.html">FolderListing</a>&gt;</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="typescript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
</pre></td>
  <td class="code"><pre>const response = await this.zpfs_hdfs.ls(parameters);</pre></td>
</tr></table></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_mv"><a class="anchor" href="#_mv"></a><a class="link" href="#_mv">mv</a></h6>
<div class="paragraph">
<p>Moves a file or folder (recursively) to a new location.
May fail if the target location is not empty.</p>
</div>
<div class="listingblock">
<div class="title">mv(parameters: <a href="./common/cloud-services-types/created-file.html">CreatedFile</a>): Promise&lt;<a href="./common/cloud-services-types/created-file.html">CreatedFile</a>&gt;</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="typescript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
</pre></td>
  <td class="code"><pre>const response = await this.zpfs_hdfs.mv(parameters);</pre></td>
</tr></table></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_snapshot"><a class="anchor" href="#_snapshot"></a><a class="link" href="#_snapshot">snapshot</a></h6>
<div class="paragraph">
<p>Creates a new folder and then copies the given files inside</p>
</div>
<div class="listingblock">
<div class="title">snapshot(parameters: <a href="./common/cloud-services-types/snapshot-creation-request.html">SnapshotCreationRequest</a>): Promise&lt;<a href="./common/cloud-services-types/created-file.html">CreatedFile</a>&gt;</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="typescript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
</pre></td>
  <td class="code"><pre>const response = await this.zpfs_hdfs.snapshot(parameters);</pre></td>
</tr></table></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_du"><a class="anchor" href="#_du"></a><a class="link" href="#_du">du</a></h6>
<div class="paragraph">
<p>Returns an recursively aggregated number of used bytes, starting at the given path.</p>
</div>
<div class="listingblock">
<div class="title">du(parameters: <a href="./common/cloud-services-types/zpfs-request.html">ZpfsRequest</a>): Promise&lt;<a href="./common/cloud-services-types/zpfs-disk-usage.html">ZpfsDiskUsage</a>&gt;</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="typescript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
</pre></td>
  <td class="code"><pre>const response = await this.zpfs_hdfs.du(parameters);</pre></td>
</tr></table></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_rm"><a class="anchor" href="#_rm"></a><a class="link" href="#_rm">rm</a></h6>
<div class="paragraph">
<p>Removes a file or folder (recursively).</p>
</div>
<div class="listingblock">
<div class="title">rm(parameters: <a href="./common/cloud-services-types/file-removal.html">FileRemoval</a>): Promise&lt;<a href="./common/cloud-services-types/file-removal.html">FileRemoval</a>&gt;</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="typescript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
</pre></td>
  <td class="code"><pre>const response = await this.zpfs_hdfs.rm(parameters);</pre></td>
</tr></table></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_freeuploadurl"><a class="anchor" href="#_freeuploadurl"></a><a class="link" href="#_freeuploadurl">freeUploadUrl</a></h6>
<div class="listingblock">
<div class="title">freeUploadUrl(parameters: <a href="./common/cloud-services-types/file-upload-request.html">FileUploadRequest</a>): Promise&lt;<a href="./common/cloud-services-types/file-upload-location.html">FileUploadLocation</a>&gt;</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="typescript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
</pre></td>
  <td class="code"><pre>const response = await this.zpfs_hdfs.freeUploadUrl(parameters);</pre></td>
</tr></table></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_newuploadurl"><a class="anchor" href="#_newuploadurl"></a><a class="link" href="#_newuploadurl">newUploadUrl</a></h6>
<div class="paragraph">
<p>Requests an HTTP upload URL.
The URL contains temporary credentials (typically valid for a few minutes) and is meant for immediate use.</p>
</div>
<div class="listingblock">
<div class="title">newUploadUrl(parameters: <a href="./common/cloud-services-types/file-upload-request.html">FileUploadRequest</a>): Promise&lt;<a href="./common/cloud-services-types/file-upload-location.html">FileUploadLocation</a>&gt;</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="typescript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
</pre></td>
  <td class="code"><pre>const response = await this.zpfs_hdfs.newUploadUrl(parameters);</pre></td>
</tr></table></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_updatemeta"><a class="anchor" href="#_updatemeta"></a><a class="link" href="#_updatemeta">updateMeta</a></h6>
<div class="listingblock">
<div class="title">updateMeta(parameters: <a href="./common/cloud-services-types/file-meta-update.html">FileMetaUpdate</a>): Promise&lt;<a href="./common/cloud-services-types/listing-entry-info.html">ListingEntryInfo</a>&gt;</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="typescript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
</pre></td>
  <td class="code"><pre>const response = await this.zpfs_hdfs.updateMeta(parameters);</pre></td>
</tr></table></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_newfile"><a class="anchor" href="#_newfile"></a><a class="link" href="#_newfile">newFile</a></h6>
<div class="paragraph">
<p>The client application calls this verb to notify that it&#8217;s done uploading to the cloud.
Calling that verb MAY trigger additional events such as thumbnail/metadata creation.</p>
</div>
<div class="listingblock">
<div class="title">newFile(parameters: <a href="./common/cloud-services-types/file-upload-complete.html">FileUploadComplete</a>): Promise&lt;<a href="./common/cloud-services-types/listing-entry-info.html">ListingEntryInfo</a>&gt;</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="typescript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
</pre></td>
  <td class="code"><pre>const response = await this.zpfs_hdfs.newFile(parameters);</pre></td>
</tr></table></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_mkdir"><a class="anchor" href="#_mkdir"></a><a class="link" href="#_mkdir">mkdir</a></h6>
<div class="paragraph">
<p>Creates a new folder.
May fail if the target location is not empty.</p>
</div>
<div class="listingblock">
<div class="title">mkdir(parameters: <a href="./common/cloud-services-types/folder-creation-request.html">FolderCreationRequest</a>): Promise&lt;<a href="./common/cloud-services-types/created-file.html">CreatedFile</a>&gt;</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="typescript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
</pre></td>
  <td class="code"><pre>const response = await this.zpfs_hdfs.mkdir(parameters);</pre></td>
</tr></table></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_how_to_use_it_8"><a class="anchor" href="#_how_to_use_it_8"></a><a class="link" href="#_how_to_use_it_8">How to use it ?</a></h6>
<div class="listingblock">
<div class="title">worker/index.ts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="typescript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
</pre></td>
  <td class="code"><pre>import { Injectable } from '@zetapush/core';
import { Zpfs_hdfs, ZpfsRequest } from '@zetapush/platform-legacy'; <i class="conum" data-value="1"></i><b>(1)</b>

@Injectable()
export default class Api {
  constructor(
    private zpfs_hdfs: Zpfs_hdfs <i class="conum" data-value="2"></i><b>(2)</b>
  ) {}
  async doStuff(parameters: ZpfsRequest) {
    const response = await this.zpfs_hdfs.readToken(parameters); <i class="conum" data-value="3"></i><b>(3)</b>
    return response;
  }
}</pre></td>
</tr></table></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Import <code>Zpfs_hdfs</code> from platform</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Declare injected service</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Call injected service</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_template"><a class="anchor" href="#_template"></a><a class="link" href="#_template">22.2.3.2. Template</a></h5>
<div class="paragraph">
<p>User API for templates</p>
</div>
<div class="paragraph">
<p>Users use this API to evaluate pre-configured templates.</p>
</div>
<div class="sect5">
<h6 id="_evaluate"><a class="anchor" href="#_evaluate"></a><a class="link" href="#_evaluate">evaluate</a></h6>
<div class="paragraph">
<p>Evaluates the given template and returns the result as a string.
Templates are parsed the first time they are evaluated. Evaluation may fail early due to a parsing error.</p>
</div>
<div class="listingblock">
<div class="title">evaluate(parameters: <a href="./common/cloud-services-types/template-request.html">TemplateRequest</a>): Promise&lt;<a href="./common/cloud-services-types/template-result.html">TemplateResult</a>&gt;</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="typescript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
</pre></td>
  <td class="code"><pre>const response = await this.template.evaluate(parameters);</pre></td>
</tr></table></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_how_to_use_it_9"><a class="anchor" href="#_how_to_use_it_9"></a><a class="link" href="#_how_to_use_it_9">How to use it ?</a></h6>
<div class="listingblock">
<div class="title">worker/index.ts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="typescript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
</pre></td>
  <td class="code"><pre>import { Injectable } from '@zetapush/core';
import { Template, TemplateRequest } from '@zetapush/platform-legacy'; <i class="conum" data-value="1"></i><b>(1)</b>

@Injectable()
export default class Api {
  constructor(
    private template: Template <i class="conum" data-value="2"></i><b>(2)</b>
  ) {}
  async doStuff(parameters: TemplateRequest) {
    const response = await this.template.evaluate(parameters); <i class="conum" data-value="3"></i><b>(3)</b>
    return response;
  }
}</pre></td>
</tr></table></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Import <code>Template</code> from platform</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Declare injected service</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Call injected service</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_communication"><a class="anchor" href="#_communication"></a><a class="link" href="#_communication">22.2.4. Communication</a></h4>
<div class="sect4">
<h5 id="_messaging"><a class="anchor" href="#_messaging"></a><a class="link" href="#_messaging">22.2.4.1. Messaging</a></h5>
<div class="paragraph">
<p>Messaging service</p>
</div>
<div class="paragraph">
<p>Simple and flexible user-to-user or user-to-group messaging service.</p>
</div>
<div class="sect5">
<h6 id="_send"><a class="anchor" href="#_send"></a><a class="link" href="#_send">send</a></h6>
<div class="paragraph">
<p>Sends the given message to the specified target on the given (optional) channel.
The administratively given default channel name is used when none is provided in the message itself.</p>
</div>
<div class="listingblock">
<div class="title">send(parameters: <a href="./common/cloud-services-types/message.html">Message</a>): Promise&lt;<a href="./common/cloud-services-types/void.html">void</a>&gt;</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="typescript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
</pre></td>
  <td class="code"><pre>const response = await this.messaging.send(parameters);</pre></td>
</tr></table></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_how_to_use_it_10"><a class="anchor" href="#_how_to_use_it_10"></a><a class="link" href="#_how_to_use_it_10">How to use it ?</a></h6>
<div class="listingblock">
<div class="title">worker/index.ts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="typescript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
</pre></td>
  <td class="code"><pre>import { Injectable } from '@zetapush/core';
import { Messaging, Message } from '@zetapush/platform-legacy'; <i class="conum" data-value="1"></i><b>(1)</b>

@Injectable()
export default class Api {
  constructor(
    private messaging: Messaging <i class="conum" data-value="2"></i><b>(2)</b>
  ) {}
  async doStuff(parameters: Message) {
    const response = await this.messaging.send(parameters); <i class="conum" data-value="3"></i><b>(3)</b>
    return response;
  }
}</pre></td>
</tr></table></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Import <code>Messaging</code> from platform</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Declare injected service</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Call injected service</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_notif"><a class="anchor" href="#_notif"></a><a class="link" href="#_notif">22.2.4.2. Notif</a></h5>
<div class="paragraph">
<p>Notification User API</p>
</div>
<div class="paragraph">
<p>User API for notifications.
For notifications to work properly, it is imperative that the resource name of a device remain constant over time.</p>
</div>
<div class="sect5">
<h6 id="_send_2"><a class="anchor" href="#_send_2"></a><a class="link" href="#_send_2">send</a></h6>
<div class="paragraph">
<p>Sends a native push notification to the target.</p>
</div>
<div class="listingblock">
<div class="title">send(parameters: <a href="./common/cloud-services-types/notification-message.html">NotificationMessage</a>): Promise&lt;<a href="./common/cloud-services-types/notification-send-status.html">NotificationSendStatus</a>&gt;</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="typescript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
</pre></td>
  <td class="code"><pre>const response = await this.notif.send(parameters);</pre></td>
</tr></table></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_unregister"><a class="anchor" href="#_unregister"></a><a class="link" href="#_unregister">unregister</a></h6>
<div class="paragraph">
<p>Unregisters the device for the current user and resource.
This verb does not need any parameters.</p>
</div>
<div class="listingblock">
<div class="title">unregister(parameters: <a href="./common/cloud-services-types/.html">undefined</a>): Promise&lt;<a href="./common/cloud-services-types/void.html">void</a>&gt;</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="typescript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
</pre></td>
  <td class="code"><pre>const response = await this.notif.unregister(parameters);</pre></td>
</tr></table></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_register"><a class="anchor" href="#_register"></a><a class="link" href="#_register">register</a></h6>
<div class="paragraph">
<p>Registers the device for the current user and resource.
This service maintains a mapping of <em>userkey/</em>resource to device registration IDs.
You MUST NOT re-use the same resource name from one device to another if you want to target specific devices with 'send'.
Only one registration can be active for a given <em>userKey/</em>resource pair in a notification service.
Device registration can be &lt;b&gt;neither impersonated nor called indirectly&lt;/b&gt; (from a scheduled job).</p>
</div>
<div class="listingblock">
<div class="title">register(parameters: <a href="./common/cloud-services-types/notifiable-device-registration.html">NotifiableDeviceRegistration</a>): Promise&lt;<a href="./common/cloud-services-types/void.html">void</a>&gt;</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="typescript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
</pre></td>
  <td class="code"><pre>const response = await this.notif.register(parameters);</pre></td>
</tr></table></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_how_to_use_it_11"><a class="anchor" href="#_how_to_use_it_11"></a><a class="link" href="#_how_to_use_it_11">How to use it ?</a></h6>
<div class="listingblock">
<div class="title">worker/index.ts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="typescript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
</pre></td>
  <td class="code"><pre>import { Injectable } from '@zetapush/core';
import { Notif, NotificationMessage } from '@zetapush/platform-legacy'; <i class="conum" data-value="1"></i><b>(1)</b>

@Injectable()
export default class Api {
  constructor(
    private notif: Notif <i class="conum" data-value="2"></i><b>(2)</b>
  ) {}
  async doStuff(parameters: NotificationMessage) {
    const response = await this.notif.send(parameters); <i class="conum" data-value="3"></i><b>(3)</b>
    return response;
  }
}</pre></td>
</tr></table></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Import <code>Notif</code> from platform</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Declare injected service</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Call injected service</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_sendmail"><a class="anchor" href="#_sendmail"></a><a class="link" href="#_sendmail">22.2.4.3. Sendmail</a></h5>
<div class="paragraph">
<p>Mail service user API</p>
</div>
<div class="paragraph">
<p>This service is statically configured with an outgoing SMTP server.
Users call the API here to actually send emails.</p>
</div>
<div class="sect5">
<h6 id="_send_3"><a class="anchor" href="#_send_3"></a><a class="link" href="#_send_3">send</a></h6>
<div class="paragraph">
<p>Sends an email with the given body to the intended recipients.</p>
</div>
<div class="listingblock">
<div class="title">send(parameters: <a href="./common/cloud-services-types/email.html">Email</a>): Promise&lt;<a href="./common/cloud-services-types/void.html">void</a>&gt;</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="typescript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
</pre></td>
  <td class="code"><pre>const response = await this.sendmail.send(parameters);</pre></td>
</tr></table></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_how_to_use_it_12"><a class="anchor" href="#_how_to_use_it_12"></a><a class="link" href="#_how_to_use_it_12">How to use it ?</a></h6>
<div class="listingblock">
<div class="title">worker/index.ts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="typescript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
</pre></td>
  <td class="code"><pre>import { Injectable } from '@zetapush/core';
import { Sendmail, Email } from '@zetapush/platform-legacy'; <i class="conum" data-value="1"></i><b>(1)</b>

@Injectable()
export default class Api {
  constructor(
    private sendmail: Sendmail <i class="conum" data-value="2"></i><b>(2)</b>
  ) {}
  async doStuff(parameters: Email) {
    const response = await this.sendmail.send(parameters); <i class="conum" data-value="3"></i><b>(3)</b>
    return response;
  }
}</pre></td>
</tr></table></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Import <code>Sendmail</code> from platform</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Declare injected service</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Call injected service</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_sms_ovh"><a class="anchor" href="#_sms_ovh"></a><a class="link" href="#_sms_ovh">22.2.4.4. Sms_ovh</a></h5>
<div class="paragraph">
<p>SMS service</p>
</div>
<div class="paragraph">
<p>User API for SMS.</p>
</div>
<div class="sect5">
<h6 id="_send_4"><a class="anchor" href="#_send_4"></a><a class="link" href="#_send_4">send</a></h6>
<div class="paragraph">
<p>Sends the given message to the given recipients.</p>
</div>
<div class="listingblock">
<div class="title">send(parameters: <a href="./common/cloud-services-types/sms-message.html">SmsMessage</a>): Promise&lt;<a href="./common/cloud-services-types/void.html">void</a>&gt;</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="typescript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
</pre></td>
  <td class="code"><pre>const response = await this.sms_ovh.send(parameters);</pre></td>
</tr></table></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_how_to_use_it_13"><a class="anchor" href="#_how_to_use_it_13"></a><a class="link" href="#_how_to_use_it_13">How to use it ?</a></h6>
<div class="listingblock">
<div class="title">worker/index.ts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="typescript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
</pre></td>
  <td class="code"><pre>import { Injectable } from '@zetapush/core';
import { Sms_ovh, SmsMessage } from '@zetapush/platform-legacy'; <i class="conum" data-value="1"></i><b>(1)</b>

@Injectable()
export default class Api {
  constructor(
    private sms_ovh: Sms_ovh <i class="conum" data-value="2"></i><b>(2)</b>
  ) {}
  async doStuff(parameters: SmsMessage) {
    const response = await this.sms_ovh.send(parameters); <i class="conum" data-value="3"></i><b>(3)</b>
    return response;
  }
}</pre></td>
</tr></table></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Import <code>Sms_ovh</code> from platform</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Declare injected service</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Call injected service</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_utilities_management"><a class="anchor" href="#_utilities_management"></a><a class="link" href="#_utilities_management">22.2.5. Utilities Management</a></h4>
<div class="sect4">
<h5 id="_cron"><a class="anchor" href="#_cron"></a><a class="link" href="#_cron">22.2.5.1. Cron</a></h5>
<div class="paragraph">
<p>User API for the Scheduler</p>
</div>
<div class="paragraph">
<p>User endpoints for scheduling : users can schedule, list and delete tasks.
Tasks are stored on a per-user basis: a task will run with the priviledges of the user who stored it.
Tasks are run on the server and thus can call api verbs marked as server-only.</p>
</div>
<div class="sect5">
<h6 id="_schedule"><a class="anchor" href="#_schedule"></a><a class="link" href="#_schedule">schedule</a></h6>
<div class="paragraph">
<p>Schedules a task for later execution. Tasks are executed asynchronously with the identity of the calling user.
Tasks will be executed at a fixed moment in time in the future, or repeatedly, with minute precision.
If a task already exists with the same cronName (a cronName is unique for a given user), this new task completely replaces it.
A task can be scheduled with a cron-like syntax for repetitive or one-shot execution.
Wildcards are not allowed for minutes and hours.
When scheduling for one-shot execution, the time must be at least two minutes into the future.</p>
</div>
<div class="listingblock">
<div class="title">schedule(parameters: <a href="./common/cloud-services-types/cron-task-request.html">CronTaskRequest</a>): Promise&lt;<a href="./common/cloud-services-types/cron-task-request.html">CronTaskRequest</a>&gt;</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="typescript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
</pre></td>
  <td class="code"><pre>const response = await this.cron.schedule(parameters);</pre></td>
</tr></table></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_settimeout"><a class="anchor" href="#_settimeout"></a><a class="link" href="#_settimeout">setTimeout</a></h6>
<div class="paragraph">
<p>Schedules a task for later execution. Tasks are executed asynchronously with the identity of the calling user.
Tasks will be executed with second precision in the near future (120 seconds delay max).</p>
</div>
<div class="listingblock">
<div class="title">setTimeout(parameters: <a href="./common/cloud-services-types/timer-request.html">TimerRequest</a>): Promise&lt;<a href="./common/cloud-services-types/timer-result.html">TimerResult</a>&gt;</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="typescript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
</pre></td>
  <td class="code"><pre>const response = await this.cron.setTimeout(parameters);</pre></td>
</tr></table></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_unschedule"><a class="anchor" href="#_unschedule"></a><a class="link" href="#_unschedule">unschedule</a></h6>
<div class="paragraph">
<p>Removes a previously scheduled task.
Does absolutely nothing if asked to remove a non-existent task.</p>
</div>
<div class="listingblock">
<div class="title">unschedule(parameters: <a href="./common/cloud-services-types/cron-task-deletion.html">CronTaskDeletion</a>): Promise&lt;<a href="./common/cloud-services-types/cron-task-deletion.html">CronTaskDeletion</a>&gt;</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="typescript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
</pre></td>
  <td class="code"><pre>const response = await this.cron.unschedule(parameters);</pre></td>
</tr></table></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_list_3"><a class="anchor" href="#_list_3"></a><a class="link" href="#_list_3">list</a></h6>
<div class="paragraph">
<p>Returns a paginated list of the asking user&#8217;s tasks.</p>
</div>
<div class="listingblock">
<div class="title">list(parameters: <a href="./common/cloud-services-types/cron-task-list-request.html">CronTaskListRequest</a>): Promise&lt;<a href="./common/cloud-services-types/cron-planning.html">CronPlanning</a>&gt;</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="typescript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
</pre></td>
  <td class="code"><pre>const response = await this.cron.list(parameters);</pre></td>
</tr></table></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_how_to_use_it_14"><a class="anchor" href="#_how_to_use_it_14"></a><a class="link" href="#_how_to_use_it_14">How to use it ?</a></h6>
<div class="listingblock">
<div class="title">worker/index.ts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="typescript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
</pre></td>
  <td class="code"><pre>import { Injectable } from '@zetapush/core';
import { Cron, CronTaskRequest } from '@zetapush/platform-legacy'; <i class="conum" data-value="1"></i><b>(1)</b>

@Injectable()
export default class Api {
  constructor(
    private cron: Cron <i class="conum" data-value="2"></i><b>(2)</b>
  ) {}
  async doStuff(parameters: CronTaskRequest) {
    const response = await this.cron.schedule(parameters); <i class="conum" data-value="3"></i><b>(3)</b>
    return response;
  }
}</pre></td>
</tr></table></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Import <code>Cron</code> from platform</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Declare injected service</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Call injected service</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_logs"><a class="anchor" href="#_logs"></a><a class="link" href="#_logs">22.2.5.2. Logs</a></h5>
<div class="paragraph">
<p>Log API</p>
</div>
<div class="paragraph">
<p>User API for logging.</p>
</div>
<div class="sect5">
<h6 id="_log"><a class="anchor" href="#_log"></a><a class="link" href="#_log">log</a></h6>
<div class="paragraph">
<p>Adds some server generated data and stores the entry into the sink defined by configuration.</p>
</div>
<div class="listingblock">
<div class="title">log(parameters: <a href="./common/cloud-services-types/log-request.html">LogRequest</a>): Promise&lt;<a href="./common/cloud-services-types/void.html">void</a>&gt;</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="typescript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
</pre></td>
  <td class="code"><pre>const response = await this.logs.log(parameters);</pre></td>
</tr></table></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_how_to_use_it_15"><a class="anchor" href="#_how_to_use_it_15"></a><a class="link" href="#_how_to_use_it_15">How to use it ?</a></h6>
<div class="listingblock">
<div class="title">worker/index.ts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="typescript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
</pre></td>
  <td class="code"><pre>import { Injectable } from '@zetapush/core';
import { Logs, LogRequest } from '@zetapush/platform-legacy'; <i class="conum" data-value="1"></i><b>(1)</b>

@Injectable()
export default class Api {
  constructor(
    private logs: Logs <i class="conum" data-value="2"></i><b>(2)</b>
  ) {}
  async doStuff(parameters: LogRequest) {
    const response = await this.logs.log(parameters); <i class="conum" data-value="3"></i><b>(3)</b>
    return response;
  }
}</pre></td>
</tr></table></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Import <code>Logs</code> from platform</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Declare injected service</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Call injected service</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_trigger"><a class="anchor" href="#_trigger"></a><a class="link" href="#_trigger">22.2.5.3. Trigger</a></h5>
<div class="paragraph">
<p>Trigger service</p>
</div>
<div class="paragraph">
<p>Register listeners and trigger events.</p>
</div>
<div class="sect5">
<h6 id="_trigger_2"><a class="anchor" href="#_trigger_2"></a><a class="link" href="#_trigger_2">trigger</a></h6>
<div class="paragraph">
<p>Triggers an event.
All listeners previously registered for that event will be called, in no particular order.</p>
</div>
<div class="listingblock">
<div class="title">trigger(parameters: <a href="./common/cloud-services-types/event-trigger.html">EventTrigger</a>): Promise&lt;<a href="./common/cloud-services-types/void.html">void</a>&gt;</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="typescript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
</pre></td>
  <td class="code"><pre>const response = await this.trigger.trigger(parameters);</pre></td>
</tr></table></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_how_to_use_it_16"><a class="anchor" href="#_how_to_use_it_16"></a><a class="link" href="#_how_to_use_it_16">How to use it ?</a></h6>
<div class="listingblock">
<div class="title">worker/index.ts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="typescript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
</pre></td>
  <td class="code"><pre>import { Injectable } from '@zetapush/core';
import { Trigger, EventTrigger } from '@zetapush/platform-legacy'; <i class="conum" data-value="1"></i><b>(1)</b>

@Injectable()
export default class Api {
  constructor(
    private trigger: Trigger <i class="conum" data-value="2"></i><b>(2)</b>
  ) {}
  async doStuff(parameters: EventTrigger) {
    const response = await this.trigger.trigger(parameters); <i class="conum" data-value="3"></i><b>(3)</b>
    return response;
  }
}</pre></td>
</tr></table></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Import <code>Trigger</code> from platform</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Declare injected service</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Call injected service</td>
</tr>
</table>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_command_line_interface"><a class="anchor" href="#_command_line_interface"></a><a class="link" href="#_command_line_interface">23. Command Line Interface</a></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_config"><a class="anchor" href="#_config"></a><a class="link" href="#_config">23.1. Config</a></h3>

</div>
<div class="sect2">
<h3 id="_run"><a class="anchor" href="#_run"></a><a class="link" href="#_run">23.2. Run</a></h3>

</div>
<div class="sect2">
<h3 id="_push_2"><a class="anchor" href="#_push_2"></a><a class="link" href="#_push_2">23.3. Push</a></h3>

</div>
<div class="sect2">
<h3 id="verbosity_level"><a class="anchor" href="#verbosity_level"></a><a class="link" href="#verbosity_level">23.4. Change verbosity</a></h3>

</div>
</div>
</div>
<div class="sect1">
<h2 id="_configuration"><a class="anchor" href="#_configuration"></a><a class="link" href="#_configuration">24. Configuration</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>ZetaPush prefers convention over configuration. However, conventions can be overriden.</p>
</div>
<div class="sect2">
<h3 id="_account_configuration"><a class="anchor" href="#_account_configuration"></a><a class="link" href="#_account_configuration">24.1. Account configuration</a></h3>
<div class="paragraph">
<p>To use ZetaPush Celtia, you need to have an account and an optional application.
You specify this properties in the <code>.zetarc</code> file.
Here is the list of them:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 4. Account variables</caption>
<colgroup>
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-middle">Name of the property</th>
<th class="tableblock halign-center valign-middle">Definition</th>
<th class="tableblock halign-center valign-middle">environment variable</th>
<th class="tableblock halign-center valign-middle">Name in the <em>.zetarc</em></th>
<th class="tableblock halign-center valign-middle">CLI parameter</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-middle"><p class="tableblock">Developer login</p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock">This login is the email used by the developer when logging in to the ZetaPush console. It <strong>does not concern</strong> the applications developed by the developer. It is only used to identify the developer account.</p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock">ZP_DEVELOPER_LOGIN</p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock">developerLogin</p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock">--developer-login &lt;login&gt;</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"><p class="tableblock">Developer password</p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock">Like the property <em>--developer-login</em>, this password is only used for the ZetaPush developer account. It <strong>does not concern</strong> the applications developed by the developer.</p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock">ZP_DEVELOPER_PASSWORD</p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock">developerLogin</p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock">--developer-password &lt;password&gt;</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"><p class="tableblock">Application name</p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock">A developer can develop many applications. Hence the need to identify each of them. The <em>appName</em> property is the unique name of an application on a ZetaPush developer account.</p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock">ZP_APP_NAME</p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock">appName</p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock">--app-name &lt;name&gt;</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"><p class="tableblock">Environment name</p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock">An application created by a developer can have many environments.
The default environment is <em>prod</em> but you can create your own (<em>dev</em>, <em>preprod</em>, &#8230;&#8203;).
An environment is one stage in the development of the application.</p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock">ZP_ENV_NAME</p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock">envName</p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock">--env-name &lt;env&gt;</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"><p class="tableblock">Platform URL</p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock">By default, the developer uses the <em>production environment of ZetaPush</em> to develop and deploy its applications. In most cases, the developer doesn&#8217;t need to set this property. <strong>This property if useful when another (on premise, or dedicated) ZetaPush platform is to be used.</strong></p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock">ZP_PLATFORM_URL</p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock">platformUrl</p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock">--platform-url &lt;platform&gt;</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="_code_structure_configuration"><a class="anchor" href="#_code_structure_configuration"></a><a class="link" href="#_code_structure_configuration">24.2. Code structure configuration</a></h3>
<div class="paragraph">
<p>You can configure your applications with several variables. Here is the list of them:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 5. Application variables</caption>
<colgroup>
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-middle">Name of the property</th>
<th class="tableblock halign-center valign-middle">Definition</th>
<th class="tableblock halign-center valign-middle"><em>package.json</em></th>
<th class="tableblock halign-center valign-middle">CLI parameter</th>
<th class="tableblock halign-center valign-middle">Default value</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-middle"><div><div class="paragraph">
<p>Front code</p>
</div></div></td>
<td class="tableblock halign-center valign-middle"><div><div class="paragraph">
<p>In an application, you need to define where you put your front end part of your application.
ZetaPush uses this property to host and expose it.</p>
</div></div></td>
<td class="tableblock halign-center valign-middle"><div><div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
</pre></td>
  <td class="code"><pre><span class="key"><span class="delimiter">&quot;</span><span class="content">zetapush</span><span class="delimiter">&quot;</span></span>: {
    <span class="key"><span class="delimiter">&quot;</span><span class="content">front</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">./path/of/front</span><span class="delimiter">&quot;</span></span>
}</pre></td>
</tr></table></code></pre>
</div>
</div></div></td>
<td class="tableblock halign-center valign-middle"><div><div class="paragraph">
<p>--front &lt;path&gt;</p>
</div></div></td>
<td class="tableblock halign-center valign-middle"><div><div class="paragraph">
<p><code>./front/</code></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"><div><div class="paragraph">
<p>Worker code</p>
</div></div></td>
<td class="tableblock halign-center valign-middle"><div><div class="paragraph">
<p>When you create your business logic in <em>custom cloud services</em>, ZetaPush need to know his location to deploy it.</p>
</div></div></td>
<td class="tableblock halign-center valign-middle"><div><div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
</pre></td>
  <td class="code"><pre><span class="key"><span class="delimiter">&quot;</span><span class="content">zetapush</span><span class="delimiter">&quot;</span></span>: {
    <span class="key"><span class="delimiter">&quot;</span><span class="content">worker</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">./path/of/worker</span><span class="delimiter">&quot;</span></span>
}</pre></td>
</tr></table></code></pre>
</div>
</div></div></td>
<td class="tableblock halign-center valign-middle"><div><div class="paragraph">
<p>--worker &lt;path&gt;</p>
</div></div></td>
<td class="tableblock halign-center valign-middle"><div><div class="paragraph">
<p><code>./worker/</code></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"><div><div class="paragraph">
<p>Worker entry point</p>
</div></div></td>
<td class="tableblock halign-center valign-middle"><div><div class="paragraph">
<p>To use your <em>custom cloud services</em> from the front part you need to export them. So the exportation of services need to be in only one file.</p>
</div></div></td>
<td class="tableblock halign-center valign-middle"><div><div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json"><span class="key"><span class="delimiter">&quot;</span><span class="content">main</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">./path/of/entry</span><span class="delimiter">&quot;</span></span></code></pre>
</div>
</div></div></td>
<td class="tableblock halign-center valign-middle"><div><div class="paragraph">
<p><em>None</em></p>
</div></div></td>
<td class="tableblock halign-center valign-middle"><div><div class="paragraph">
<p><code>./worker/index.ts</code></p>
</div></div></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="configuration_properties"><a class="anchor" href="#configuration_properties"></a><a class="link" href="#configuration_properties">24.3. Configuration properties</a></h3>

</div>
<div class="sect2">
<h3 id="_customize_cloud_services"><a class="anchor" href="#_customize_cloud_services"></a><a class="link" href="#_customize_cloud_services">24.4. Customize cloud services</a></h3>
<div class="sect3">
<h4 id="_user_management_2"><a class="anchor" href="#_user_management_2"></a><a class="link" href="#_user_management_2">24.4.1. User Management</a></h4>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p>Update this section to match new plan</p>
</div>
<div class="paragraph">
<p><a href="https://github.com/zetapush/documentation/issues/61" class="bare">https://github.com/zetapush/documentation/issues/61</a></p>
</div>
<div class="paragraph">
<p>Unresolved directive in reference.adoc - include::/var/lib/jenkins/workspace/Github_documentation_master-IOSGDW42Y6L7PFABZDVKWIMQ7U5ZFS2WPFP2G4YQ6QQOVPTQ7Y4A/src/docs/asciidoc/common/cloud-services/user-management.adoc[leveloffset=+2]</p>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_logs_2"><a class="anchor" href="#_logs_2"></a><a class="link" href="#_logs_2">25. Logs</a></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_console_log"><a class="anchor" href="#_console_log"></a><a class="link" href="#_console_log">25.1. Console.log</a></h3>

</div>
<div class="sect2">
<h3 id="local_logger"><a class="anchor" href="#local_logger"></a><a class="link" href="#local_logger">25.2. Utility methods provided by @zetapush/common</a></h3>

</div>
<div class="sect2">
<h3 id="log_service"><a class="anchor" href="#log_service"></a><a class="link" href="#log_service">25.3. Built-in log cloud service</a></h3>

</div>
<div class="sect2">
<h3 id="_logs_using_requestcontext"><a class="anchor" href="#_logs_using_requestcontext"></a><a class="link" href="#_logs_using_requestcontext">Logs using requestContext</a></h3>

</div>
<div class="sect2">
<h3 id="_use_another_logging_library"><a class="anchor" href="#_use_another_logging_library"></a><a class="link" href="#_use_another_logging_library">25.4. Use another logging library</a></h3>

</div>
<div class="sect2">
<h3 id="logs_in_web_console"><a class="anchor" href="#logs_in_web_console"></a><a class="link" href="#logs_in_web_console">25.5. View logs in web console</a></h3>

</div>
<div class="sect2">
<h3 id="_persist_logs"><a class="anchor" href="#_persist_logs"></a><a class="link" href="#_persist_logs">25.6. Persist logs</a></h3>

</div>
<div class="sect2">
<h3 id="_external_log_visualization"><a class="anchor" href="#_external_log_visualization"></a><a class="link" href="#_external_log_visualization">25.7. External log visualization</a></h3>

</div>
</div>
</div>
<div class="sect1">
<h2 id="_tests"><a class="anchor" href="#_tests"></a><a class="link" href="#_tests">26. Tests</a></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_test_your_custom_cloud_services"><a class="anchor" href="#_test_your_custom_cloud_services"></a><a class="link" href="#_test_your_custom_cloud_services">26.1. Test your custom cloud services</a></h3>
<div class="sect3">
<h4 id="testing_utilities"><a class="anchor" href="#testing_utilities"></a><a class="link" href="#testing_utilities">26.1.1. Testing utilities provided by ZetaPush</a></h4>

</div>
<div class="sect3">
<h4 id="_unit_testing_2"><a class="anchor" href="#_unit_testing_2"></a><a class="link" href="#_unit_testing_2">26.1.2. Unit testing</a></h4>

</div>
<div class="sect3">
<h4 id="integration_testing"><a class="anchor" href="#integration_testing"></a><a class="link" href="#integration_testing">26.1.3. Integration testing</a></h4>
<div class="sect4">
<h5 id="tests_in_cloud"><a class="anchor" href="#tests_in_cloud"></a><a class="link" href="#tests_in_cloud">26.1.3.1. Integration testing on published worker</a></h5>

</div>
</div>
<div class="sect3">
<h4 id="e2e_testing"><a class="anchor" href="#e2e_testing"></a><a class="link" href="#e2e_testing">26.1.4. Test your application (end to end)</a></h4>

</div>
</div>
<div class="sect2">
<h3 id="test_in_typescript"><a class="anchor" href="#test_in_typescript"></a><a class="link" href="#test_in_typescript">26.2. Write tests in TypeScript</a></h3>

</div>
<div class="sect2">
<h3 id="advanced_mocks"><a class="anchor" href="#advanced_mocks"></a><a class="link" href="#advanced_mocks">26.3. Mocks</a></h3>

</div>
<div class="sect2">
<h3 id="test_snapshot"><a class="anchor" href="#test_snapshot"></a><a class="link" href="#test_snapshot">26.4. Initialize test with data</a></h3>

</div>
<div class="sect2">
<h3 id="_logs_in_tests"><a class="anchor" href="#_logs_in_tests"></a><a class="link" href="#_logs_in_tests">26.5. Logs in tests</a></h3>
<div class="sect3">
<h4 id="verbosity_level_in_tests"><a class="anchor" href="#verbosity_level_in_tests"></a><a class="link" href="#verbosity_level_in_tests">26.5.1. Verbosity level</a></h4>

</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_advanced_run_of_your_application"><a class="anchor" href="#_advanced_run_of_your_application"></a><a class="link" href="#_advanced_run_of_your_application">27. Advanced run of your application</a></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="run_worker_only"><a class="anchor" href="#run_worker_only"></a><a class="link" href="#run_worker_only">27.1. Run cloud services only</a></h3>

</div>
<div class="sect2">
<h3 id="_run_front_only"><a class="anchor" href="#_run_front_only"></a><a class="link" href="#_run_front_only">27.2. Run front only</a></h3>

</div>
</div>
</div>
<div class="sect1">
<h2 id="_advanced_deployment_of_your_application"><a class="anchor" href="#_advanced_deployment_of_your_application"></a><a class="link" href="#_advanced_deployment_of_your_application">28. Advanced deployment of your application</a></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="partial_deployment"><a class="anchor" href="#partial_deployment"></a><a class="link" href="#partial_deployment">28.1. Partial deployment</a></h3>

</div>
<div class="sect2">
<h3 id="_environment_variables"><a class="anchor" href="#_environment_variables"></a><a class="link" href="#_environment_variables">28.2. Environment variables</a></h3>

</div>
<div class="sect2">
<h3 id="_custom_npm_registry"><a class="anchor" href="#_custom_npm_registry"></a><a class="link" href="#_custom_npm_registry">28.3. Custom npm registry</a></h3>

</div>
</div>
</div>
<div class="sect1">
<h2 id="_http_server"><a class="anchor" href="#_http_server"></a><a class="link" href="#_http_server">29. HTTP server</a></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="internal_http_server"><a class="anchor" href="#internal_http_server"></a><a class="link" href="#internal_http_server">29.1. HTTP server provided by ZetaPush</a></h3>

</div>
<div class="sect2">
<h3 id="custom_http_server"><a class="anchor" href="#custom_http_server"></a><a class="link" href="#custom_http_server">29.2. Custom HTTP server</a></h3>

</div>
</div>
</div>
<div class="sect1">
<h2 id="_extend_a_cloud_service"><a class="anchor" href="#_extend_a_cloud_service"></a><a class="link" href="#_extend_a_cloud_service">30. Extend a cloud service</a></h2>
<div class="sectionbody">

</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2018-12-17 08:48:24 UTC
</div>
</div>
</body>
</html>